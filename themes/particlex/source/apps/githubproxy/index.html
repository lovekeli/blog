<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Github代理</title>
    <script src="tailwindcss.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#4080FF',
                        neutral: '#F5F7FA',
                        dark: '#1D2129',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
        function getPing(url, timeout = 5000) {
            return new Promise(resolve => {
                const start = performance.now();
                const img = new Image();

                // 添加随机查询参数，避免缓存
                img.src = `${url.replace(/\/+$/, '')}/favicon.ico?rand=${Math.random()}`;

                // 成功加载事件
                img.onload = () => {
                    cleanup();
                    const end = performance.now();
                    resolve(end - start);
                };

                // 错误事件
                img.onerror = () => {
                    cleanup();
                    // 即使加载失败，也能反映网络连接时间
                    const end = performance.now();
                    resolve(end - start);
                };

                // 超时处理
                const timeoutId = setTimeout(() => {
                    cleanup();
                    resolve(Infinity);
                }, timeout);

                // 清理函数
                function cleanup() {
                    img.onload = null;
                    img.onerror = null;
                    clearTimeout(timeoutId);
                    // 移除图像对象以释放资源
                    img.src = 'about:blank';
                }
            });
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .tab-active {
                @apply text-primary border-primary font-medium;
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-inter text-dark">
    <div class="container mx-auto px-4 py-12 max-w-4xl">
        <!-- 第一部分：标题 -->
        <div class="text-center mb-12">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-dark mb-3 tracking-tight">Github代理下载</h1>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto">支持GitHub （Git Clone、Releases、Archive、Gist、Raw）
                文件加速访问，提升下载体验。</p>
        </div>

        <!-- 第二部分：输入区域 -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-12 px-4">
            <div class="w-full md:w-1/3">
                <select id="resourceType"
                    class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-custom">
                </select>
            </div>
            <div class="w-full md:w-1/3 relative">
                <input type="text" id="resourceUrl" placeholder="输入资源地址"
                    class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 pl-10 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-custom">
                <i class="fa fa-link absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
            <div class="w-full md:w-1/3">
                <button id="fetchBtn"
                    class="w-full bg-primary hover:bg-primary/90 text-white font-medium rounded-lg px-6 py-3 flex items-center justify-center gap-2 transition-custom shadow-lg shadow-primary/20">
                    <i class="fa fa-download"></i>
                    <span>下载资源</span>
                </button>
            </div>
        </div>

        <!-- 第三部分：Tab 页面 -->
        <div class="bg-white rounded-xl shadow-xl overflow-hidden transition-custom hover:shadow-2xl">
            <!-- Tab 标签 -->
            <div class="flex border-b border-gray-200">
                <button class="tab-btn tab-active flex-1 py-4 px-6 text-center border-b-2 transition-custom"
                    data-tab="git">
                    <i class="fa fa-git mr-2"></i>Git
                </button>
                <button class="tab-btn flex-1 py-4 px-6 text-center border-b-2 border-transparent transition-custom"
                    data-tab="wget">
                    <i class="fa fa-terminal mr-2"></i>Wget&Curl
                </button>
                <button class="tab-btn flex-1 py-4 px-6 text-center border-b-2 border-transparent transition-custom"
                    data-tab="download">
                    <i class="fa fa-cloud-download mr-2"></i>Download
                </button>
            </div>

            <!-- Tab 内容 -->
            <div class="tab-content p-6">
                <!-- Git 标签页 -->
                <div id="git-tab" class="tab-pane active">
                    <h3 class="text-xl font-semibold mb-4 text-primary flex items-center">
                        <i class="fa fa-git-square mr-2"></i>Git 仓库操作
                    </h3>
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <p class="font-medium mb-2">操作示例：</p>
                        <pre id="gittip"
                            class="bg-dark text-white p-3 rounded-md overflow-x-auto text-sm font-mono">git clone https://github.com/username/repo.git</pre>
                    </div>

                </div>

                <!-- Wget 标签页 -->
                <div id="wget-tab" class="tab-pane hidden">
                    <h3 class="text-xl font-semibold mb-4 text-primary flex items-center">
                        <i class="fa fa-terminal mr-2"></i>Wget 下载
                    </h3>
                    <p class="text-gray-600 mb-6">使用 Wget 命令从远程服务器下载文件，支持断点续传和后台下载。</p>
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <p class="font-medium mb-2">操作示例：</p>
                        <pre id="wgettip"
                            class="bg-dark text-white p-3 rounded-md overflow-x-auto text-sm font-mono">wget -c -O filename.zip https://example.com/file.zip</pre>
                    </div>
                </div>

                <!-- Download 标签页 -->
                <div id="download-tab" class="tab-pane hidden">
                    <h3 class="text-xl font-semibold mb-4 text-primary flex items-center">
                        <i class="fa fa-cloud-download mr-2"></i>直接下载
                    </h3>
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <p class="font-medium mb-2">下载链接：</p>
                        <pre id="downtip"
                            class="bg-dark text-white p-3 rounded-md overflow-x-auto text-sm font-mono"> https://example.com/file.zip</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        // Tab 切换功能
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 移除所有激活状态
                tabBtns.forEach(b => b.classList.remove('tab-active'));
                tabPanes.forEach(p => p.classList.add('hidden'));
                tabPanes.forEach(p => p.classList.remove('active'));

                // 添加当前激活状态
                btn.classList.add('tab-active');
                const tabId = btn.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        const resourceType = document.getElementById('resourceType');
        const resourceUrl = document.getElementById('resourceUrl');
        const gittip = document.getElementById('gittip');
        const wgettip = document.getElementById('wgettip');
        const downtip = document.getElementById('downtip');
        const fetchBtn = document.getElementById('fetchBtn');
        gittip.innerText = "git clone https://github.com/hunshcn/project/archive/master.zip";
        wgettip.innerText = "wget https://github.com/hunshcn/project/archive/master.zip" + "\n" + "curl -O https://github.com/hunshcn/project/archive/master.zip";
        downtip.innerText = "https://github.com/hunshcn/project/archive/master.zip";
        fetch('./config.json').then(res => res.json()).then(async data => {
            for (let i = 0; i < data.length; i++) {
                let option = document.createElement('option');
                option.value = data[i].url;
                resourceType.appendChild(option);
                let ping=await getPing(data[i].url);
                if(ping === Infinity){
                    option.style.color='#b12a5b';
                    option.innerText=data[i].name+'(超时)';
                }else{
                    option.style.color='#96e6a1';
                    option.innerText=data[i].name+'('+Math.round(ping)+'ms)';
                }
                option.title=option.innerText;
            }
            resourceType.addEventListener('change', () => {
                let fileurl = resourceUrl.value;
                if (fileurl != '') {
                    if (fileurl.indexOf('https://') == -1) {
                        fileurl = 'https://' + fileurl;
                    }
                    let url = data[resourceType.selectedIndex].url + "/" + fileurl;
                    gittip.innerText = "git clone " + url;
                    wgettip.innerText = "wget " + url + "\n" + "curl -O " + url;
                    downtip.innerText = url;
                } else {
                    gittip.innerText = "git clone https://github.com/hunshcn/project/archive/master.zip";
                    wgettip.innerText = "wget https://github.com/hunshcn/project/archive/master.zip" + "\n" + "curl -O https://github.com/hunshcn/project/archive/master.zip";
                    downtip.innerText = "https://github.com/hunshcn/project/archive/master.zip";
                }
            });
            resourceUrl.addEventListener('input', () => {
                let fileurl = resourceUrl.value;
                if (fileurl != '') {
                    if (fileurl.indexOf('https://') == -1) {
                        fileurl = 'https://' + fileurl;
                    }
                    let url = data[resourceType.selectedIndex].url + "/" + fileurl;
                    gittip.innerText = "git clone " + url;
                    wgettip.innerText = "wget " + url + "\n" + "curl -O " + url;
                    downtip.innerText = url;
                } else {
                    gittip.innerText = "git clone https://github.com/hunshcn/project/archive/master.zip";
                    wgettip.innerText = "wget https://github.com/hunshcn/project/archive/master.zip" + "\n" + "curl -O https://github.com/hunshcn/project/archive/master.zip";
                    downtip.innerText = "https://github.com/hunshcn/project/archive/master.zip";
                }
            });
            fetchBtn.addEventListener('click', () => {
                let fileurl = resourceUrl.value;
                if (fileurl.indexOf('https://') == -1) {
                    fileurl = 'https://' + fileurl;
                }
                let url = data[resourceType.selectedIndex].url + "/" + fileurl;
                window.open(url, '_blank');
            });
        });

    </script>
</body>

</html>