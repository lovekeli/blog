var zE=Object.defineProperty;var jE=(t,e,r)=>e in t?zE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $e=(t,e,r)=>(jE(t,typeof e!="symbol"?e+"":e,r),r);function NE(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in t)){const h=Object.getOwnPropertyDescriptor(n,a);h&&Object.defineProperty(t,a,h.get?h:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var _g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function UE(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}),r}var Wr={exports:{}},tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u_=Symbol.for("react.element"),VE=Symbol.for("react.portal"),WE=Symbol.for("react.fragment"),GE=Symbol.for("react.strict_mode"),HE=Symbol.for("react.profiler"),KE=Symbol.for("react.provider"),XE=Symbol.for("react.context"),YE=Symbol.for("react.forward_ref"),qE=Symbol.for("react.suspense"),QE=Symbol.for("react.memo"),JE=Symbol.for("react.lazy"),k1=Symbol.iterator;function ZE(t){return t===null||typeof t!="object"?null:(t=k1&&t[k1]||t["@@iterator"],typeof t=="function"?t:null)}var $b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rb=Object.assign,Bb={};function pg(t,e,r){this.props=t,this.context=e,this.refs=Bb,this.updater=r||$b}pg.prototype.isReactComponent={};pg.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};pg.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function zb(){}zb.prototype=pg.prototype;function mw(t,e,r){this.props=t,this.context=e,this.refs=Bb,this.updater=r||$b}var gw=mw.prototype=new zb;gw.constructor=mw;Rb(gw,pg.prototype);gw.isPureReactComponent=!0;var I1=Array.isArray,jb=Object.prototype.hasOwnProperty,_w={current:null},Nb={key:!0,ref:!0,__self:!0,__source:!0};function Ub(t,e,r){var n,a={},h=null,x=null;if(e!=null)for(n in e.ref!==void 0&&(x=e.ref),e.key!==void 0&&(h=""+e.key),e)jb.call(e,n)&&!Nb.hasOwnProperty(n)&&(a[n]=e[n]);var f=arguments.length-2;if(f===1)a.children=r;else if(1<f){for(var s=Array(f),d=0;d<f;d++)s[d]=arguments[d+2];a.children=s}if(t&&t.defaultProps)for(n in f=t.defaultProps,f)a[n]===void 0&&(a[n]=f[n]);return{$$typeof:u_,type:t,key:h,ref:x,props:a,_owner:_w.current}}function eP(t,e){return{$$typeof:u_,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vw(t){return typeof t=="object"&&t!==null&&t.$$typeof===u_}function tP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var A1=/\/+/g;function yy(t,e){return typeof t=="object"&&t!==null&&t.key!=null?tP(""+t.key):e.toString(36)}function z_(t,e,r,n,a){var h=typeof t;(h==="undefined"||h==="boolean")&&(t=null);var x=!1;if(t===null)x=!0;else switch(h){case"string":case"number":x=!0;break;case"object":switch(t.$$typeof){case u_:case VE:x=!0}}if(x)return x=t,a=a(x),t=n===""?"."+yy(x,0):n,I1(a)?(r="",t!=null&&(r=t.replace(A1,"$&/")+"/"),z_(a,e,r,"",function(d){return d})):a!=null&&(vw(a)&&(a=eP(a,r+(!a.key||x&&x.key===a.key?"":(""+a.key).replace(A1,"$&/")+"/")+t)),e.push(a)),1;if(x=0,n=n===""?".":n+":",I1(t))for(var f=0;f<t.length;f++){h=t[f];var s=n+yy(h,f);x+=z_(h,e,r,s,a)}else if(s=ZE(t),typeof s=="function")for(t=s.call(t),f=0;!(h=t.next()).done;)h=h.value,s=n+yy(h,f++),x+=z_(h,e,r,s,a);else if(h==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return x}function g_(t,e,r){if(t==null)return t;var n=[],a=0;return z_(t,n,"","",function(h){return e.call(r,h,a++)}),n}function rP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ps={current:null},j_={transition:null},nP={ReactCurrentDispatcher:Ps,ReactCurrentBatchConfig:j_,ReactCurrentOwner:_w};function Vb(){throw Error("act(...) is not supported in production builds of React.")}tn.Children={map:g_,forEach:function(t,e,r){g_(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return g_(t,function(){e++}),e},toArray:function(t){return g_(t,function(e){return e})||[]},only:function(t){if(!vw(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};tn.Component=pg;tn.Fragment=WE;tn.Profiler=HE;tn.PureComponent=mw;tn.StrictMode=GE;tn.Suspense=qE;tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nP;tn.act=Vb;tn.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Rb({},t.props),a=t.key,h=t.ref,x=t._owner;if(e!=null){if(e.ref!==void 0&&(h=e.ref,x=_w.current),e.key!==void 0&&(a=""+e.key),t.type&&t.type.defaultProps)var f=t.type.defaultProps;for(s in e)jb.call(e,s)&&!Nb.hasOwnProperty(s)&&(n[s]=e[s]===void 0&&f!==void 0?f[s]:e[s])}var s=arguments.length-2;if(s===1)n.children=r;else if(1<s){f=Array(s);for(var d=0;d<s;d++)f[d]=arguments[d+2];n.children=f}return{$$typeof:u_,type:t.type,key:a,ref:h,props:n,_owner:x}};tn.createContext=function(t){return t={$$typeof:XE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:KE,_context:t},t.Consumer=t};tn.createElement=Ub;tn.createFactory=function(t){var e=Ub.bind(null,t);return e.type=t,e};tn.createRef=function(){return{current:null}};tn.forwardRef=function(t){return{$$typeof:YE,render:t}};tn.isValidElement=vw;tn.lazy=function(t){return{$$typeof:JE,_payload:{_status:-1,_result:t},_init:rP}};tn.memo=function(t,e){return{$$typeof:QE,type:t,compare:e===void 0?null:e}};tn.startTransition=function(t){var e=j_.transition;j_.transition={};try{t()}finally{j_.transition=e}};tn.unstable_act=Vb;tn.useCallback=function(t,e){return Ps.current.useCallback(t,e)};tn.useContext=function(t){return Ps.current.useContext(t)};tn.useDebugValue=function(){};tn.useDeferredValue=function(t){return Ps.current.useDeferredValue(t)};tn.useEffect=function(t,e){return Ps.current.useEffect(t,e)};tn.useId=function(){return Ps.current.useId()};tn.useImperativeHandle=function(t,e,r){return Ps.current.useImperativeHandle(t,e,r)};tn.useInsertionEffect=function(t,e){return Ps.current.useInsertionEffect(t,e)};tn.useLayoutEffect=function(t,e){return Ps.current.useLayoutEffect(t,e)};tn.useMemo=function(t,e){return Ps.current.useMemo(t,e)};tn.useReducer=function(t,e,r){return Ps.current.useReducer(t,e,r)};tn.useRef=function(t){return Ps.current.useRef(t)};tn.useState=function(t){return Ps.current.useState(t)};tn.useSyncExternalStore=function(t,e,r){return Ps.current.useSyncExternalStore(t,e,r)};tn.useTransition=function(){return Ps.current.useTransition()};tn.version="18.3.1";(function(t){t.exports=tn})(Wr);const Lp=pw(Wr.exports);var D1={},Wb={exports:{}},Po={},Gb={exports:{}},Hb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ve,K){var re=ve.length;ve.push(K);e:for(;0<re;){var X=re-1>>>1,N=ve[X];if(0<a(N,K))ve[X]=K,ve[re]=N,re=X;else break e}}function r(ve){return ve.length===0?null:ve[0]}function n(ve){if(ve.length===0)return null;var K=ve[0],re=ve.pop();if(re!==K){ve[0]=re;e:for(var X=0,N=ve.length,ae=N>>>1;X<ae;){var J=2*(X+1)-1,Y=ve[J],be=J+1,Ce=ve[be];if(0>a(Y,re))be<N&&0>a(Ce,Y)?(ve[X]=Ce,ve[be]=re,X=be):(ve[X]=Y,ve[J]=re,X=J);else if(be<N&&0>a(Ce,re))ve[X]=Ce,ve[be]=re,X=be;else break e}}return K}function a(ve,K){var re=ve.sortIndex-K.sortIndex;return re!==0?re:ve.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;t.unstable_now=function(){return h.now()}}else{var x=Date,f=x.now();t.unstable_now=function(){return x.now()-f}}var s=[],d=[],m=1,o=null,l=3,u=!1,p=!1,w=!1,_=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(ve){for(var K=r(d);K!==null;){if(K.callback===null)n(d);else if(K.startTime<=ve)n(d),K.sortIndex=K.expirationTime,e(s,K);else break;K=r(d)}}function C(ve){if(w=!1,T(ve),!p)if(r(s)!==null)p=!0,Me(P);else{var K=r(d);K!==null&&ke(C,K.startTime-ve)}}function P(ve,K){p=!1,w&&(w=!1,v(L),L=-1),u=!0;var re=l;try{for(T(K),o=r(s);o!==null&&(!(o.expirationTime>K)||ve&&!te());){var X=o.callback;if(typeof X=="function"){o.callback=null,l=o.priorityLevel;var N=X(o.expirationTime<=K);K=t.unstable_now(),typeof N=="function"?o.callback=N:o===r(s)&&n(s),T(K)}else n(s);o=r(s)}if(o!==null)var ae=!0;else{var J=r(d);J!==null&&ke(C,J.startTime-K),ae=!1}return ae}finally{o=null,l=re,u=!1}}var O=!1,D=null,L=-1,W=5,U=-1;function te(){return!(t.unstable_now()-U<W)}function pe(){if(D!==null){var ve=t.unstable_now();U=ve;var K=!0;try{K=D(!0,ve)}finally{K?ne():(O=!1,D=null)}}else O=!1}var ne;if(typeof y=="function")ne=function(){y(pe)};else if(typeof MessageChannel<"u"){var ye=new MessageChannel,ce=ye.port2;ye.port1.onmessage=pe,ne=function(){ce.postMessage(null)}}else ne=function(){_(pe,0)};function Me(ve){D=ve,O||(O=!0,ne())}function ke(ve,K){L=_(function(){ve(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ve){ve.callback=null},t.unstable_continueExecution=function(){p||u||(p=!0,Me(P))},t.unstable_forceFrameRate=function(ve){0>ve||125<ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<ve?Math.floor(1e3/ve):5},t.unstable_getCurrentPriorityLevel=function(){return l},t.unstable_getFirstCallbackNode=function(){return r(s)},t.unstable_next=function(ve){switch(l){case 1:case 2:case 3:var K=3;break;default:K=l}var re=l;l=K;try{return ve()}finally{l=re}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ve,K){switch(ve){case 1:case 2:case 3:case 4:case 5:break;default:ve=3}var re=l;l=ve;try{return K()}finally{l=re}},t.unstable_scheduleCallback=function(ve,K,re){var X=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?X+re:X):re=X,ve){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=re+N,ve={id:m++,callback:K,priorityLevel:ve,startTime:re,expirationTime:N,sortIndex:-1},re>X?(ve.sortIndex=re,e(d,ve),r(s)===null&&ve===r(d)&&(w?(v(L),L=-1):w=!0,ke(C,re-X))):(ve.sortIndex=N,e(s,ve),p||u||(p=!0,Me(P))),ve},t.unstable_shouldYield=te,t.unstable_wrapCallback=function(ve){var K=l;return function(){var re=l;l=K;try{return ve.apply(this,arguments)}finally{l=re}}}})(Hb);(function(t){t.exports=Hb})(Gb);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iP=Wr.exports,So=Gb.exports;function Ft(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kb=new Set,Vg={};function Wp(t,e){ng(t,e),ng(t+"Capture",e)}function ng(t,e){for(Vg[t]=e,t=0;t<e.length;t++)Kb.add(e[t])}var Yu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l0=Object.prototype.hasOwnProperty,sP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,F1={},L1={};function oP(t){return l0.call(L1,t)?!0:l0.call(F1,t)?!1:sP.test(t)?L1[t]=!0:(F1[t]=!0,!1)}function aP(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function lP(t,e,r,n){if(e===null||typeof e>"u"||aP(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Os(t,e,r,n,a,h,x){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=h,this.removeEmptyString=x}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Qi[t]=new Os(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Qi[e]=new Os(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Qi[t]=new Os(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Qi[t]=new Os(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Qi[t]=new Os(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Qi[t]=new Os(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Qi[t]=new Os(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Qi[t]=new Os(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Qi[t]=new Os(t,5,!1,t.toLowerCase(),null,!1,!1)});var yw=/[\-:]([a-z])/g;function ww(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(yw,ww);Qi[e]=new Os(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(yw,ww);Qi[e]=new Os(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(yw,ww);Qi[e]=new Os(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Qi[t]=new Os(t,1,!1,t.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Os("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Qi[t]=new Os(t,1,!1,t.toLowerCase(),null,!0,!0)});function xw(t,e,r,n){var a=Qi.hasOwnProperty(e)?Qi[e]:null;(a!==null?a.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(lP(e,r,a,n)&&(r=null),n||a===null?oP(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):a.mustUseProperty?t[a.propertyName]=r===null?a.type===3?!1:"":r:(e=a.attributeName,n=a.attributeNamespace,r===null?t.removeAttribute(e):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Zu=iP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,__=Symbol.for("react.element"),Rm=Symbol.for("react.portal"),Bm=Symbol.for("react.fragment"),bw=Symbol.for("react.strict_mode"),u0=Symbol.for("react.profiler"),Xb=Symbol.for("react.provider"),Yb=Symbol.for("react.context"),Mw=Symbol.for("react.forward_ref"),c0=Symbol.for("react.suspense"),d0=Symbol.for("react.suspense_list"),Tw=Symbol.for("react.memo"),tf=Symbol.for("react.lazy"),qb=Symbol.for("react.offscreen"),$1=Symbol.iterator;function vg(t){return t===null||typeof t!="object"?null:(t=$1&&t[$1]||t["@@iterator"],typeof t=="function"?t:null)}var Jn=Object.assign,wy;function Pg(t){if(wy===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);wy=e&&e[1]||""}return`
`+wy+t}var xy=!1;function by(t,e){if(!t||xy)return"";xy=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var n=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){n=d}t.call(e.prototype)}else{try{throw Error()}catch(d){n=d}t()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),h=n.stack.split(`
`),x=a.length-1,f=h.length-1;1<=x&&0<=f&&a[x]!==h[f];)f--;for(;1<=x&&0<=f;x--,f--)if(a[x]!==h[f]){if(x!==1||f!==1)do if(x--,f--,0>f||a[x]!==h[f]){var s=`
`+a[x].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=x&&0<=f);break}}}finally{xy=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Pg(t):""}function uP(t){switch(t.tag){case 5:return Pg(t.type);case 16:return Pg("Lazy");case 13:return Pg("Suspense");case 19:return Pg("SuspenseList");case 0:case 2:case 15:return t=by(t.type,!1),t;case 11:return t=by(t.type.render,!1),t;case 1:return t=by(t.type,!0),t;default:return""}}function f0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Bm:return"Fragment";case Rm:return"Portal";case u0:return"Profiler";case bw:return"StrictMode";case c0:return"Suspense";case d0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Yb:return(t.displayName||"Context")+".Consumer";case Xb:return(t._context.displayName||"Context")+".Provider";case Mw:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Tw:return e=t.displayName||null,e!==null?e:f0(t.type)||"Memo";case tf:e=t._payload,t=t._init;try{return f0(t(e))}catch{}}return null}function cP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return f0(e);case 8:return e===bw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function vf(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Qb(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dP(t){var e=Qb(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,h=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(x){n=""+x,h.call(this,x)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(x){n=""+x},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function v_(t){t._valueTracker||(t._valueTracker=dP(t))}function Jb(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=Qb(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function tv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function h0(t,e){var r=e.checked;return Jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:t._wrapperState.initialChecked})}function R1(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=vf(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Zb(t,e){e=e.checked,e!=null&&xw(t,"checked",e,!1)}function p0(t,e){Zb(t,e);var r=vf(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?m0(t,e.type,r):e.hasOwnProperty("defaultValue")&&m0(t,e.type,vf(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function B1(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function m0(t,e,r){(e!=="number"||tv(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Og=Array.isArray;function qm(t,e,r,n){if(t=t.options,e){e={};for(var a=0;a<r.length;a++)e["$"+r[a]]=!0;for(r=0;r<t.length;r++)a=e.hasOwnProperty("$"+t[r].value),t[r].selected!==a&&(t[r].selected=a),a&&n&&(t[r].defaultSelected=!0)}else{for(r=""+vf(r),e=null,a=0;a<t.length;a++){if(t[a].value===r){t[a].selected=!0,n&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function g0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ft(91));return Jn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function z1(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Ft(92));if(Og(r)){if(1<r.length)throw Error(Ft(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:vf(r)}}function eM(t,e){var r=vf(e.value),n=vf(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function j1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function tM(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?tM(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var y_,rM=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,a){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,a)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(y_=y_||document.createElement("div"),y_.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=y_.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Wg(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Dg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fP=["Webkit","ms","Moz","O"];Object.keys(Dg).forEach(function(t){fP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Dg[e]=Dg[t]})});function nM(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Dg.hasOwnProperty(t)&&Dg[t]?(""+e).trim():e+"px"}function iM(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=nM(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,a):t[r]=a}}var hP=Jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function v0(t,e){if(e){if(hP[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ft(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ft(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ft(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ft(62))}}function y0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w0=null;function Sw(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var x0=null,Qm=null,Jm=null;function N1(t){if(t=f_(t)){if(typeof x0!="function")throw Error(Ft(280));var e=t.stateNode;e&&(e=Vv(e),x0(t.stateNode,t.type,e))}}function sM(t){Qm?Jm?Jm.push(t):Jm=[t]:Qm=t}function oM(){if(Qm){var t=Qm,e=Jm;if(Jm=Qm=null,N1(t),e)for(t=0;t<e.length;t++)N1(e[t])}}function aM(t,e){return t(e)}function lM(){}var My=!1;function uM(t,e,r){if(My)return t(e,r);My=!0;try{return aM(t,e,r)}finally{My=!1,(Qm!==null||Jm!==null)&&(lM(),oM())}}function Gg(t,e){var r=t.stateNode;if(r===null)return null;var n=Vv(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Ft(231,e,typeof r));return r}var b0=!1;if(Yu)try{var yg={};Object.defineProperty(yg,"passive",{get:function(){b0=!0}}),window.addEventListener("test",yg,yg),window.removeEventListener("test",yg,yg)}catch{b0=!1}function pP(t,e,r,n,a,h,x,f,s){var d=Array.prototype.slice.call(arguments,3);try{e.apply(r,d)}catch(m){this.onError(m)}}var Fg=!1,rv=null,nv=!1,M0=null,mP={onError:function(t){Fg=!0,rv=t}};function gP(t,e,r,n,a,h,x,f,s){Fg=!1,rv=null,pP.apply(mP,arguments)}function _P(t,e,r,n,a,h,x,f,s){if(gP.apply(this,arguments),Fg){if(Fg){var d=rv;Fg=!1,rv=null}else throw Error(Ft(198));nv||(nv=!0,M0=d)}}function Gp(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function cM(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function U1(t){if(Gp(t)!==t)throw Error(Ft(188))}function vP(t){var e=t.alternate;if(!e){if(e=Gp(t),e===null)throw Error(Ft(188));return e!==t?null:t}for(var r=t,n=e;;){var a=r.return;if(a===null)break;var h=a.alternate;if(h===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===h.child){for(h=a.child;h;){if(h===r)return U1(a),t;if(h===n)return U1(a),e;h=h.sibling}throw Error(Ft(188))}if(r.return!==n.return)r=a,n=h;else{for(var x=!1,f=a.child;f;){if(f===r){x=!0,r=a,n=h;break}if(f===n){x=!0,n=a,r=h;break}f=f.sibling}if(!x){for(f=h.child;f;){if(f===r){x=!0,r=h,n=a;break}if(f===n){x=!0,n=h,r=a;break}f=f.sibling}if(!x)throw Error(Ft(189))}}if(r.alternate!==n)throw Error(Ft(190))}if(r.tag!==3)throw Error(Ft(188));return r.stateNode.current===r?t:e}function dM(t){return t=vP(t),t!==null?fM(t):null}function fM(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=fM(t);if(e!==null)return e;t=t.sibling}return null}var hM=So.unstable_scheduleCallback,V1=So.unstable_cancelCallback,yP=So.unstable_shouldYield,wP=So.unstable_requestPaint,fi=So.unstable_now,xP=So.unstable_getCurrentPriorityLevel,Cw=So.unstable_ImmediatePriority,pM=So.unstable_UserBlockingPriority,iv=So.unstable_NormalPriority,bP=So.unstable_LowPriority,mM=So.unstable_IdlePriority,zv=null,Bl=null;function MP(t){if(Bl&&typeof Bl.onCommitFiberRoot=="function")try{Bl.onCommitFiberRoot(zv,t,void 0,(t.current.flags&128)===128)}catch{}}var Ga=Math.clz32?Math.clz32:CP,TP=Math.log,SP=Math.LN2;function CP(t){return t>>>=0,t===0?32:31-(TP(t)/SP|0)|0}var w_=64,x_=4194304;function kg(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function sv(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,a=t.suspendedLanes,h=t.pingedLanes,x=r&268435455;if(x!==0){var f=x&~a;f!==0?n=kg(f):(h&=x,h!==0&&(n=kg(h)))}else x=r&~a,x!==0?n=kg(x):h!==0&&(n=kg(h));if(n===0)return 0;if(e!==0&&e!==n&&(e&a)===0&&(a=n&-n,h=e&-e,a>=h||a===16&&(h&4194240)!==0))return e;if((n&4)!==0&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Ga(e),a=1<<r,n|=t[r],e&=~a;return n}function EP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function PP(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,a=t.expirationTimes,h=t.pendingLanes;0<h;){var x=31-Ga(h),f=1<<x,s=a[x];s===-1?((f&r)===0||(f&n)!==0)&&(a[x]=EP(f,e)):s<=e&&(t.expiredLanes|=f),h&=~f}}function T0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function gM(){var t=w_;return w_<<=1,(w_&4194240)===0&&(w_=64),t}function Ty(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function c_(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ga(e),t[e]=r}function OP(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var a=31-Ga(r),h=1<<a;e[a]=0,n[a]=-1,t[a]=-1,r&=~h}}function Ew(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Ga(r),a=1<<n;a&e|t[n]&e&&(t[n]|=e),r&=~a}}var xn=0;function _M(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var vM,Pw,yM,wM,xM,S0=!1,b_=[],uf=null,cf=null,df=null,Hg=new Map,Kg=new Map,nf=[],kP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function W1(t,e){switch(t){case"focusin":case"focusout":uf=null;break;case"dragenter":case"dragleave":cf=null;break;case"mouseover":case"mouseout":df=null;break;case"pointerover":case"pointerout":Hg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kg.delete(e.pointerId)}}function wg(t,e,r,n,a,h){return t===null||t.nativeEvent!==h?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:h,targetContainers:[a]},e!==null&&(e=f_(e),e!==null&&Pw(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function IP(t,e,r,n,a){switch(e){case"focusin":return uf=wg(uf,t,e,r,n,a),!0;case"dragenter":return cf=wg(cf,t,e,r,n,a),!0;case"mouseover":return df=wg(df,t,e,r,n,a),!0;case"pointerover":var h=a.pointerId;return Hg.set(h,wg(Hg.get(h)||null,t,e,r,n,a)),!0;case"gotpointercapture":return h=a.pointerId,Kg.set(h,wg(Kg.get(h)||null,t,e,r,n,a)),!0}return!1}function bM(t){var e=Op(t.target);if(e!==null){var r=Gp(e);if(r!==null){if(e=r.tag,e===13){if(e=cM(r),e!==null){t.blockedOn=e,xM(t.priority,function(){yM(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function N_(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=C0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);w0=n,r.target.dispatchEvent(n),w0=null}else return e=f_(r),e!==null&&Pw(e),t.blockedOn=r,!1;e.shift()}return!0}function G1(t,e,r){N_(t)&&r.delete(e)}function AP(){S0=!1,uf!==null&&N_(uf)&&(uf=null),cf!==null&&N_(cf)&&(cf=null),df!==null&&N_(df)&&(df=null),Hg.forEach(G1),Kg.forEach(G1)}function xg(t,e){t.blockedOn===e&&(t.blockedOn=null,S0||(S0=!0,So.unstable_scheduleCallback(So.unstable_NormalPriority,AP)))}function Xg(t){function e(a){return xg(a,t)}if(0<b_.length){xg(b_[0],t);for(var r=1;r<b_.length;r++){var n=b_[r];n.blockedOn===t&&(n.blockedOn=null)}}for(uf!==null&&xg(uf,t),cf!==null&&xg(cf,t),df!==null&&xg(df,t),Hg.forEach(e),Kg.forEach(e),r=0;r<nf.length;r++)n=nf[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<nf.length&&(r=nf[0],r.blockedOn===null);)bM(r),r.blockedOn===null&&nf.shift()}var Zm=Zu.ReactCurrentBatchConfig,ov=!0;function DP(t,e,r,n){var a=xn,h=Zm.transition;Zm.transition=null;try{xn=1,Ow(t,e,r,n)}finally{xn=a,Zm.transition=h}}function FP(t,e,r,n){var a=xn,h=Zm.transition;Zm.transition=null;try{xn=4,Ow(t,e,r,n)}finally{xn=a,Zm.transition=h}}function Ow(t,e,r,n){if(ov){var a=C0(t,e,r,n);if(a===null)Fy(t,e,n,av,r),W1(t,n);else if(IP(a,t,e,r,n))n.stopPropagation();else if(W1(t,n),e&4&&-1<kP.indexOf(t)){for(;a!==null;){var h=f_(a);if(h!==null&&vM(h),h=C0(t,e,r,n),h===null&&Fy(t,e,n,av,r),h===a)break;a=h}a!==null&&n.stopPropagation()}else Fy(t,e,n,null,r)}}var av=null;function C0(t,e,r,n){if(av=null,t=Sw(n),t=Op(t),t!==null)if(e=Gp(t),e===null)t=null;else if(r=e.tag,r===13){if(t=cM(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return av=t,null}function MM(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xP()){case Cw:return 1;case pM:return 4;case iv:case bP:return 16;case mM:return 536870912;default:return 16}default:return 16}}var of=null,kw=null,U_=null;function TM(){if(U_)return U_;var t,e=kw,r=e.length,n,a="value"in of?of.value:of.textContent,h=a.length;for(t=0;t<r&&e[t]===a[t];t++);var x=r-t;for(n=1;n<=x&&e[r-n]===a[h-n];n++);return U_=a.slice(t,1<n?1-n:void 0)}function V_(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function M_(){return!0}function H1(){return!1}function Oo(t){function e(r,n,a,h,x){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=h,this.target=x,this.currentTarget=null;for(var f in t)t.hasOwnProperty(f)&&(r=t[f],this[f]=r?r(h):h[f]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?M_:H1,this.isPropagationStopped=H1,this}return Jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=M_)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=M_)},persist:function(){},isPersistent:M_}),e}var mg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Iw=Oo(mg),d_=Jn({},mg,{view:0,detail:0}),LP=Oo(d_),Sy,Cy,bg,jv=Jn({},d_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Aw,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==bg&&(bg&&t.type==="mousemove"?(Sy=t.screenX-bg.screenX,Cy=t.screenY-bg.screenY):Cy=Sy=0,bg=t),Sy)},movementY:function(t){return"movementY"in t?t.movementY:Cy}}),K1=Oo(jv),$P=Jn({},jv,{dataTransfer:0}),RP=Oo($P),BP=Jn({},d_,{relatedTarget:0}),Ey=Oo(BP),zP=Jn({},mg,{animationName:0,elapsedTime:0,pseudoElement:0}),jP=Oo(zP),NP=Jn({},mg,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),UP=Oo(NP),VP=Jn({},mg,{data:0}),X1=Oo(VP),WP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},GP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},HP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function KP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=HP[t])?!!e[t]:!1}function Aw(){return KP}var XP=Jn({},d_,{key:function(t){if(t.key){var e=WP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=V_(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?GP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Aw,charCode:function(t){return t.type==="keypress"?V_(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?V_(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),YP=Oo(XP),qP=Jn({},jv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Y1=Oo(qP),QP=Jn({},d_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Aw}),JP=Oo(QP),ZP=Jn({},mg,{propertyName:0,elapsedTime:0,pseudoElement:0}),e2=Oo(ZP),t2=Jn({},jv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),r2=Oo(t2),n2=[9,13,27,32],Dw=Yu&&"CompositionEvent"in window,Lg=null;Yu&&"documentMode"in document&&(Lg=document.documentMode);var i2=Yu&&"TextEvent"in window&&!Lg,SM=Yu&&(!Dw||Lg&&8<Lg&&11>=Lg),q1=String.fromCharCode(32),Q1=!1;function CM(t,e){switch(t){case"keyup":return n2.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function EM(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zm=!1;function s2(t,e){switch(t){case"compositionend":return EM(e);case"keypress":return e.which!==32?null:(Q1=!0,q1);case"textInput":return t=e.data,t===q1&&Q1?null:t;default:return null}}function o2(t,e){if(zm)return t==="compositionend"||!Dw&&CM(t,e)?(t=TM(),U_=kw=of=null,zm=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return SM&&e.locale!=="ko"?null:e.data;default:return null}}var a2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!a2[t.type]:e==="textarea"}function PM(t,e,r,n){sM(n),e=lv(e,"onChange"),0<e.length&&(r=new Iw("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var $g=null,Yg=null;function l2(t){zM(t,0)}function Nv(t){var e=Um(t);if(Jb(e))return t}function u2(t,e){if(t==="change")return e}var OM=!1;if(Yu){var Py;if(Yu){var Oy="oninput"in document;if(!Oy){var Z1=document.createElement("div");Z1.setAttribute("oninput","return;"),Oy=typeof Z1.oninput=="function"}Py=Oy}else Py=!1;OM=Py&&(!document.documentMode||9<document.documentMode)}function ex(){$g&&($g.detachEvent("onpropertychange",kM),Yg=$g=null)}function kM(t){if(t.propertyName==="value"&&Nv(Yg)){var e=[];PM(e,Yg,t,Sw(t)),uM(l2,e)}}function c2(t,e,r){t==="focusin"?(ex(),$g=e,Yg=r,$g.attachEvent("onpropertychange",kM)):t==="focusout"&&ex()}function d2(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nv(Yg)}function f2(t,e){if(t==="click")return Nv(e)}function h2(t,e){if(t==="input"||t==="change")return Nv(e)}function p2(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Xa=typeof Object.is=="function"?Object.is:p2;function qg(t,e){if(Xa(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!l0.call(e,a)||!Xa(t[a],e[a]))return!1}return!0}function tx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function rx(t,e){var r=tx(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=tx(r)}}function IM(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?IM(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function AM(){for(var t=window,e=tv();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=tv(t.document)}return e}function Fw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function m2(t){var e=AM(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&IM(r.ownerDocument.documentElement,r)){if(n!==null&&Fw(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var a=r.textContent.length,h=Math.min(n.start,a);n=n.end===void 0?h:Math.min(n.end,a),!t.extend&&h>n&&(a=n,n=h,h=a),a=rx(r,h);var x=rx(r,n);a&&x&&(t.rangeCount!==1||t.anchorNode!==a.node||t.anchorOffset!==a.offset||t.focusNode!==x.node||t.focusOffset!==x.offset)&&(e=e.createRange(),e.setStart(a.node,a.offset),t.removeAllRanges(),h>n?(t.addRange(e),t.extend(x.node,x.offset)):(e.setEnd(x.node,x.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var g2=Yu&&"documentMode"in document&&11>=document.documentMode,jm=null,E0=null,Rg=null,P0=!1;function nx(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;P0||jm==null||jm!==tv(n)||(n=jm,"selectionStart"in n&&Fw(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Rg&&qg(Rg,n)||(Rg=n,n=lv(E0,"onSelect"),0<n.length&&(e=new Iw("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=jm)))}function T_(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Nm={animationend:T_("Animation","AnimationEnd"),animationiteration:T_("Animation","AnimationIteration"),animationstart:T_("Animation","AnimationStart"),transitionend:T_("Transition","TransitionEnd")},ky={},DM={};Yu&&(DM=document.createElement("div").style,"AnimationEvent"in window||(delete Nm.animationend.animation,delete Nm.animationiteration.animation,delete Nm.animationstart.animation),"TransitionEvent"in window||delete Nm.transitionend.transition);function Uv(t){if(ky[t])return ky[t];if(!Nm[t])return t;var e=Nm[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in DM)return ky[t]=e[r];return t}var FM=Uv("animationend"),LM=Uv("animationiteration"),$M=Uv("animationstart"),RM=Uv("transitionend"),BM=new Map,ix="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xf(t,e){BM.set(t,e),Wp(e,[t])}for(var Iy=0;Iy<ix.length;Iy++){var Ay=ix[Iy],_2=Ay.toLowerCase(),v2=Ay[0].toUpperCase()+Ay.slice(1);xf(_2,"on"+v2)}xf(FM,"onAnimationEnd");xf(LM,"onAnimationIteration");xf($M,"onAnimationStart");xf("dblclick","onDoubleClick");xf("focusin","onFocus");xf("focusout","onBlur");xf(RM,"onTransitionEnd");ng("onMouseEnter",["mouseout","mouseover"]);ng("onMouseLeave",["mouseout","mouseover"]);ng("onPointerEnter",["pointerout","pointerover"]);ng("onPointerLeave",["pointerout","pointerover"]);Wp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wp("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ig="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),y2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ig));function sx(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,_P(n,e,void 0,t),t.currentTarget=null}function zM(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],a=n.event;n=n.listeners;e:{var h=void 0;if(e)for(var x=n.length-1;0<=x;x--){var f=n[x],s=f.instance,d=f.currentTarget;if(f=f.listener,s!==h&&a.isPropagationStopped())break e;sx(a,f,d),h=s}else for(x=0;x<n.length;x++){if(f=n[x],s=f.instance,d=f.currentTarget,f=f.listener,s!==h&&a.isPropagationStopped())break e;sx(a,f,d),h=s}}}if(nv)throw t=M0,nv=!1,M0=null,t}function Ln(t,e){var r=e[D0];r===void 0&&(r=e[D0]=new Set);var n=t+"__bubble";r.has(n)||(jM(e,t,2,!1),r.add(n))}function Dy(t,e,r){var n=0;e&&(n|=4),jM(r,t,n,e)}var S_="_reactListening"+Math.random().toString(36).slice(2);function Qg(t){if(!t[S_]){t[S_]=!0,Kb.forEach(function(r){r!=="selectionchange"&&(y2.has(r)||Dy(r,!1,t),Dy(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[S_]||(e[S_]=!0,Dy("selectionchange",!1,e))}}function jM(t,e,r,n){switch(MM(e)){case 1:var a=DP;break;case 4:a=FP;break;default:a=Ow}r=a.bind(null,e,r,t),a=void 0,!b0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),n?a!==void 0?t.addEventListener(e,r,{capture:!0,passive:a}):t.addEventListener(e,r,!0):a!==void 0?t.addEventListener(e,r,{passive:a}):t.addEventListener(e,r,!1)}function Fy(t,e,r,n,a){var h=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var x=n.tag;if(x===3||x===4){var f=n.stateNode.containerInfo;if(f===a||f.nodeType===8&&f.parentNode===a)break;if(x===4)for(x=n.return;x!==null;){var s=x.tag;if((s===3||s===4)&&(s=x.stateNode.containerInfo,s===a||s.nodeType===8&&s.parentNode===a))return;x=x.return}for(;f!==null;){if(x=Op(f),x===null)return;if(s=x.tag,s===5||s===6){n=h=x;continue e}f=f.parentNode}}n=n.return}uM(function(){var d=h,m=Sw(r),o=[];e:{var l=BM.get(t);if(l!==void 0){var u=Iw,p=t;switch(t){case"keypress":if(V_(r)===0)break e;case"keydown":case"keyup":u=YP;break;case"focusin":p="focus",u=Ey;break;case"focusout":p="blur",u=Ey;break;case"beforeblur":case"afterblur":u=Ey;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=K1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=RP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=JP;break;case FM:case LM:case $M:u=jP;break;case RM:u=e2;break;case"scroll":u=LP;break;case"wheel":u=r2;break;case"copy":case"cut":case"paste":u=UP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Y1}var w=(e&4)!==0,_=!w&&t==="scroll",v=w?l!==null?l+"Capture":null:l;w=[];for(var y=d,T;y!==null;){T=y;var C=T.stateNode;if(T.tag===5&&C!==null&&(T=C,v!==null&&(C=Gg(y,v),C!=null&&w.push(Jg(y,C,T)))),_)break;y=y.return}0<w.length&&(l=new u(l,p,null,r,m),o.push({event:l,listeners:w}))}}if((e&7)===0){e:{if(l=t==="mouseover"||t==="pointerover",u=t==="mouseout"||t==="pointerout",l&&r!==w0&&(p=r.relatedTarget||r.fromElement)&&(Op(p)||p[qu]))break e;if((u||l)&&(l=m.window===m?m:(l=m.ownerDocument)?l.defaultView||l.parentWindow:window,u?(p=r.relatedTarget||r.toElement,u=d,p=p?Op(p):null,p!==null&&(_=Gp(p),p!==_||p.tag!==5&&p.tag!==6)&&(p=null)):(u=null,p=d),u!==p)){if(w=K1,C="onMouseLeave",v="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(w=Y1,C="onPointerLeave",v="onPointerEnter",y="pointer"),_=u==null?l:Um(u),T=p==null?l:Um(p),l=new w(C,y+"leave",u,r,m),l.target=_,l.relatedTarget=T,C=null,Op(m)===d&&(w=new w(v,y+"enter",p,r,m),w.target=T,w.relatedTarget=_,C=w),_=C,u&&p)t:{for(w=u,v=p,y=0,T=w;T;T=Om(T))y++;for(T=0,C=v;C;C=Om(C))T++;for(;0<y-T;)w=Om(w),y--;for(;0<T-y;)v=Om(v),T--;for(;y--;){if(w===v||v!==null&&w===v.alternate)break t;w=Om(w),v=Om(v)}w=null}else w=null;u!==null&&ox(o,l,u,w,!1),p!==null&&_!==null&&ox(o,_,p,w,!0)}}e:{if(l=d?Um(d):window,u=l.nodeName&&l.nodeName.toLowerCase(),u==="select"||u==="input"&&l.type==="file")var P=u2;else if(J1(l))if(OM)P=h2;else{P=d2;var O=c2}else(u=l.nodeName)&&u.toLowerCase()==="input"&&(l.type==="checkbox"||l.type==="radio")&&(P=f2);if(P&&(P=P(t,d))){PM(o,P,r,m);break e}O&&O(t,l,d),t==="focusout"&&(O=l._wrapperState)&&O.controlled&&l.type==="number"&&m0(l,"number",l.value)}switch(O=d?Um(d):window,t){case"focusin":(J1(O)||O.contentEditable==="true")&&(jm=O,E0=d,Rg=null);break;case"focusout":Rg=E0=jm=null;break;case"mousedown":P0=!0;break;case"contextmenu":case"mouseup":case"dragend":P0=!1,nx(o,r,m);break;case"selectionchange":if(g2)break;case"keydown":case"keyup":nx(o,r,m)}var D;if(Dw)e:{switch(t){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else zm?CM(t,r)&&(L="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(L="onCompositionStart");L&&(SM&&r.locale!=="ko"&&(zm||L!=="onCompositionStart"?L==="onCompositionEnd"&&zm&&(D=TM()):(of=m,kw="value"in of?of.value:of.textContent,zm=!0)),O=lv(d,L),0<O.length&&(L=new X1(L,t,null,r,m),o.push({event:L,listeners:O}),D?L.data=D:(D=EM(r),D!==null&&(L.data=D)))),(D=i2?s2(t,r):o2(t,r))&&(d=lv(d,"onBeforeInput"),0<d.length&&(m=new X1("onBeforeInput","beforeinput",null,r,m),o.push({event:m,listeners:d}),m.data=D))}zM(o,e)})}function Jg(t,e,r){return{instance:t,listener:e,currentTarget:r}}function lv(t,e){for(var r=e+"Capture",n=[];t!==null;){var a=t,h=a.stateNode;a.tag===5&&h!==null&&(a=h,h=Gg(t,r),h!=null&&n.unshift(Jg(t,h,a)),h=Gg(t,e),h!=null&&n.push(Jg(t,h,a))),t=t.return}return n}function Om(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ox(t,e,r,n,a){for(var h=e._reactName,x=[];r!==null&&r!==n;){var f=r,s=f.alternate,d=f.stateNode;if(s!==null&&s===n)break;f.tag===5&&d!==null&&(f=d,a?(s=Gg(r,h),s!=null&&x.unshift(Jg(r,s,f))):a||(s=Gg(r,h),s!=null&&x.push(Jg(r,s,f)))),r=r.return}x.length!==0&&t.push({event:e,listeners:x})}var w2=/\r\n?/g,x2=/\u0000|\uFFFD/g;function ax(t){return(typeof t=="string"?t:""+t).replace(w2,`
`).replace(x2,"")}function C_(t,e,r){if(e=ax(e),ax(t)!==e&&r)throw Error(Ft(425))}function uv(){}var O0=null,k0=null;function I0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var A0=typeof setTimeout=="function"?setTimeout:void 0,b2=typeof clearTimeout=="function"?clearTimeout:void 0,lx=typeof Promise=="function"?Promise:void 0,M2=typeof queueMicrotask=="function"?queueMicrotask:typeof lx<"u"?function(t){return lx.resolve(null).then(t).catch(T2)}:A0;function T2(t){setTimeout(function(){throw t})}function Ly(t,e){var r=e,n=0;do{var a=r.nextSibling;if(t.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){t.removeChild(a),Xg(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);Xg(e)}function ff(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ux(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var gg=Math.random().toString(36).slice(2),Ll="__reactFiber$"+gg,Zg="__reactProps$"+gg,qu="__reactContainer$"+gg,D0="__reactEvents$"+gg,S2="__reactListeners$"+gg,C2="__reactHandles$"+gg;function Op(t){var e=t[Ll];if(e)return e;for(var r=t.parentNode;r;){if(e=r[qu]||r[Ll]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=ux(t);t!==null;){if(r=t[Ll])return r;t=ux(t)}return e}t=r,r=t.parentNode}return null}function f_(t){return t=t[Ll]||t[qu],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Um(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ft(33))}function Vv(t){return t[Zg]||null}var F0=[],Vm=-1;function bf(t){return{current:t}}function $n(t){0>Vm||(t.current=F0[Vm],F0[Vm]=null,Vm--)}function kn(t,e){Vm++,F0[Vm]=t.current,t.current=e}var yf={},us=bf(yf),to=bf(!1),$p=yf;function ig(t,e){var r=t.type.contextTypes;if(!r)return yf;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var a={},h;for(h in r)a[h]=e[h];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function ro(t){return t=t.childContextTypes,t!=null}function cv(){$n(to),$n(us)}function cx(t,e,r){if(us.current!==yf)throw Error(Ft(168));kn(us,e),kn(to,r)}function NM(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in e))throw Error(Ft(108,cP(t)||"Unknown",a));return Jn({},r,n)}function dv(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||yf,$p=us.current,kn(us,t),kn(to,to.current),!0}function dx(t,e,r){var n=t.stateNode;if(!n)throw Error(Ft(169));r?(t=NM(t,e,$p),n.__reactInternalMemoizedMergedChildContext=t,$n(to),$n(us),kn(us,t)):$n(to),kn(to,r)}var Wu=null,Wv=!1,$y=!1;function UM(t){Wu===null?Wu=[t]:Wu.push(t)}function E2(t){Wv=!0,UM(t)}function Mf(){if(!$y&&Wu!==null){$y=!0;var t=0,e=xn;try{var r=Wu;for(xn=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Wu=null,Wv=!1}catch(a){throw Wu!==null&&(Wu=Wu.slice(t+1)),hM(Cw,Mf),a}finally{xn=e,$y=!1}}return null}var Wm=[],Gm=0,fv=null,hv=0,Zo=[],ea=0,Rp=null,Gu=1,Hu="";function Sp(t,e){Wm[Gm++]=hv,Wm[Gm++]=fv,fv=t,hv=e}function VM(t,e,r){Zo[ea++]=Gu,Zo[ea++]=Hu,Zo[ea++]=Rp,Rp=t;var n=Gu;t=Hu;var a=32-Ga(n)-1;n&=~(1<<a),r+=1;var h=32-Ga(e)+a;if(30<h){var x=a-a%5;h=(n&(1<<x)-1).toString(32),n>>=x,a-=x,Gu=1<<32-Ga(e)+a|r<<a|n,Hu=h+t}else Gu=1<<h|r<<a|n,Hu=t}function Lw(t){t.return!==null&&(Sp(t,1),VM(t,1,0))}function $w(t){for(;t===fv;)fv=Wm[--Gm],Wm[Gm]=null,hv=Wm[--Gm],Wm[Gm]=null;for(;t===Rp;)Rp=Zo[--ea],Zo[ea]=null,Hu=Zo[--ea],Zo[ea]=null,Gu=Zo[--ea],Zo[ea]=null}var Mo=null,bo=null,jn=!1,Ua=null;function WM(t,e){var r=ra(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function fx(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Mo=t,bo=ff(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Mo=t,bo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Rp!==null?{id:Gu,overflow:Hu}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=ra(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Mo=t,bo=null,!0):!1;default:return!1}}function L0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function $0(t){if(jn){var e=bo;if(e){var r=e;if(!fx(t,e)){if(L0(t))throw Error(Ft(418));e=ff(r.nextSibling);var n=Mo;e&&fx(t,e)?WM(n,r):(t.flags=t.flags&-4097|2,jn=!1,Mo=t)}}else{if(L0(t))throw Error(Ft(418));t.flags=t.flags&-4097|2,jn=!1,Mo=t}}}function hx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Mo=t}function E_(t){if(t!==Mo)return!1;if(!jn)return hx(t),jn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!I0(t.type,t.memoizedProps)),e&&(e=bo)){if(L0(t))throw GM(),Error(Ft(418));for(;e;)WM(t,e),e=ff(e.nextSibling)}if(hx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ft(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){bo=ff(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}bo=null}}else bo=Mo?ff(t.stateNode.nextSibling):null;return!0}function GM(){for(var t=bo;t;)t=ff(t.nextSibling)}function sg(){bo=Mo=null,jn=!1}function Rw(t){Ua===null?Ua=[t]:Ua.push(t)}var P2=Zu.ReactCurrentBatchConfig;function Mg(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ft(309));var n=r.stateNode}if(!n)throw Error(Ft(147,t));var a=n,h=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===h?e.ref:(e=function(x){var f=a.refs;x===null?delete f[h]:f[h]=x},e._stringRef=h,e)}if(typeof t!="string")throw Error(Ft(284));if(!r._owner)throw Error(Ft(290,t))}return t}function P_(t,e){throw t=Object.prototype.toString.call(e),Error(Ft(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function px(t){var e=t._init;return e(t._payload)}function HM(t){function e(v,y){if(t){var T=v.deletions;T===null?(v.deletions=[y],v.flags|=16):T.push(y)}}function r(v,y){if(!t)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function n(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function a(v,y){return v=gf(v,y),v.index=0,v.sibling=null,v}function h(v,y,T){return v.index=T,t?(T=v.alternate,T!==null?(T=T.index,T<y?(v.flags|=2,y):T):(v.flags|=2,y)):(v.flags|=1048576,y)}function x(v){return t&&v.alternate===null&&(v.flags|=2),v}function f(v,y,T,C){return y===null||y.tag!==6?(y=Vy(T,v.mode,C),y.return=v,y):(y=a(y,T),y.return=v,y)}function s(v,y,T,C){var P=T.type;return P===Bm?m(v,y,T.props.children,C,T.key):y!==null&&(y.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===tf&&px(P)===y.type)?(C=a(y,T.props),C.ref=Mg(v,y,T),C.return=v,C):(C=q_(T.type,T.key,T.props,null,v.mode,C),C.ref=Mg(v,y,T),C.return=v,C)}function d(v,y,T,C){return y===null||y.tag!==4||y.stateNode.containerInfo!==T.containerInfo||y.stateNode.implementation!==T.implementation?(y=Wy(T,v.mode,C),y.return=v,y):(y=a(y,T.children||[]),y.return=v,y)}function m(v,y,T,C,P){return y===null||y.tag!==7?(y=Fp(T,v.mode,C,P),y.return=v,y):(y=a(y,T),y.return=v,y)}function o(v,y,T){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Vy(""+y,v.mode,T),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case __:return T=q_(y.type,y.key,y.props,null,v.mode,T),T.ref=Mg(v,null,y),T.return=v,T;case Rm:return y=Wy(y,v.mode,T),y.return=v,y;case tf:var C=y._init;return o(v,C(y._payload),T)}if(Og(y)||vg(y))return y=Fp(y,v.mode,T,null),y.return=v,y;P_(v,y)}return null}function l(v,y,T,C){var P=y!==null?y.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return P!==null?null:f(v,y,""+T,C);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case __:return T.key===P?s(v,y,T,C):null;case Rm:return T.key===P?d(v,y,T,C):null;case tf:return P=T._init,l(v,y,P(T._payload),C)}if(Og(T)||vg(T))return P!==null?null:m(v,y,T,C,null);P_(v,T)}return null}function u(v,y,T,C,P){if(typeof C=="string"&&C!==""||typeof C=="number")return v=v.get(T)||null,f(y,v,""+C,P);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case __:return v=v.get(C.key===null?T:C.key)||null,s(y,v,C,P);case Rm:return v=v.get(C.key===null?T:C.key)||null,d(y,v,C,P);case tf:var O=C._init;return u(v,y,T,O(C._payload),P)}if(Og(C)||vg(C))return v=v.get(T)||null,m(y,v,C,P,null);P_(y,C)}return null}function p(v,y,T,C){for(var P=null,O=null,D=y,L=y=0,W=null;D!==null&&L<T.length;L++){D.index>L?(W=D,D=null):W=D.sibling;var U=l(v,D,T[L],C);if(U===null){D===null&&(D=W);break}t&&D&&U.alternate===null&&e(v,D),y=h(U,y,L),O===null?P=U:O.sibling=U,O=U,D=W}if(L===T.length)return r(v,D),jn&&Sp(v,L),P;if(D===null){for(;L<T.length;L++)D=o(v,T[L],C),D!==null&&(y=h(D,y,L),O===null?P=D:O.sibling=D,O=D);return jn&&Sp(v,L),P}for(D=n(v,D);L<T.length;L++)W=u(D,v,L,T[L],C),W!==null&&(t&&W.alternate!==null&&D.delete(W.key===null?L:W.key),y=h(W,y,L),O===null?P=W:O.sibling=W,O=W);return t&&D.forEach(function(te){return e(v,te)}),jn&&Sp(v,L),P}function w(v,y,T,C){var P=vg(T);if(typeof P!="function")throw Error(Ft(150));if(T=P.call(T),T==null)throw Error(Ft(151));for(var O=P=null,D=y,L=y=0,W=null,U=T.next();D!==null&&!U.done;L++,U=T.next()){D.index>L?(W=D,D=null):W=D.sibling;var te=l(v,D,U.value,C);if(te===null){D===null&&(D=W);break}t&&D&&te.alternate===null&&e(v,D),y=h(te,y,L),O===null?P=te:O.sibling=te,O=te,D=W}if(U.done)return r(v,D),jn&&Sp(v,L),P;if(D===null){for(;!U.done;L++,U=T.next())U=o(v,U.value,C),U!==null&&(y=h(U,y,L),O===null?P=U:O.sibling=U,O=U);return jn&&Sp(v,L),P}for(D=n(v,D);!U.done;L++,U=T.next())U=u(D,v,L,U.value,C),U!==null&&(t&&U.alternate!==null&&D.delete(U.key===null?L:U.key),y=h(U,y,L),O===null?P=U:O.sibling=U,O=U);return t&&D.forEach(function(pe){return e(v,pe)}),jn&&Sp(v,L),P}function _(v,y,T,C){if(typeof T=="object"&&T!==null&&T.type===Bm&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case __:e:{for(var P=T.key,O=y;O!==null;){if(O.key===P){if(P=T.type,P===Bm){if(O.tag===7){r(v,O.sibling),y=a(O,T.props.children),y.return=v,v=y;break e}}else if(O.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===tf&&px(P)===O.type){r(v,O.sibling),y=a(O,T.props),y.ref=Mg(v,O,T),y.return=v,v=y;break e}r(v,O);break}else e(v,O);O=O.sibling}T.type===Bm?(y=Fp(T.props.children,v.mode,C,T.key),y.return=v,v=y):(C=q_(T.type,T.key,T.props,null,v.mode,C),C.ref=Mg(v,y,T),C.return=v,v=C)}return x(v);case Rm:e:{for(O=T.key;y!==null;){if(y.key===O)if(y.tag===4&&y.stateNode.containerInfo===T.containerInfo&&y.stateNode.implementation===T.implementation){r(v,y.sibling),y=a(y,T.children||[]),y.return=v,v=y;break e}else{r(v,y);break}else e(v,y);y=y.sibling}y=Wy(T,v.mode,C),y.return=v,v=y}return x(v);case tf:return O=T._init,_(v,y,O(T._payload),C)}if(Og(T))return p(v,y,T,C);if(vg(T))return w(v,y,T,C);P_(v,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,y!==null&&y.tag===6?(r(v,y.sibling),y=a(y,T),y.return=v,v=y):(r(v,y),y=Vy(T,v.mode,C),y.return=v,v=y),x(v)):r(v,y)}return _}var og=HM(!0),KM=HM(!1),pv=bf(null),mv=null,Hm=null,Bw=null;function zw(){Bw=Hm=mv=null}function jw(t){var e=pv.current;$n(pv),t._currentValue=e}function R0(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function eg(t,e){mv=t,Bw=Hm=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(eo=!0),t.firstContext=null)}function ia(t){var e=t._currentValue;if(Bw!==t)if(t={context:t,memoizedValue:e,next:null},Hm===null){if(mv===null)throw Error(Ft(308));Hm=t,mv.dependencies={lanes:0,firstContext:t}}else Hm=Hm.next=t;return e}var kp=null;function Nw(t){kp===null?kp=[t]:kp.push(t)}function XM(t,e,r,n){var a=e.interleaved;return a===null?(r.next=r,Nw(e)):(r.next=a.next,a.next=r),e.interleaved=r,Qu(t,n)}function Qu(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var rf=!1;function Uw(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YM(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ku(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function hf(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(hn&2)!==0){var a=n.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),n.pending=e,Qu(t,r)}return a=n.interleaved,a===null?(e.next=e,Nw(n)):(e.next=a.next,a.next=e),n.interleaved=e,Qu(t,r)}function W_(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Ew(t,r)}}function mx(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,h=null;if(r=r.firstBaseUpdate,r!==null){do{var x={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};h===null?a=h=x:h=h.next=x,r=r.next}while(r!==null);h===null?a=h=e:h=h.next=e}else a=h=e;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:h,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function gv(t,e,r,n){var a=t.updateQueue;rf=!1;var h=a.firstBaseUpdate,x=a.lastBaseUpdate,f=a.shared.pending;if(f!==null){a.shared.pending=null;var s=f,d=s.next;s.next=null,x===null?h=d:x.next=d,x=s;var m=t.alternate;m!==null&&(m=m.updateQueue,f=m.lastBaseUpdate,f!==x&&(f===null?m.firstBaseUpdate=d:f.next=d,m.lastBaseUpdate=s))}if(h!==null){var o=a.baseState;x=0,m=d=s=null,f=h;do{var l=f.lane,u=f.eventTime;if((n&l)===l){m!==null&&(m=m.next={eventTime:u,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});e:{var p=t,w=f;switch(l=e,u=r,w.tag){case 1:if(p=w.payload,typeof p=="function"){o=p.call(u,o,l);break e}o=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=w.payload,l=typeof p=="function"?p.call(u,o,l):p,l==null)break e;o=Jn({},o,l);break e;case 2:rf=!0}}f.callback!==null&&f.lane!==0&&(t.flags|=64,l=a.effects,l===null?a.effects=[f]:l.push(f))}else u={eventTime:u,lane:l,tag:f.tag,payload:f.payload,callback:f.callback,next:null},m===null?(d=m=u,s=o):m=m.next=u,x|=l;if(f=f.next,f===null){if(f=a.shared.pending,f===null)break;l=f,f=l.next,l.next=null,a.lastBaseUpdate=l,a.shared.pending=null}}while(1);if(m===null&&(s=o),a.baseState=s,a.firstBaseUpdate=d,a.lastBaseUpdate=m,e=a.shared.interleaved,e!==null){a=e;do x|=a.lane,a=a.next;while(a!==e)}else h===null&&(a.shared.lanes=0);zp|=x,t.lanes=x,t.memoizedState=o}}function gx(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Ft(191,a));a.call(n)}}}var h_={},zl=bf(h_),e_=bf(h_),t_=bf(h_);function Ip(t){if(t===h_)throw Error(Ft(174));return t}function Vw(t,e){switch(kn(t_,e),kn(e_,t),kn(zl,h_),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=_0(e,t)}$n(zl),kn(zl,e)}function ag(){$n(zl),$n(e_),$n(t_)}function qM(t){Ip(t_.current);var e=Ip(zl.current),r=_0(e,t.type);e!==r&&(kn(e_,t),kn(zl,r))}function Ww(t){e_.current===t&&($n(zl),$n(e_))}var qn=bf(0);function _v(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ry=[];function Gw(){for(var t=0;t<Ry.length;t++)Ry[t]._workInProgressVersionPrimary=null;Ry.length=0}var G_=Zu.ReactCurrentDispatcher,By=Zu.ReactCurrentBatchConfig,Bp=0,Qn=null,Pi=null,Bi=null,vv=!1,Bg=!1,r_=0,O2=0;function ss(){throw Error(Ft(321))}function Hw(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Xa(t[r],e[r]))return!1;return!0}function Kw(t,e,r,n,a,h){if(Bp=h,Qn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,G_.current=t===null||t.memoizedState===null?D2:F2,t=r(n,a),Bg){h=0;do{if(Bg=!1,r_=0,25<=h)throw Error(Ft(301));h+=1,Bi=Pi=null,e.updateQueue=null,G_.current=L2,t=r(n,a)}while(Bg)}if(G_.current=yv,e=Pi!==null&&Pi.next!==null,Bp=0,Bi=Pi=Qn=null,vv=!1,e)throw Error(Ft(300));return t}function Xw(){var t=r_!==0;return r_=0,t}function Fl(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bi===null?Qn.memoizedState=Bi=t:Bi=Bi.next=t,Bi}function sa(){if(Pi===null){var t=Qn.alternate;t=t!==null?t.memoizedState:null}else t=Pi.next;var e=Bi===null?Qn.memoizedState:Bi.next;if(e!==null)Bi=e,Pi=t;else{if(t===null)throw Error(Ft(310));Pi=t,t={memoizedState:Pi.memoizedState,baseState:Pi.baseState,baseQueue:Pi.baseQueue,queue:Pi.queue,next:null},Bi===null?Qn.memoizedState=Bi=t:Bi=Bi.next=t}return Bi}function n_(t,e){return typeof e=="function"?e(t):e}function zy(t){var e=sa(),r=e.queue;if(r===null)throw Error(Ft(311));r.lastRenderedReducer=t;var n=Pi,a=n.baseQueue,h=r.pending;if(h!==null){if(a!==null){var x=a.next;a.next=h.next,h.next=x}n.baseQueue=a=h,r.pending=null}if(a!==null){h=a.next,n=n.baseState;var f=x=null,s=null,d=h;do{var m=d.lane;if((Bp&m)===m)s!==null&&(s=s.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:t(n,d.action);else{var o={lane:m,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};s===null?(f=s=o,x=n):s=s.next=o,Qn.lanes|=m,zp|=m}d=d.next}while(d!==null&&d!==h);s===null?x=n:s.next=f,Xa(n,e.memoizedState)||(eo=!0),e.memoizedState=n,e.baseState=x,e.baseQueue=s,r.lastRenderedState=n}if(t=r.interleaved,t!==null){a=t;do h=a.lane,Qn.lanes|=h,zp|=h,a=a.next;while(a!==t)}else a===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function jy(t){var e=sa(),r=e.queue;if(r===null)throw Error(Ft(311));r.lastRenderedReducer=t;var n=r.dispatch,a=r.pending,h=e.memoizedState;if(a!==null){r.pending=null;var x=a=a.next;do h=t(h,x.action),x=x.next;while(x!==a);Xa(h,e.memoizedState)||(eo=!0),e.memoizedState=h,e.baseQueue===null&&(e.baseState=h),r.lastRenderedState=h}return[h,n]}function QM(){}function JM(t,e){var r=Qn,n=sa(),a=e(),h=!Xa(n.memoizedState,a);if(h&&(n.memoizedState=a,eo=!0),n=n.queue,Yw(tT.bind(null,r,n,t),[t]),n.getSnapshot!==e||h||Bi!==null&&Bi.memoizedState.tag&1){if(r.flags|=2048,i_(9,eT.bind(null,r,n,a,e),void 0,null),zi===null)throw Error(Ft(349));(Bp&30)!==0||ZM(r,e,a)}return a}function ZM(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Qn.updateQueue,e===null?(e={lastEffect:null,stores:null},Qn.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function eT(t,e,r,n){e.value=r,e.getSnapshot=n,rT(e)&&nT(t)}function tT(t,e,r){return r(function(){rT(e)&&nT(t)})}function rT(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Xa(t,r)}catch{return!0}}function nT(t){var e=Qu(t,1);e!==null&&Ha(e,t,1,-1)}function _x(t){var e=Fl();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n_,lastRenderedState:t},e.queue=t,t=t.dispatch=A2.bind(null,Qn,t),[e.memoizedState,t]}function i_(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Qn.updateQueue,e===null?(e={lastEffect:null,stores:null},Qn.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function iT(){return sa().memoizedState}function H_(t,e,r,n){var a=Fl();Qn.flags|=t,a.memoizedState=i_(1|e,r,void 0,n===void 0?null:n)}function Gv(t,e,r,n){var a=sa();n=n===void 0?null:n;var h=void 0;if(Pi!==null){var x=Pi.memoizedState;if(h=x.destroy,n!==null&&Hw(n,x.deps)){a.memoizedState=i_(e,r,h,n);return}}Qn.flags|=t,a.memoizedState=i_(1|e,r,h,n)}function vx(t,e){return H_(8390656,8,t,e)}function Yw(t,e){return Gv(2048,8,t,e)}function sT(t,e){return Gv(4,2,t,e)}function oT(t,e){return Gv(4,4,t,e)}function aT(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function lT(t,e,r){return r=r!=null?r.concat([t]):null,Gv(4,4,aT.bind(null,e,t),r)}function qw(){}function uT(t,e){var r=sa();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&Hw(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function cT(t,e){var r=sa();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&Hw(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function dT(t,e,r){return(Bp&21)===0?(t.baseState&&(t.baseState=!1,eo=!0),t.memoizedState=r):(Xa(r,e)||(r=gM(),Qn.lanes|=r,zp|=r,t.baseState=!0),e)}function k2(t,e){var r=xn;xn=r!==0&&4>r?r:4,t(!0);var n=By.transition;By.transition={};try{t(!1),e()}finally{xn=r,By.transition=n}}function fT(){return sa().memoizedState}function I2(t,e,r){var n=mf(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},hT(t))pT(e,r);else if(r=XM(t,e,r,n),r!==null){var a=Es();Ha(r,t,n,a),mT(r,e,n)}}function A2(t,e,r){var n=mf(t),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(hT(t))pT(e,a);else{var h=t.alternate;if(t.lanes===0&&(h===null||h.lanes===0)&&(h=e.lastRenderedReducer,h!==null))try{var x=e.lastRenderedState,f=h(x,r);if(a.hasEagerState=!0,a.eagerState=f,Xa(f,x)){var s=e.interleaved;s===null?(a.next=a,Nw(e)):(a.next=s.next,s.next=a),e.interleaved=a;return}}catch{}finally{}r=XM(t,e,a,n),r!==null&&(a=Es(),Ha(r,t,n,a),mT(r,e,n))}}function hT(t){var e=t.alternate;return t===Qn||e!==null&&e===Qn}function pT(t,e){Bg=vv=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function mT(t,e,r){if((r&4194240)!==0){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Ew(t,r)}}var yv={readContext:ia,useCallback:ss,useContext:ss,useEffect:ss,useImperativeHandle:ss,useInsertionEffect:ss,useLayoutEffect:ss,useMemo:ss,useReducer:ss,useRef:ss,useState:ss,useDebugValue:ss,useDeferredValue:ss,useTransition:ss,useMutableSource:ss,useSyncExternalStore:ss,useId:ss,unstable_isNewReconciler:!1},D2={readContext:ia,useCallback:function(t,e){return Fl().memoizedState=[t,e===void 0?null:e],t},useContext:ia,useEffect:vx,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,H_(4194308,4,aT.bind(null,e,t),r)},useLayoutEffect:function(t,e){return H_(4194308,4,t,e)},useInsertionEffect:function(t,e){return H_(4,2,t,e)},useMemo:function(t,e){var r=Fl();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Fl();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=I2.bind(null,Qn,t),[n.memoizedState,t]},useRef:function(t){var e=Fl();return t={current:t},e.memoizedState=t},useState:_x,useDebugValue:qw,useDeferredValue:function(t){return Fl().memoizedState=t},useTransition:function(){var t=_x(!1),e=t[0];return t=k2.bind(null,t[1]),Fl().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Qn,a=Fl();if(jn){if(r===void 0)throw Error(Ft(407));r=r()}else{if(r=e(),zi===null)throw Error(Ft(349));(Bp&30)!==0||ZM(n,e,r)}a.memoizedState=r;var h={value:r,getSnapshot:e};return a.queue=h,vx(tT.bind(null,n,h,t),[t]),n.flags|=2048,i_(9,eT.bind(null,n,h,r,e),void 0,null),r},useId:function(){var t=Fl(),e=zi.identifierPrefix;if(jn){var r=Hu,n=Gu;r=(n&~(1<<32-Ga(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=r_++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=O2++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},F2={readContext:ia,useCallback:uT,useContext:ia,useEffect:Yw,useImperativeHandle:lT,useInsertionEffect:sT,useLayoutEffect:oT,useMemo:cT,useReducer:zy,useRef:iT,useState:function(){return zy(n_)},useDebugValue:qw,useDeferredValue:function(t){var e=sa();return dT(e,Pi.memoizedState,t)},useTransition:function(){var t=zy(n_)[0],e=sa().memoizedState;return[t,e]},useMutableSource:QM,useSyncExternalStore:JM,useId:fT,unstable_isNewReconciler:!1},L2={readContext:ia,useCallback:uT,useContext:ia,useEffect:Yw,useImperativeHandle:lT,useInsertionEffect:sT,useLayoutEffect:oT,useMemo:cT,useReducer:jy,useRef:iT,useState:function(){return jy(n_)},useDebugValue:qw,useDeferredValue:function(t){var e=sa();return Pi===null?e.memoizedState=t:dT(e,Pi.memoizedState,t)},useTransition:function(){var t=jy(n_)[0],e=sa().memoizedState;return[t,e]},useMutableSource:QM,useSyncExternalStore:JM,useId:fT,unstable_isNewReconciler:!1};function ja(t,e){if(t&&t.defaultProps){e=Jn({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function B0(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Jn({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Hv={isMounted:function(t){return(t=t._reactInternals)?Gp(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=Es(),a=mf(t),h=Ku(n,a);h.payload=e,r!=null&&(h.callback=r),e=hf(t,h,a),e!==null&&(Ha(e,t,a,n),W_(e,t,a))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=Es(),a=mf(t),h=Ku(n,a);h.tag=1,h.payload=e,r!=null&&(h.callback=r),e=hf(t,h,a),e!==null&&(Ha(e,t,a,n),W_(e,t,a))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Es(),n=mf(t),a=Ku(r,n);a.tag=2,e!=null&&(a.callback=e),e=hf(t,a,n),e!==null&&(Ha(e,t,n,r),W_(e,t,n))}};function yx(t,e,r,n,a,h,x){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,h,x):e.prototype&&e.prototype.isPureReactComponent?!qg(r,n)||!qg(a,h):!0}function gT(t,e,r){var n=!1,a=yf,h=e.contextType;return typeof h=="object"&&h!==null?h=ia(h):(a=ro(e)?$p:us.current,n=e.contextTypes,h=(n=n!=null)?ig(t,a):yf),e=new e(r,h),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Hv,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=h),e}function wx(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&Hv.enqueueReplaceState(e,e.state,null)}function z0(t,e,r,n){var a=t.stateNode;a.props=r,a.state=t.memoizedState,a.refs={},Uw(t);var h=e.contextType;typeof h=="object"&&h!==null?a.context=ia(h):(h=ro(e)?$p:us.current,a.context=ig(t,h)),a.state=t.memoizedState,h=e.getDerivedStateFromProps,typeof h=="function"&&(B0(t,e,h,r),a.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(e=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),e!==a.state&&Hv.enqueueReplaceState(a,a.state,null),gv(t,r,a,n),a.state=t.memoizedState),typeof a.componentDidMount=="function"&&(t.flags|=4194308)}function lg(t,e){try{var r="",n=e;do r+=uP(n),n=n.return;while(n);var a=r}catch(h){a=`
Error generating stack: `+h.message+`
`+h.stack}return{value:t,source:e,stack:a,digest:null}}function Ny(t,e,r){return{value:t,source:null,stack:r!=null?r:null,digest:e!=null?e:null}}function j0(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var $2=typeof WeakMap=="function"?WeakMap:Map;function _T(t,e,r){r=Ku(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){xv||(xv=!0,q0=n),j0(t,e)},r}function vT(t,e,r){r=Ku(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var a=e.value;r.payload=function(){return n(a)},r.callback=function(){j0(t,e)}}var h=t.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(r.callback=function(){j0(t,e),typeof n!="function"&&(pf===null?pf=new Set([this]):pf.add(this));var x=e.stack;this.componentDidCatch(e.value,{componentStack:x!==null?x:""})}),r}function xx(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new $2;var a=new Set;n.set(e,a)}else a=n.get(e),a===void 0&&(a=new Set,n.set(e,a));a.has(r)||(a.add(r),t=q2.bind(null,t,e,r),e.then(t,t))}function bx(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Mx(t,e,r,n,a){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Ku(-1,1),e.tag=2,hf(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=a,t)}var R2=Zu.ReactCurrentOwner,eo=!1;function Cs(t,e,r,n){e.child=t===null?KM(e,null,r,n):og(e,t.child,r,n)}function Tx(t,e,r,n,a){r=r.render;var h=e.ref;return eg(e,a),n=Kw(t,e,r,n,h,a),r=Xw(),t!==null&&!eo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,Ju(t,e,a)):(jn&&r&&Lw(e),e.flags|=1,Cs(t,e,n,a),e.child)}function Sx(t,e,r,n,a){if(t===null){var h=r.type;return typeof h=="function"&&!i1(h)&&h.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=h,yT(t,e,h,n,a)):(t=q_(r.type,null,n,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(h=t.child,(t.lanes&a)===0){var x=h.memoizedProps;if(r=r.compare,r=r!==null?r:qg,r(x,n)&&t.ref===e.ref)return Ju(t,e,a)}return e.flags|=1,t=gf(h,n),t.ref=e.ref,t.return=e,e.child=t}function yT(t,e,r,n,a){if(t!==null){var h=t.memoizedProps;if(qg(h,n)&&t.ref===e.ref)if(eo=!1,e.pendingProps=n=h,(t.lanes&a)!==0)(t.flags&131072)!==0&&(eo=!0);else return e.lanes=t.lanes,Ju(t,e,a)}return N0(t,e,r,n,a)}function wT(t,e,r){var n=e.pendingProps,a=n.children,h=t!==null?t.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kn(Xm,wo),wo|=r;else{if((r&1073741824)===0)return t=h!==null?h.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,kn(Xm,wo),wo|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=h!==null?h.baseLanes:r,kn(Xm,wo),wo|=n}else h!==null?(n=h.baseLanes|r,e.memoizedState=null):n=r,kn(Xm,wo),wo|=n;return Cs(t,e,a,r),e.child}function xT(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function N0(t,e,r,n,a){var h=ro(r)?$p:us.current;return h=ig(e,h),eg(e,a),r=Kw(t,e,r,n,h,a),n=Xw(),t!==null&&!eo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,Ju(t,e,a)):(jn&&n&&Lw(e),e.flags|=1,Cs(t,e,r,a),e.child)}function Cx(t,e,r,n,a){if(ro(r)){var h=!0;dv(e)}else h=!1;if(eg(e,a),e.stateNode===null)K_(t,e),gT(e,r,n),z0(e,r,n,a),n=!0;else if(t===null){var x=e.stateNode,f=e.memoizedProps;x.props=f;var s=x.context,d=r.contextType;typeof d=="object"&&d!==null?d=ia(d):(d=ro(r)?$p:us.current,d=ig(e,d));var m=r.getDerivedStateFromProps,o=typeof m=="function"||typeof x.getSnapshotBeforeUpdate=="function";o||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(f!==n||s!==d)&&wx(e,x,n,d),rf=!1;var l=e.memoizedState;x.state=l,gv(e,n,x,a),s=e.memoizedState,f!==n||l!==s||to.current||rf?(typeof m=="function"&&(B0(e,r,m,n),s=e.memoizedState),(f=rf||yx(e,r,f,n,l,s,d))?(o||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(e.flags|=4194308)):(typeof x.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=s),x.props=n,x.state=s,x.context=d,n=f):(typeof x.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{x=e.stateNode,YM(t,e),f=e.memoizedProps,d=e.type===e.elementType?f:ja(e.type,f),x.props=d,o=e.pendingProps,l=x.context,s=r.contextType,typeof s=="object"&&s!==null?s=ia(s):(s=ro(r)?$p:us.current,s=ig(e,s));var u=r.getDerivedStateFromProps;(m=typeof u=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(f!==o||l!==s)&&wx(e,x,n,s),rf=!1,l=e.memoizedState,x.state=l,gv(e,n,x,a);var p=e.memoizedState;f!==o||l!==p||to.current||rf?(typeof u=="function"&&(B0(e,r,u,n),p=e.memoizedState),(d=rf||yx(e,r,d,n,l,p,s)||!1)?(m||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(n,p,s),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(n,p,s)),typeof x.componentDidUpdate=="function"&&(e.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof x.componentDidUpdate!="function"||f===t.memoizedProps&&l===t.memoizedState||(e.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&l===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),x.props=n,x.state=p,x.context=s,n=d):(typeof x.componentDidUpdate!="function"||f===t.memoizedProps&&l===t.memoizedState||(e.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&l===t.memoizedState||(e.flags|=1024),n=!1)}return U0(t,e,r,n,h,a)}function U0(t,e,r,n,a,h){xT(t,e);var x=(e.flags&128)!==0;if(!n&&!x)return a&&dx(e,r,!1),Ju(t,e,h);n=e.stateNode,R2.current=e;var f=x&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&x?(e.child=og(e,t.child,null,h),e.child=og(e,null,f,h)):Cs(t,e,f,h),e.memoizedState=n.state,a&&dx(e,r,!0),e.child}function bT(t){var e=t.stateNode;e.pendingContext?cx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&cx(t,e.context,!1),Vw(t,e.containerInfo)}function Ex(t,e,r,n,a){return sg(),Rw(a),e.flags|=256,Cs(t,e,r,n),e.child}var V0={dehydrated:null,treeContext:null,retryLane:0};function W0(t){return{baseLanes:t,cachePool:null,transitions:null}}function MT(t,e,r){var n=e.pendingProps,a=qn.current,h=!1,x=(e.flags&128)!==0,f;if((f=x)||(f=t!==null&&t.memoizedState===null?!1:(a&2)!==0),f?(h=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(a|=1),kn(qn,a&1),t===null)return $0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(x=n.children,t=n.fallback,h?(n=e.mode,h=e.child,x={mode:"hidden",children:x},(n&1)===0&&h!==null?(h.childLanes=0,h.pendingProps=x):h=Yv(x,n,0,null),t=Fp(t,n,r,null),h.return=e,t.return=e,h.sibling=t,e.child=h,e.child.memoizedState=W0(r),e.memoizedState=V0,t):Qw(e,x));if(a=t.memoizedState,a!==null&&(f=a.dehydrated,f!==null))return B2(t,e,x,n,f,a,r);if(h){h=n.fallback,x=e.mode,a=t.child,f=a.sibling;var s={mode:"hidden",children:n.children};return(x&1)===0&&e.child!==a?(n=e.child,n.childLanes=0,n.pendingProps=s,e.deletions=null):(n=gf(a,s),n.subtreeFlags=a.subtreeFlags&14680064),f!==null?h=gf(f,h):(h=Fp(h,x,r,null),h.flags|=2),h.return=e,n.return=e,n.sibling=h,e.child=n,n=h,h=e.child,x=t.child.memoizedState,x=x===null?W0(r):{baseLanes:x.baseLanes|r,cachePool:null,transitions:x.transitions},h.memoizedState=x,h.childLanes=t.childLanes&~r,e.memoizedState=V0,n}return h=t.child,t=h.sibling,n=gf(h,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function Qw(t,e){return e=Yv({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function O_(t,e,r,n){return n!==null&&Rw(n),og(e,t.child,null,r),t=Qw(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function B2(t,e,r,n,a,h,x){if(r)return e.flags&256?(e.flags&=-257,n=Ny(Error(Ft(422))),O_(t,e,x,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(h=n.fallback,a=e.mode,n=Yv({mode:"visible",children:n.children},a,0,null),h=Fp(h,a,x,null),h.flags|=2,n.return=e,h.return=e,n.sibling=h,e.child=n,(e.mode&1)!==0&&og(e,t.child,null,x),e.child.memoizedState=W0(x),e.memoizedState=V0,h);if((e.mode&1)===0)return O_(t,e,x,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var f=n.dgst;return n=f,h=Error(Ft(419)),n=Ny(h,n,void 0),O_(t,e,x,n)}if(f=(x&t.childLanes)!==0,eo||f){if(n=zi,n!==null){switch(x&-x){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=(a&(n.suspendedLanes|x))!==0?0:a,a!==0&&a!==h.retryLane&&(h.retryLane=a,Qu(t,a),Ha(n,t,a,-1))}return n1(),n=Ny(Error(Ft(421))),O_(t,e,x,n)}return a.data==="$?"?(e.flags|=128,e.child=t.child,e=Q2.bind(null,t),a._reactRetry=e,null):(t=h.treeContext,bo=ff(a.nextSibling),Mo=e,jn=!0,Ua=null,t!==null&&(Zo[ea++]=Gu,Zo[ea++]=Hu,Zo[ea++]=Rp,Gu=t.id,Hu=t.overflow,Rp=e),e=Qw(e,n.children),e.flags|=4096,e)}function Px(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),R0(t.return,e,r)}function Uy(t,e,r,n,a){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(h.isBackwards=e,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=r,h.tailMode=a)}function TT(t,e,r){var n=e.pendingProps,a=n.revealOrder,h=n.tail;if(Cs(t,e,n.children,r),n=qn.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Px(t,r,e);else if(t.tag===19)Px(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(kn(qn,n),(e.mode&1)===0)e.memoizedState=null;else switch(a){case"forwards":for(r=e.child,a=null;r!==null;)t=r.alternate,t!==null&&_v(t)===null&&(a=r),r=r.sibling;r=a,r===null?(a=e.child,e.child=null):(a=r.sibling,r.sibling=null),Uy(e,!1,a,r,h);break;case"backwards":for(r=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&_v(t)===null){e.child=a;break}t=a.sibling,a.sibling=r,r=a,a=t}Uy(e,!0,r,null,h);break;case"together":Uy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function K_(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ju(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),zp|=e.lanes,(r&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(Ft(153));if(e.child!==null){for(t=e.child,r=gf(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=gf(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function z2(t,e,r){switch(e.tag){case 3:bT(e),sg();break;case 5:qM(e);break;case 1:ro(e.type)&&dv(e);break;case 4:Vw(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,a=e.memoizedProps.value;kn(pv,n._currentValue),n._currentValue=a;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(kn(qn,qn.current&1),e.flags|=128,null):(r&e.child.childLanes)!==0?MT(t,e,r):(kn(qn,qn.current&1),t=Ju(t,e,r),t!==null?t.sibling:null);kn(qn,qn.current&1);break;case 19:if(n=(r&e.childLanes)!==0,(t.flags&128)!==0){if(n)return TT(t,e,r);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),kn(qn,qn.current),n)break;return null;case 22:case 23:return e.lanes=0,wT(t,e,r)}return Ju(t,e,r)}var ST,G0,CT,ET;ST=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};G0=function(){};CT=function(t,e,r,n){var a=t.memoizedProps;if(a!==n){t=e.stateNode,Ip(zl.current);var h=null;switch(r){case"input":a=h0(t,a),n=h0(t,n),h=[];break;case"select":a=Jn({},a,{value:void 0}),n=Jn({},n,{value:void 0}),h=[];break;case"textarea":a=g0(t,a),n=g0(t,n),h=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=uv)}v0(r,n);var x;r=null;for(d in a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var f=a[d];for(x in f)f.hasOwnProperty(x)&&(r||(r={}),r[x]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Vg.hasOwnProperty(d)?h||(h=[]):(h=h||[]).push(d,null));for(d in n){var s=n[d];if(f=a!=null?a[d]:void 0,n.hasOwnProperty(d)&&s!==f&&(s!=null||f!=null))if(d==="style")if(f){for(x in f)!f.hasOwnProperty(x)||s&&s.hasOwnProperty(x)||(r||(r={}),r[x]="");for(x in s)s.hasOwnProperty(x)&&f[x]!==s[x]&&(r||(r={}),r[x]=s[x])}else r||(h||(h=[]),h.push(d,r)),r=s;else d==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,f=f?f.__html:void 0,s!=null&&f!==s&&(h=h||[]).push(d,s)):d==="children"?typeof s!="string"&&typeof s!="number"||(h=h||[]).push(d,""+s):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Vg.hasOwnProperty(d)?(s!=null&&d==="onScroll"&&Ln("scroll",t),h||f===s||(h=[])):(h=h||[]).push(d,s))}r&&(h=h||[]).push("style",r);var d=h;(e.updateQueue=d)&&(e.flags|=4)}};ET=function(t,e,r,n){r!==n&&(e.flags|=4)};function Tg(t,e){if(!jn)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function os(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var a=t.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function j2(t,e,r){var n=e.pendingProps;switch($w(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return os(e),null;case 1:return ro(e.type)&&cv(),os(e),null;case 3:return n=e.stateNode,ag(),$n(to),$n(us),Gw(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(E_(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Ua!==null&&(Z0(Ua),Ua=null))),G0(t,e),os(e),null;case 5:Ww(e);var a=Ip(t_.current);if(r=e.type,t!==null&&e.stateNode!=null)CT(t,e,r,n,a),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ft(166));return os(e),null}if(t=Ip(zl.current),E_(e)){n=e.stateNode,r=e.type;var h=e.memoizedProps;switch(n[Ll]=e,n[Zg]=h,t=(e.mode&1)!==0,r){case"dialog":Ln("cancel",n),Ln("close",n);break;case"iframe":case"object":case"embed":Ln("load",n);break;case"video":case"audio":for(a=0;a<Ig.length;a++)Ln(Ig[a],n);break;case"source":Ln("error",n);break;case"img":case"image":case"link":Ln("error",n),Ln("load",n);break;case"details":Ln("toggle",n);break;case"input":R1(n,h),Ln("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!h.multiple},Ln("invalid",n);break;case"textarea":z1(n,h),Ln("invalid",n)}v0(r,h),a=null;for(var x in h)if(h.hasOwnProperty(x)){var f=h[x];x==="children"?typeof f=="string"?n.textContent!==f&&(h.suppressHydrationWarning!==!0&&C_(n.textContent,f,t),a=["children",f]):typeof f=="number"&&n.textContent!==""+f&&(h.suppressHydrationWarning!==!0&&C_(n.textContent,f,t),a=["children",""+f]):Vg.hasOwnProperty(x)&&f!=null&&x==="onScroll"&&Ln("scroll",n)}switch(r){case"input":v_(n),B1(n,h,!0);break;case"textarea":v_(n),j1(n);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(n.onclick=uv)}n=a,e.updateQueue=n,n!==null&&(e.flags|=4)}else{x=a.nodeType===9?a:a.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=tM(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=x.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=x.createElement(r,{is:n.is}):(t=x.createElement(r),r==="select"&&(x=t,n.multiple?x.multiple=!0:n.size&&(x.size=n.size))):t=x.createElementNS(t,r),t[Ll]=e,t[Zg]=n,ST(t,e,!1,!1),e.stateNode=t;e:{switch(x=y0(r,n),r){case"dialog":Ln("cancel",t),Ln("close",t),a=n;break;case"iframe":case"object":case"embed":Ln("load",t),a=n;break;case"video":case"audio":for(a=0;a<Ig.length;a++)Ln(Ig[a],t);a=n;break;case"source":Ln("error",t),a=n;break;case"img":case"image":case"link":Ln("error",t),Ln("load",t),a=n;break;case"details":Ln("toggle",t),a=n;break;case"input":R1(t,n),a=h0(t,n),Ln("invalid",t);break;case"option":a=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},a=Jn({},n,{value:void 0}),Ln("invalid",t);break;case"textarea":z1(t,n),a=g0(t,n),Ln("invalid",t);break;default:a=n}v0(r,a),f=a;for(h in f)if(f.hasOwnProperty(h)){var s=f[h];h==="style"?iM(t,s):h==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&rM(t,s)):h==="children"?typeof s=="string"?(r!=="textarea"||s!=="")&&Wg(t,s):typeof s=="number"&&Wg(t,""+s):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Vg.hasOwnProperty(h)?s!=null&&h==="onScroll"&&Ln("scroll",t):s!=null&&xw(t,h,s,x))}switch(r){case"input":v_(t),B1(t,n,!1);break;case"textarea":v_(t),j1(t);break;case"option":n.value!=null&&t.setAttribute("value",""+vf(n.value));break;case"select":t.multiple=!!n.multiple,h=n.value,h!=null?qm(t,!!n.multiple,h,!1):n.defaultValue!=null&&qm(t,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(t.onclick=uv)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return os(e),null;case 6:if(t&&e.stateNode!=null)ET(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ft(166));if(r=Ip(t_.current),Ip(zl.current),E_(e)){if(n=e.stateNode,r=e.memoizedProps,n[Ll]=e,(h=n.nodeValue!==r)&&(t=Mo,t!==null))switch(t.tag){case 3:C_(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&C_(n.nodeValue,r,(t.mode&1)!==0)}h&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Ll]=e,e.stateNode=n}return os(e),null;case 13:if($n(qn),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(jn&&bo!==null&&(e.mode&1)!==0&&(e.flags&128)===0)GM(),sg(),e.flags|=98560,h=!1;else if(h=E_(e),n!==null&&n.dehydrated!==null){if(t===null){if(!h)throw Error(Ft(318));if(h=e.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(Ft(317));h[Ll]=e}else sg(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;os(e),h=!1}else Ua!==null&&(Z0(Ua),Ua=null),h=!0;if(!h)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(qn.current&1)!==0?Oi===0&&(Oi=3):n1())),e.updateQueue!==null&&(e.flags|=4),os(e),null);case 4:return ag(),G0(t,e),t===null&&Qg(e.stateNode.containerInfo),os(e),null;case 10:return jw(e.type._context),os(e),null;case 17:return ro(e.type)&&cv(),os(e),null;case 19:if($n(qn),h=e.memoizedState,h===null)return os(e),null;if(n=(e.flags&128)!==0,x=h.rendering,x===null)if(n)Tg(h,!1);else{if(Oi!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(x=_v(t),x!==null){for(e.flags|=128,Tg(h,!1),n=x.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)h=r,t=n,h.flags&=14680066,x=h.alternate,x===null?(h.childLanes=0,h.lanes=t,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=x.childLanes,h.lanes=x.lanes,h.child=x.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=x.memoizedProps,h.memoizedState=x.memoizedState,h.updateQueue=x.updateQueue,h.type=x.type,t=x.dependencies,h.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return kn(qn,qn.current&1|2),e.child}t=t.sibling}h.tail!==null&&fi()>ug&&(e.flags|=128,n=!0,Tg(h,!1),e.lanes=4194304)}else{if(!n)if(t=_v(x),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Tg(h,!0),h.tail===null&&h.tailMode==="hidden"&&!x.alternate&&!jn)return os(e),null}else 2*fi()-h.renderingStartTime>ug&&r!==1073741824&&(e.flags|=128,n=!0,Tg(h,!1),e.lanes=4194304);h.isBackwards?(x.sibling=e.child,e.child=x):(r=h.last,r!==null?r.sibling=x:e.child=x,h.last=x)}return h.tail!==null?(e=h.tail,h.rendering=e,h.tail=e.sibling,h.renderingStartTime=fi(),e.sibling=null,r=qn.current,kn(qn,n?r&1|2:r&1),e):(os(e),null);case 22:case 23:return r1(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(wo&1073741824)!==0&&(os(e),e.subtreeFlags&6&&(e.flags|=8192)):os(e),null;case 24:return null;case 25:return null}throw Error(Ft(156,e.tag))}function N2(t,e){switch($w(e),e.tag){case 1:return ro(e.type)&&cv(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ag(),$n(to),$n(us),Gw(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return Ww(e),null;case 13:if($n(qn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ft(340));sg()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return $n(qn),null;case 4:return ag(),null;case 10:return jw(e.type._context),null;case 22:case 23:return r1(),null;case 24:return null;default:return null}}var k_=!1,ls=!1,U2=typeof WeakSet=="function"?WeakSet:Set,er=null;function Km(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){oi(t,e,n)}else r.current=null}function H0(t,e,r){try{r()}catch(n){oi(t,e,n)}}var Ox=!1;function V2(t,e){if(O0=ov,t=AM(),Fw(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,h=n.focusNode;n=n.focusOffset;try{r.nodeType,h.nodeType}catch{r=null;break e}var x=0,f=-1,s=-1,d=0,m=0,o=t,l=null;t:for(;;){for(var u;o!==r||a!==0&&o.nodeType!==3||(f=x+a),o!==h||n!==0&&o.nodeType!==3||(s=x+n),o.nodeType===3&&(x+=o.nodeValue.length),(u=o.firstChild)!==null;)l=o,o=u;for(;;){if(o===t)break t;if(l===r&&++d===a&&(f=x),l===h&&++m===n&&(s=x),(u=o.nextSibling)!==null)break;o=l,l=o.parentNode}o=u}r=f===-1||s===-1?null:{start:f,end:s}}else r=null}r=r||{start:0,end:0}}else r=null;for(k0={focusedElem:t,selectionRange:r},ov=!1,er=e;er!==null;)if(e=er,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,er=t;else for(;er!==null;){e=er;try{var p=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var w=p.memoizedProps,_=p.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?w:ja(e.type,w),_);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ft(163))}}catch(C){oi(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,er=t;break}er=e.return}return p=Ox,Ox=!1,p}function zg(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&t)===t){var h=a.destroy;a.destroy=void 0,h!==void 0&&H0(e,r,h)}a=a.next}while(a!==n)}}function Kv(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function K0(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function PT(t){var e=t.alternate;e!==null&&(t.alternate=null,PT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ll],delete e[Zg],delete e[D0],delete e[S2],delete e[C2])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function OT(t){return t.tag===5||t.tag===3||t.tag===4}function kx(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||OT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function X0(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=uv));else if(n!==4&&(t=t.child,t!==null))for(X0(t,e,r),t=t.sibling;t!==null;)X0(t,e,r),t=t.sibling}function Y0(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Y0(t,e,r),t=t.sibling;t!==null;)Y0(t,e,r),t=t.sibling}var Yi=null,Na=!1;function Jd(t,e,r){for(r=r.child;r!==null;)kT(t,e,r),r=r.sibling}function kT(t,e,r){if(Bl&&typeof Bl.onCommitFiberUnmount=="function")try{Bl.onCommitFiberUnmount(zv,r)}catch{}switch(r.tag){case 5:ls||Km(r,e);case 6:var n=Yi,a=Na;Yi=null,Jd(t,e,r),Yi=n,Na=a,Yi!==null&&(Na?(t=Yi,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Yi.removeChild(r.stateNode));break;case 18:Yi!==null&&(Na?(t=Yi,r=r.stateNode,t.nodeType===8?Ly(t.parentNode,r):t.nodeType===1&&Ly(t,r),Xg(t)):Ly(Yi,r.stateNode));break;case 4:n=Yi,a=Na,Yi=r.stateNode.containerInfo,Na=!0,Jd(t,e,r),Yi=n,Na=a;break;case 0:case 11:case 14:case 15:if(!ls&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var h=a,x=h.destroy;h=h.tag,x!==void 0&&((h&2)!==0||(h&4)!==0)&&H0(r,e,x),a=a.next}while(a!==n)}Jd(t,e,r);break;case 1:if(!ls&&(Km(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(f){oi(r,e,f)}Jd(t,e,r);break;case 21:Jd(t,e,r);break;case 22:r.mode&1?(ls=(n=ls)||r.memoizedState!==null,Jd(t,e,r),ls=n):Jd(t,e,r);break;default:Jd(t,e,r)}}function Ix(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new U2),e.forEach(function(n){var a=J2.bind(null,t,n);r.has(n)||(r.add(n),n.then(a,a))})}}function Ra(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var h=t,x=e,f=x;e:for(;f!==null;){switch(f.tag){case 5:Yi=f.stateNode,Na=!1;break e;case 3:Yi=f.stateNode.containerInfo,Na=!0;break e;case 4:Yi=f.stateNode.containerInfo,Na=!0;break e}f=f.return}if(Yi===null)throw Error(Ft(160));kT(h,x,a),Yi=null,Na=!1;var s=a.alternate;s!==null&&(s.return=null),a.return=null}catch(d){oi(a,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)IT(e,t),e=e.sibling}function IT(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ra(e,t),Al(t),n&4){try{zg(3,t,t.return),Kv(3,t)}catch(w){oi(t,t.return,w)}try{zg(5,t,t.return)}catch(w){oi(t,t.return,w)}}break;case 1:Ra(e,t),Al(t),n&512&&r!==null&&Km(r,r.return);break;case 5:if(Ra(e,t),Al(t),n&512&&r!==null&&Km(r,r.return),t.flags&32){var a=t.stateNode;try{Wg(a,"")}catch(w){oi(t,t.return,w)}}if(n&4&&(a=t.stateNode,a!=null)){var h=t.memoizedProps,x=r!==null?r.memoizedProps:h,f=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{f==="input"&&h.type==="radio"&&h.name!=null&&Zb(a,h),y0(f,x);var d=y0(f,h);for(x=0;x<s.length;x+=2){var m=s[x],o=s[x+1];m==="style"?iM(a,o):m==="dangerouslySetInnerHTML"?rM(a,o):m==="children"?Wg(a,o):xw(a,m,o,d)}switch(f){case"input":p0(a,h);break;case"textarea":eM(a,h);break;case"select":var l=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!h.multiple;var u=h.value;u!=null?qm(a,!!h.multiple,u,!1):l!==!!h.multiple&&(h.defaultValue!=null?qm(a,!!h.multiple,h.defaultValue,!0):qm(a,!!h.multiple,h.multiple?[]:"",!1))}a[Zg]=h}catch(w){oi(t,t.return,w)}}break;case 6:if(Ra(e,t),Al(t),n&4){if(t.stateNode===null)throw Error(Ft(162));a=t.stateNode,h=t.memoizedProps;try{a.nodeValue=h}catch(w){oi(t,t.return,w)}}break;case 3:if(Ra(e,t),Al(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Xg(e.containerInfo)}catch(w){oi(t,t.return,w)}break;case 4:Ra(e,t),Al(t);break;case 13:Ra(e,t),Al(t),a=t.child,a.flags&8192&&(h=a.memoizedState!==null,a.stateNode.isHidden=h,!h||a.alternate!==null&&a.alternate.memoizedState!==null||(e1=fi())),n&4&&Ix(t);break;case 22:if(m=r!==null&&r.memoizedState!==null,t.mode&1?(ls=(d=ls)||m,Ra(e,t),ls=d):Ra(e,t),Al(t),n&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!m&&(t.mode&1)!==0)for(er=t,m=t.child;m!==null;){for(o=er=m;er!==null;){switch(l=er,u=l.child,l.tag){case 0:case 11:case 14:case 15:zg(4,l,l.return);break;case 1:Km(l,l.return);var p=l.stateNode;if(typeof p.componentWillUnmount=="function"){n=l,r=l.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(w){oi(n,r,w)}}break;case 5:Km(l,l.return);break;case 22:if(l.memoizedState!==null){Dx(o);continue}}u!==null?(u.return=l,er=u):Dx(o)}m=m.sibling}e:for(m=null,o=t;;){if(o.tag===5){if(m===null){m=o;try{a=o.stateNode,d?(h=a.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(f=o.stateNode,s=o.memoizedProps.style,x=s!=null&&s.hasOwnProperty("display")?s.display:null,f.style.display=nM("display",x))}catch(w){oi(t,t.return,w)}}}else if(o.tag===6){if(m===null)try{o.stateNode.nodeValue=d?"":o.memoizedProps}catch(w){oi(t,t.return,w)}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===t)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;o.sibling===null;){if(o.return===null||o.return===t)break e;m===o&&(m=null),o=o.return}m===o&&(m=null),o.sibling.return=o.return,o=o.sibling}}break;case 19:Ra(e,t),Al(t),n&4&&Ix(t);break;case 21:break;default:Ra(e,t),Al(t)}}function Al(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(OT(r)){var n=r;break e}r=r.return}throw Error(Ft(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Wg(a,""),n.flags&=-33);var h=kx(t);Y0(t,h,a);break;case 3:case 4:var x=n.stateNode.containerInfo,f=kx(t);X0(t,f,x);break;default:throw Error(Ft(161))}}catch(s){oi(t,t.return,s)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function W2(t,e,r){er=t,AT(t)}function AT(t,e,r){for(var n=(t.mode&1)!==0;er!==null;){var a=er,h=a.child;if(a.tag===22&&n){var x=a.memoizedState!==null||k_;if(!x){var f=a.alternate,s=f!==null&&f.memoizedState!==null||ls;f=k_;var d=ls;if(k_=x,(ls=s)&&!d)for(er=a;er!==null;)x=er,s=x.child,x.tag===22&&x.memoizedState!==null?Fx(a):s!==null?(s.return=x,er=s):Fx(a);for(;h!==null;)er=h,AT(h),h=h.sibling;er=a,k_=f,ls=d}Ax(t)}else(a.subtreeFlags&8772)!==0&&h!==null?(h.return=a,er=h):Ax(t)}}function Ax(t){for(;er!==null;){var e=er;if((e.flags&8772)!==0){var r=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:ls||Kv(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!ls)if(r===null)n.componentDidMount();else{var a=e.elementType===e.type?r.memoizedProps:ja(e.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var h=e.updateQueue;h!==null&&gx(e,h,n);break;case 3:var x=e.updateQueue;if(x!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}gx(e,x,r)}break;case 5:var f=e.stateNode;if(r===null&&e.flags&4){r=f;var s=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&r.focus();break;case"img":s.src&&(r.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var m=d.memoizedState;if(m!==null){var o=m.dehydrated;o!==null&&Xg(o)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ft(163))}ls||e.flags&512&&K0(e)}catch(l){oi(e,e.return,l)}}if(e===t){er=null;break}if(r=e.sibling,r!==null){r.return=e.return,er=r;break}er=e.return}}function Dx(t){for(;er!==null;){var e=er;if(e===t){er=null;break}var r=e.sibling;if(r!==null){r.return=e.return,er=r;break}er=e.return}}function Fx(t){for(;er!==null;){var e=er;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Kv(4,e)}catch(s){oi(e,r,s)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var a=e.return;try{n.componentDidMount()}catch(s){oi(e,a,s)}}var h=e.return;try{K0(e)}catch(s){oi(e,h,s)}break;case 5:var x=e.return;try{K0(e)}catch(s){oi(e,x,s)}}}catch(s){oi(e,e.return,s)}if(e===t){er=null;break}var f=e.sibling;if(f!==null){f.return=e.return,er=f;break}er=e.return}}var G2=Math.ceil,wv=Zu.ReactCurrentDispatcher,Jw=Zu.ReactCurrentOwner,na=Zu.ReactCurrentBatchConfig,hn=0,zi=null,xi=null,qi=0,wo=0,Xm=bf(0),Oi=0,s_=null,zp=0,Xv=0,Zw=0,jg=null,Zs=null,e1=0,ug=1/0,Vu=null,xv=!1,q0=null,pf=null,I_=!1,af=null,bv=0,Ng=0,Q0=null,X_=-1,Y_=0;function Es(){return(hn&6)!==0?fi():X_!==-1?X_:X_=fi()}function mf(t){return(t.mode&1)===0?1:(hn&2)!==0&&qi!==0?qi&-qi:P2.transition!==null?(Y_===0&&(Y_=gM()),Y_):(t=xn,t!==0||(t=window.event,t=t===void 0?16:MM(t.type)),t)}function Ha(t,e,r,n){if(50<Ng)throw Ng=0,Q0=null,Error(Ft(185));c_(t,r,n),((hn&2)===0||t!==zi)&&(t===zi&&((hn&2)===0&&(Xv|=r),Oi===4&&sf(t,qi)),no(t,n),r===1&&hn===0&&(e.mode&1)===0&&(ug=fi()+500,Wv&&Mf()))}function no(t,e){var r=t.callbackNode;PP(t,e);var n=sv(t,t===zi?qi:0);if(n===0)r!==null&&V1(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&V1(r),e===1)t.tag===0?E2(Lx.bind(null,t)):UM(Lx.bind(null,t)),M2(function(){(hn&6)===0&&Mf()}),r=null;else{switch(_M(n)){case 1:r=Cw;break;case 4:r=pM;break;case 16:r=iv;break;case 536870912:r=mM;break;default:r=iv}r=jT(r,DT.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function DT(t,e){if(X_=-1,Y_=0,(hn&6)!==0)throw Error(Ft(327));var r=t.callbackNode;if(tg()&&t.callbackNode!==r)return null;var n=sv(t,t===zi?qi:0);if(n===0)return null;if((n&30)!==0||(n&t.expiredLanes)!==0||e)e=Mv(t,n);else{e=n;var a=hn;hn|=2;var h=LT();(zi!==t||qi!==e)&&(Vu=null,ug=fi()+500,Dp(t,e));do try{X2();break}catch(f){FT(t,f)}while(1);zw(),wv.current=h,hn=a,xi!==null?e=0:(zi=null,qi=0,e=Oi)}if(e!==0){if(e===2&&(a=T0(t),a!==0&&(n=a,e=J0(t,a))),e===1)throw r=s_,Dp(t,0),sf(t,n),no(t,fi()),r;if(e===6)sf(t,n);else{if(a=t.current.alternate,(n&30)===0&&!H2(a)&&(e=Mv(t,n),e===2&&(h=T0(t),h!==0&&(n=h,e=J0(t,h))),e===1))throw r=s_,Dp(t,0),sf(t,n),no(t,fi()),r;switch(t.finishedWork=a,t.finishedLanes=n,e){case 0:case 1:throw Error(Ft(345));case 2:Cp(t,Zs,Vu);break;case 3:if(sf(t,n),(n&130023424)===n&&(e=e1+500-fi(),10<e)){if(sv(t,0)!==0)break;if(a=t.suspendedLanes,(a&n)!==n){Es(),t.pingedLanes|=t.suspendedLanes&a;break}t.timeoutHandle=A0(Cp.bind(null,t,Zs,Vu),e);break}Cp(t,Zs,Vu);break;case 4:if(sf(t,n),(n&4194240)===n)break;for(e=t.eventTimes,a=-1;0<n;){var x=31-Ga(n);h=1<<x,x=e[x],x>a&&(a=x),n&=~h}if(n=a,n=fi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*G2(n/1960))-n,10<n){t.timeoutHandle=A0(Cp.bind(null,t,Zs,Vu),n);break}Cp(t,Zs,Vu);break;case 5:Cp(t,Zs,Vu);break;default:throw Error(Ft(329))}}}return no(t,fi()),t.callbackNode===r?DT.bind(null,t):null}function J0(t,e){var r=jg;return t.current.memoizedState.isDehydrated&&(Dp(t,e).flags|=256),t=Mv(t,e),t!==2&&(e=Zs,Zs=r,e!==null&&Z0(e)),t}function Z0(t){Zs===null?Zs=t:Zs.push.apply(Zs,t)}function H2(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],h=a.getSnapshot;a=a.value;try{if(!Xa(h(),a))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function sf(t,e){for(e&=~Zw,e&=~Xv,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Ga(e),n=1<<r;t[r]=-1,e&=~n}}function Lx(t){if((hn&6)!==0)throw Error(Ft(327));tg();var e=sv(t,0);if((e&1)===0)return no(t,fi()),null;var r=Mv(t,e);if(t.tag!==0&&r===2){var n=T0(t);n!==0&&(e=n,r=J0(t,n))}if(r===1)throw r=s_,Dp(t,0),sf(t,e),no(t,fi()),r;if(r===6)throw Error(Ft(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Cp(t,Zs,Vu),no(t,fi()),null}function t1(t,e){var r=hn;hn|=1;try{return t(e)}finally{hn=r,hn===0&&(ug=fi()+500,Wv&&Mf())}}function jp(t){af!==null&&af.tag===0&&(hn&6)===0&&tg();var e=hn;hn|=1;var r=na.transition,n=xn;try{if(na.transition=null,xn=1,t)return t()}finally{xn=n,na.transition=r,hn=e,(hn&6)===0&&Mf()}}function r1(){wo=Xm.current,$n(Xm)}function Dp(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,b2(r)),xi!==null)for(r=xi.return;r!==null;){var n=r;switch($w(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&cv();break;case 3:ag(),$n(to),$n(us),Gw();break;case 5:Ww(n);break;case 4:ag();break;case 13:$n(qn);break;case 19:$n(qn);break;case 10:jw(n.type._context);break;case 22:case 23:r1()}r=r.return}if(zi=t,xi=t=gf(t.current,null),qi=wo=e,Oi=0,s_=null,Zw=Xv=zp=0,Zs=jg=null,kp!==null){for(e=0;e<kp.length;e++)if(r=kp[e],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,h=r.pending;if(h!==null){var x=h.next;h.next=a,n.next=x}r.pending=n}kp=null}return t}function FT(t,e){do{var r=xi;try{if(zw(),G_.current=yv,vv){for(var n=Qn.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}vv=!1}if(Bp=0,Bi=Pi=Qn=null,Bg=!1,r_=0,Jw.current=null,r===null||r.return===null){Oi=1,s_=e,xi=null;break}e:{var h=t,x=r.return,f=r,s=e;if(e=qi,f.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var d=s,m=f,o=m.tag;if((m.mode&1)===0&&(o===0||o===11||o===15)){var l=m.alternate;l?(m.updateQueue=l.updateQueue,m.memoizedState=l.memoizedState,m.lanes=l.lanes):(m.updateQueue=null,m.memoizedState=null)}var u=bx(x);if(u!==null){u.flags&=-257,Mx(u,x,f,h,e),u.mode&1&&xx(h,d,e),e=u,s=d;var p=e.updateQueue;if(p===null){var w=new Set;w.add(s),e.updateQueue=w}else p.add(s);break e}else{if((e&1)===0){xx(h,d,e),n1();break e}s=Error(Ft(426))}}else if(jn&&f.mode&1){var _=bx(x);if(_!==null){(_.flags&65536)===0&&(_.flags|=256),Mx(_,x,f,h,e),Rw(lg(s,f));break e}}h=s=lg(s,f),Oi!==4&&(Oi=2),jg===null?jg=[h]:jg.push(h),h=x;do{switch(h.tag){case 3:h.flags|=65536,e&=-e,h.lanes|=e;var v=_T(h,s,e);mx(h,v);break e;case 1:f=s;var y=h.type,T=h.stateNode;if((h.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(pf===null||!pf.has(T)))){h.flags|=65536,e&=-e,h.lanes|=e;var C=vT(h,f,e);mx(h,C);break e}}h=h.return}while(h!==null)}RT(r)}catch(P){e=P,xi===r&&r!==null&&(xi=r=r.return);continue}break}while(1)}function LT(){var t=wv.current;return wv.current=yv,t===null?yv:t}function n1(){(Oi===0||Oi===3||Oi===2)&&(Oi=4),zi===null||(zp&268435455)===0&&(Xv&268435455)===0||sf(zi,qi)}function Mv(t,e){var r=hn;hn|=2;var n=LT();(zi!==t||qi!==e)&&(Vu=null,Dp(t,e));do try{K2();break}catch(a){FT(t,a)}while(1);if(zw(),hn=r,wv.current=n,xi!==null)throw Error(Ft(261));return zi=null,qi=0,Oi}function K2(){for(;xi!==null;)$T(xi)}function X2(){for(;xi!==null&&!yP();)$T(xi)}function $T(t){var e=zT(t.alternate,t,wo);t.memoizedProps=t.pendingProps,e===null?RT(t):xi=e,Jw.current=null}function RT(t){var e=t;do{var r=e.alternate;if(t=e.return,(e.flags&32768)===0){if(r=j2(r,e,wo),r!==null){xi=r;return}}else{if(r=N2(r,e),r!==null){r.flags&=32767,xi=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Oi=6,xi=null;return}}if(e=e.sibling,e!==null){xi=e;return}xi=e=t}while(e!==null);Oi===0&&(Oi=5)}function Cp(t,e,r){var n=xn,a=na.transition;try{na.transition=null,xn=1,Y2(t,e,r,n)}finally{na.transition=a,xn=n}return null}function Y2(t,e,r,n){do tg();while(af!==null);if((hn&6)!==0)throw Error(Ft(327));r=t.finishedWork;var a=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Ft(177));t.callbackNode=null,t.callbackPriority=0;var h=r.lanes|r.childLanes;if(OP(t,h),t===zi&&(xi=zi=null,qi=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||I_||(I_=!0,jT(iv,function(){return tg(),null})),h=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||h){h=na.transition,na.transition=null;var x=xn;xn=1;var f=hn;hn|=4,Jw.current=null,V2(t,r),IT(r,t),m2(k0),ov=!!O0,k0=O0=null,t.current=r,W2(r),wP(),hn=f,xn=x,na.transition=h}else t.current=r;if(I_&&(I_=!1,af=t,bv=a),h=t.pendingLanes,h===0&&(pf=null),MP(r.stateNode),no(t,fi()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)a=e[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(xv)throw xv=!1,t=q0,q0=null,t;return(bv&1)!==0&&t.tag!==0&&tg(),h=t.pendingLanes,(h&1)!==0?t===Q0?Ng++:(Ng=0,Q0=t):Ng=0,Mf(),null}function tg(){if(af!==null){var t=_M(bv),e=na.transition,r=xn;try{if(na.transition=null,xn=16>t?16:t,af===null)var n=!1;else{if(t=af,af=null,bv=0,(hn&6)!==0)throw Error(Ft(331));var a=hn;for(hn|=4,er=t.current;er!==null;){var h=er,x=h.child;if((er.flags&16)!==0){var f=h.deletions;if(f!==null){for(var s=0;s<f.length;s++){var d=f[s];for(er=d;er!==null;){var m=er;switch(m.tag){case 0:case 11:case 15:zg(8,m,h)}var o=m.child;if(o!==null)o.return=m,er=o;else for(;er!==null;){m=er;var l=m.sibling,u=m.return;if(PT(m),m===d){er=null;break}if(l!==null){l.return=u,er=l;break}er=u}}}var p=h.alternate;if(p!==null){var w=p.child;if(w!==null){p.child=null;do{var _=w.sibling;w.sibling=null,w=_}while(w!==null)}}er=h}}if((h.subtreeFlags&2064)!==0&&x!==null)x.return=h,er=x;else e:for(;er!==null;){if(h=er,(h.flags&2048)!==0)switch(h.tag){case 0:case 11:case 15:zg(9,h,h.return)}var v=h.sibling;if(v!==null){v.return=h.return,er=v;break e}er=h.return}}var y=t.current;for(er=y;er!==null;){x=er;var T=x.child;if((x.subtreeFlags&2064)!==0&&T!==null)T.return=x,er=T;else e:for(x=y;er!==null;){if(f=er,(f.flags&2048)!==0)try{switch(f.tag){case 0:case 11:case 15:Kv(9,f)}}catch(P){oi(f,f.return,P)}if(f===x){er=null;break e}var C=f.sibling;if(C!==null){C.return=f.return,er=C;break e}er=f.return}}if(hn=a,Mf(),Bl&&typeof Bl.onPostCommitFiberRoot=="function")try{Bl.onPostCommitFiberRoot(zv,t)}catch{}n=!0}return n}finally{xn=r,na.transition=e}}return!1}function $x(t,e,r){e=lg(r,e),e=_T(t,e,1),t=hf(t,e,1),e=Es(),t!==null&&(c_(t,1,e),no(t,e))}function oi(t,e,r){if(t.tag===3)$x(t,t,r);else for(;e!==null;){if(e.tag===3){$x(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(pf===null||!pf.has(n))){t=lg(r,t),t=vT(e,t,1),e=hf(e,t,1),t=Es(),e!==null&&(c_(e,1,t),no(e,t));break}}e=e.return}}function q2(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=Es(),t.pingedLanes|=t.suspendedLanes&r,zi===t&&(qi&r)===r&&(Oi===4||Oi===3&&(qi&130023424)===qi&&500>fi()-e1?Dp(t,0):Zw|=r),no(t,e)}function BT(t,e){e===0&&((t.mode&1)===0?e=1:(e=x_,x_<<=1,(x_&130023424)===0&&(x_=4194304)));var r=Es();t=Qu(t,e),t!==null&&(c_(t,e,r),no(t,r))}function Q2(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),BT(t,r)}function J2(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,a=t.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(Ft(314))}n!==null&&n.delete(e),BT(t,r)}var zT;zT=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||to.current)eo=!0;else{if((t.lanes&r)===0&&(e.flags&128)===0)return eo=!1,z2(t,e,r);eo=(t.flags&131072)!==0}else eo=!1,jn&&(e.flags&1048576)!==0&&VM(e,hv,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;K_(t,e),t=e.pendingProps;var a=ig(e,us.current);eg(e,r),a=Kw(null,e,n,t,a,r);var h=Xw();return e.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ro(n)?(h=!0,dv(e)):h=!1,e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Uw(e),a.updater=Hv,e.stateNode=a,a._reactInternals=e,z0(e,n,t,r),e=U0(null,e,n,!0,h,r)):(e.tag=0,jn&&h&&Lw(e),Cs(null,e,a,r),e=e.child),e;case 16:n=e.elementType;e:{switch(K_(t,e),t=e.pendingProps,a=n._init,n=a(n._payload),e.type=n,a=e.tag=eO(n),t=ja(n,t),a){case 0:e=N0(null,e,n,t,r);break e;case 1:e=Cx(null,e,n,t,r);break e;case 11:e=Tx(null,e,n,t,r);break e;case 14:e=Sx(null,e,n,ja(n.type,t),r);break e}throw Error(Ft(306,n,""))}return e;case 0:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:ja(n,a),N0(t,e,n,a,r);case 1:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:ja(n,a),Cx(t,e,n,a,r);case 3:e:{if(bT(e),t===null)throw Error(Ft(387));n=e.pendingProps,h=e.memoizedState,a=h.element,YM(t,e),gv(e,n,null,r);var x=e.memoizedState;if(n=x.element,h.isDehydrated)if(h={element:n,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},e.updateQueue.baseState=h,e.memoizedState=h,e.flags&256){a=lg(Error(Ft(423)),e),e=Ex(t,e,n,r,a);break e}else if(n!==a){a=lg(Error(Ft(424)),e),e=Ex(t,e,n,r,a);break e}else for(bo=ff(e.stateNode.containerInfo.firstChild),Mo=e,jn=!0,Ua=null,r=KM(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(sg(),n===a){e=Ju(t,e,r);break e}Cs(t,e,n,r)}e=e.child}return e;case 5:return qM(e),t===null&&$0(e),n=e.type,a=e.pendingProps,h=t!==null?t.memoizedProps:null,x=a.children,I0(n,a)?x=null:h!==null&&I0(n,h)&&(e.flags|=32),xT(t,e),Cs(t,e,x,r),e.child;case 6:return t===null&&$0(e),null;case 13:return MT(t,e,r);case 4:return Vw(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=og(e,null,n,r):Cs(t,e,n,r),e.child;case 11:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:ja(n,a),Tx(t,e,n,a,r);case 7:return Cs(t,e,e.pendingProps,r),e.child;case 8:return Cs(t,e,e.pendingProps.children,r),e.child;case 12:return Cs(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,a=e.pendingProps,h=e.memoizedProps,x=a.value,kn(pv,n._currentValue),n._currentValue=x,h!==null)if(Xa(h.value,x)){if(h.children===a.children&&!to.current){e=Ju(t,e,r);break e}}else for(h=e.child,h!==null&&(h.return=e);h!==null;){var f=h.dependencies;if(f!==null){x=h.child;for(var s=f.firstContext;s!==null;){if(s.context===n){if(h.tag===1){s=Ku(-1,r&-r),s.tag=2;var d=h.updateQueue;if(d!==null){d=d.shared;var m=d.pending;m===null?s.next=s:(s.next=m.next,m.next=s),d.pending=s}}h.lanes|=r,s=h.alternate,s!==null&&(s.lanes|=r),R0(h.return,r,e),f.lanes|=r;break}s=s.next}}else if(h.tag===10)x=h.type===e.type?null:h.child;else if(h.tag===18){if(x=h.return,x===null)throw Error(Ft(341));x.lanes|=r,f=x.alternate,f!==null&&(f.lanes|=r),R0(x,r,e),x=h.sibling}else x=h.child;if(x!==null)x.return=h;else for(x=h;x!==null;){if(x===e){x=null;break}if(h=x.sibling,h!==null){h.return=x.return,x=h;break}x=x.return}h=x}Cs(t,e,a.children,r),e=e.child}return e;case 9:return a=e.type,n=e.pendingProps.children,eg(e,r),a=ia(a),n=n(a),e.flags|=1,Cs(t,e,n,r),e.child;case 14:return n=e.type,a=ja(n,e.pendingProps),a=ja(n.type,a),Sx(t,e,n,a,r);case 15:return yT(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,a=e.pendingProps,a=e.elementType===n?a:ja(n,a),K_(t,e),e.tag=1,ro(n)?(t=!0,dv(e)):t=!1,eg(e,r),gT(e,n,a),z0(e,n,a,r),U0(null,e,n,!0,t,r);case 19:return TT(t,e,r);case 22:return wT(t,e,r)}throw Error(Ft(156,e.tag))};function jT(t,e){return hM(t,e)}function Z2(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ra(t,e,r,n){return new Z2(t,e,r,n)}function i1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function eO(t){if(typeof t=="function")return i1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Mw)return 11;if(t===Tw)return 14}return 2}function gf(t,e){var r=t.alternate;return r===null?(r=ra(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function q_(t,e,r,n,a,h){var x=2;if(n=t,typeof t=="function")i1(t)&&(x=1);else if(typeof t=="string")x=5;else e:switch(t){case Bm:return Fp(r.children,a,h,e);case bw:x=8,a|=8;break;case u0:return t=ra(12,r,e,a|2),t.elementType=u0,t.lanes=h,t;case c0:return t=ra(13,r,e,a),t.elementType=c0,t.lanes=h,t;case d0:return t=ra(19,r,e,a),t.elementType=d0,t.lanes=h,t;case qb:return Yv(r,a,h,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Xb:x=10;break e;case Yb:x=9;break e;case Mw:x=11;break e;case Tw:x=14;break e;case tf:x=16,n=null;break e}throw Error(Ft(130,t==null?t:typeof t,""))}return e=ra(x,r,e,a),e.elementType=t,e.type=n,e.lanes=h,e}function Fp(t,e,r,n){return t=ra(7,t,n,e),t.lanes=r,t}function Yv(t,e,r,n){return t=ra(22,t,n,e),t.elementType=qb,t.lanes=r,t.stateNode={isHidden:!1},t}function Vy(t,e,r){return t=ra(6,t,null,e),t.lanes=r,t}function Wy(t,e,r){return e=ra(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tO(t,e,r,n,a){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ty(0),this.expirationTimes=Ty(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ty(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function s1(t,e,r,n,a,h,x,f,s){return t=new tO(t,e,r,f,s),e===1?(e=1,h===!0&&(e|=8)):e=0,h=ra(3,null,null,e),t.current=h,h.stateNode=t,h.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uw(h),t}function rO(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rm,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function NT(t){if(!t)return yf;t=t._reactInternals;e:{if(Gp(t)!==t||t.tag!==1)throw Error(Ft(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ro(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ft(171))}if(t.tag===1){var r=t.type;if(ro(r))return NM(t,r,e)}return e}function UT(t,e,r,n,a,h,x,f,s){return t=s1(r,n,!0,t,a,h,x,f,s),t.context=NT(null),r=t.current,n=Es(),a=mf(r),h=Ku(n,a),h.callback=e!=null?e:null,hf(r,h,a),t.current.lanes=a,c_(t,a,n),no(t,n),t}function qv(t,e,r,n){var a=e.current,h=Es(),x=mf(a);return r=NT(r),e.context===null?e.context=r:e.pendingContext=r,e=Ku(h,x),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=hf(a,e,x),t!==null&&(Ha(t,a,x,h),W_(t,a,x)),x}function Tv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Rx(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function o1(t,e){Rx(t,e),(t=t.alternate)&&Rx(t,e)}function nO(){return null}var VT=typeof reportError=="function"?reportError:function(t){console.error(t)};function a1(t){this._internalRoot=t}Qv.prototype.render=a1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ft(409));qv(t,e,null,null)};Qv.prototype.unmount=a1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jp(function(){qv(null,t,null,null)}),e[qu]=null}};function Qv(t){this._internalRoot=t}Qv.prototype.unstable_scheduleHydration=function(t){if(t){var e=wM();t={blockedOn:null,target:t,priority:e};for(var r=0;r<nf.length&&e!==0&&e<nf[r].priority;r++);nf.splice(r,0,t),r===0&&bM(t)}};function l1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Jv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Bx(){}function iO(t,e,r,n,a){if(a){if(typeof n=="function"){var h=n;n=function(){var d=Tv(x);h.call(d)}}var x=UT(e,n,t,0,null,!1,!1,"",Bx);return t._reactRootContainer=x,t[qu]=x.current,Qg(t.nodeType===8?t.parentNode:t),jp(),x}for(;a=t.lastChild;)t.removeChild(a);if(typeof n=="function"){var f=n;n=function(){var d=Tv(s);f.call(d)}}var s=s1(t,0,!1,null,null,!1,!1,"",Bx);return t._reactRootContainer=s,t[qu]=s.current,Qg(t.nodeType===8?t.parentNode:t),jp(function(){qv(e,s,r,n)}),s}function Zv(t,e,r,n,a){var h=r._reactRootContainer;if(h){var x=h;if(typeof a=="function"){var f=a;a=function(){var s=Tv(x);f.call(s)}}qv(e,x,t,a)}else x=iO(r,e,t,a,n);return Tv(x)}vM=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=kg(e.pendingLanes);r!==0&&(Ew(e,r|1),no(e,fi()),(hn&6)===0&&(ug=fi()+500,Mf()))}break;case 13:jp(function(){var n=Qu(t,1);if(n!==null){var a=Es();Ha(n,t,1,a)}}),o1(t,1)}};Pw=function(t){if(t.tag===13){var e=Qu(t,134217728);if(e!==null){var r=Es();Ha(e,t,134217728,r)}o1(t,134217728)}};yM=function(t){if(t.tag===13){var e=mf(t),r=Qu(t,e);if(r!==null){var n=Es();Ha(r,t,e,n)}o1(t,e)}};wM=function(){return xn};xM=function(t,e){var r=xn;try{return xn=t,e()}finally{xn=r}};x0=function(t,e,r){switch(e){case"input":if(p0(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var a=Vv(n);if(!a)throw Error(Ft(90));Jb(n),p0(n,a)}}}break;case"textarea":eM(t,r);break;case"select":e=r.value,e!=null&&qm(t,!!r.multiple,e,!1)}};aM=t1;lM=jp;var sO={usingClientEntryPoint:!1,Events:[f_,Um,Vv,sM,oM,t1]},Sg={findFiberByHostInstance:Op,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},oO={bundleType:Sg.bundleType,version:Sg.version,rendererPackageName:Sg.rendererPackageName,rendererConfig:Sg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zu.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=dM(t),t===null?null:t.stateNode},findFiberByHostInstance:Sg.findFiberByHostInstance||nO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var A_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!A_.isDisabled&&A_.supportsFiber)try{zv=A_.inject(oO),Bl=A_}catch{}}Po.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sO;Po.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l1(e))throw Error(Ft(200));return rO(t,e,null,r)};Po.createRoot=function(t,e){if(!l1(t))throw Error(Ft(299));var r=!1,n="",a=VT;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=s1(t,1,!1,null,null,r,!1,n,a),t[qu]=e.current,Qg(t.nodeType===8?t.parentNode:t),new a1(e)};Po.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ft(188)):(t=Object.keys(t).join(","),Error(Ft(268,t)));return t=dM(e),t=t===null?null:t.stateNode,t};Po.flushSync=function(t){return jp(t)};Po.hydrate=function(t,e,r){if(!Jv(e))throw Error(Ft(200));return Zv(null,t,e,!0,r)};Po.hydrateRoot=function(t,e,r){if(!l1(t))throw Error(Ft(405));var n=r!=null&&r.hydratedSources||null,a=!1,h="",x=VT;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(x=r.onRecoverableError)),e=UT(e,null,t,1,r!=null?r:null,a,!1,h,x),t[qu]=e.current,Qg(t),n)for(t=0;t<n.length;t++)r=n[t],a=r._getVersion,a=a(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,a]:e.mutableSourceEagerHydrationData.push(r,a);return new Qv(e)};Po.render=function(t,e,r){if(!Jv(e))throw Error(Ft(200));return Zv(null,t,e,!1,r)};Po.unmountComponentAtNode=function(t){if(!Jv(t))throw Error(Ft(40));return t._reactRootContainer?(jp(function(){Zv(null,null,t,!1,function(){t._reactRootContainer=null,t[qu]=null})}),!0):!1};Po.unstable_batchedUpdates=t1;Po.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Jv(r))throw Error(Ft(200));if(t==null||t._reactInternals===void 0)throw Error(Ft(38));return Zv(t,e,r,!1,n)};Po.version="18.3.1-next-f1338f8080-20240426";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}e(),t.exports=Po})(Wb);var zx=Wb.exports;D1.createRoot=zx.createRoot,D1.hydrateRoot=zx.hydrateRoot;var aO={};const lO={},uO=Object.freeze(Object.defineProperty({__proto__:null,default:lO},Symbol.toStringTag,{value:"Module"})),Gy=UE(uO);(function(t){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.5.2"};if(t.fabric=e,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var r=Gy,n=new r.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=n.document,e.jsdomImplForWrapper=Gy.implForWrapper,e.nodeCanvas=Gy.Canvas,e.window=n,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=e),function(){function f(u,p){if(!!this.__eventListeners[u]){var w=this.__eventListeners[u];p?w[w.indexOf(p)]=!1:e.util.array.fill(w,!1)}}function s(u,p){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var w in u)this.on(w,u[w]);else this.__eventListeners[u]||(this.__eventListeners[u]=[]),this.__eventListeners[u].push(p);return this}function d(u,p){var w=function(){p.apply(this,arguments),this.off(u,w)}.bind(this);this.on(u,w)}function m(u,p){if(arguments.length===1)for(var w in u)d.call(this,w,u[w]);else d.call(this,u,p);return this}function o(u,p){if(!this.__eventListeners)return this;if(arguments.length===0)for(u in this.__eventListeners)f.call(this,u);else if(arguments.length===1&&typeof arguments[0]=="object")for(var w in u)f.call(this,w,u[w]);else f.call(this,u,p);return this}function l(u,p){if(!this.__eventListeners)return this;var w=this.__eventListeners[u];if(!w)return this;for(var _=0,v=w.length;_<v;_++)w[_]&&w[_].call(this,p||{});return this.__eventListeners[u]=w.filter(function(y){return y!==!1}),this}e.Observable={fire:l,on:s,once:m,off:o}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var f=0,s=arguments.length;f<s;f++)this._onObjectAdded(arguments[f]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(f,s,d){var m=this._objects;return d?m[s]=f:m.splice(s,0,f),this._onObjectAdded&&this._onObjectAdded(f),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var f=this._objects,s,d=!1,m=0,o=arguments.length;m<o;m++)s=f.indexOf(arguments[m]),s!==-1&&(d=!0,f.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[m]));return this.renderOnAddRemove&&d&&this.requestRenderAll(),this},forEachObject:function(f,s){for(var d=this.getObjects(),m=0,o=d.length;m<o;m++)f.call(s,d[m],m,d);return this},getObjects:function(f){return typeof f>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===f})},item:function(f){return this._objects[f]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(f,s){return this._objects.indexOf(f)>-1?!0:s?this._objects.some(function(d){return typeof d.contains=="function"&&d.contains(f,!0)}):!1},complexity:function(){return this._objects.reduce(function(f,s){return f+=s.complexity?s.complexity():0,f},0)}},e.CommonMethods={_setOptions:function(f){for(var s in f)this.set(s,f[s])},_initGradient:function(f,s){f&&f.colorStops&&!(f instanceof e.Gradient)&&this.set(s,new e.Gradient(f))},_initPattern:function(f,s,d){f&&f.source&&!(f instanceof e.Pattern)?this.set(s,new e.Pattern(f,d)):d&&d()},_setObject:function(f){for(var s in f)this._set(s,f[s])},set:function(f,s){return typeof f=="object"?this._setObject(f):this._set(f,s),this},_set:function(f,s){this[f]=s},toggle:function(f){var s=this.get(f);return typeof s=="boolean"&&this.set(f,!s),this},get:function(f){return this[f]}},function(f){var s=Math.sqrt,d=Math.atan2,m=Math.pow,o=Math.PI/180,l=Math.PI/2;e.util={cos:function(u){if(u===0)return 1;u<0&&(u=-u);var p=u/l;switch(p){case 1:case 3:return 0;case 2:return-1}return Math.cos(u)},sin:function(u){if(u===0)return 0;var p=u/l,w=1;switch(u<0&&(w=-1),p){case 1:return w;case 2:return 0;case 3:return-w}return Math.sin(u)},removeFromArray:function(u,p){var w=u.indexOf(p);return w!==-1&&u.splice(w,1),u},getRandomInt:function(u,p){return Math.floor(Math.random()*(p-u+1))+u},degreesToRadians:function(u){return u*o},radiansToDegrees:function(u){return u/o},rotatePoint:function(u,p,w){var _=new e.Point(u.x-p.x,u.y-p.y),v=e.util.rotateVector(_,w);return new e.Point(v.x,v.y).addEquals(p)},rotateVector:function(u,p){var w=e.util.sin(p),_=e.util.cos(p),v=u.x*_-u.y*w,y=u.x*w+u.y*_;return{x:v,y}},createVector:function(u,p){return new e.Point(p.x-u.x,p.y-u.y)},calcAngleBetweenVectors:function(u,p){return Math.acos((u.x*p.x+u.y*p.y)/(Math.hypot(u.x,u.y)*Math.hypot(p.x,p.y)))},getHatVector:function(u){return new e.Point(u.x,u.y).multiply(1/Math.hypot(u.x,u.y))},getBisector:function(u,p,w){var _=e.util.createVector(u,p),v=e.util.createVector(u,w),y=e.util.calcAngleBetweenVectors(_,v),T=e.util.calcAngleBetweenVectors(e.util.rotateVector(_,y),v),C=y*(T===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(_,C)),angle:y}},projectStrokeOnPoints:function(u,p,w){var _=[],v=p.strokeWidth/2,y=p.strokeUniform?new e.Point(1/p.scaleX,1/p.scaleY):new e.Point(1,1),T=function(C){var P=v/Math.hypot(C.x,C.y);return new e.Point(C.x*P*y.x,C.y*P*y.y)};return u.length<=1||u.forEach(function(C,P){var O=new e.Point(C.x,C.y),D,L;P===0?(L=u[P+1],D=w?T(e.util.createVector(L,O)).addEquals(O):u[u.length-1]):P===u.length-1?(D=u[P-1],L=w?T(e.util.createVector(D,O)).addEquals(O):u[0]):(D=u[P-1],L=u[P+1]);var W=e.util.getBisector(O,D,L),U=W.vector,te=W.angle,pe,ne;if(p.strokeLineJoin==="miter"&&(pe=-v/Math.sin(te/2),ne=new e.Point(U.x*pe*y.x,U.y*pe*y.y),Math.hypot(ne.x,ne.y)/v<=p.strokeMiterLimit)){_.push(O.add(ne)),_.push(O.subtract(ne));return}pe=-v*Math.SQRT2,ne=new e.Point(U.x*pe*y.x,U.y*pe*y.y),_.push(O.add(ne)),_.push(O.subtract(ne))}),_},transformPoint:function(u,p,w){return w?new e.Point(p[0]*u.x+p[2]*u.y,p[1]*u.x+p[3]*u.y):new e.Point(p[0]*u.x+p[2]*u.y+p[4],p[1]*u.x+p[3]*u.y+p[5])},makeBoundingBoxFromPoints:function(u,p){if(p)for(var w=0;w<u.length;w++)u[w]=e.util.transformPoint(u[w],p);var _=[u[0].x,u[1].x,u[2].x,u[3].x],v=e.util.array.min(_),y=e.util.array.max(_),T=y-v,C=[u[0].y,u[1].y,u[2].y,u[3].y],P=e.util.array.min(C),O=e.util.array.max(C),D=O-P;return{left:v,top:P,width:T,height:D}},invertTransform:function(u){var p=1/(u[0]*u[3]-u[1]*u[2]),w=[p*u[3],-p*u[1],-p*u[2],p*u[0]],_=e.util.transformPoint({x:u[4],y:u[5]},w,!0);return w[4]=-_.x,w[5]=-_.y,w},toFixed:function(u,p){return parseFloat(Number(u).toFixed(p))},parseUnit:function(u,p){var w=/\D{0,2}$/.exec(u),_=parseFloat(u);switch(p||(p=e.Text.DEFAULT_SVG_FONT_SIZE),w[0]){case"mm":return _*e.DPI/25.4;case"cm":return _*e.DPI/2.54;case"in":return _*e.DPI;case"pt":return _*e.DPI/72;case"pc":return _*e.DPI/72*12;case"em":return _*p;default:return _}},falseFunction:function(){return!1},getKlass:function(u,p){return u=e.util.string.camelize(u.charAt(0).toUpperCase()+u.slice(1)),e.util.resolveNamespace(p)[u]},getSvgAttributes:function(u){var p=["instantiated_by_use","style","id","class"];switch(u){case"linearGradient":p=p.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":p=p.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":p=p.concat(["offset","stop-color","stop-opacity"]);break}return p},resolveNamespace:function(u){if(!u)return e;var p=u.split("."),w=p.length,_,v=f||e.window;for(_=0;_<w;++_)v=v[p[_]];return v},loadImage:function(u,p,w,_){if(!u){p&&p.call(w,u);return}var v=e.util.createImage(),y=function(){p&&p.call(w,v,!1),v=v.onload=v.onerror=null};v.onload=y,v.onerror=function(){e.log("Error loading "+v.src),p&&p.call(w,null,!0),v=v.onload=v.onerror=null},u.indexOf("data")!==0&&_!==void 0&&_!==null&&(v.crossOrigin=_),u.substring(0,14)==="data:image/svg"&&(v.onload=null,e.util.loadImageInDom(v,y)),v.src=u},loadImageInDom:function(u,p){var w=e.document.createElement("div");w.style.width=w.style.height="1px",w.style.left=w.style.top="-100%",w.style.position="absolute",w.appendChild(u),e.document.querySelector("body").appendChild(w),u.onload=function(){p(),w.parentNode.removeChild(w),w=null}},enlivenObjects:function(u,p,w,_){u=u||[];var v=[],y=0,T=u.length;function C(){++y===T&&p&&p(v.filter(function(P){return P}))}if(!T){p&&p(v);return}u.forEach(function(P,O){if(!P||!P.type){C();return}var D=e.util.getKlass(P.type,w);D.fromObject(P,function(L,W){W||(v[O]=L),_&&_(P,L,W),C()})})},enlivenObjectEnlivables:function(u,p,w){var _=e.Object.ENLIVEN_PROPS.filter(function(v){return!!u[v]});e.util.enlivenObjects(_.map(function(v){return u[v]}),function(v){var y={};_.forEach(function(T,C){y[T]=v[C],p&&(p[T]=v[C])}),w&&w(y)})},enlivenPatterns:function(u,p){u=u||[];function w(){++v===y&&p&&p(_)}var _=[],v=0,y=u.length;if(!y){p&&p(_);return}u.forEach(function(T,C){T&&T.source?new e.Pattern(T,function(P){_[C]=P,w()}):(_[C]=T,w())})},groupSVGElements:function(u,p,w){var _;return u&&u.length===1?(typeof w<"u"&&(u[0].sourcePath=w),u[0]):(p&&(p.width&&p.height?p.centerPoint={x:p.width/2,y:p.height/2}:(delete p.width,delete p.height)),_=new e.Group(u,p),typeof w<"u"&&(_.sourcePath=w),_)},populateWithProperties:function(u,p,w){if(w&&Array.isArray(w))for(var _=0,v=w.length;_<v;_++)w[_]in u&&(p[w[_]]=u[w[_]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(u){var p=e.util.createCanvasElement();return p.width=u.width,p.height=u.height,p.getContext("2d").drawImage(u,0,0),p},toDataURL:function(u,p,w){return u.toDataURL("image/"+p,w)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(u,p,w){return[u[0]*p[0]+u[2]*p[1],u[1]*p[0]+u[3]*p[1],u[0]*p[2]+u[2]*p[3],u[1]*p[2]+u[3]*p[3],w?0:u[0]*p[4]+u[2]*p[5]+u[4],w?0:u[1]*p[4]+u[3]*p[5]+u[5]]},qrDecompose:function(u){var p=d(u[1],u[0]),w=m(u[0],2)+m(u[1],2),_=s(w),v=(u[0]*u[3]-u[2]*u[1])/_,y=d(u[0]*u[2]+u[1]*u[3],w);return{angle:p/o,scaleX:_,scaleY:v,skewX:y/o,skewY:0,translateX:u[4],translateY:u[5]}},calcRotateMatrix:function(u){if(!u.angle)return e.iMatrix.concat();var p=e.util.degreesToRadians(u.angle),w=e.util.cos(p),_=e.util.sin(p);return[w,_,-_,w,0,0]},calcDimensionsMatrix:function(u){var p=typeof u.scaleX>"u"?1:u.scaleX,w=typeof u.scaleY>"u"?1:u.scaleY,_=[u.flipX?-p:p,0,0,u.flipY?-w:w,0,0],v=e.util.multiplyTransformMatrices,y=e.util.degreesToRadians;return u.skewX&&(_=v(_,[1,0,Math.tan(y(u.skewX)),1],!0)),u.skewY&&(_=v(_,[1,Math.tan(y(u.skewY)),0,1],!0)),_},composeMatrix:function(u){var p=[1,0,0,1,u.translateX||0,u.translateY||0],w=e.util.multiplyTransformMatrices;return u.angle&&(p=w(p,e.util.calcRotateMatrix(u))),(u.scaleX!==1||u.scaleY!==1||u.skewX||u.skewY||u.flipX||u.flipY)&&(p=w(p,e.util.calcDimensionsMatrix(u))),p},resetObjectTransform:function(u){u.scaleX=1,u.scaleY=1,u.skewX=0,u.skewY=0,u.flipX=!1,u.flipY=!1,u.rotate(0)},saveObjectTransform:function(u){return{scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,angle:u.angle,left:u.left,flipX:u.flipX,flipY:u.flipY,top:u.top}},isTransparent:function(u,p,w,_){_>0&&(p>_?p-=_:p=0,w>_?w-=_:w=0);var v=!0,y,T,C=u.getImageData(p,w,_*2||1,_*2||1),P=C.data.length;for(y=3;y<P&&(T=C.data[y],v=T<=0,v!==!1);y+=4);return C=null,v},parsePreserveAspectRatioAttribute:function(u){var p="meet",w="Mid",_="Mid",v=u.split(" "),y;return v&&v.length&&(p=v.pop(),p!=="meet"&&p!=="slice"?(y=p,p="meet"):v.length&&(y=v.pop())),w=y!=="none"?y.slice(1,4):"none",_=y!=="none"?y.slice(5,8):"none",{meetOrSlice:p,alignX:w,alignY:_}},clearFabricFontCache:function(u){u=(u||"").toLowerCase(),u?e.charWidthsCache[u]&&delete e.charWidthsCache[u]:e.charWidthsCache={}},limitDimsByArea:function(u,p){var w=Math.sqrt(p*u),_=Math.floor(p/w);return{x:Math.floor(w),y:_}},capValue:function(u,p,w){return Math.max(u,Math.min(p,w))},findScaleToFit:function(u,p){return Math.min(p.width/u.width,p.height/u.height)},findScaleToCover:function(u,p){return Math.max(p.width/u.width,p.height/u.height)},matrixToSVG:function(u){return"matrix("+u.map(function(p){return e.util.toFixed(p,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(u,p){var w=e.util.invertTransform(p),_=e.util.multiplyTransformMatrices(w,u.calcOwnMatrix());e.util.applyTransformToObject(u,_)},addTransformToObject:function(u,p){e.util.applyTransformToObject(u,e.util.multiplyTransformMatrices(p,u.calcOwnMatrix()))},applyTransformToObject:function(u,p){var w=e.util.qrDecompose(p),_=new e.Point(w.translateX,w.translateY);u.flipX=!1,u.flipY=!1,u.set("scaleX",w.scaleX),u.set("scaleY",w.scaleY),u.skewX=w.skewX,u.skewY=w.skewY,u.angle=w.angle,u.setPositionByOrigin(_,"center","center")},sizeAfterTransform:function(u,p,w){var _=u/2,v=p/2,y=[{x:-_,y:-v},{x:_,y:-v},{x:-_,y:v},{x:_,y:v}],T=e.util.calcDimensionsMatrix(w),C=e.util.makeBoundingBoxFromPoints(y,T);return{x:C.width,y:C.height}},mergeClipPaths:function(u,p){var w=u,_=p;w.inverted&&!_.inverted&&(w=p,_=u),e.util.applyTransformToObject(_,e.util.multiplyTransformMatrices(e.util.invertTransform(w.calcTransformMatrix()),_.calcTransformMatrix()));var v=w.inverted&&_.inverted;return v&&(w.inverted=_.inverted=!1),new e.Group([w],{clipPath:_,inverted:v})},hasStyleChanged:function(u,p,w){return w=w||!1,u.fill!==p.fill||u.stroke!==p.stroke||u.strokeWidth!==p.strokeWidth||u.fontSize!==p.fontSize||u.fontFamily!==p.fontFamily||u.fontWeight!==p.fontWeight||u.fontStyle!==p.fontStyle||u.textBackgroundColor!==p.textBackgroundColor||u.deltaY!==p.deltaY||w&&(u.overline!==p.overline||u.underline!==p.underline||u.linethrough!==p.linethrough)},stylesToArray:function(w,p){for(var w=e.util.object.clone(w,!0),_=p.split(`
`),v=-1,y={},T=[],C=0;C<_.length;C++){if(!w[C]){v+=_[C].length;continue}for(var P=0;P<_[C].length;P++){v++;var O=w[C][P];if(O&&Object.keys(O).length>0){var D=e.util.hasStyleChanged(y,O,!0);D?T.push({start:v,end:v+1,style:O}):T[T.length-1].end++}y=O||{}}}return T},stylesFromArray:function(u,p){if(!Array.isArray(u))return u;for(var w=p.split(`
`),_=-1,v=0,y={},T=0;T<w.length;T++)for(var C=0;C<w[T].length;C++)_++,u[v]&&u[v].start<=_&&_<u[v].end&&(y[T]=y[T]||{},y[T][C]=Object.assign({},u[v].style),_===u[v].end-1&&v++);return y}}}(t),function(){var f=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},d={m:"l",M:"L"};function m(K,re,X,N,ae,J,Y,be,Ce,Ue,Ve){var Ie=e.util.cos(K),he=e.util.sin(K),Fe=e.util.cos(re),ee=e.util.sin(re),we=X*ae*Fe-N*J*ee+Y,Re=N*ae*Fe+X*J*ee+be,Be=Ue+Ce*(-X*ae*he-N*J*Ie),Se=Ve+Ce*(-N*ae*he+X*J*Ie),Ne=we+Ce*(X*ae*ee+N*J*Fe),ze=Re+Ce*(N*ae*ee-X*J*Fe);return["C",Be,Se,Ne,ze,we,Re]}function o(K,re,X,N,ae,J,Y){var be=Math.PI,Ce=Y*be/180,Ue=e.util.sin(Ce),Ve=e.util.cos(Ce),Ie=0,he=0;X=Math.abs(X),N=Math.abs(N);var Fe=-Ve*K*.5-Ue*re*.5,ee=-Ve*re*.5+Ue*K*.5,we=X*X,Re=N*N,Be=ee*ee,Se=Fe*Fe,Ne=we*Re-we*Be-Re*Se,ze=0;if(Ne<0){var rt=Math.sqrt(1-Ne/(we*Re));X*=rt,N*=rt}else ze=(ae===J?-1:1)*Math.sqrt(Ne/(we*Be+Re*Se));var nt=ze*X*ee/N,Ge=-ze*N*Fe/X,qe=Ve*nt-Ue*Ge+K*.5,gt=Ue*nt+Ve*Ge+re*.5,ct=l(1,0,(Fe-nt)/X,(ee-Ge)/N),wt=l((Fe-nt)/X,(ee-Ge)/N,(-Fe-nt)/X,(-ee-Ge)/N);J===0&&wt>0?wt-=2*be:J===1&&wt<0&&(wt+=2*be);for(var bt=Math.ceil(Math.abs(wt/be*2)),Ct=[],It=wt/bt,jt=8/3*Math.sin(It/4)*Math.sin(It/4)/Math.sin(It/2),Fr=ct+It,lr=0;lr<bt;lr++)Ct[lr]=m(ct,Fr,Ve,Ue,X,N,qe,gt,jt,Ie,he),Ie=Ct[lr][5],he=Ct[lr][6],ct=Fr,Fr+=It;return Ct}function l(K,re,X,N){var ae=Math.atan2(re,K),J=Math.atan2(N,X);return J>=ae?J-ae:2*Math.PI-(ae-J)}function u(K,re,X,N,ae,J,Y,be){var Ce;if(e.cachesBoundsOfCurve&&(Ce=f.call(arguments),e.boundsOfCurveCache[Ce]))return e.boundsOfCurveCache[Ce];var Ue=Math.sqrt,Ve=Math.min,Ie=Math.max,he=Math.abs,Fe=[],ee=[[],[]],we,Re,Be,Se,Ne,ze,rt,nt;Re=6*K-12*X+6*ae,we=-3*K+9*X-9*ae+3*Y,Be=3*X-3*K;for(var Ge=0;Ge<2;++Ge){if(Ge>0&&(Re=6*re-12*N+6*J,we=-3*re+9*N-9*J+3*be,Be=3*N-3*re),he(we)<1e-12){if(he(Re)<1e-12)continue;Se=-Be/Re,0<Se&&Se<1&&Fe.push(Se);continue}rt=Re*Re-4*Be*we,!(rt<0)&&(nt=Ue(rt),Ne=(-Re+nt)/(2*we),0<Ne&&Ne<1&&Fe.push(Ne),ze=(-Re-nt)/(2*we),0<ze&&ze<1&&Fe.push(ze))}for(var qe,gt,ct=Fe.length,wt=ct,bt;ct--;)Se=Fe[ct],bt=1-Se,qe=bt*bt*bt*K+3*bt*bt*Se*X+3*bt*Se*Se*ae+Se*Se*Se*Y,ee[0][ct]=qe,gt=bt*bt*bt*re+3*bt*bt*Se*N+3*bt*Se*Se*J+Se*Se*Se*be,ee[1][ct]=gt;ee[0][wt]=K,ee[1][wt]=re,ee[0][wt+1]=Y,ee[1][wt+1]=be;var Ct=[{x:Ve.apply(null,ee[0]),y:Ve.apply(null,ee[1])},{x:Ie.apply(null,ee[0]),y:Ie.apply(null,ee[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[Ce]=Ct),Ct}function p(K,re,X){for(var N=X[1],ae=X[2],J=X[3],Y=X[4],be=X[5],Ce=X[6],Ue=X[7],Ve=o(Ce-K,Ue-re,N,ae,Y,be,J),Ie=0,he=Ve.length;Ie<he;Ie++)Ve[Ie][1]+=K,Ve[Ie][2]+=re,Ve[Ie][3]+=K,Ve[Ie][4]+=re,Ve[Ie][5]+=K,Ve[Ie][6]+=re;return Ve}function w(K){var re=0,X=0,N=K.length,ae=0,J=0,Y,be,Ce,Ue=[],Ve,Ie,he;for(be=0;be<N;++be){switch(Ce=!1,Y=K[be].slice(0),Y[0]){case"l":Y[0]="L",Y[1]+=re,Y[2]+=X;case"L":re=Y[1],X=Y[2];break;case"h":Y[1]+=re;case"H":Y[0]="L",Y[2]=X,re=Y[1];break;case"v":Y[1]+=X;case"V":Y[0]="L",X=Y[1],Y[1]=re,Y[2]=X;break;case"m":Y[0]="M",Y[1]+=re,Y[2]+=X;case"M":re=Y[1],X=Y[2],ae=Y[1],J=Y[2];break;case"c":Y[0]="C",Y[1]+=re,Y[2]+=X,Y[3]+=re,Y[4]+=X,Y[5]+=re,Y[6]+=X;case"C":Ie=Y[3],he=Y[4],re=Y[5],X=Y[6];break;case"s":Y[0]="S",Y[1]+=re,Y[2]+=X,Y[3]+=re,Y[4]+=X;case"S":Ve==="C"?(Ie=2*re-Ie,he=2*X-he):(Ie=re,he=X),re=Y[3],X=Y[4],Y[0]="C",Y[5]=Y[3],Y[6]=Y[4],Y[3]=Y[1],Y[4]=Y[2],Y[1]=Ie,Y[2]=he,Ie=Y[3],he=Y[4];break;case"q":Y[0]="Q",Y[1]+=re,Y[2]+=X,Y[3]+=re,Y[4]+=X;case"Q":Ie=Y[1],he=Y[2],re=Y[3],X=Y[4];break;case"t":Y[0]="T",Y[1]+=re,Y[2]+=X;case"T":Ve==="Q"?(Ie=2*re-Ie,he=2*X-he):(Ie=re,he=X),Y[0]="Q",re=Y[1],X=Y[2],Y[1]=Ie,Y[2]=he,Y[3]=re,Y[4]=X;break;case"a":Y[0]="A",Y[6]+=re,Y[7]+=X;case"A":Ce=!0,Ue=Ue.concat(p(re,X,Y)),re=Y[6],X=Y[7];break;case"z":case"Z":re=ae,X=J;break}Ce||Ue.push(Y),Ve=Y[0]}return Ue}function _(K,re,X,N){return Math.sqrt((X-K)*(X-K)+(N-re)*(N-re))}function v(K){return K*K*K}function y(K){return 3*K*K*(1-K)}function T(K){return 3*K*(1-K)*(1-K)}function C(K){return(1-K)*(1-K)*(1-K)}function P(K,re,X,N,ae,J,Y,be){return function(Ce){var Ue=v(Ce),Ve=y(Ce),Ie=T(Ce),he=C(Ce);return{x:Y*Ue+ae*Ve+X*Ie+K*he,y:be*Ue+J*Ve+N*Ie+re*he}}}function O(K,re,X,N,ae,J,Y,be){return function(Ce){var Ue=1-Ce,Ve=3*Ue*Ue*(X-K)+6*Ue*Ce*(ae-X)+3*Ce*Ce*(Y-ae),Ie=3*Ue*Ue*(N-re)+6*Ue*Ce*(J-N)+3*Ce*Ce*(be-J);return Math.atan2(Ie,Ve)}}function D(K){return K*K}function L(K){return 2*K*(1-K)}function W(K){return(1-K)*(1-K)}function U(K,re,X,N,ae,J){return function(Y){var be=D(Y),Ce=L(Y),Ue=W(Y);return{x:ae*be+X*Ce+K*Ue,y:J*be+N*Ce+re*Ue}}}function te(K,re,X,N,ae,J){return function(Y){var be=1-Y,Ce=2*be*(X-K)+2*Y*(ae-X),Ue=2*be*(N-re)+2*Y*(J-N);return Math.atan2(Ue,Ce)}}function pe(K,re,X){var N={x:re,y:X},ae,J=0,Y;for(Y=1;Y<=100;Y+=1)ae=K(Y/100),J+=_(N.x,N.y,ae.x,ae.y),N=ae;return J}function ne(K,re){for(var X=0,N=0,ae=K.iterator,J={x:K.x,y:K.y},Y,be,Ce=.01,Ue=K.angleFinder,Ve;N<re&&Ce>1e-4;)Y=ae(X),Ve=X,be=_(J.x,J.y,Y.x,Y.y),be+N>re?(X-=Ce,Ce/=2):(J=Y,X+=Ce,N+=be);return Y.angle=Ue(Ve),Y}function ye(K){for(var re=0,X=K.length,N,ae=0,J=0,Y=0,be=0,Ce=[],Ue,Ve,Ie,he=0;he<X;he++){switch(N=K[he],Ve={x:ae,y:J,command:N[0]},N[0]){case"M":Ve.length=0,Y=ae=N[1],be=J=N[2];break;case"L":Ve.length=_(ae,J,N[1],N[2]),ae=N[1],J=N[2];break;case"C":Ue=P(ae,J,N[1],N[2],N[3],N[4],N[5],N[6]),Ie=O(ae,J,N[1],N[2],N[3],N[4],N[5],N[6]),Ve.iterator=Ue,Ve.angleFinder=Ie,Ve.length=pe(Ue,ae,J),ae=N[5],J=N[6];break;case"Q":Ue=U(ae,J,N[1],N[2],N[3],N[4]),Ie=te(ae,J,N[1],N[2],N[3],N[4]),Ve.iterator=Ue,Ve.angleFinder=Ie,Ve.length=pe(Ue,ae,J),ae=N[3],J=N[4];break;case"Z":case"z":Ve.destX=Y,Ve.destY=be,Ve.length=_(ae,J,Y,be),ae=Y,J=be;break}re+=Ve.length,Ce.push(Ve)}return Ce.push({length:re,x:ae,y:J}),Ce}function ce(K,re,X){X||(X=ye(K));for(var N=0;re-X[N].length>0&&N<X.length-2;)re-=X[N].length,N++;var ae=X[N],J=re/ae.length,Y=ae.command,be=K[N],Ce;switch(Y){case"M":return{x:ae.x,y:ae.y,angle:0};case"Z":case"z":return Ce=new e.Point(ae.x,ae.y).lerp(new e.Point(ae.destX,ae.destY),J),Ce.angle=Math.atan2(ae.destY-ae.y,ae.destX-ae.x),Ce;case"L":return Ce=new e.Point(ae.x,ae.y).lerp(new e.Point(be[1],be[2]),J),Ce.angle=Math.atan2(be[2]-ae.y,be[1]-ae.x),Ce;case"C":return ne(ae,re);case"Q":return ne(ae,re)}}function Me(K){var re=[],X=[],N,ae,J=e.rePathCommand,Y="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",be="("+Y+")"+e.commaWsp,Ce="([01])"+e.commaWsp+"?",Ue=be+"?"+be+"?"+be+Ce+Ce+be+"?("+Y+")",Ve=new RegExp(Ue,"g"),Ie,he,Fe;if(!K||!K.match)return re;Fe=K.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var ee=0,we,Re=Fe.length;ee<Re;ee++){N=Fe[ee],he=N.slice(1).trim(),X.length=0;var Be=N.charAt(0);if(we=[Be],Be.toLowerCase()==="a")for(var Se;Se=Ve.exec(he);)for(var Ne=1;Ne<Se.length;Ne++)X.push(Se[Ne]);else for(;Ie=J.exec(he);)X.push(Ie[0]);for(var Ne=0,ze=X.length;Ne<ze;Ne++)ae=parseFloat(X[Ne]),isNaN(ae)||we.push(ae);var rt=s[Be.toLowerCase()],nt=d[Be]||Be;if(we.length-1>rt)for(var Ge=1,qe=we.length;Ge<qe;Ge+=rt)re.push([Be].concat(we.slice(Ge,Ge+rt))),Be=nt;else re.push(we)}return re}function ke(K,re){var X=[],N,ae=new e.Point(K[0].x,K[0].y),J=new e.Point(K[1].x,K[1].y),Y=K.length,be=1,Ce=0,Ue=Y>2;for(re=re||0,Ue&&(be=K[2].x<J.x?-1:K[2].x===J.x?0:1,Ce=K[2].y<J.y?-1:K[2].y===J.y?0:1),X.push(["M",ae.x-be*re,ae.y-Ce*re]),N=1;N<Y;N++){if(!ae.eq(J)){var Ve=ae.midPointFrom(J);X.push(["Q",ae.x,ae.y,Ve.x,Ve.y])}ae=K[N],N+1<K.length&&(J=K[N+1])}return Ue&&(be=ae.x>K[N-2].x?1:ae.x===K[N-2].x?0:-1,Ce=ae.y>K[N-2].y?1:ae.y===K[N-2].y?0:-1),X.push(["L",ae.x+be*re,ae.y+Ce*re]),X}function ve(K,re,X){return X&&(re=e.util.multiplyTransformMatrices(re,[1,0,0,1,-X.x,-X.y])),K.map(function(N){for(var ae=N.slice(0),J={},Y=1;Y<N.length-1;Y+=2)J.x=N[Y],J.y=N[Y+1],J=e.util.transformPoint(J,re),ae[Y]=J.x,ae[Y+1]=J.y;return ae})}e.util.joinPath=function(K){return K.map(function(re){return re.join(" ")}).join(" ")},e.util.parsePath=Me,e.util.makePathSimpler=w,e.util.getSmoothPathFromPoints=ke,e.util.getPathSegmentsInfo=ye,e.util.getBoundsOfCurve=u,e.util.getPointOnPath=ce,e.util.transformPath=ve}(),function(){var f=Array.prototype.slice;function s(u,p){for(var w=f.call(arguments,2),_=[],v=0,y=u.length;v<y;v++)_[v]=w.length?u[v][p].apply(u[v],w):u[v][p].call(u[v]);return _}function d(u,p){return l(u,p,function(w,_){return w>=_})}function m(u,p){return l(u,p,function(w,_){return w<_})}function o(u,p){for(var w=u.length;w--;)u[w]=p;return u}function l(u,p,w){if(!(!u||u.length===0)){var _=u.length-1,v=p?u[_][p]:u[_];if(p)for(;_--;)w(u[_][p],v)&&(v=u[_][p]);else for(;_--;)w(u[_],v)&&(v=u[_]);return v}}e.util.array={fill:o,invoke:s,min:m,max:d}}(),function(){function f(d,m,o){if(o)if(!e.isLikelyNode&&m instanceof Element)d=m;else if(m instanceof Array){d=[];for(var l=0,u=m.length;l<u;l++)d[l]=f({},m[l],o)}else if(m&&typeof m=="object")for(var p in m)p==="canvas"||p==="group"?d[p]=null:m.hasOwnProperty(p)&&(d[p]=f({},m[p],o));else d=m;else for(var p in m)d[p]=m[p];return d}function s(d,m){return f({},d,m)}e.util.object={extend:f,clone:s},e.util.object.extend(e.util,e.Observable)}(),function(){function f(l){return l.replace(/-+(.)?/g,function(u,p){return p?p.toUpperCase():""})}function s(l,u){return l.charAt(0).toUpperCase()+(u?l.slice(1):l.slice(1).toLowerCase())}function d(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function m(l){var u=0,p,w=[];for(u=0,p;u<l.length;u++)(p=o(l,u))!==!1&&w.push(p);return w}function o(l,u){var p=l.charCodeAt(u);if(isNaN(p))return"";if(p<55296||p>57343)return l.charAt(u);if(55296<=p&&p<=56319){if(l.length<=u+1)throw"High surrogate without following low surrogate";var w=l.charCodeAt(u+1);if(56320>w||w>57343)throw"High surrogate without following low surrogate";return l.charAt(u)+l.charAt(u+1)}if(u===0)throw"Low surrogate without preceding high surrogate";var _=l.charCodeAt(u-1);if(55296>_||_>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:f,capitalize:s,escapeXml:d,graphemeSplit:m}}(),function(){var f=Array.prototype.slice,s=function(){},d=function(){for(var p in{toString:1})if(p==="toString")return!1;return!0}(),m=function(p,w,_){for(var v in w)v in p.prototype&&typeof p.prototype[v]=="function"&&(w[v]+"").indexOf("callSuper")>-1?p.prototype[v]=function(y){return function(){var T=this.constructor.superclass;this.constructor.superclass=_;var C=w[y].apply(this,arguments);if(this.constructor.superclass=T,y!=="initialize")return C}}(v):p.prototype[v]=w[v],d&&(w.toString!==Object.prototype.toString&&(p.prototype.toString=w.toString),w.valueOf!==Object.prototype.valueOf&&(p.prototype.valueOf=w.valueOf))};function o(){}function l(p){for(var w=null,_=this;_.constructor.superclass;){var v=_.constructor.superclass.prototype[p];if(_[p]!==v){w=v;break}_=_.constructor.superclass.prototype}return w?arguments.length>1?w.apply(this,f.call(arguments,1)):w.call(this):console.log("tried to callSuper "+p+", method not found in prototype chain",this)}function u(){var p=null,w=f.call(arguments,0);typeof w[0]=="function"&&(p=w.shift());function _(){this.initialize.apply(this,arguments)}_.superclass=p,_.subclasses=[],p&&(o.prototype=p.prototype,_.prototype=new o,p.subclasses.push(_));for(var v=0,y=w.length;v<y;v++)m(_,w[v],p);return _.prototype.initialize||(_.prototype.initialize=s),_.prototype.constructor=_,_.prototype.callSuper=l,_}e.util.createClass=u}(),function(){var f=!!e.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];e.util.addListener=function(m,o,l,u){m&&m.addEventListener(o,l,f?!1:u)},e.util.removeListener=function(m,o,l,u){m&&m.removeEventListener(o,l,f?!1:u)};function d(m){var o=m.changedTouches;return o&&o[0]?o[0]:m}e.util.getPointer=function(m){var o=m.target,l=e.util.getScrollLeftTop(o),u=d(m);return{x:u.clientX+l.left,y:u.clientY+l.top}},e.util.isTouchEvent=function(m){return s.indexOf(m.type)>-1||m.pointerType==="touch"}}(),function(){function f(u,p){var w=u.style;if(!w)return u;if(typeof p=="string")return u.style.cssText+=";"+p,p.indexOf("opacity")>-1?l(u,p.match(/opacity:\s*(\d?\.?\d*)/)[1]):u;for(var _ in p)if(_==="opacity")l(u,p[_]);else{var v=_==="float"||_==="cssFloat"?typeof w.styleFloat>"u"?"cssFloat":"styleFloat":_;w.setProperty(v,p[_])}return u}var s=e.document.createElement("div"),d=typeof s.style.opacity=="string",m=typeof s.style.filter=="string",o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,l=function(u){return u};d?l=function(u,p){return u.style.opacity=p,u}:m&&(l=function(u,p){var w=u.style;return u.currentStyle&&!u.currentStyle.hasLayout&&(w.zoom=1),o.test(w.filter)?(p=p>=.9999?"":"alpha(opacity="+p*100+")",w.filter=w.filter.replace(o,p)):w.filter+=" alpha(opacity="+p*100+")",u}),e.util.setStyle=f}(),function(){var f=Array.prototype.slice;function s(C){return typeof C=="string"?e.document.getElementById(C):C}var d,m=function(C){return f.call(C,0)};try{d=m(e.document.childNodes)instanceof Array}catch{}d||(m=function(C){for(var P=new Array(C.length),O=C.length;O--;)P[O]=C[O];return P});function o(C,P){var O=e.document.createElement(C);for(var D in P)D==="class"?O.className=P[D]:D==="for"?O.htmlFor=P[D]:O.setAttribute(D,P[D]);return O}function l(C,P){C&&(" "+C.className+" ").indexOf(" "+P+" ")===-1&&(C.className+=(C.className?" ":"")+P)}function u(C,P,O){return typeof P=="string"&&(P=o(P,O)),C.parentNode&&C.parentNode.replaceChild(P,C),P.appendChild(C),P}function p(C){for(var P=0,O=0,D=e.document.documentElement,L=e.document.body||{scrollLeft:0,scrollTop:0};C&&(C.parentNode||C.host)&&(C=C.parentNode||C.host,C===e.document?(P=L.scrollLeft||D.scrollLeft||0,O=L.scrollTop||D.scrollTop||0):(P+=C.scrollLeft||0,O+=C.scrollTop||0),!(C.nodeType===1&&C.style.position==="fixed")););return{left:P,top:O}}function w(C){var P,O=C&&C.ownerDocument,D={left:0,top:0},L={left:0,top:0},W,U={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!O)return L;for(var te in U)L[U[te]]+=parseInt(_(C,te),10)||0;return P=O.documentElement,typeof C.getBoundingClientRect<"u"&&(D=C.getBoundingClientRect()),W=p(C),{left:D.left+W.left-(P.clientLeft||0)+L.left,top:D.top+W.top-(P.clientTop||0)+L.top}}var _;e.document.defaultView&&e.document.defaultView.getComputedStyle?_=function(C,P){var O=e.document.defaultView.getComputedStyle(C,null);return O?O[P]:void 0}:_=function(C,P){var O=C.style[P];return!O&&C.currentStyle&&(O=C.currentStyle[P]),O},function(){var C=e.document.documentElement.style,P="userSelect"in C?"userSelect":"MozUserSelect"in C?"MozUserSelect":"WebkitUserSelect"in C?"WebkitUserSelect":"KhtmlUserSelect"in C?"KhtmlUserSelect":"";function O(L){return typeof L.onselectstart<"u"&&(L.onselectstart=e.util.falseFunction),P?L.style[P]="none":typeof L.unselectable=="string"&&(L.unselectable="on"),L}function D(L){return typeof L.onselectstart<"u"&&(L.onselectstart=null),P?L.style[P]="":typeof L.unselectable=="string"&&(L.unselectable=""),L}e.util.makeElementUnselectable=O,e.util.makeElementSelectable=D}();function v(C){var P=e.jsdomImplForWrapper(C);return P._canvas||P._image}function y(C){if(!!e.isLikelyNode){var P=e.jsdomImplForWrapper(C);P&&(P._image=null,P._canvas=null,P._currentSrc=null,P._attributes=null,P._classList=null)}}function T(C,P){C.imageSmoothingEnabled=C.imageSmoothingEnabled||C.webkitImageSmoothingEnabled||C.mozImageSmoothingEnabled||C.msImageSmoothingEnabled||C.oImageSmoothingEnabled,C.imageSmoothingEnabled=P}e.util.setImageSmoothing=T,e.util.getById=s,e.util.toArray=m,e.util.addClass=l,e.util.makeElement=o,e.util.wrapElement=u,e.util.getScrollLeftTop=p,e.util.getElementOffset=w,e.util.getNodeCanvas=v,e.util.cleanUpJsdomNode=y}(),function(){function f(m,o){return m+(/\?/.test(m)?"&":"?")+o}function s(){}function d(m,o){o||(o={});var l=o.method?o.method.toUpperCase():"GET",u=o.onComplete||function(){},p=new e.window.XMLHttpRequest,w=o.body||o.parameters;return p.onreadystatechange=function(){p.readyState===4&&(u(p),p.onreadystatechange=s)},l==="GET"&&(w=null,typeof o.parameters=="string"&&(m=f(m,o.parameters))),p.open(l,m,!0),(l==="POST"||l==="PUT")&&p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.send(w),p}e.util.request=d}(),e.log=console.log,e.warn=console.warn,function(){var f=e.util.object.extend,s=e.util.object.clone,d=[];e.util.object.extend(d,{cancelAll:function(){var v=this.splice(0);return v.forEach(function(y){y.cancel()}),v},cancelByCanvas:function(v){if(!v)return[];var y=this.filter(function(T){return typeof T.target=="object"&&T.target.canvas===v});return y.forEach(function(T){T.cancel()}),y},cancelByTarget:function(v){var y=this.findAnimationsByTarget(v);return y.forEach(function(T){T.cancel()}),y},findAnimationIndex:function(v){return this.indexOf(this.findAnimation(v))},findAnimation:function(v){return this.find(function(y){return y.cancel===v})},findAnimationsByTarget:function(v){return v?this.filter(function(y){return y.target===v}):[]}});function m(){return!1}function o(v,y,T,C){return-T*Math.cos(v/C*(Math.PI/2))+T+y}function l(v){v||(v={});var y=!1,T,C=function(){var P=e.runningAnimations.indexOf(T);return P>-1&&e.runningAnimations.splice(P,1)[0]};return T=f(s(v),{cancel:function(){return y=!0,C()},currentValue:"startValue"in v?v.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(T),w(function(P){var O=P||+new Date,D=v.duration||500,L=O+D,W,U=v.onChange||m,te=v.abort||m,pe=v.onComplete||m,ne=v.easing||o,ye="startValue"in v?v.startValue.length>0:!1,ce="startValue"in v?v.startValue:0,Me="endValue"in v?v.endValue:100,ke=v.byValue||(ye?ce.map(function(ve,K){return Me[K]-ce[K]}):Me-ce);v.onStart&&v.onStart(),function ve(K){W=K||+new Date;var re=W>L?D:W-O,X=re/D,N=ye?ce.map(function(J,Y){return ne(re,ce[Y],ke[Y],D)}):ne(re,ce,ke,D),ae=Math.abs(ye?(N[0]-ce[0])/ke[0]:(N-ce)/ke);if(T.currentValue=ye?N.slice():N,T.completionRate=ae,T.durationRate=X,!y){if(te(N,ae,X)){C();return}if(W>L){T.currentValue=ye?Me.slice():Me,T.completionRate=1,T.durationRate=1,U(ye?Me.slice():Me,1,1),pe(Me,1,1),C();return}else U(N,ae,X),w(ve)}}(O)}),T.cancel}var u=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(v){return e.window.setTimeout(v,1e3/60)},p=e.window.cancelAnimationFrame||e.window.clearTimeout;function w(){return u.apply(e.window,arguments)}function _(){return p.apply(e.window,arguments)}e.util.animate=l,e.util.requestAnimFrame=w,e.util.cancelAnimFrame=_,e.runningAnimations=d}(),function(){function f(d,m,o){var l="rgba("+parseInt(d[0]+o*(m[0]-d[0]),10)+","+parseInt(d[1]+o*(m[1]-d[1]),10)+","+parseInt(d[2]+o*(m[2]-d[2]),10);return l+=","+(d&&m?parseFloat(d[3]+o*(m[3]-d[3])):1),l+=")",l}function s(d,m,o,l){var u=new e.Color(d).getSource(),p=new e.Color(m).getSource(),w=l.onComplete,_=l.onChange;return l=l||{},e.util.animate(e.util.object.extend(l,{duration:o||500,startValue:u,endValue:p,byValue:p,easing:function(v,y,T,C){var P=l.colorEasing?l.colorEasing(v,C):1-Math.cos(v/C*(Math.PI/2));return f(y,T,P)},onComplete:function(v,y,T){if(w)return w(f(p,p,0),y,T)},onChange:function(v,y,T){if(_){if(Array.isArray(v))return _(f(v,v,0),y,T);_(v,y,T)}}}))}e.util.animateColor=s}(),function(){function f(K,re,X,N){return K<Math.abs(re)?(K=re,N=X/4):re===0&&K===0?N=X/(2*Math.PI)*Math.asin(1):N=X/(2*Math.PI)*Math.asin(re/K),{a:K,c:re,p:X,s:N}}function s(K,re,X){return K.a*Math.pow(2,10*(re-=1))*Math.sin((re*X-K.s)*(2*Math.PI)/K.p)}function d(K,re,X,N){return X*((K=K/N-1)*K*K+1)+re}function m(K,re,X,N){return K/=N/2,K<1?X/2*K*K*K+re:X/2*((K-=2)*K*K+2)+re}function o(K,re,X,N){return X*(K/=N)*K*K*K+re}function l(K,re,X,N){return-X*((K=K/N-1)*K*K*K-1)+re}function u(K,re,X,N){return K/=N/2,K<1?X/2*K*K*K*K+re:-X/2*((K-=2)*K*K*K-2)+re}function p(K,re,X,N){return X*(K/=N)*K*K*K*K+re}function w(K,re,X,N){return X*((K=K/N-1)*K*K*K*K+1)+re}function _(K,re,X,N){return K/=N/2,K<1?X/2*K*K*K*K*K+re:X/2*((K-=2)*K*K*K*K+2)+re}function v(K,re,X,N){return-X*Math.cos(K/N*(Math.PI/2))+X+re}function y(K,re,X,N){return X*Math.sin(K/N*(Math.PI/2))+re}function T(K,re,X,N){return-X/2*(Math.cos(Math.PI*K/N)-1)+re}function C(K,re,X,N){return K===0?re:X*Math.pow(2,10*(K/N-1))+re}function P(K,re,X,N){return K===N?re+X:X*(-Math.pow(2,-10*K/N)+1)+re}function O(K,re,X,N){return K===0?re:K===N?re+X:(K/=N/2,K<1?X/2*Math.pow(2,10*(K-1))+re:X/2*(-Math.pow(2,-10*--K)+2)+re)}function D(K,re,X,N){return-X*(Math.sqrt(1-(K/=N)*K)-1)+re}function L(K,re,X,N){return X*Math.sqrt(1-(K=K/N-1)*K)+re}function W(K,re,X,N){return K/=N/2,K<1?-X/2*(Math.sqrt(1-K*K)-1)+re:X/2*(Math.sqrt(1-(K-=2)*K)+1)+re}function U(K,re,X,N){var ae=1.70158,J=0,Y=X;if(K===0)return re;if(K/=N,K===1)return re+X;J||(J=N*.3);var be=f(Y,X,J,ae);return-s(be,K,N)+re}function te(K,re,X,N){var ae=1.70158,J=0,Y=X;if(K===0)return re;if(K/=N,K===1)return re+X;J||(J=N*.3);var be=f(Y,X,J,ae);return be.a*Math.pow(2,-10*K)*Math.sin((K*N-be.s)*(2*Math.PI)/be.p)+be.c+re}function pe(K,re,X,N){var ae=1.70158,J=0,Y=X;if(K===0)return re;if(K/=N/2,K===2)return re+X;J||(J=N*(.3*1.5));var be=f(Y,X,J,ae);return K<1?-.5*s(be,K,N)+re:be.a*Math.pow(2,-10*(K-=1))*Math.sin((K*N-be.s)*(2*Math.PI)/be.p)*.5+be.c+re}function ne(K,re,X,N,ae){return ae===void 0&&(ae=1.70158),X*(K/=N)*K*((ae+1)*K-ae)+re}function ye(K,re,X,N,ae){return ae===void 0&&(ae=1.70158),X*((K=K/N-1)*K*((ae+1)*K+ae)+1)+re}function ce(K,re,X,N,ae){return ae===void 0&&(ae=1.70158),K/=N/2,K<1?X/2*(K*K*(((ae*=1.525)+1)*K-ae))+re:X/2*((K-=2)*K*(((ae*=1.525)+1)*K+ae)+2)+re}function Me(K,re,X,N){return X-ke(N-K,0,X,N)+re}function ke(K,re,X,N){return(K/=N)<1/2.75?X*(7.5625*K*K)+re:K<2/2.75?X*(7.5625*(K-=1.5/2.75)*K+.75)+re:K<2.5/2.75?X*(7.5625*(K-=2.25/2.75)*K+.9375)+re:X*(7.5625*(K-=2.625/2.75)*K+.984375)+re}function ve(K,re,X,N){return K<N/2?Me(K*2,0,X,N)*.5+re:ke(K*2-N,0,X,N)*.5+X*.5+re}e.util.ease={easeInQuad:function(K,re,X,N){return X*(K/=N)*K+re},easeOutQuad:function(K,re,X,N){return-X*(K/=N)*(K-2)+re},easeInOutQuad:function(K,re,X,N){return K/=N/2,K<1?X/2*K*K+re:-X/2*(--K*(K-2)-1)+re},easeInCubic:function(K,re,X,N){return X*(K/=N)*K*K+re},easeOutCubic:d,easeInOutCubic:m,easeInQuart:o,easeOutQuart:l,easeInOutQuart:u,easeInQuint:p,easeOutQuint:w,easeInOutQuint:_,easeInSine:v,easeOutSine:y,easeInOutSine:T,easeInExpo:C,easeOutExpo:P,easeInOutExpo:O,easeInCirc:D,easeOutCirc:L,easeInOutCirc:W,easeInElastic:U,easeOutElastic:te,easeInOutElastic:pe,easeInBack:ne,easeOutBack:ye,easeInOutBack:ce,easeInBounce:Me,easeOutBounce:ke,easeInOutBounce:ve}}(),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.util.object.clone,o=s.util.toFixed,l=s.util.parseUnit,u=s.util.multiplyTransformMatrices,p=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],w=["symbol","image","marker","pattern","view","svg"],_=["pattern","defs","symbol","metadata","clipPath","mask","desc"],v=["symbol","g","a","svg","clipPath","defs"],y={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},T={stroke:"strokeOpacity",fill:"fillOpacity"},C="font-size",P="clip-path";s.svgValidTagNamesRegEx=L(p),s.svgViewBoxElementsRegEx=L(w),s.svgInvalidAncestorsRegEx=L(_),s.svgValidParentsRegEx=L(v),s.cssRules={},s.gradientDefs={},s.clipPaths={};function O(J){return J in y?y[J]:J}function D(J,Y,be,Ce){var Ue=Array.isArray(Y),Ve;if((J==="fill"||J==="stroke")&&Y==="none")Y="";else{if(J==="strokeUniform")return Y==="non-scaling-stroke";if(J==="strokeDashArray")Y==="none"?Y=null:Y=Y.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(J==="transformMatrix")be&&be.transformMatrix?Y=u(be.transformMatrix,s.parseTransformAttribute(Y)):Y=s.parseTransformAttribute(Y);else if(J==="visible")Y=Y!=="none"&&Y!=="hidden",be&&be.visible===!1&&(Y=!1);else if(J==="opacity")Y=parseFloat(Y),be&&typeof be.opacity<"u"&&(Y*=be.opacity);else if(J==="textAnchor")Y=Y==="start"?"left":Y==="end"?"right":"center";else if(J==="charSpacing")Ve=l(Y,Ce)/Ce*1e3;else if(J==="paintFirst"){var Ie=Y.indexOf("fill"),he=Y.indexOf("stroke"),Y="fill";(Ie>-1&&he>-1&&he<Ie||Ie===-1&&he>-1)&&(Y="stroke")}else{if(J==="href"||J==="xlink:href"||J==="font")return Y;if(J==="imageSmoothing")return Y==="optimizeQuality";Ve=Ue?Y.map(l):l(Y,Ce)}}return!Ue&&isNaN(Ve)?Y:Ve}function L(J){return new RegExp("^("+J.join("|")+")\\b","i")}function W(J){for(var Y in T)if(!(typeof J[T[Y]]>"u"||J[Y]==="")){if(typeof J[Y]>"u"){if(!s.Object.prototype[Y])continue;J[Y]=s.Object.prototype[Y]}if(J[Y].indexOf("url(")!==0){var be=new s.Color(J[Y]);J[Y]=be.setAlpha(o(be.getAlpha()*J[T[Y]],2)).toRgba()}}return J}function U(J,Y){var be,Ce=[],Ue,Ve,Ie;for(Ve=0,Ie=Y.length;Ve<Ie;Ve++)be=Y[Ve],Ue=J.getElementsByTagName(be),Ce=Ce.concat(Array.prototype.slice.call(Ue));return Ce}s.parseTransformAttribute=function(){function J(Ge,qe){var gt=s.util.cos(qe[0]),ct=s.util.sin(qe[0]),wt=0,bt=0;qe.length===3&&(wt=qe[1],bt=qe[2]),Ge[0]=gt,Ge[1]=ct,Ge[2]=-ct,Ge[3]=gt,Ge[4]=wt-(gt*wt-ct*bt),Ge[5]=bt-(ct*wt+gt*bt)}function Y(Ge,qe){var gt=qe[0],ct=qe.length===2?qe[1]:qe[0];Ge[0]=gt,Ge[3]=ct}function be(Ge,qe,gt){Ge[gt]=Math.tan(s.util.degreesToRadians(qe[0]))}function Ce(Ge,qe){Ge[4]=qe[0],qe.length===2&&(Ge[5]=qe[1])}var Ue=s.iMatrix,Ve=s.reNum,Ie=s.commaWsp,he="(?:(skewX)\\s*\\(\\s*("+Ve+")\\s*\\))",Fe="(?:(skewY)\\s*\\(\\s*("+Ve+")\\s*\\))",ee="(?:(rotate)\\s*\\(\\s*("+Ve+")(?:"+Ie+"("+Ve+")"+Ie+"("+Ve+"))?\\s*\\))",we="(?:(scale)\\s*\\(\\s*("+Ve+")(?:"+Ie+"("+Ve+"))?\\s*\\))",Re="(?:(translate)\\s*\\(\\s*("+Ve+")(?:"+Ie+"("+Ve+"))?\\s*\\))",Be="(?:(matrix)\\s*\\(\\s*("+Ve+")"+Ie+"("+Ve+")"+Ie+"("+Ve+")"+Ie+"("+Ve+")"+Ie+"("+Ve+")"+Ie+"("+Ve+")\\s*\\))",Se="(?:"+Be+"|"+Re+"|"+we+"|"+ee+"|"+he+"|"+Fe+")",Ne="(?:"+Se+"(?:"+Ie+"*"+Se+")*)",ze="^\\s*(?:"+Ne+"?)\\s*$",rt=new RegExp(ze),nt=new RegExp(Se,"g");return function(Ge){var qe=Ue.concat(),gt=[];if(!Ge||Ge&&!rt.test(Ge))return qe;Ge.replace(nt,function(wt){var bt=new RegExp(Se).exec(wt).filter(function(jt){return!!jt}),Ct=bt[1],It=bt.slice(2).map(parseFloat);switch(Ct){case"translate":Ce(qe,It);break;case"rotate":It[0]=s.util.degreesToRadians(It[0]),J(qe,It);break;case"scale":Y(qe,It);break;case"skewX":be(qe,It,2);break;case"skewY":be(qe,It,1);break;case"matrix":qe=It;break}gt.push(qe.concat()),qe=Ue.concat()});for(var ct=gt[0];gt.length>1;)gt.shift(),ct=s.util.multiplyTransformMatrices(ct,gt[0]);return ct}}();function te(J,Y){var be,Ce;J.replace(/;\s*$/,"").split(";").forEach(function(Ue){var Ve=Ue.split(":");be=Ve[0].trim().toLowerCase(),Ce=Ve[1].trim(),Y[be]=Ce})}function pe(J,Y){var be,Ce;for(var Ue in J)typeof J[Ue]>"u"||(be=Ue.toLowerCase(),Ce=J[Ue],Y[be]=Ce)}function ne(J,Y){var be={};for(var Ce in s.cssRules[Y])if(ye(J,Ce.split(" ")))for(var Ue in s.cssRules[Y][Ce])be[Ue]=s.cssRules[Y][Ce][Ue];return be}function ye(J,Y){var be,Ce=!0;return be=Me(J,Y.pop()),be&&Y.length&&(Ce=ce(J,Y)),be&&Ce&&Y.length===0}function ce(J,Y){for(var be,Ce=!0;J.parentNode&&J.parentNode.nodeType===1&&Y.length;)Ce&&(be=Y.pop()),J=J.parentNode,Ce=Me(J,be);return Y.length===0}function Me(J,Y){var be=J.nodeName,Ce=J.getAttribute("class"),Ue=J.getAttribute("id"),Ve,Ie;if(Ve=new RegExp("^"+be,"i"),Y=Y.replace(Ve,""),Ue&&Y.length&&(Ve=new RegExp("#"+Ue+"(?![a-zA-Z\\-]+)","i"),Y=Y.replace(Ve,"")),Ce&&Y.length)for(Ce=Ce.split(" "),Ie=Ce.length;Ie--;)Ve=new RegExp("\\."+Ce[Ie]+"(?![a-zA-Z\\-]+)","i"),Y=Y.replace(Ve,"");return Y.length===0}function ke(J,Y){var be;if(J.getElementById&&(be=J.getElementById(Y)),be)return be;var Ce,Ue,Ve,Ie=J.getElementsByTagName("*");for(Ue=0,Ve=Ie.length;Ue<Ve;Ue++)if(Ce=Ie[Ue],Y===Ce.getAttribute("id"))return Ce}function ve(J){for(var Y=U(J,["use","svg:use"]),be=0;Y.length&&be<Y.length;){var Ce=Y[be],Ue=Ce.getAttribute("xlink:href")||Ce.getAttribute("href");if(Ue===null)return;var Ve=Ue.slice(1),Ie=Ce.getAttribute("x")||0,he=Ce.getAttribute("y")||0,Fe=ke(J,Ve).cloneNode(!0),ee=(Fe.getAttribute("transform")||"")+" translate("+Ie+", "+he+")",we,Re=Y.length,Be,Se,Ne,ze,rt=s.svgNS;if(re(Fe),/^svg$/i.test(Fe.nodeName)){var nt=Fe.ownerDocument.createElementNS(rt,"g");for(Se=0,Ne=Fe.attributes,ze=Ne.length;Se<ze;Se++)Be=Ne.item(Se),nt.setAttributeNS(rt,Be.nodeName,Be.nodeValue);for(;Fe.firstChild;)nt.appendChild(Fe.firstChild);Fe=nt}for(Se=0,Ne=Ce.attributes,ze=Ne.length;Se<ze;Se++)Be=Ne.item(Se),!(Be.nodeName==="x"||Be.nodeName==="y"||Be.nodeName==="xlink:href"||Be.nodeName==="href")&&(Be.nodeName==="transform"?ee=Be.nodeValue+" "+ee:Fe.setAttribute(Be.nodeName,Be.nodeValue));Fe.setAttribute("transform",ee),Fe.setAttribute("instantiated_by_use","1"),Fe.removeAttribute("id"),we=Ce.parentNode,we.replaceChild(Fe,Ce),Y.length===Re&&be++}}var K=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function re(J){if(!s.svgViewBoxElementsRegEx.test(J.nodeName))return{};var Y=J.getAttribute("viewBox"),be=1,Ce=1,Ue=0,Ve=0,Ie,he,Fe,ee,we=J.getAttribute("width"),Re=J.getAttribute("height"),Be=J.getAttribute("x")||0,Se=J.getAttribute("y")||0,Ne=J.getAttribute("preserveAspectRatio")||"",ze=!Y||!(Y=Y.match(K)),rt=!we||!Re||we==="100%"||Re==="100%",nt=ze&&rt,Ge={},qe="",gt=0,ct=0;if(Ge.width=0,Ge.height=0,Ge.toBeParsed=nt,ze&&(Be||Se)&&J.parentNode&&J.parentNode.nodeName!=="#document"&&(qe=" translate("+l(Be)+" "+l(Se)+") ",Fe=(J.getAttribute("transform")||"")+qe,J.setAttribute("transform",Fe),J.removeAttribute("x"),J.removeAttribute("y")),nt)return Ge;if(ze)return Ge.width=l(we),Ge.height=l(Re),Ge;if(Ue=-parseFloat(Y[1]),Ve=-parseFloat(Y[2]),Ie=parseFloat(Y[3]),he=parseFloat(Y[4]),Ge.minX=Ue,Ge.minY=Ve,Ge.viewBoxWidth=Ie,Ge.viewBoxHeight=he,rt?(Ge.width=Ie,Ge.height=he):(Ge.width=l(we),Ge.height=l(Re),be=Ge.width/Ie,Ce=Ge.height/he),Ne=s.util.parsePreserveAspectRatioAttribute(Ne),Ne.alignX!=="none"&&(Ne.meetOrSlice==="meet"&&(Ce=be=be>Ce?Ce:be),Ne.meetOrSlice==="slice"&&(Ce=be=be>Ce?be:Ce),gt=Ge.width-Ie*be,ct=Ge.height-he*be,Ne.alignX==="Mid"&&(gt/=2),Ne.alignY==="Mid"&&(ct/=2),Ne.alignX==="Min"&&(gt=0),Ne.alignY==="Min"&&(ct=0)),be===1&&Ce===1&&Ue===0&&Ve===0&&Be===0&&Se===0)return Ge;if((Be||Se)&&J.parentNode.nodeName!=="#document"&&(qe=" translate("+l(Be)+" "+l(Se)+") "),Fe=qe+" matrix("+be+" 0 0 "+Ce+" "+(Ue*be+gt)+" "+(Ve*Ce+ct)+") ",J.nodeName==="svg"){for(ee=J.ownerDocument.createElementNS(s.svgNS,"g");J.firstChild;)ee.appendChild(J.firstChild);J.appendChild(ee)}else ee=J,ee.removeAttribute("x"),ee.removeAttribute("y"),Fe=ee.getAttribute("transform")+Fe;return ee.setAttribute("transform",Fe),Ge}function X(J,Y){for(;J&&(J=J.parentNode);)if(J.nodeName&&Y.test(J.nodeName.replace("svg:",""))&&!J.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(J,Y,be,Ce){if(!!J){ve(J);var Ue=s.Object.__uid++,Ve,Ie,he=re(J),Fe=s.util.toArray(J.getElementsByTagName("*"));if(he.crossOrigin=Ce&&Ce.crossOrigin,he.svgUid=Ue,Fe.length===0&&s.isLikelyNode){Fe=J.selectNodes('//*[name(.)!="svg"]');var ee=[];for(Ve=0,Ie=Fe.length;Ve<Ie;Ve++)ee[Ve]=Fe[Ve];Fe=ee}var we=Fe.filter(function(Be){return re(Be),s.svgValidTagNamesRegEx.test(Be.nodeName.replace("svg:",""))&&!X(Be,s.svgInvalidAncestorsRegEx)});if(!we||we&&!we.length){Y&&Y([],{});return}var Re={};Fe.filter(function(Be){return Be.nodeName.replace("svg:","")==="clipPath"}).forEach(function(Be){var Se=Be.getAttribute("id");Re[Se]=s.util.toArray(Be.getElementsByTagName("*")).filter(function(Ne){return s.svgValidTagNamesRegEx.test(Ne.nodeName.replace("svg:",""))})}),s.gradientDefs[Ue]=s.getGradientDefs(J),s.cssRules[Ue]=s.getCSSRules(J),s.clipPaths[Ue]=Re,s.parseElements(we,function(Be,Se){Y&&(Y(Be,he,Se,Fe),delete s.gradientDefs[Ue],delete s.cssRules[Ue],delete s.clipPaths[Ue])},m(he),be,Ce)}};function N(J,Y){var be=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],Ce="xlink:href",Ue=Y.getAttribute(Ce).slice(1),Ve=ke(J,Ue);if(Ve&&Ve.getAttribute(Ce)&&N(J,Ve),be.forEach(function(he){Ve&&!Y.hasAttribute(he)&&Ve.hasAttribute(he)&&Y.setAttribute(he,Ve.getAttribute(he))}),!Y.children.length)for(var Ie=Ve.cloneNode(!0);Ie.firstChild;)Y.appendChild(Ie.firstChild);Y.removeAttribute(Ce)}var ae=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");d(s,{parseFontDeclaration:function(J,Y){var be=J.match(ae);if(!!be){var Ce=be[1],Ue=be[3],Ve=be[4],Ie=be[5],he=be[6];Ce&&(Y.fontStyle=Ce),Ue&&(Y.fontWeight=isNaN(parseFloat(Ue))?Ue:parseFloat(Ue)),Ve&&(Y.fontSize=l(Ve)),he&&(Y.fontFamily=he),Ie&&(Y.lineHeight=Ie==="normal"?1:Ie)}},getGradientDefs:function(J){var Y=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],be=U(J,Y),Ce,Ue=0,Ve={};for(Ue=be.length;Ue--;)Ce=be[Ue],Ce.getAttribute("xlink:href")&&N(J,Ce),Ve[Ce.getAttribute("id")]=Ce;return Ve},parseAttributes:function(J,Y,be){if(!!J){var Ce,Ue={},Ve,Ie;typeof be>"u"&&(be=J.getAttribute("svgUid")),J.parentNode&&s.svgValidParentsRegEx.test(J.parentNode.nodeName)&&(Ue=s.parseAttributes(J.parentNode,Y,be));var he=Y.reduce(function(Ne,ze){return Ce=J.getAttribute(ze),Ce&&(Ne[ze]=Ce),Ne},{}),Fe=d(ne(J,be),s.parseStyleAttribute(J));he=d(he,Fe),Fe[P]&&J.setAttribute(P,Fe[P]),Ve=Ie=Ue.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,he[C]&&(he[C]=Ve=l(he[C],Ie));var ee,we,Re={};for(var Be in he)ee=O(Be),we=D(ee,he[Be],Ue,Ve),Re[ee]=we;Re&&Re.font&&s.parseFontDeclaration(Re.font,Re);var Se=d(Ue,Re);return s.svgValidParentsRegEx.test(J.nodeName)?Se:W(Se)}},parseElements:function(J,Y,be,Ce,Ue){new s.ElementsParser(J,Y,be,Ce,Ue).parse()},parseStyleAttribute:function(J){var Y={},be=J.getAttribute("style");return be&&(typeof be=="string"?te(be,Y):pe(be,Y)),Y},parsePointsAttribute:function(J){if(!J)return null;J=J.replace(/,/g," ").trim(),J=J.split(/\s+/);var Y=[],be,Ce;for(be=0,Ce=J.length;be<Ce;be+=2)Y.push({x:parseFloat(J[be]),y:parseFloat(J[be+1])});return Y},getCSSRules:function(J){var Y=J.getElementsByTagName("style"),be,Ce,Ue={},Ve;for(be=0,Ce=Y.length;be<Ce;be++){var Ie=Y[be].textContent;Ie=Ie.replace(/\/\*[\s\S]*?\*\//g,""),Ie.trim()!==""&&(Ve=Ie.split("}"),Ve=Ve.filter(function(he){return he.trim()}),Ve.forEach(function(he){var Fe=he.split("{"),ee={},we=Fe[1].trim(),Re=we.split(";").filter(function(ze){return ze.trim()});for(be=0,Ce=Re.length;be<Ce;be++){var Be=Re[be].split(":"),Se=Be[0].trim(),Ne=Be[1].trim();ee[Se]=Ne}he=Fe[0].trim(),he.split(",").forEach(function(ze){ze=ze.replace(/^svg/i,"").trim(),ze!==""&&(Ue[ze]?s.util.object.extend(Ue[ze],ee):Ue[ze]=s.util.object.clone(ee))})}))}return Ue},loadSVGFromURL:function(J,Y,be,Ce){J=J.replace(/^\n\s*/,"").trim(),new s.util.request(J,{method:"get",onComplete:Ue});function Ue(Ve){var Ie=Ve.responseXML;if(!Ie||!Ie.documentElement)return Y&&Y(null),!1;s.parseSVGDocument(Ie.documentElement,function(he,Fe,ee,we){Y&&Y(he,Fe,ee,we)},be,Ce)}},loadSVGFromString:function(J,Y,be,Ce){var Ue=new s.window.DOMParser,Ve=Ue.parseFromString(J.trim(),"text/xml");s.parseSVGDocument(Ve.documentElement,function(Ie,he,Fe,ee){Y(Ie,he,Fe,ee)},be,Ce)}})}(t),e.ElementsParser=function(f,s,d,m,o,l){this.elements=f,this.callback=s,this.options=d,this.reviver=m,this.svgUid=d&&d.svgUid||0,this.parsingOptions=o,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=l},function(f){f.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},f.createObjects=function(){var s=this;this.elements.forEach(function(d,m){d.setAttribute("svgUid",s.svgUid),s.createObject(d,m)})},f.findTag=function(s){return e[e.util.string.capitalize(s.tagName.replace("svg:",""))]},f.createObject=function(s,d){var m=this.findTag(s);if(m&&m.fromElement)try{m.fromElement(s,this.createCallback(d,s),this.options)}catch(o){e.log(o)}else this.checkIfDone()},f.createCallback=function(s,d){var m=this;return function(o){var l;m.resolveGradient(o,d,"fill"),m.resolveGradient(o,d,"stroke"),o instanceof e.Image&&o._originalElement&&(l=o.parsePreserveAspectRatioAttribute(d)),o._removeTransformMatrix(l),m.resolveClipPath(o,d),m.reviver&&m.reviver(d,o),m.instances[s]=o,m.checkIfDone()}},f.extractPropertyDefinition=function(s,d,m){var o=s[d],l=this.regexUrl;if(!!l.test(o)){l.lastIndex=0;var u=l.exec(o)[1];return l.lastIndex=0,e[m][this.svgUid][u]}},f.resolveGradient=function(s,d,m){var o=this.extractPropertyDefinition(s,m,"gradientDefs");if(o){var l=d.getAttribute(m+"-opacity"),u=e.Gradient.fromElement(o,s,l,this.options);s.set(m,u)}},f.createClipPathCallback=function(s,d){return function(m){m._removeTransformMatrix(),m.fillRule=m.clipRule,d.push(m)}},f.resolveClipPath=function(s,d){var m=this.extractPropertyDefinition(s,"clipPath","clipPaths"),o,l,u,p,w,_;if(m){p=[],u=e.util.invertTransform(s.calcTransformMatrix());for(var v=m[0].parentNode,y=d;y.parentNode&&y.getAttribute("clip-path")!==s.clipPath;)y=y.parentNode;y.parentNode.appendChild(v);for(var T=0;T<m.length;T++)o=m[T],l=this.findTag(o),l.fromElement(o,this.createClipPathCallback(s,p),this.options);p.length===1?m=p[0]:m=new e.Group(p),w=e.util.multiplyTransformMatrices(u,m.calcTransformMatrix()),m.clipPath&&this.resolveClipPath(m,y);var _=e.util.qrDecompose(w);m.flipX=!1,m.flipY=!1,m.set("scaleX",_.scaleX),m.set("scaleY",_.scaleY),m.angle=_.angle,m.skewX=_.skewX,m.skewY=0,m.setPositionByOrigin({x:_.translateX,y:_.translateY},"center","center"),s.clipPath=m}else delete s.clipPath},f.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(f){var s=f.fabric||(f.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=d;function d(m,o){this.x=m,this.y=o}d.prototype={type:"point",constructor:d,add:function(m){return new d(this.x+m.x,this.y+m.y)},addEquals:function(m){return this.x+=m.x,this.y+=m.y,this},scalarAdd:function(m){return new d(this.x+m,this.y+m)},scalarAddEquals:function(m){return this.x+=m,this.y+=m,this},subtract:function(m){return new d(this.x-m.x,this.y-m.y)},subtractEquals:function(m){return this.x-=m.x,this.y-=m.y,this},scalarSubtract:function(m){return new d(this.x-m,this.y-m)},scalarSubtractEquals:function(m){return this.x-=m,this.y-=m,this},multiply:function(m){return new d(this.x*m,this.y*m)},multiplyEquals:function(m){return this.x*=m,this.y*=m,this},divide:function(m){return new d(this.x/m,this.y/m)},divideEquals:function(m){return this.x/=m,this.y/=m,this},eq:function(m){return this.x===m.x&&this.y===m.y},lt:function(m){return this.x<m.x&&this.y<m.y},lte:function(m){return this.x<=m.x&&this.y<=m.y},gt:function(m){return this.x>m.x&&this.y>m.y},gte:function(m){return this.x>=m.x&&this.y>=m.y},lerp:function(m,o){return typeof o>"u"&&(o=.5),o=Math.max(Math.min(1,o),0),new d(this.x+(m.x-this.x)*o,this.y+(m.y-this.y)*o)},distanceFrom:function(m){var o=this.x-m.x,l=this.y-m.y;return Math.sqrt(o*o+l*l)},midPointFrom:function(m){return this.lerp(m)},min:function(m){return new d(Math.min(this.x,m.x),Math.min(this.y,m.y))},max:function(m){return new d(Math.max(this.x,m.x),Math.max(this.y,m.y))},toString:function(){return this.x+","+this.y},setXY:function(m,o){return this.x=m,this.y=o,this},setX:function(m){return this.x=m,this},setY:function(m){return this.y=m,this},setFromPoint:function(m){return this.x=m.x,this.y=m.y,this},swap:function(m){var o=this.x,l=this.y;this.x=m.x,this.y=m.y,m.x=o,m.y=l},clone:function(){return new d(this.x,this.y)}}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function d(m){this.status=m,this.points=[]}s.Intersection=d,s.Intersection.prototype={constructor:d,appendPoint:function(m){return this.points.push(m),this},appendPoints:function(m){return this.points=this.points.concat(m),this}},s.Intersection.intersectLineLine=function(m,o,l,u){var p,w=(u.x-l.x)*(m.y-l.y)-(u.y-l.y)*(m.x-l.x),_=(o.x-m.x)*(m.y-l.y)-(o.y-m.y)*(m.x-l.x),v=(u.y-l.y)*(o.x-m.x)-(u.x-l.x)*(o.y-m.y);if(v!==0){var y=w/v,T=_/v;0<=y&&y<=1&&0<=T&&T<=1?(p=new d("Intersection"),p.appendPoint(new s.Point(m.x+y*(o.x-m.x),m.y+y*(o.y-m.y)))):p=new d}else w===0||_===0?p=new d("Coincident"):p=new d("Parallel");return p},s.Intersection.intersectLinePolygon=function(m,o,l){var u=new d,p=l.length,w,_,v,y;for(y=0;y<p;y++)w=l[y],_=l[(y+1)%p],v=d.intersectLineLine(m,o,w,_),u.appendPoints(v.points);return u.points.length>0&&(u.status="Intersection"),u},s.Intersection.intersectPolygonPolygon=function(m,o){var l=new d,u=m.length,p;for(p=0;p<u;p++){var w=m[p],_=m[(p+1)%u],v=d.intersectLinePolygon(w,_,o);l.appendPoints(v.points)}return l.points.length>0&&(l.status="Intersection"),l},s.Intersection.intersectPolygonRectangle=function(m,o,l){var u=o.min(l),p=o.max(l),w=new s.Point(p.x,u.y),_=new s.Point(u.x,p.y),v=d.intersectLinePolygon(u,w,m),y=d.intersectLinePolygon(w,p,m),T=d.intersectLinePolygon(p,_,m),C=d.intersectLinePolygon(_,u,m),P=new d;return P.appendPoints(v.points),P.appendPoints(y.points),P.appendPoints(T.points),P.appendPoints(C.points),P.points.length>0&&(P.status="Intersection"),P}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function d(o){o?this._tryParsingColor(o):this.setSource([0,0,0,1])}s.Color=d,s.Color.prototype={_tryParsingColor:function(o){var l;o in d.colorNameMap&&(o=d.colorNameMap[o]),o==="transparent"&&(l=[255,255,255,0]),l||(l=d.sourceFromHex(o)),l||(l=d.sourceFromRgb(o)),l||(l=d.sourceFromHsl(o)),l||(l=[0,0,0,1]),l&&this.setSource(l)},_rgbToHsl:function(o,l,u){o/=255,l/=255,u/=255;var p,w,_,v=s.util.array.max([o,l,u]),y=s.util.array.min([o,l,u]);if(_=(v+y)/2,v===y)p=w=0;else{var T=v-y;switch(w=_>.5?T/(2-v-y):T/(v+y),v){case o:p=(l-u)/T+(l<u?6:0);break;case l:p=(u-o)/T+2;break;case u:p=(o-l)/T+4;break}p/=6}return[Math.round(p*360),Math.round(w*100),Math.round(_*100)]},getSource:function(){return this._source},setSource:function(o){this._source=o},toRgb:function(){var o=this.getSource();return"rgb("+o[0]+","+o[1]+","+o[2]+")"},toRgba:function(){var o=this.getSource();return"rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")"},toHsl:function(){var o=this.getSource(),l=this._rgbToHsl(o[0],o[1],o[2]);return"hsl("+l[0]+","+l[1]+"%,"+l[2]+"%)"},toHsla:function(){var o=this.getSource(),l=this._rgbToHsl(o[0],o[1],o[2]);return"hsla("+l[0]+","+l[1]+"%,"+l[2]+"%,"+o[3]+")"},toHex:function(){var o=this.getSource(),l,u,p;return l=o[0].toString(16),l=l.length===1?"0"+l:l,u=o[1].toString(16),u=u.length===1?"0"+u:u,p=o[2].toString(16),p=p.length===1?"0"+p:p,l.toUpperCase()+u.toUpperCase()+p.toUpperCase()},toHexa:function(){var o=this.getSource(),l;return l=Math.round(o[3]*255),l=l.toString(16),l=l.length===1?"0"+l:l,this.toHex()+l.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(o){var l=this.getSource();return l[3]=o,this.setSource(l),this},toGrayscale:function(){var o=this.getSource(),l=parseInt((o[0]*.3+o[1]*.59+o[2]*.11).toFixed(0),10),u=o[3];return this.setSource([l,l,l,u]),this},toBlackWhite:function(o){var l=this.getSource(),u=(l[0]*.3+l[1]*.59+l[2]*.11).toFixed(0),p=l[3];return o=o||127,u=Number(u)<Number(o)?0:255,this.setSource([u,u,u,p]),this},overlayWith:function(o){o instanceof d||(o=new d(o));var l=[],u=this.getAlpha(),p=.5,w=this.getSource(),_=o.getSource(),v;for(v=0;v<3;v++)l.push(Math.round(w[v]*(1-p)+_[v]*p));return l[3]=u,this.setSource(l),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function m(o,l,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?o+(l-o)*6*u:u<1/2?l:u<2/3?o+(l-o)*(2/3-u)*6:o}s.Color.fromRgb=function(o){return d.fromSource(d.sourceFromRgb(o))},s.Color.sourceFromRgb=function(o){var l=o.match(d.reRGBa);if(l){var u=parseInt(l[1],10)/(/%$/.test(l[1])?100:1)*(/%$/.test(l[1])?255:1),p=parseInt(l[2],10)/(/%$/.test(l[2])?100:1)*(/%$/.test(l[2])?255:1),w=parseInt(l[3],10)/(/%$/.test(l[3])?100:1)*(/%$/.test(l[3])?255:1);return[parseInt(u,10),parseInt(p,10),parseInt(w,10),l[4]?parseFloat(l[4]):1]}},s.Color.fromRgba=d.fromRgb,s.Color.fromHsl=function(o){return d.fromSource(d.sourceFromHsl(o))},s.Color.sourceFromHsl=function(o){var l=o.match(d.reHSLa);if(!!l){var u=(parseFloat(l[1])%360+360)%360/360,p=parseFloat(l[2])/(/%$/.test(l[2])?100:1),w=parseFloat(l[3])/(/%$/.test(l[3])?100:1),_,v,y;if(p===0)_=v=y=w;else{var T=w<=.5?w*(p+1):w+p-w*p,C=w*2-T;_=m(C,T,u+1/3),v=m(C,T,u),y=m(C,T,u-1/3)}return[Math.round(_*255),Math.round(v*255),Math.round(y*255),l[4]?parseFloat(l[4]):1]}},s.Color.fromHsla=d.fromHsl,s.Color.fromHex=function(o){return d.fromSource(d.sourceFromHex(o))},s.Color.sourceFromHex=function(o){if(o.match(d.reHex)){var l=o.slice(o.indexOf("#")+1),u=l.length===3||l.length===4,p=l.length===8||l.length===4,w=u?l.charAt(0)+l.charAt(0):l.substring(0,2),_=u?l.charAt(1)+l.charAt(1):l.substring(2,4),v=u?l.charAt(2)+l.charAt(2):l.substring(4,6),y=p?u?l.charAt(3)+l.charAt(3):l.substring(6,8):"FF";return[parseInt(w,16),parseInt(_,16),parseInt(v,16),parseFloat((parseInt(y,16)/255).toFixed(2))]}},s.Color.fromSource=function(o){var l=new d;return l.setSource(o),l}}(t),function(f){var s=f.fabric||(f.fabric={}),d=["e","se","s","sw","w","nw","n","ne","e"],m=["ns","nesw","ew","nwse"],o={},l="left",u="top",p="right",w="bottom",_="center",v={top:w,bottom:u,left:p,right:l,center:_},y=s.util.radiansToDegrees,T=Math.sign||function(ee){return(ee>0)-(ee<0)||+ee};function C(ee,we){var Re=ee.angle+y(Math.atan2(we.y,we.x))+360;return Math.round(Re%360/45)}function P(ee,we){var Re=we.transform.target,Be=Re.canvas,Se=s.util.object.clone(we);Se.target=Re,Be&&Be.fire("object:"+ee,Se),Re.fire(ee,we)}function O(ee,we){var Re=we.canvas,Be=Re.uniScaleKey,Se=ee[Be];return Re.uniformScaling&&!Se||!Re.uniformScaling&&Se}function D(ee){return ee.originX===_&&ee.originY===_}function L(ee,we,Re){var Be=ee.lockScalingX,Se=ee.lockScalingY;return!!(Be&&Se||!we&&(Be||Se)&&Re||Be&&we==="x"||Se&&we==="y")}function W(ee,we,Re){var Be="not-allowed",Se=O(ee,Re),Ne="";if(we.x!==0&&we.y===0?Ne="x":we.x===0&&we.y!==0&&(Ne="y"),L(Re,Ne,Se))return Be;var ze=C(Re,we);return d[ze]+"-resize"}function U(ee,we,Re){var Be="not-allowed";if(we.x!==0&&Re.lockSkewingY||we.y!==0&&Re.lockSkewingX)return Be;var Se=C(Re,we)%4;return m[Se]+"-resize"}function te(ee,we,Re){return ee[Re.canvas.altActionKey]?o.skewCursorStyleHandler(ee,we,Re):o.scaleCursorStyleHandler(ee,we,Re)}function pe(ee,we,Re){var Be=ee[Re.canvas.altActionKey];if(we.x===0)return Be?"skewX":"scaleY";if(we.y===0)return Be?"skewY":"scaleX"}function ne(ee,we,Re){return Re.lockRotation?"not-allowed":we.cursorStyle}function ye(ee,we,Re,Be){return{e:ee,transform:we,pointer:{x:Re,y:Be}}}function ce(ee){return function(we,Re,Be,Se){var Ne=Re.target,ze=Ne.getCenterPoint(),rt=Ne.translateToOriginPoint(ze,Re.originX,Re.originY),nt=ee(we,Re,Be,Se);return Ne.setPositionByOrigin(rt,Re.originX,Re.originY),nt}}function Me(ee,we){return function(Re,Be,Se,Ne){var ze=we(Re,Be,Se,Ne);return ze&&P(ee,ye(Re,Be,Se,Ne)),ze}}function ke(ee,we,Re,Be,Se){var Ne=ee.target,ze=Ne.controls[ee.corner],rt=Ne.canvas.getZoom(),nt=Ne.padding/rt,Ge=Ne.toLocalPoint(new s.Point(Be,Se),we,Re);return Ge.x>=nt&&(Ge.x-=nt),Ge.x<=-nt&&(Ge.x+=nt),Ge.y>=nt&&(Ge.y-=nt),Ge.y<=nt&&(Ge.y+=nt),Ge.x-=ze.offsetX,Ge.y-=ze.offsetY,Ge}function ve(ee){return ee.flipX!==ee.flipY}function K(ee,we,Re,Be,Se){if(ee[we]!==0){var Ne=ee._getTransformedDimensions()[Be],ze=Se/Ne*ee[Re];ee.set(Re,ze)}}function re(ee,we,Re,Be){var Se=we.target,Ne=Se._getTransformedDimensions(0,Se.skewY),ze=ke(we,we.originX,we.originY,Re,Be),rt=Math.abs(ze.x*2)-Ne.x,nt=Se.skewX,Ge;rt<2?Ge=0:(Ge=y(Math.atan2(rt/Se.scaleX,Ne.y/Se.scaleY)),we.originX===l&&we.originY===w&&(Ge=-Ge),we.originX===p&&we.originY===u&&(Ge=-Ge),ve(Se)&&(Ge=-Ge));var qe=nt!==Ge;if(qe){var gt=Se._getTransformedDimensions().y;Se.set("skewX",Ge),K(Se,"skewY","scaleY","y",gt)}return qe}function X(ee,we,Re,Be){var Se=we.target,Ne=Se._getTransformedDimensions(Se.skewX,0),ze=ke(we,we.originX,we.originY,Re,Be),rt=Math.abs(ze.y*2)-Ne.y,nt=Se.skewY,Ge;rt<2?Ge=0:(Ge=y(Math.atan2(rt/Se.scaleY,Ne.x/Se.scaleX)),we.originX===l&&we.originY===w&&(Ge=-Ge),we.originX===p&&we.originY===u&&(Ge=-Ge),ve(Se)&&(Ge=-Ge));var qe=nt!==Ge;if(qe){var gt=Se._getTransformedDimensions().x;Se.set("skewY",Ge),K(Se,"skewX","scaleX","x",gt)}return qe}function N(ee,we,Re,Be){var Se=we.target,Ne=Se.skewX,ze,rt=we.originY;if(Se.lockSkewingX)return!1;if(Ne===0){var nt=ke(we,_,_,Re,Be);nt.x>0?ze=l:ze=p}else Ne>0&&(ze=rt===u?l:p),Ne<0&&(ze=rt===u?p:l),ve(Se)&&(ze=ze===l?p:l);we.originX=ze;var Ge=Me("skewing",ce(re));return Ge(ee,we,Re,Be)}function ae(ee,we,Re,Be){var Se=we.target,Ne=Se.skewY,ze,rt=we.originX;if(Se.lockSkewingY)return!1;if(Ne===0){var nt=ke(we,_,_,Re,Be);nt.y>0?ze=u:ze=w}else Ne>0&&(ze=rt===l?u:w),Ne<0&&(ze=rt===l?w:u),ve(Se)&&(ze=ze===u?w:u);we.originY=ze;var Ge=Me("skewing",ce(X));return Ge(ee,we,Re,Be)}function J(ee,we,Re,Be){var Se=we,Ne=Se.target,ze=Ne.translateToOriginPoint(Ne.getCenterPoint(),Se.originX,Se.originY);if(Ne.lockRotation)return!1;var rt=Math.atan2(Se.ey-ze.y,Se.ex-ze.x),nt=Math.atan2(Be-ze.y,Re-ze.x),Ge=y(nt-rt+Se.theta),qe=!0;if(Ne.snapAngle>0){var gt=Ne.snapAngle,ct=Ne.snapThreshold||gt,wt=Math.ceil(Ge/gt)*gt,bt=Math.floor(Ge/gt)*gt;Math.abs(Ge-bt)<ct?Ge=bt:Math.abs(Ge-wt)<ct&&(Ge=wt)}return Ge<0&&(Ge=360+Ge),Ge%=360,qe=Ne.angle!==Ge,Ne.angle=Ge,qe}function Y(ee,we,Re,Be,Se){Se=Se||{};var Ne=we.target,ze=Ne.lockScalingX,rt=Ne.lockScalingY,nt=Se.by,Ge,qe,gt,ct,wt=O(ee,Ne),bt=L(Ne,nt,wt),Ct,It,jt=we.gestureScale;if(bt)return!1;if(jt)qe=we.scaleX*jt,gt=we.scaleY*jt;else{if(Ge=ke(we,we.originX,we.originY,Re,Be),Ct=nt!=="y"?T(Ge.x):1,It=nt!=="x"?T(Ge.y):1,we.signX||(we.signX=Ct),we.signY||(we.signY=It),Ne.lockScalingFlip&&(we.signX!==Ct||we.signY!==It))return!1;if(ct=Ne._getTransformedDimensions(),wt&&!nt){var Fr=Math.abs(Ge.x)+Math.abs(Ge.y),lr=we.original,cr=Math.abs(ct.x*lr.scaleX/Ne.scaleX)+Math.abs(ct.y*lr.scaleY/Ne.scaleY),gn=Fr/cr;qe=lr.scaleX*gn,gt=lr.scaleY*gn}else qe=Math.abs(Ge.x*Ne.scaleX/ct.x),gt=Math.abs(Ge.y*Ne.scaleY/ct.y);D(we)&&(qe*=2,gt*=2),we.signX!==Ct&&nt!=="y"&&(we.originX=v[we.originX],qe*=-1,we.signX=Ct),we.signY!==It&&nt!=="x"&&(we.originY=v[we.originY],gt*=-1,we.signY=It)}var Jr=Ne.scaleX,Zn=Ne.scaleY;return nt?(nt==="x"&&Ne.set("scaleX",qe),nt==="y"&&Ne.set("scaleY",gt)):(!ze&&Ne.set("scaleX",qe),!rt&&Ne.set("scaleY",gt)),Jr!==Ne.scaleX||Zn!==Ne.scaleY}function be(ee,we,Re,Be){return Y(ee,we,Re,Be)}function Ce(ee,we,Re,Be){return Y(ee,we,Re,Be,{by:"x"})}function Ue(ee,we,Re,Be){return Y(ee,we,Re,Be,{by:"y"})}function Ve(ee,we,Re,Be){return ee[we.target.canvas.altActionKey]?o.skewHandlerX(ee,we,Re,Be):o.scalingY(ee,we,Re,Be)}function Ie(ee,we,Re,Be){return ee[we.target.canvas.altActionKey]?o.skewHandlerY(ee,we,Re,Be):o.scalingX(ee,we,Re,Be)}function he(ee,we,Re,Be){var Se=we.target,Ne=ke(we,we.originX,we.originY,Re,Be),ze=Se.strokeWidth/(Se.strokeUniform?Se.scaleX:1),rt=D(we)?2:1,nt=Se.width,Ge=Math.abs(Ne.x*rt/Se.scaleX)-ze;return Se.set("width",Math.max(Ge,0)),nt!==Ge}function Fe(ee,we,Re,Be){var Se=we.target,Ne=Re-we.offsetX,ze=Be-we.offsetY,rt=!Se.get("lockMovementX")&&Se.left!==Ne,nt=!Se.get("lockMovementY")&&Se.top!==ze;return rt&&Se.set("left",Ne),nt&&Se.set("top",ze),(rt||nt)&&P("moving",ye(ee,we,Re,Be)),rt||nt}o.scaleCursorStyleHandler=W,o.skewCursorStyleHandler=U,o.scaleSkewCursorStyleHandler=te,o.rotationWithSnapping=Me("rotating",ce(J)),o.scalingEqually=Me("scaling",ce(be)),o.scalingX=Me("scaling",ce(Ce)),o.scalingY=Me("scaling",ce(Ue)),o.scalingYOrSkewingX=Ve,o.scalingXOrSkewingY=Ie,o.changeWidth=Me("resizing",ce(he)),o.skewHandlerX=N,o.skewHandlerY=ae,o.dragHandler=Fe,o.scaleOrSkewActionName=pe,o.rotationStyleHandler=ne,o.fireEvent=P,o.wrapWithFixedAnchor=ce,o.wrapWithFireEvent=Me,o.getLocalPoint=ke,s.controlsUtils=o}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.degreesToRadians,m=s.controlsUtils;function o(u,p,w,_,v){_=_||{};var y=this.sizeX||_.cornerSize||v.cornerSize,T=this.sizeY||_.cornerSize||v.cornerSize,C=typeof _.transparentCorners<"u"?_.transparentCorners:v.transparentCorners,P=C?"stroke":"fill",O=!C&&(_.cornerStrokeColor||v.cornerStrokeColor),D=p,L=w,W;u.save(),u.fillStyle=_.cornerColor||v.cornerColor,u.strokeStyle=_.cornerStrokeColor||v.cornerStrokeColor,y>T?(W=y,u.scale(1,T/y),L=w*y/T):T>y?(W=T,u.scale(y/T,1),D=p*T/y):W=y,u.lineWidth=1,u.beginPath(),u.arc(D,L,W/2,0,2*Math.PI,!1),u[P](),O&&u.stroke(),u.restore()}function l(u,p,w,_,v){_=_||{};var y=this.sizeX||_.cornerSize||v.cornerSize,T=this.sizeY||_.cornerSize||v.cornerSize,C=typeof _.transparentCorners<"u"?_.transparentCorners:v.transparentCorners,P=C?"stroke":"fill",O=!C&&(_.cornerStrokeColor||v.cornerStrokeColor),D=y/2,L=T/2;u.save(),u.fillStyle=_.cornerColor||v.cornerColor,u.strokeStyle=_.cornerStrokeColor||v.cornerStrokeColor,u.lineWidth=1,u.translate(p,w),u.rotate(d(v.angle)),u[P+"Rect"](-D,-L,y,T),O&&u.strokeRect(-D,-L,y,T),u.restore()}m.renderCircleControl=o,m.renderSquareControl=l}(t),function(f){var s=f.fabric||(f.fabric={});function d(m){for(var o in m)this[o]=m[o]}s.Control=d,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(m,o){return o.cursorStyle},getActionName:function(m,o){return o.actionName},getVisibility:function(m,o){var l=m._controlsVisibility;return l&&typeof l[o]<"u"?l[o]:this.visible},setVisibility:function(m){this.visible=m},positionHandler:function(m,o){var l=s.util.transformPoint({x:this.x*m.x+this.offsetX,y:this.y*m.y+this.offsetY},o);return l},calcCornerCoords:function(m,o,l,u,p){var w,_,v,y,T=p?this.touchSizeX:this.sizeX,C=p?this.touchSizeY:this.sizeY;if(T&&C&&T!==C){var P=Math.atan2(C,T),O=Math.sqrt(T*T+C*C)/2,D=P-s.util.degreesToRadians(m),L=Math.PI/2-P-s.util.degreesToRadians(m);w=O*s.util.cos(D),_=O*s.util.sin(D),v=O*s.util.cos(L),y=O*s.util.sin(L)}else{var W=T&&C?T:o;O=W*.7071067812;var D=s.util.degreesToRadians(45-m);w=v=O*s.util.cos(D),_=y=O*s.util.sin(D)}return{tl:{x:l-y,y:u-v},tr:{x:l+w,y:u-_},bl:{x:l-w,y:u+_},br:{x:l+y,y:u+v}}},render:function(m,o,l,u,p){switch(u=u||{},u.cornerStyle||p.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,m,o,l,u,p);break;default:s.controlsUtils.renderSquareControl.call(this,m,o,l,u,p)}}}}(t),function(){function f(l,u){var p=l.getAttribute("style"),w=l.getAttribute("offset")||0,_,v,y,T;if(w=parseFloat(w)/(/%$/.test(w)?100:1),w=w<0?0:w>1?1:w,p){var C=p.split(/\s*;\s*/);for(C[C.length-1]===""&&C.pop(),T=C.length;T--;){var P=C[T].split(/\s*:\s*/),O=P[0].trim(),D=P[1].trim();O==="stop-color"?_=D:O==="stop-opacity"&&(y=D)}}return _||(_=l.getAttribute("stop-color")||"rgb(0,0,0)"),y||(y=l.getAttribute("stop-opacity")),_=new e.Color(_),v=_.getAlpha(),y=isNaN(parseFloat(y))?1:parseFloat(y),y*=v*u,{offset:w,color:_.toRgb(),opacity:y}}function s(l){return{x1:l.getAttribute("x1")||0,y1:l.getAttribute("y1")||0,x2:l.getAttribute("x2")||"100%",y2:l.getAttribute("y2")||0}}function d(l){return{x1:l.getAttribute("fx")||l.getAttribute("cx")||"50%",y1:l.getAttribute("fy")||l.getAttribute("cy")||"50%",r1:0,x2:l.getAttribute("cx")||"50%",y2:l.getAttribute("cy")||"50%",r2:l.getAttribute("r")||"50%"}}var m=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var u,p=this;Object.keys(l).forEach(function(w){p[w]=l[w]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,u={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(u.r1=l.coords.r1||0,u.r2=l.coords.r2||0),this.coords=u,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var u in l){var p=new e.Color(l[u]);this.colorStops.push({offset:parseFloat(u),color:p.toRgb(),opacity:p.getAlpha()})}return this},toObject:function(l){var u={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,u,l),u},toSVG:function(l,v){var p=m(this.coords,!0),w,_,v=v||{},y,T,C=m(this.colorStops,!0),P=p.r1>p.r2,O=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),D=-this.offsetX,L=-this.offsetY,W=!!v.additionalTransform,U=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(C.sort(function(ce,Me){return ce.offset-Me.offset}),U==="objectBoundingBox"?(D/=l.width,L/=l.height):(D+=l.width/2,L+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(D-=l.pathOffset.x,L-=l.pathOffset.y),O[4]-=D,O[5]-=L,T='id="SVGID_'+this.id+'" gradientUnits="'+U+'"',T+=' gradientTransform="'+(W?v.additionalTransform+" ":"")+e.util.matrixToSVG(O)+'" ',this.type==="linear"?y=["<linearGradient ",T,' x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,`">
`]:this.type==="radial"&&(y=["<radialGradient ",T,' cx="',P?p.x1:p.x2,'" cy="',P?p.y1:p.y2,'" r="',P?p.r1:p.r2,'" fx="',P?p.x2:p.x1,'" fy="',P?p.y2:p.y1,`">
`]),this.type==="radial"){if(P)for(C=C.concat(),C.reverse(),w=0,_=C.length;w<_;w++)C[w].offset=1-C[w].offset;var te=Math.min(p.r1,p.r2);if(te>0){var pe=Math.max(p.r1,p.r2),ne=te/pe;for(w=0,_=C.length;w<_;w++)C[w].offset+=ne*(1-C[w].offset)}}for(w=0,_=C.length;w<_;w++){var ye=C[w];y.push("<stop ",'offset="',ye.offset*100+"%",'" style="stop-color:',ye.color,typeof ye.opacity<"u"?";stop-opacity: "+ye.opacity:";",`"/>
`)}return y.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),y.join("")},toLive:function(l){var u,p=e.util.object.clone(this.coords),w,_;if(!!this.type){for(this.type==="linear"?u=l.createLinearGradient(p.x1,p.y1,p.x2,p.y2):this.type==="radial"&&(u=l.createRadialGradient(p.x1,p.y1,p.r1,p.x2,p.y2,p.r2)),w=0,_=this.colorStops.length;w<_;w++){var v=this.colorStops[w].color,y=this.colorStops[w].opacity,T=this.colorStops[w].offset;typeof y<"u"&&(v=new e.Color(v).setAlpha(y).toRgba()),u.addColorStop(T,v)}return u}}}),e.util.object.extend(e.Gradient,{fromElement:function(l,u,p,w){var _=parseFloat(p)/(/%$/.test(p)?100:1);_=_<0?0:_>1?1:_,isNaN(_)&&(_=1);var v=l.getElementsByTagName("stop"),y,T=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",C=l.getAttribute("gradientTransform")||"",P=[],O,D,L=0,W=0,U;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(y="linear",O=s(l)):(y="radial",O=d(l)),D=v.length;D--;)P.push(f(v[D],_));U=e.parseTransformAttribute(C),o(u,O,w,T),T==="pixels"&&(L=-u.left,W=-u.top);var te=new e.Gradient({id:l.getAttribute("id"),type:y,coords:O,colorStops:P,gradientUnits:T,gradientTransform:U,offsetX:L,offsetY:W});return te}});function o(l,u,p,w){var _,v;Object.keys(u).forEach(function(y){_=u[y],_==="Infinity"?v=1:_==="-Infinity"?v=0:(v=parseFloat(u[y],10),typeof _=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(_)&&(v*=.01,w==="pixels"&&((y==="x1"||y==="x2"||y==="r2")&&(v*=p.viewBoxWidth||p.width),(y==="y1"||y==="y2")&&(v*=p.viewBoxHeight||p.height)))),u[y]=v})}}(),function(){var f=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,d){if(s||(s={}),this.id=e.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){d&&d(this);return}else{var m=this;this.source=e.util.createImage(),e.util.loadImage(s.source,function(o,l){m.source=o,d&&d(m,l)},null,this.crossOrigin)}},toObject:function(s){var d=e.Object.NUM_FRACTION_DIGITS,m,o;return typeof this.source.src=="string"?m=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(m=this.source.toDataURL()),o={type:"pattern",source:m,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:f(this.offsetX,d),offsetY:f(this.offsetY,d),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,o,s),o},toSVG:function(s){var d=typeof this.source=="function"?this.source():this.source,m=d.width/s.width,o=d.height/s.height,l=this.offsetX/s.width,u=this.offsetY/s.height,p="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(o=1,u&&(o+=Math.abs(u))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(m=1,l&&(m+=Math.abs(l))),d.src?p=d.src:d.toDataURL&&(p=d.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+l+'" y="'+u+'" width="'+m+'" height="'+o+`">
<image x="0" y="0" width="`+d.width+'" height="'+d.height+'" xlink:href="'+p+`"></image>
</pattern>
`},setOptions:function(s){for(var d in s)this[d]=s[d]},toLive:function(s){var d=this.source;return!d||typeof d.src<"u"&&(!d.complete||d.naturalWidth===0||d.naturalHeight===0)?"":s.createPattern(d,this.repeat)}})}(),function(f){var s=f.fabric||(f.fabric={}),d=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(m){typeof m=="string"&&(m=this._parseShadow(m));for(var o in m)this[o]=m[o];this.id=s.Object.__uid++},_parseShadow:function(m){var o=m.trim(),l=s.Shadow.reOffsetsAndBlur.exec(o)||[],u=o.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseFloat(l[1],10)||0,offsetY:parseFloat(l[2],10)||0,blur:parseFloat(l[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(m){var o=40,l=40,u=s.Object.NUM_FRACTION_DIGITS,p=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-m.angle)),w=20,_=new s.Color(this.color);return m.width&&m.height&&(o=d((Math.abs(p.x)+this.blur)/m.width,u)*100+w,l=d((Math.abs(p.y)+this.blur)/m.height,u)*100+w),m.flipX&&(p.x*=-1),m.flipY&&(p.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+l+'%" height="'+(100+2*l)+'%" x="-'+o+'%" width="'+(100+2*o)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+d(this.blur?this.blur/2:0,u)+`"></feGaussianBlur>
	<feOffset dx="`+d(p.x,u)+'" dy="'+d(p.y,u)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+_.toRgb()+'" flood-opacity="'+_.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var m={},o=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(l){this[l]!==o[l]&&(m[l]=this[l])},this),m}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(t),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var f=e.util.object.extend,s=e.util.getElementOffset,d=e.util.removeFromArray,m=e.util.toFixed,o=e.util.transformPoint,l=e.util.invertTransform,u=e.util.getNodeCanvas,p=e.util.createCanvasElement,w=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(_,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(_,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(_,v){var y=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(_),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,y),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,y),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,y),v.overlayColor&&this.setOverlayColor(v.overlayColor,y),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var _=e.devicePixelRatio;this.__initRetinaScaling(_,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(_,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(_,v,y){v.setAttribute("width",this.width*_),v.setAttribute("height",this.height*_),y.scale(_,_)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(_,v,y){return this.__setBgOverlayImage("overlayImage",_,v,y)},setBackgroundImage:function(_,v,y){return this.__setBgOverlayImage("backgroundImage",_,v,y)},setOverlayColor:function(_,v){return this.__setBgOverlayColor("overlayColor",_,v)},setBackgroundColor:function(_,v){return this.__setBgOverlayColor("backgroundColor",_,v)},__setBgOverlayImage:function(_,v,y,T){return typeof v=="string"?e.util.loadImage(v,function(C,P){if(C){var O=new e.Image(C,T);this[_]=O,O.canvas=this}y&&y(C,P)},this,T&&T.crossOrigin):(T&&v.setOptions(T),this[_]=v,v&&(v.canvas=this),y&&y(v,!1)),this},__setBgOverlayColor:function(_,v,y){return this[_]=v,this._initGradient(v,_),this._initPattern(v,_,y),this},_createCanvasElement:function(){var _=p();if(!_||(_.style||(_.style={}),typeof _.getContext>"u"))throw w;return _},_initOptions:function(_){var v=this.lowerCanvasEl;this._setOptions(_),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(_){_&&_.getContext?this.lowerCanvasEl=_:this.lowerCanvasEl=e.util.getById(_)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(_,v){return this.setDimensions({width:_},v)},setHeight:function(_,v){return this.setDimensions({height:_},v)},setDimensions:function(_,v){var y;v=v||{};for(var T in _)y=_[T],v.cssOnly||(this._setBackstoreDimension(T,_[T]),y+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(T,y);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(_,v){return this.lowerCanvasEl[_]=v,this.upperCanvasEl&&(this.upperCanvasEl[_]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[_]=v),this[_]=v,this},_setCssDimension:function(_,v){return this.lowerCanvasEl.style[_]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[_]=v),this.wrapperEl&&(this.wrapperEl.style[_]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(_){var v=this._activeObject,y=this.backgroundImage,T=this.overlayImage,C,P,O;for(this.viewportTransform=_,P=0,O=this._objects.length;P<O;P++)C=this._objects[P],C.group||C.setCoords(!0);return v&&v.setCoords(),y&&y.setCoords(!0),T&&T.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(_,v){var y=_,T=this.viewportTransform.slice(0);_=o(_,l(this.viewportTransform)),T[0]=v,T[3]=v;var C=o(_,T);return T[4]+=y.x-C.x,T[5]+=y.y-C.y,this.setViewportTransform(T)},setZoom:function(_){return this.zoomToPoint(new e.Point(0,0),_),this},absolutePan:function(_){var v=this.viewportTransform.slice(0);return v[4]=-_.x,v[5]=-_.y,this.setViewportTransform(v)},relativePan:function(_){return this.absolutePan(new e.Point(-_.x-this.viewportTransform[4],-_.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(_){this.stateful&&_.setupState(),_._set("canvas",this),_.setCoords(),this.fire("object:added",{target:_}),_.fire("added")},_onObjectRemoved:function(_){this.fire("object:removed",{target:_}),_.fire("removed"),delete _.canvas},clearContext:function(_){return _.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var _=this.contextContainer;return this.renderCanvas(_,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var _={},v=this.width,y=this.height,T=l(this.viewportTransform);return _.tl=o({x:0,y:0},T),_.br=o({x:v,y},T),_.tr=new e.Point(_.br.x,_.tl.y),_.bl=new e.Point(_.tl.x,_.br.y),this.vptCoords=_,_},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(_,v){var y=this.viewportTransform,T=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(_),e.util.setImageSmoothing(_,this.imageSmoothingEnabled),this.fire("before:render",{ctx:_}),this._renderBackground(_),_.save(),_.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._renderObjects(_,v),_.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(_),T&&(T.canvas=this,T.shouldCache(),T._transformDone=!0,T.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(_)),this._renderOverlay(_),this.controlsAboveOverlay&&this.interactive&&this.drawControls(_),this.fire("after:render",{ctx:_})},drawClipPathOnCanvas:function(_){var v=this.viewportTransform,y=this.clipPath;_.save(),_.transform(v[0],v[1],v[2],v[3],v[4],v[5]),_.globalCompositeOperation="destination-in",y.transform(_),_.scale(1/y.zoomX,1/y.zoomY),_.drawImage(y._cacheCanvas,-y.cacheTranslationX,-y.cacheTranslationY),_.restore()},_renderObjects:function(_,v){var y,T;for(y=0,T=v.length;y<T;++y)v[y]&&v[y].render(_)},_renderBackgroundOrOverlay:function(_,v){var y=this[v+"Color"],T=this[v+"Image"],C=this.viewportTransform,P=this[v+"Vpt"];if(!(!y&&!T)){if(y){_.save(),_.beginPath(),_.moveTo(0,0),_.lineTo(this.width,0),_.lineTo(this.width,this.height),_.lineTo(0,this.height),_.closePath(),_.fillStyle=y.toLive?y.toLive(_,this):y,P&&_.transform(C[0],C[1],C[2],C[3],C[4],C[5]),_.transform(1,0,0,1,y.offsetX||0,y.offsetY||0);var O=y.gradientTransform||y.patternTransform;O&&_.transform(O[0],O[1],O[2],O[3],O[4],O[5]),_.fill(),_.restore()}if(T){_.save();var D=this.skipOffscreen;this.skipOffscreen=P,P&&_.transform(C[0],C[1],C[2],C[3],C[4],C[5]),T.render(_),this.skipOffscreen=D,_.restore()}}},_renderBackground:function(_){this._renderBackgroundOrOverlay(_,"background")},_renderOverlay:function(_){this._renderBackgroundOrOverlay(_,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(_){return this._centerObject(_,new e.Point(this.getCenterPoint().x,_.getCenterPoint().y))},centerObjectV:function(_){return this._centerObject(_,new e.Point(_.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(_){var v=this.getCenterPoint();return this._centerObject(_,v)},viewportCenterObject:function(_){var v=this.getVpCenter();return this._centerObject(_,v)},viewportCenterObjectH:function(_){var v=this.getVpCenter();return this._centerObject(_,new e.Point(v.x,_.getCenterPoint().y)),this},viewportCenterObjectV:function(_){var v=this.getVpCenter();return this._centerObject(_,new e.Point(_.getCenterPoint().x,v.y))},getVpCenter:function(){var _=this.getCenterPoint(),v=l(this.viewportTransform);return o(_,v)},_centerObject:function(_,v){return _.setPositionByOrigin(v,"center","center"),_.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(_){return this.toDatalessObject(_)},toObject:function(_){return this._toObjectMethod("toObject",_)},toDatalessObject:function(_){return this._toObjectMethod("toDatalessObject",_)},_toObjectMethod:function(_,v){var y=this.clipPath,T={version:e.version,objects:this._toObjects(_,v)};return y&&!y.excludeFromExport&&(T.clipPath=this._toObject(this.clipPath,_,v)),f(T,this.__serializeBgOverlay(_,v)),e.util.populateWithProperties(this,T,v),T},_toObjects:function(_,v){return this._objects.filter(function(y){return!y.excludeFromExport}).map(function(y){return this._toObject(y,_,v)},this)},_toObject:function(_,v,y){var T;this.includeDefaultValues||(T=_.includeDefaultValues,_.includeDefaultValues=!1);var C=_[v](y);return this.includeDefaultValues||(_.includeDefaultValues=T),C},__serializeBgOverlay:function(_,v){var y={},T=this.backgroundImage,C=this.overlayImage,P=this.backgroundColor,O=this.overlayColor;return P&&P.toObject?P.excludeFromExport||(y.background=P.toObject(v)):P&&(y.background=P),O&&O.toObject?O.excludeFromExport||(y.overlay=O.toObject(v)):O&&(y.overlay=O),T&&!T.excludeFromExport&&(y.backgroundImage=this._toObject(T,_,v)),C&&!C.excludeFromExport&&(y.overlayImage=this._toObject(C,_,v)),y},svgViewportTransformation:!0,toSVG:function(_,v){_||(_={}),_.reviver=v;var y=[];return this._setSVGPreamble(y,_),this._setSVGHeader(y,_),this.clipPath&&y.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(y,"background"),this._setSVGBgOverlayImage(y,"backgroundImage",v),this._setSVGObjects(y,v),this.clipPath&&y.push(`</g>
`),this._setSVGBgOverlayColor(y,"overlay"),this._setSVGBgOverlayImage(y,"overlayImage",v),y.push("</svg>"),y.join("")},_setSVGPreamble:function(_,v){v.suppressPreamble||_.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(_,v){var y=v.width||this.width,T=v.height||this.height,C,P='viewBox="0 0 '+this.width+" "+this.height+'" ',O=e.Object.NUM_FRACTION_DIGITS;v.viewBox?P='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(C=this.viewportTransform,P='viewBox="'+m(-C[4]/C[0],O)+" "+m(-C[5]/C[3],O)+" "+m(this.width/C[0],O)+" "+m(this.height/C[3],O)+'" '),_.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',y,'" ','height="',T,'" ',P,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(_){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(_.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var _=this,v=["background","overlay"].map(function(y){var T=_[y+"Color"];if(T&&T.toLive){var C=_[y+"Vpt"],P=_.viewportTransform,O={width:_.width/(C?P[0]:1),height:_.height/(C?P[3]:1)};return T.toSVG(O,{additionalTransform:C?e.util.matrixToSVG(P):""})}});return v.join("")},createSVGFontFacesMarkup:function(){var _="",v={},y,T,C,P,O,D,L,W,U,te=e.fontPaths,pe=[];for(this._objects.forEach(function ye(ce){pe.push(ce),ce._objects&&ce._objects.forEach(ye)}),W=0,U=pe.length;W<U;W++)if(y=pe[W],T=y.fontFamily,!(y.type.indexOf("text")===-1||v[T]||!te[T])&&(v[T]=!0,!!y.styles)){C=y.styles;for(O in C){P=C[O];for(L in P)D=P[L],T=D.fontFamily,!v[T]&&te[T]&&(v[T]=!0)}}for(var ne in v)_+=[`		@font-face {
`,"			font-family: '",ne,`';
`,"			src: url('",te[ne],`');
`,`		}
`].join("");return _&&(_=['	<style type="text/css">',`<![CDATA[
`,_,"]]>",`</style>
`].join("")),_},_setSVGObjects:function(_,v){var y,T,C,P=this._objects;for(T=0,C=P.length;T<C;T++)y=P[T],!y.excludeFromExport&&this._setSVGObject(_,y,v)},_setSVGObject:function(_,v,y){_.push(v.toSVG(y))},_setSVGBgOverlayImage:function(_,v,y){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&_.push(this[v].toSVG(y))},_setSVGBgOverlayColor:function(_,v){var y=this[v+"Color"],T=this.viewportTransform,C=this.width,P=this.height;if(!!y)if(y.toLive){var O=y.repeat,D=e.util.invertTransform(T),L=this[v+"Vpt"],W=L?e.util.matrixToSVG(D):"";_.push('<rect transform="'+W+" translate(",C/2,",",P/2,')"',' x="',y.offsetX-C/2,'" y="',y.offsetY-P/2,'" ','width="',O==="repeat-y"||O==="no-repeat"?y.source.width:C,'" height="',O==="repeat-x"||O==="no-repeat"?y.source.height:P,'" fill="url(#SVGID_'+y.id+')"',`></rect>
`)}else _.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',y,'"',`></rect>
`)},sendToBack:function(_){if(!_)return this;var v=this._activeObject,y,T,C;if(_===v&&_.type==="activeSelection")for(C=v._objects,y=C.length;y--;)T=C[y],d(this._objects,T),this._objects.unshift(T);else d(this._objects,_),this._objects.unshift(_);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(_){if(!_)return this;var v=this._activeObject,y,T,C;if(_===v&&_.type==="activeSelection")for(C=v._objects,y=0;y<C.length;y++)T=C[y],d(this._objects,T),this._objects.push(T);else d(this._objects,_),this._objects.push(_);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(_,v){if(!_)return this;var y=this._activeObject,T,C,P,O,D,L=0;if(_===y&&_.type==="activeSelection")for(D=y._objects,T=0;T<D.length;T++)C=D[T],P=this._objects.indexOf(C),P>0+L&&(O=P-1,d(this._objects,C),this._objects.splice(O,0,C)),L++;else P=this._objects.indexOf(_),P!==0&&(O=this._findNewLowerIndex(_,P,v),d(this._objects,_),this._objects.splice(O,0,_));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(_,v,y){var T,C;if(y)for(T=v,C=v-1;C>=0;--C){var P=_.intersectsWithObject(this._objects[C])||_.isContainedWithinObject(this._objects[C])||this._objects[C].isContainedWithinObject(_);if(P){T=C;break}}else T=v-1;return T},bringForward:function(_,v){if(!_)return this;var y=this._activeObject,T,C,P,O,D,L=0;if(_===y&&_.type==="activeSelection")for(D=y._objects,T=D.length;T--;)C=D[T],P=this._objects.indexOf(C),P<this._objects.length-1-L&&(O=P+1,d(this._objects,C),this._objects.splice(O,0,C)),L++;else P=this._objects.indexOf(_),P!==this._objects.length-1&&(O=this._findNewUpperIndex(_,P,v),d(this._objects,_),this._objects.splice(O,0,_));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(_,v,y){var T,C,P;if(y)for(T=v,C=v+1,P=this._objects.length;C<P;++C){var O=_.intersectsWithObject(this._objects[C])||_.isContainedWithinObject(this._objects[C])||this._objects[C].isContainedWithinObject(_);if(O){T=C;break}}else T=v+1;return T},moveTo:function(_,v){return d(this._objects,_),this._objects.splice(v,0,_),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(_){_.dispose&&_.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),f(e.StaticCanvas.prototype,e.Observable),f(e.StaticCanvas.prototype,e.Collection),f(e.StaticCanvas.prototype,e.DataURLExporter),f(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(_){var v=p();if(!v||!v.getContext)return null;var y=v.getContext("2d");if(!y)return null;switch(_){case"setLineDash":return typeof y.setLineDash<"u";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var _=u(this.lowerCanvasEl);return _&&_.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(_){var v=u(this.lowerCanvasEl);return v&&v.createJPEGStream(_)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(f){f.strokeStyle=this.color,f.lineWidth=this.width,f.lineCap=this.strokeLineCap,f.miterLimit=this.strokeMiterLimit,f.lineJoin=this.strokeLineJoin,f.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(f){var s=this.canvas.viewportTransform;f.save(),f.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(!!this.shadow){var f=this.canvas,s=this.shadow,d=f.contextTop,m=f.getZoom();f&&f._isRetinaScaling()&&(m*=e.devicePixelRatio),d.shadowColor=s.color,d.shadowBlur=s.blur*m,d.shadowOffsetX=s.offsetX*m,d.shadowOffsetY=s.offsetY*m}},needsFullRender:function(){var f=new e.Color(this.color);return f.getAlpha()<1||!!this.shadow},_resetShadow:function(){var f=this.canvas.contextTop;f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0},_isOutSideCanvas:function(f){return f.x<0||f.x>this.canvas.getWidth()||f.y<0||f.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(f){this.canvas=f,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(f,s,d){var m=s.midPointFrom(d);return f.quadraticCurveTo(s.x,s.y,m.x,m.y),m},onMouseDown:function(f,s){!this.canvas._isMainEvent(s.e)||(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(f),this._captureDrawingPath(f),this._render())},onMouseMove:function(f,s){if(!!this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f))&&this._captureDrawingPath(f)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var d=this._points,m=d.length,o=this.canvas.contextTop;this._saveAndTransform(o),this.oldEnd&&(o.beginPath(),o.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(o,d[m-2],d[m-1],!0),o.stroke(),o.restore()}},onMouseUp:function(f){return this.canvas._isMainEvent(f.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(f){var s=new e.Point(f.x,f.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(f){return this._points.length>1&&f.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(f),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(f){var s=new e.Point(f.x,f.y);return this._addPoint(s)},_render:function(f){var s,d,m=this._points[0],o=this._points[1];if(f=f||this.canvas.contextTop,this._saveAndTransform(f),f.beginPath(),this._points.length===2&&m.x===o.x&&m.y===o.y){var l=this.width/1e3;m=new e.Point(m.x,m.y),o=new e.Point(o.x,o.y),m.x-=l,o.x+=l}for(f.moveTo(m.x,m.y),s=1,d=this._points.length;s<d;s++)this._drawSegment(f,m,o),m=this._points[s],o=this._points[s+1];f.lineTo(m.x,m.y),f.stroke(),f.restore()},convertPointsToSVGPath:function(f){var s=this.width/1e3;return e.util.getSmoothPathFromPoints(f,s)},_isEmptySVGPath:function(f){var s=e.util.joinPath(f);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(f){var s=new e.Path(f,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new e.Shadow(this.shadow)),s},decimatePoints:function(f,s){if(f.length<=2)return f;var d=this.canvas.getZoom(),m=Math.pow(s/d,2),o,l=f.length-1,u=f[0],p=[u],w;for(o=1;o<l-1;o++)w=Math.pow(u.x-f[o].x,2)+Math.pow(u.y-f[o].y,2),w>=m&&(u=f[o],p.push(u));return p.push(f[l]),p},_finalizeAndAddPath:function(){var f=this.canvas.contextTop;f.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var d=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.requestRenderAll(),d.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:d})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(f){this.canvas=f,this.points=[]},drawDot:function(f){var s=this.addPoint(f),d=this.canvas.contextTop;this._saveAndTransform(d),this.dot(d,s),d.restore()},dot:function(f,s){f.fillStyle=s.fill,f.beginPath(),f.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),f.closePath(),f.fill()},onMouseDown:function(f){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(f)},_render:function(){var f=this.canvas.contextTop,s,d,m=this.points;for(this._saveAndTransform(f),s=0,d=m.length;s<d;s++)this.dot(f,m[s]);f.restore()},onMouseMove:function(f){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(f),this._render()):this.drawDot(f))},onMouseUp:function(){var f=this.canvas.renderOnAddRemove,s,d;this.canvas.renderOnAddRemove=!1;var m=[];for(s=0,d=this.points.length;s<d;s++){var o=this.points[s],l=new e.Circle({radius:o.radius,left:o.x,top:o.y,originX:"center",originY:"center",fill:o.fill});this.shadow&&(l.shadow=new e.Shadow(this.shadow)),m.push(l)}var u=new e.Group(m);u.canvas=this.canvas,this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},addPoint:function(f){var s=new e.Point(f.x,f.y),d=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,m=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return s.radius=d,s.fill=m,this.points.push(s),s}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(f){this.canvas=f,this.sprayChunks=[]},onMouseDown:function(f){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(f),this.render(this.sprayChunkPoints)},onMouseMove:function(f){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f)||(this.addSprayChunk(f),this.render(this.sprayChunkPoints))},onMouseUp:function(){var f=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],d=0,m=this.sprayChunks.length;d<m;d++)for(var o=this.sprayChunks[d],l=0,u=o.length;l<u;l++){var p=new e.Rect({width:o[l].width,height:o[l].width,left:o[l].x+1,top:o[l].y+1,originX:"center",originY:"center",fill:this.color});s.push(p)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var w=new e.Group(s);this.shadow&&w.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:w}),this.canvas.add(w),this.canvas.fire("path:created",{path:w}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},_getOptimizedRects:function(f){var s={},d,m,o;for(m=0,o=f.length;m<o;m++)d=f[m].left+""+f[m].top,s[d]||(s[d]=f[m]);var l=[];for(d in s)l.push(s[d]);return l},render:function(f){var s=this.canvas.contextTop,d,m;for(s.fillStyle=this.color,this._saveAndTransform(s),d=0,m=f.length;d<m;d++){var o=f[d];typeof o.opacity<"u"&&(s.globalAlpha=o.opacity),s.fillRect(o.x,o.y,o.width,o.width)}s.restore()},_render:function(){var f=this.canvas.contextTop,s,d;for(f.fillStyle=this.color,this._saveAndTransform(f),s=0,d=this.sprayChunks.length;s<d;s++)this.render(this.sprayChunks[s]);f.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var s,d,m,o=this.width/2,l;for(l=0;l<this.density;l++){s=e.util.getRandomInt(f.x-o,f.x+o),d=e.util.getRandomInt(f.y-o,f.y+o),this.dotWidthVariance?m=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):m=this.dotWidth;var u=new e.Point(s,d);u.width=m,this.randomOpacity&&(u.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(u)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var f=20,s=5,d=e.util.createCanvasElement(),m=d.getContext("2d");return d.width=d.height=f+s,m.fillStyle=this.color,m.beginPath(),m.arc(f/2,f/2,f/2,0,Math.PI*2,!1),m.closePath(),m.fill(),d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(f){return f.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(f){this.callSuper("_setBrushStyles",f),f.strokeStyle=this.getPattern(f)},createPath:function(f){var s=this.callSuper("createPath",f),d=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-d.x,offsetY:-d.y}),s}}),function(){var f=e.util.getPointer,s=e.util.degreesToRadians,d=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(o,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o=this.getActiveObjects(),l,u,p;if(o.length>0&&!this.preserveObjectStacking){u=[],p=[];for(var w=0,_=this._objects.length;w<_;w++)l=this._objects[w],o.indexOf(l)===-1?u.push(l):p.push(l);o.length>1&&(this._activeObject._objects=p),u.push.apply(u,p)}else u=this._objects;return u},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var o=this.contextContainer;return this.renderCanvas(o,this._chooseObjectsToRender()),this},renderTopLayer:function(o){o.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(o),this.contextTopDirty=!0),o.restore()},renderTop:function(){var o=this.contextTop;return this.clearContext(o),this.renderTopLayer(o),this.fire("after:render"),this},_normalizePointer:function(o,l){var u=o.calcTransformMatrix(),p=e.util.invertTransform(u),w=this.restorePointerVpt(l);return e.util.transformPoint(w,p)},isTargetTransparent:function(o,l,u){if(o.shouldCache()&&o._cacheCanvas&&o!==this._activeObject){var p=this._normalizePointer(o,{x:l,y:u}),w=Math.max(o.cacheTranslationX+p.x*o.zoomX,0),_=Math.max(o.cacheTranslationY+p.y*o.zoomY,0),C=e.util.isTransparent(o._cacheContext,Math.round(w),Math.round(_),this.targetFindTolerance);return C}var v=this.contextCache,y=o.selectionBackgroundColor,T=this.viewportTransform;o.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(T[0],T[1],T[2],T[3],T[4],T[5]),o.render(v),v.restore(),o.selectionBackgroundColor=y;var C=e.util.isTransparent(v,l,u,this.targetFindTolerance);return C},_isSelectionKeyPressed:function(o){var l=!1;return Array.isArray(this.selectionKey)?l=!!this.selectionKey.find(function(u){return o[u]===!0}):l=o[this.selectionKey],l},_shouldClearSelection:function(o,l){var u=this.getActiveObjects(),p=this._activeObject;return!l||l&&p&&u.length>1&&u.indexOf(l)===-1&&p!==l&&!this._isSelectionKeyPressed(o)||l&&!l.evented||l&&!l.selectable&&p&&p!==l},_shouldCenterTransform:function(o,l,u){if(!!o){var p;return l==="scale"||l==="scaleX"||l==="scaleY"||l==="resizing"?p=this.centeredScaling||o.centeredScaling:l==="rotate"&&(p=this.centeredRotation||o.centeredRotation),p?!u:u}},_getOriginFromCorner:function(o,l){var u={x:o.originX,y:o.originY};return l==="ml"||l==="tl"||l==="bl"?u.x="right":(l==="mr"||l==="tr"||l==="br")&&(u.x="left"),l==="tl"||l==="mt"||l==="tr"?u.y="bottom":(l==="bl"||l==="mb"||l==="br")&&(u.y="top"),u},_getActionFromCorner:function(o,l,u,p){if(!l||!o)return"drag";var w=p.controls[l];return w.getActionName(u,w,p)},_setupCurrentTransform:function(o,l,u){if(!!l){var p=this.getPointer(o),w=l.__corner,_=l.controls[w],v=u&&w?_.getActionHandler(o,l,_):e.controlsUtils.dragHandler,y=this._getActionFromCorner(u,w,o,l),T=this._getOriginFromCorner(l,w),C=o[this.centeredKey],P={target:l,action:y,actionHandler:v,corner:w,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:p.x-l.left,offsetY:p.y-l.top,originX:T.x,originY:T.y,ex:p.x,ey:p.y,lastX:p.x,lastY:p.y,theta:s(l.angle),width:l.width*l.scaleX,shiftKey:o.shiftKey,altKey:C,original:e.util.saveObjectTransform(l)};this._shouldCenterTransform(l,y,C)&&(P.originX="center",P.originY="center"),P.original.originX=T.x,P.original.originY=T.y,this._currentTransform=P,this._beforeTransform(o)}},setCursor:function(o){this.upperCanvasEl.style.cursor=o},_drawSelection:function(o){var l=this._groupSelector,u=new e.Point(l.ex,l.ey),p=e.util.transformPoint(u,this.viewportTransform),w=new e.Point(l.ex+l.left,l.ey+l.top),_=e.util.transformPoint(w,this.viewportTransform),v=Math.min(p.x,_.x),y=Math.min(p.y,_.y),T=Math.max(p.x,_.x),C=Math.max(p.y,_.y),P=this.selectionLineWidth/2;this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(v,y,T-v,C-y)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,v+=P,y+=P,T-=P,C-=P,e.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(v,y,T-v,C-y))},findTarget:function(o,l){if(!this.skipTargetFind){var u=!0,p=this.getPointer(o,u),w=this._activeObject,_=this.getActiveObjects(),v,y,T=d(o),C=_.length>1&&!l||_.length===1;if(this.targets=[],C&&w._findTargetCorner(p,T)||_.length>1&&!l&&w===this._searchPossibleTargets([w],p))return w;if(_.length===1&&w===this._searchPossibleTargets([w],p))if(this.preserveObjectStacking)v=w,y=this.targets,this.targets=[];else return w;var P=this._searchPossibleTargets(this._objects,p);return o[this.altSelectionKey]&&P&&v&&P!==v&&(P=v,this.targets=y),P}},_checkTarget:function(o,l,u){if(l&&l.visible&&l.evented&&l.containsPoint(o))if((this.perPixelTargetFind||l.perPixelTargetFind)&&!l.isEditing){var p=this.isTargetTransparent(l,u.x,u.y);if(!p)return!0}else return!0},_searchPossibleTargets:function(o,l){for(var u,p=o.length,w;p--;){var _=o[p],v=_.group?this._normalizePointer(_.group,l):l;if(this._checkTarget(v,_,l)){u=o[p],u.subTargetCheck&&u instanceof e.Group&&(w=this._searchPossibleTargets(u._objects,l),w&&this.targets.push(w));break}}return u},restorePointerVpt:function(o){return e.util.transformPoint(o,e.util.invertTransform(this.viewportTransform))},getPointer:function(o,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var u=f(o),p=this.upperCanvasEl,w=p.getBoundingClientRect(),_=w.width||0,v=w.height||0,y;(!_||!v)&&("top"in w&&"bottom"in w&&(v=Math.abs(w.top-w.bottom)),"right"in w&&"left"in w&&(_=Math.abs(w.right-w.left))),this.calcOffset(),u.x=u.x-this._offset.left,u.y=u.y-this._offset.top,l||(u=this.restorePointerVpt(u));var T=this.getRetinaScaling();return T!==1&&(u.x/=T,u.y/=T),_===0||v===0?y={width:1,height:1}:y={width:p.width/_,height:p.height/v},{x:u.x*y.width,y:u.y*y.height}},_createUpperCanvas:function(){var o=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,u=this.upperCanvasEl;u?u.className="":(u=this._createCanvasElement(),this.upperCanvasEl=u),e.util.addClass(u,"upper-canvas "+o),this.wrapperEl.appendChild(u),this._copyCanvasStyle(l,u),this._applyCanvasStyle(u),this.contextTop=u.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(o){var l=this.width||o.width,u=this.height||o.height;e.util.setStyle(o,{position:"absolute",width:l+"px",height:u+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),o.width=l,o.height=u,e.util.makeElementUnselectable(o)},_copyCanvasStyle:function(o,l){l.style.cssText=o.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var o=this._activeObject;return o?o.type==="activeSelection"&&o._objects?o._objects.slice(0):[o]:[]},_onObjectRemoved:function(o){o===this._activeObject&&(this.fire("before:selection:cleared",{target:o}),this._discardActiveObject(),this.fire("selection:cleared",{target:o}),o.fire("deselected")),o===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",o)},_fireSelectionEvents:function(o,l){var u=!1,p=this.getActiveObjects(),w=[],_=[];o.forEach(function(v){p.indexOf(v)===-1&&(u=!0,v.fire("deselected",{e:l,target:v}),_.push(v))}),p.forEach(function(v){o.indexOf(v)===-1&&(u=!0,v.fire("selected",{e:l,target:v}),w.push(v))}),o.length>0&&p.length>0?u&&this.fire("selection:updated",{e:l,selected:w,deselected:_}):p.length>0?this.fire("selection:created",{e:l,selected:w}):o.length>0&&this.fire("selection:cleared",{e:l,deselected:_})},setActiveObject:function(o,l){var u=this.getActiveObjects();return this._setActiveObject(o,l),this._fireSelectionEvents(u,l),this},_setActiveObject:function(o,l){return this._activeObject===o||!this._discardActiveObject(l,o)||o.onSelect({e:l})?!1:(this._activeObject=o,!0)},_discardActiveObject:function(o,l){var u=this._activeObject;if(u){if(u.onDeselect({e:o,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(o){var l=this.getActiveObjects(),u=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:u,e:o}),this._discardActiveObject(o),this._fireSelectionEvents(l,o),this},dispose:function(){var o=this.wrapperEl;return this.removeListeners(),o.removeChild(this.upperCanvasEl),o.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(l){e.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this)),o.parentNode&&o.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(o){var l=this._activeObject;l&&l._renderControls(o)},_toObject:function(o,l,u){var p=this._realizeGroupTransformOnObject(o),w=this.callSuper("_toObject",o,l,u);return this._unwindGroupTransformOnObject(o,p),w},_realizeGroupTransformOnObject:function(o){if(o.group&&o.group.type==="activeSelection"&&this._activeObject===o.group){var l=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],u={};return l.forEach(function(p){u[p]=o[p]}),e.util.addTransformToObject(o,this._activeObject.calcOwnMatrix()),u}else return null},_unwindGroupTransformOnObject:function(o,l){l&&o.set(l)},_setSVGObject:function(o,l,u){var p=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",o,l,u),this._unwindGroupTransformOnObject(l,p)},setViewportTransform:function(o){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,o)}});for(var m in e.StaticCanvas)m!=="prototype"&&(e.Canvas[m]=e.StaticCanvas[m])}(),function(){var f=e.util.addListener,s=e.util.removeListener,d=3,m=2,o=1,l={passive:!1};function u(p,w){return p.button&&p.button===w-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(f,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(p,w){var _=this.upperCanvasEl,v=this._getEventPrefix();p(e.window,"resize",this._onResize),p(_,v+"down",this._onMouseDown),p(_,v+"move",this._onMouseMove,l),p(_,v+"out",this._onMouseOut),p(_,v+"enter",this._onMouseEnter),p(_,"wheel",this._onMouseWheel),p(_,"contextmenu",this._onContextMenu),p(_,"dblclick",this._onDoubleClick),p(_,"dragover",this._onDragOver),p(_,"dragenter",this._onDragEnter),p(_,"dragleave",this._onDragLeave),p(_,"drop",this._onDrop),this.enablePointerEvents||p(_,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&w in eventjs&&(eventjs[w](_,"gesture",this._onGesture),eventjs[w](_,"drag",this._onDrag),eventjs[w](_,"orientation",this._onOrientationChange),eventjs[w](_,"shake",this._onShake),eventjs[w](_,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var p=this._getEventPrefix();s(e.document,p+"up",this._onMouseUp),s(e.document,"touchend",this._onTouchEnd,l),s(e.document,p+"move",this._onMouseMove,l),s(e.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(p,w){this.__onTransformGesture&&this.__onTransformGesture(p,w)},_onDrag:function(p,w){this.__onDrag&&this.__onDrag(p,w)},_onMouseWheel:function(p){this.__onMouseWheel(p)},_onMouseOut:function(p){var w=this._hoveredTarget;this.fire("mouse:out",{target:w,e:p}),this._hoveredTarget=null,w&&w.fire("mouseout",{e:p});var _=this;this._hoveredTargets.forEach(function(v){_.fire("mouse:out",{target:v,e:p}),v&&v.fire("mouseout",{e:p})}),this._hoveredTargets=[]},_onMouseEnter:function(p){!this._currentTransform&&!this.findTarget(p)&&(this.fire("mouse:over",{target:null,e:p}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(p,w){this.__onOrientationChange&&this.__onOrientationChange(p,w)},_onShake:function(p,w){this.__onShake&&this.__onShake(p,w)},_onLongPress:function(p,w){this.__onLongPress&&this.__onLongPress(p,w)},_onDragOver:function(p){p.preventDefault();var w=this._simpleEventHandler("dragover",p);this._fireEnterLeaveEvents(w,p)},_onDrop:function(p){return this._simpleEventHandler("drop:before",p),this._simpleEventHandler("drop",p)},_onContextMenu:function(p){return this.stopContextMenu&&(p.stopPropagation(),p.preventDefault()),!1},_onDoubleClick:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"dblclick"),this._resetTransformEventData(p)},getPointerId:function(p){var w=p.changedTouches;return w?w[0]&&w[0].identifier:this.enablePointerEvents?p.pointerId:-1},_isMainEvent:function(p){return p.isPrimary===!0?!0:p.isPrimary===!1?!1:p.type==="touchend"&&p.touches.length===0?!0:p.changedTouches?p.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(p){p.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var w=this.upperCanvasEl,_=this._getEventPrefix();f(e.document,"touchend",this._onTouchEnd,l),f(e.document,"touchmove",this._onMouseMove,l),s(w,_+"down",this._onMouseDown)},_onMouseDown:function(p){this.__onMouseDown(p),this._resetTransformEventData();var w=this.upperCanvasEl,_=this._getEventPrefix();s(w,_+"move",this._onMouseMove,l),f(e.document,_+"up",this._onMouseUp),f(e.document,_+"move",this._onMouseMove,l)},_onTouchEnd:function(p){if(!(p.touches.length>0)){this.__onMouseUp(p),this._resetTransformEventData(),this.mainTouchId=null;var w=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,l),s(e.document,"touchmove",this._onMouseMove,l);var _=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){f(_.upperCanvasEl,w+"down",_._onMouseDown),_._willAddMouseDown=0},400)}},_onMouseUp:function(p){this.__onMouseUp(p),this._resetTransformEventData();var w=this.upperCanvasEl,_=this._getEventPrefix();this._isMainEvent(p)&&(s(e.document,_+"up",this._onMouseUp),s(e.document,_+"move",this._onMouseMove,l),f(w,_+"move",this._onMouseMove,l))},_onMouseMove:function(p){!this.allowTouchScrolling&&p.preventDefault&&p.preventDefault(),this.__onMouseMove(p)},_onResize:function(){this.calcOffset()},_shouldRender:function(p){var w=this._activeObject;return!!w!=!!p||w&&p&&w!==p?!0:(w&&w.isEditing,!1)},__onMouseUp:function(p){var w,_=this._currentTransform,v=this._groupSelector,y=!1,T=!v||v.left===0&&v.top===0;if(this._cacheTransformEventData(p),w=this._target,this._handleEvent(p,"up:before"),u(p,d)){this.fireRightClick&&this._handleEvent(p,"up",d,T);return}if(u(p,m)){this.fireMiddleClick&&this._handleEvent(p,"up",m,T),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(p);return}if(!!this._isMainEvent(p)){if(_&&(this._finalizeCurrentTransform(p),y=_.actionPerformed),!T){var C=w===this._activeObject;this._maybeGroupObjects(p),y||(y=this._shouldRender(w)||!C&&w===this._activeObject)}var P,O;if(w){if(P=w._findTargetCorner(this.getPointer(p,!0),e.util.isTouchEvent(p)),w.selectable&&w!==this._activeObject&&w.activeOn==="up")this.setActiveObject(w,p),y=!0;else{var D=w.controls[P],L=D&&D.getMouseUpHandler(p,w,D);L&&(O=this.getPointer(p),L(p,_,O.x,O.y))}w.isMoving=!1}if(_&&(_.target!==w||_.corner!==P)){var W=_.target&&_.target.controls[_.corner],U=W&&W.getMouseUpHandler(p,w,D);O=O||this.getPointer(p),U&&U(p,_,O.x,O.y)}this._setCursorFromEvent(p,w),this._handleEvent(p,"up",o,T),this._groupSelector=null,this._currentTransform=null,w&&(w.__corner=0),y?this.requestRenderAll():T||this.renderTop()}},_simpleEventHandler:function(p,w){var _=this.findTarget(w),v=this.targets,y={e:w,target:_,subTargets:v};if(this.fire(p,y),_&&_.fire(p,y),!v)return _;for(var T=0;T<v.length;T++)v[T].fire(p,y);return _},_handleEvent:function(p,w,_,v){var y=this._target,T=this.targets||[],C={e:p,target:y,subTargets:T,button:_||o,isClick:v||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};w==="up"&&(C.currentTarget=this.findTarget(p),C.currentSubTargets=this.targets),this.fire("mouse:"+w,C),y&&y.fire("mouse"+w,C);for(var P=0;P<T.length;P++)T[P].fire("mouse"+w,C)},_finalizeCurrentTransform:function(p){var w=this._currentTransform,_=w.target,v={e:p,target:_,transform:w,action:w.action};_._scaling&&(_._scaling=!1),_.setCoords(),(w.actionPerformed||this.stateful&&_.hasStateChanged())&&this._fire("modified",v)},_onMouseDownInDrawingMode:function(p){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(p).requestRenderAll();var w=this.getPointer(p);this.freeDrawingBrush.onMouseDown(w,{e:p,pointer:w}),this._handleEvent(p,"down")},_onMouseMoveInDrawingMode:function(p){if(this._isCurrentlyDrawing){var w=this.getPointer(p);this.freeDrawingBrush.onMouseMove(w,{e:p,pointer:w})}this.setCursor(this.freeDrawingCursor),this._handleEvent(p,"move")},_onMouseUpInDrawingMode:function(p){var w=this.getPointer(p);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:p,pointer:w}),this._handleEvent(p,"up")},__onMouseDown:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"down:before");var w=this._target;if(u(p,d)){this.fireRightClick&&this._handleEvent(p,"down",d);return}if(u(p,m)){this.fireMiddleClick&&this._handleEvent(p,"down",m);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(p);return}if(!!this._isMainEvent(p)&&!this._currentTransform){var _=this._pointer;this._previousPointer=_;var v=this._shouldRender(w),y=this._shouldGroup(p,w);if(this._shouldClearSelection(p,w)?this.discardActiveObject(p):y&&(this._handleGrouping(p,w),w=this._activeObject),this.selection&&(!w||!w.selectable&&!w.isEditing&&w!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),w){var T=w===this._activeObject;w.selectable&&w.activeOn==="down"&&this.setActiveObject(w,p);var C=w._findTargetCorner(this.getPointer(p,!0),e.util.isTouchEvent(p));if(w.__corner=C,w===this._activeObject&&(C||!y)){this._setupCurrentTransform(p,w,T);var P=w.controls[C],_=this.getPointer(p),O=P&&P.getMouseDownHandler(p,w,P);O&&O(p,this._currentTransform,_.x,_.y)}}this._handleEvent(p,"down"),(v||y)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(p){this._resetTransformEventData(),this._pointer=this.getPointer(p,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(p)||null},_beforeTransform:function(p){var w=this._currentTransform;this.stateful&&w.target.saveState(),this.fire("before:transform",{e:p,transform:w})},__onMouseMove:function(p){this._handleEvent(p,"move:before"),this._cacheTransformEventData(p);var w,_;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(p);return}if(!!this._isMainEvent(p)){var v=this._groupSelector;v?(_=this._absolutePointer,v.left=_.x-v.ex,v.top=_.y-v.ey,this.renderTop()):this._currentTransform?this._transformObject(p):(w=this.findTarget(p)||null,this._setCursorFromEvent(p,w),this._fireOverOutEvents(w,p)),this._handleEvent(p,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(p,w){var _=this._hoveredTarget,v=this._hoveredTargets,y=this.targets,T=Math.max(v.length,y.length);this.fireSyntheticInOutEvents(p,w,{oldTarget:_,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var C=0;C<T;C++)this.fireSyntheticInOutEvents(y[C],w,{oldTarget:v[C],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=p,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(p,w){var _=this._draggedoverTarget,v=this._hoveredTargets,y=this.targets,T=Math.max(v.length,y.length);this.fireSyntheticInOutEvents(p,w,{oldTarget:_,evtOut:"dragleave",evtIn:"dragenter"});for(var C=0;C<T;C++)this.fireSyntheticInOutEvents(y[C],w,{oldTarget:v[C],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=p},fireSyntheticInOutEvents:function(p,w,_){var v,y,T=_.oldTarget,C,P,O=T!==p,D=_.canvasEvtIn,L=_.canvasEvtOut;O&&(v={e:w,target:p,previousTarget:T},y={e:w,target:T,nextTarget:p}),P=p&&O,C=T&&O,C&&(L&&this.fire(L,y),T.fire(_.evtOut,y)),P&&(D&&this.fire(D,v),p.fire(_.evtIn,v))},__onMouseWheel:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"wheel"),this._resetTransformEventData()},_transformObject:function(p){var w=this.getPointer(p),_=this._currentTransform;_.reset=!1,_.shiftKey=p.shiftKey,_.altKey=p[this.centeredKey],this._performTransformAction(p,_,w),_.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(p,w,_){var v=_.x,y=_.y,T=w.action,C=!1,P=w.actionHandler;P&&(C=P(p,w,v,y)),T==="drag"&&C&&(w.target.isMoving=!0,this.setCursor(w.target.moveCursor||this.moveCursor)),w.actionPerformed=w.actionPerformed||C},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(p,w){if(!w)return this.setCursor(this.defaultCursor),!1;var _=w.hoverCursor||this.hoverCursor,v=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,y=(!v||!v.contains(w))&&w._findTargetCorner(this.getPointer(p,!0));y?this.setCursor(this.getCornerCursor(y,w,p)):(w.subTargetCheck&&this.targets.concat().reverse().map(function(T){_=T.hoverCursor||_}),this.setCursor(_))},getCornerCursor:function(p,w,_){var v=w.controls[p];return v.cursorStyleHandler(_,v,w)}})}(),function(){var f=Math.min,s=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(d,m){var o=this._activeObject;return o&&this._isSelectionKeyPressed(d)&&m&&m.selectable&&this.selection&&(o!==m||o.type==="activeSelection")&&!m.onSelect({e:d})},_handleGrouping:function(d,m){var o=this._activeObject;o.__corner||m===o&&(m=this.findTarget(d,!0),!m||!m.selectable)||(o&&o.type==="activeSelection"?this._updateActiveSelection(m,d):this._createActiveSelection(m,d))},_updateActiveSelection:function(d,m){var o=this._activeObject,l=o._objects.slice(0);o.contains(d)?(o.removeWithUpdate(d),this._hoveredTarget=d,this._hoveredTargets=this.targets.concat(),o.size()===1&&this._setActiveObject(o.item(0),m)):(o.addWithUpdate(d),this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,m)},_createActiveSelection:function(d,m){var o=this.getActiveObjects(),l=this._createGroup(d);this._hoveredTarget=l,this._setActiveObject(l,m),this._fireSelectionEvents(o,m)},_createGroup:function(d){var m=this._objects,o=m.indexOf(this._activeObject)<m.indexOf(d),l=o?[this._activeObject,d]:[d,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(d){var m=this._collectObjects(d),o;m.length===1?this.setActiveObject(m[0],d):m.length>1&&(o=new e.ActiveSelection(m.reverse(),{canvas:this}),this.setActiveObject(o,d))},_collectObjects:function(d){for(var m=[],o,l=this._groupSelector.ex,u=this._groupSelector.ey,p=l+this._groupSelector.left,w=u+this._groupSelector.top,_=new e.Point(f(l,p),f(u,w)),v=new e.Point(s(l,p),s(u,w)),y=!this.selectionFullyContained,T=l===p&&u===w,C=this._objects.length;C--&&(o=this._objects[C],!(!(!o||!o.selectable||!o.visible)&&(y&&o.intersectsWithRect(_,v,!0)||o.isContainedWithinRect(_,v,!0)||y&&o.containsPoint(_,null,!0)||y&&o.containsPoint(v,null,!0))&&(m.push(o),T))););return m.length>1&&(m=m.filter(function(P){return!P.onSelect({e:d})})),m},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(f){f||(f={});var s=f.format||"png",d=f.quality||1,m=(f.multiplier||1)*(f.enableRetinaScaling?this.getRetinaScaling():1),o=this.toCanvasElement(m,f);return e.util.toDataURL(o,s,d)},toCanvasElement:function(f,s){f=f||1,s=s||{};var d=(s.width||this.width)*f,m=(s.height||this.height)*f,o=this.getZoom(),l=this.width,u=this.height,p=o*f,w=this.viewportTransform,_=(w[4]-(s.left||0))*f,v=(w[5]-(s.top||0))*f,y=this.interactive,T=[p,0,0,p,_,v],C=this.enableRetinaScaling,P=e.util.createCanvasElement(),O=this.contextTop;return P.width=d,P.height=m,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=T,this.width=d,this.height=m,this.calcViewportBoundaries(),this.renderCanvas(P.getContext("2d"),this._objects),this.viewportTransform=w,this.width=l,this.height=u,this.calcViewportBoundaries(),this.interactive=y,this.enableRetinaScaling=C,this.contextTop=O,P}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(f,s,d){if(!!f){var m=typeof f=="string"?JSON.parse(f):e.util.object.clone(f),o=this,l=m.clipPath,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete m.clipPath,this._enlivenObjects(m.objects,function(p){o.clear(),o._setBgOverlay(m,function(){l?o._enlivenObjects([l],function(w){o.clipPath=w[0],o.__setupCanvas.call(o,m,p,u,s)}):o.__setupCanvas.call(o,m,p,u,s)})},d),this}},__setupCanvas:function(f,s,d,m){var o=this;s.forEach(function(l,u){o.insertAt(l,u)}),this.renderOnAddRemove=d,delete f.objects,delete f.backgroundImage,delete f.overlayImage,delete f.background,delete f.overlay,this._setOptions(f),this.renderAll(),m&&m()},_setBgOverlay:function(f,s){var d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!f.backgroundImage&&!f.overlayImage&&!f.background&&!f.overlay){s&&s();return}var m=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",f.backgroundImage,d,m),this.__setBgOverlay("overlayImage",f.overlayImage,d,m),this.__setBgOverlay("backgroundColor",f.background,d,m),this.__setBgOverlay("overlayColor",f.overlay,d,m)},__setBgOverlay:function(f,s,d,m){var o=this;if(!s){d[f]=!0,m&&m();return}f==="backgroundImage"||f==="overlayImage"?e.util.enlivenObjects([s],function(l){o[f]=l[0],d[f]=!0,m&&m()}):this["set"+e.util.string.capitalize(f,!0)](s,function(){d[f]=!0,m&&m()})},_enlivenObjects:function(f,s,d){if(!f||f.length===0){s&&s([]);return}e.util.enlivenObjects(f,function(m){s&&s(m)},null,d)},_toDataURL:function(f,s){this.clone(function(d){s(d.toDataURL(f))})},_toDataURLWithMultiplier:function(f,s,d){this.clone(function(m){d(m.toDataURLWithMultiplier(f,s))})},clone:function(f,s){var d=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(m){m.loadFromJSON(d,function(){f&&f(m)})})},cloneWithoutData:function(f){var s=e.util.createCanvasElement();s.width=this.width,s.height=this.height;var d=new e.Canvas(s);this.backgroundImage?(d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll(),f&&f(d)}),d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=this.backgroundImageStretch):f&&f(d)}}),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.util.object.clone,o=s.util.toFixed,l=s.util.string.capitalize,u=s.util.degreesToRadians,p=!s.isLikelyNode,w=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:p,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(_){_&&this.setOptions(_)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(_){var v=s.perfLimitSizeTotal,y=_.width,T=_.height,C=s.maxCacheSideLimit,P=s.minCacheSideLimit;if(y<=C&&T<=C&&y*T<=v)return y<P&&(_.width=P),T<P&&(_.height=P),_;var O=y/T,D=s.util.limitDimsByArea(O,v),L=s.util.capValue,W=L(P,D.x,C),U=L(P,D.y,C);return y>W&&(_.zoomX/=y/W,_.width=W,_.capped=!0),T>U&&(_.zoomY/=T/U,_.height=U,_.capped=!0),_},_getCacheCanvasDimensions:function(){var _=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),y=v.x*_.scaleX/this.scaleX,T=v.y*_.scaleY/this.scaleY;return{width:Math.ceil(y+w),height:Math.ceil(T+w),zoomX:_.scaleX,zoomY:_.scaleY,x:y,y:T}},_updateCacheCanvas:function(){var _=this.canvas;if(this.noScaleCache&&_&&_._currentTransform){var v=_._currentTransform.target,y=_._currentTransform.action;if(this===v&&y.slice&&y.slice(0,5)==="scale")return!1}var T=this._cacheCanvas,C=this._limitCacheSize(this._getCacheCanvasDimensions()),P=C.width,O=C.height,D,L,W=C.zoomX,U=C.zoomY,te=P!==this.cacheWidth||O!==this.cacheHeight,pe=this.zoomX!==W||this.zoomY!==U,ne=te||pe;return ne?(te?(T.width=P,T.height=O):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,T.width,T.height)),D=C.x/2,L=C.y/2,this.cacheTranslationX=Math.round(T.width/2-D)+D,this.cacheTranslationY=Math.round(T.height/2-L)+L,this.cacheWidth=P,this.cacheHeight=O,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(W,U),this.zoomX=W,this.zoomY=U,!0):!1},setOptions:function(_){this._setOptions(_),this._initGradient(_.fill,"fill"),this._initGradient(_.stroke,"stroke"),this._initPattern(_.fill,"fill"),this._initPattern(_.stroke,"stroke")},transform:function(_){var v=this.group&&!this.group._transformDone||this.group&&this.canvas&&_===this.canvas.contextTop,y=this.calcTransformMatrix(!v);_.transform(y[0],y[1],y[2],y[3],y[4],y[5])},toObject:function(_){var v=s.Object.NUM_FRACTION_DIGITS,y={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:o(this.left,v),top:o(this.top,v),width:o(this.width,v),height:o(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:o(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:o(this.strokeMiterLimit,v),scaleX:o(this.scaleX,v),scaleY:o(this.scaleY,v),angle:o(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:o(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:o(this.skewX,v),skewY:o(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(y.clipPath=this.clipPath.toObject(_),y.clipPath.inverted=this.clipPath.inverted,y.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,y,_),this.includeDefaultValues||(y=this._removeDefaultValues(y)),y},toDatalessObject:function(_){return this.toObject(_)},_removeDefaultValues:function(_){var v=s.util.getKlass(_.type).prototype,y=v.stateProperties;return y.forEach(function(T){T==="left"||T==="top"||(_[T]===v[T]&&delete _[T],Array.isArray(_[T])&&Array.isArray(v[T])&&_[T].length===0&&v[T].length===0&&delete _[T])}),_},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var _=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(_.scaleX),scaleY:Math.abs(_.scaleY)}},getTotalObjectScaling:function(){var _=this.getObjectScaling(),v=_.scaleX,y=_.scaleY;if(this.canvas){var T=this.canvas.getZoom(),C=this.canvas.getRetinaScaling();v*=T*C,y*=T*C}return{scaleX:v,scaleY:y}},getObjectOpacity:function(){var _=this.opacity;return this.group&&(_*=this.group.getObjectOpacity()),_},_set:function(_,v){var y=_==="scaleX"||_==="scaleY",T=this[_]!==v,C=!1;return y&&(v=this._constrainScale(v)),_==="scaleX"&&v<0?(this.flipX=!this.flipX,v*=-1):_==="scaleY"&&v<0?(this.flipY=!this.flipY,v*=-1):_==="shadow"&&v&&!(v instanceof s.Shadow)?v=new s.Shadow(v):_==="dirty"&&this.group&&this.group.set("dirty",v),this[_]=v,T&&(C=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(_)>-1?(this.dirty=!0,C&&this.group.set("dirty",!0)):C&&this.stateProperties.indexOf(_)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(_){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(_.save(),this._setupCompositeOperation(_),this.drawSelectionBackground(_),this.transform(_),this._setOpacity(_),this._setShadow(_,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(_)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(_),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),_.restore())},renderCache:function(_){_=_||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,_.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(_,v){if(_.save(),v.inverted?_.globalCompositeOperation="destination-out":_.globalCompositeOperation="destination-in",v.absolutePositioned){var y=s.util.invertTransform(this.calcTransformMatrix());_.transform(y[0],y[1],y[2],y[3],y[4],y[5])}v.transform(_),_.scale(1/v.zoomX,1/v.zoomY),_.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),_.restore()},drawObject:function(_,v){var y=this.fill,T=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(_)):this._renderBackground(_),this._render(_),this._drawClipPath(_,this.clipPath),this.fill=y,this.stroke=T},_drawClipPath:function(_,v){!v||(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(_,v))},drawCacheOnCanvas:function(_){_.scale(1/this.zoomX,1/this.zoomY),_.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(_){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!_&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!_){var v=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-y/2,v,y)}return!0}return!1},_renderBackground:function(_){if(!!this.backgroundColor){var v=this._getNonTransformedDimensions();_.fillStyle=this.backgroundColor,_.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(_)}},_setOpacity:function(_){this.group&&!this.group._transformDone?_.globalAlpha=this.getObjectOpacity():_.globalAlpha*=this.opacity},_setStrokeStyles:function(_,v){var y=v.stroke;y&&(_.lineWidth=v.strokeWidth,_.lineCap=v.strokeLineCap,_.lineDashOffset=v.strokeDashOffset,_.lineJoin=v.strokeLineJoin,_.miterLimit=v.strokeMiterLimit,y.toLive?y.gradientUnits==="percentage"||y.gradientTransform||y.patternTransform?this._applyPatternForTransformedGradient(_,y):(_.strokeStyle=y.toLive(_,this),this._applyPatternGradientTransform(_,y)):_.strokeStyle=v.stroke)},_setFillStyles:function(_,v){var y=v.fill;y&&(y.toLive?(_.fillStyle=y.toLive(_,this),this._applyPatternGradientTransform(_,v.fill)):_.fillStyle=y)},_setClippingProperties:function(_){_.globalAlpha=1,_.strokeStyle="transparent",_.fillStyle="#000000"},_setLineDash:function(_,v){!v||v.length===0||(1&v.length&&v.push.apply(v,v),_.setLineDash(v))},_renderControls:function(_,v){var y=this.getViewportTransform(),T=this.calcTransformMatrix(),C,P,O;v=v||{},P=typeof v.hasBorders<"u"?v.hasBorders:this.hasBorders,O=typeof v.hasControls<"u"?v.hasControls:this.hasControls,T=s.util.multiplyTransformMatrices(y,T),C=s.util.qrDecompose(T),_.save(),_.translate(C.translateX,C.translateY),_.lineWidth=1*this.borderScaleFactor,this.group||(_.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(C.angle-=180),_.rotate(u(this.group?C.angle:this.angle)),v.forActiveSelection||this.group?P&&this.drawBordersInGroup(_,C,v):P&&this.drawBorders(_,v),O&&this.drawControls(_,v),_.restore()},_setShadow:function(_){if(!!this.shadow){var v=this.shadow,y=this.canvas,T,C=y&&y.viewportTransform[0]||1,P=y&&y.viewportTransform[3]||1;v.nonScaling?T={scaleX:1,scaleY:1}:T=this.getObjectScaling(),y&&y._isRetinaScaling()&&(C*=s.devicePixelRatio,P*=s.devicePixelRatio),_.shadowColor=v.color,_.shadowBlur=v.blur*s.browserShadowBlurConstant*(C+P)*(T.scaleX+T.scaleY)/4,_.shadowOffsetX=v.offsetX*C*T.scaleX,_.shadowOffsetY=v.offsetY*P*T.scaleY}},_removeShadow:function(_){!this.shadow||(_.shadowColor="",_.shadowBlur=_.shadowOffsetX=_.shadowOffsetY=0)},_applyPatternGradientTransform:function(_,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var y=v.gradientTransform||v.patternTransform,T=-this.width/2+v.offsetX||0,C=-this.height/2+v.offsetY||0;return v.gradientUnits==="percentage"?_.transform(this.width,0,0,this.height,T,C):_.transform(1,0,0,1,T,C),y&&_.transform(y[0],y[1],y[2],y[3],y[4],y[5]),{offsetX:T,offsetY:C}},_renderPaintInOrder:function(_){this.paintFirst==="stroke"?(this._renderStroke(_),this._renderFill(_)):(this._renderFill(_),this._renderStroke(_))},_render:function(){},_renderFill:function(_){!this.fill||(_.save(),this._setFillStyles(_,this),this.fillRule==="evenodd"?_.fill("evenodd"):_.fill(),_.restore())},_renderStroke:function(_){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(_),_.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();_.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&_.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(_,this.strokeDashArray),this._setStrokeStyles(_,this),_.stroke(),_.restore()}},_applyPatternForTransformedGradient:function(_,v){var y=this._limitCacheSize(this._getCacheCanvasDimensions()),T=s.util.createCanvasElement(),C,P=this.canvas.getRetinaScaling(),O=y.x/this.scaleX/P,D=y.y/this.scaleY/P;T.width=Math.ceil(O),T.height=Math.ceil(D),C=T.getContext("2d"),C.beginPath(),C.moveTo(0,0),C.lineTo(O,0),C.lineTo(O,D),C.lineTo(0,D),C.closePath(),C.translate(O/2,D/2),C.scale(y.zoomX/this.scaleX/P,y.zoomY/this.scaleY/P),this._applyPatternGradientTransform(C,v),C.fillStyle=v.toLive(_),C.fill(),_.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),_.scale(P*this.scaleX/y.zoomX,P*this.scaleY/y.zoomY),_.strokeStyle=C.createPattern(T,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var _=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",_.scaleX),this.set("scaleY",_.scaleY),this.angle=_.angle,this.skewX=_.skewX,this.skewY=0}},_removeTransformMatrix:function(_){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=s.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,_&&(this.scaleX*=_.scaleX,this.scaleY*=_.scaleY,this.cropX=_.cropX,this.cropY=_.cropY,v.x+=_.offsetLeft,v.y+=_.offsetTop,this.width=_.width,this.height=_.height),this.setPositionByOrigin(v,"center","center")},clone:function(_,v){var y=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(y,_):s.Object._fromObject("Object",y,_)},cloneAsImage:function(_,v){var y=this.toCanvasElement(v);return _&&_(new s.Image(y)),this},toCanvasElement:function(_){_||(_={});var v=s.util,y=v.saveObjectTransform(this),T=this.group,C=this.shadow,P=Math.abs,O=(_.multiplier||1)*(_.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,_.withoutTransform&&v.resetObjectTransform(this),_.withoutShadow&&(this.shadow=null);var D=s.util.createCanvasElement(),L=this.getBoundingRect(!0,!0),W=this.shadow,U,te={x:0,y:0},pe,ne,ye;W&&(pe=W.blur,W.nonScaling?U={scaleX:1,scaleY:1}:U=this.getObjectScaling(),te.x=2*Math.round(P(W.offsetX)+pe)*P(U.scaleX),te.y=2*Math.round(P(W.offsetY)+pe)*P(U.scaleY)),ne=L.width+te.x,ye=L.height+te.y,D.width=Math.ceil(ne),D.height=Math.ceil(ye);var ce=new s.StaticCanvas(D,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});_.format==="jpeg"&&(ce.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(ce.width/2,ce.height/2),"center","center");var Me=this.canvas;ce.add(this);var ke=ce.toCanvasElement(O||1,_);return this.shadow=C,this.set("canvas",Me),T&&(this.group=T),this.set(y).setCoords(),ce._objects=[],ce.dispose(),ce=null,ke},toDataURL:function(_){return _||(_={}),s.util.toDataURL(this.toCanvasElement(_),_.format||"png",_.quality||1)},isType:function(_){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===_},complexity:function(){return 1},toJSON:function(_){return this.toObject(_)},rotate:function(_){var v=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",_),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(_,v){v=v||this.canvas.getPointer(_);var y=new s.Point(v.x,v.y),T=this._getLeftTopCoords();return this.angle&&(y=s.util.rotatePoint(y,T,u(-this.angle))),{x:y.x-T.x,y:y.y-T.y}},_setupCompositeOperation:function(_){this.globalCompositeOperation&&(_.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),d(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(_,v,y,T){var C=s[_];v=m(v,!0),s.util.enlivenPatterns([v.fill,v.stroke],function(P){typeof P[0]<"u"&&(v.fill=P[0]),typeof P[1]<"u"&&(v.stroke=P[1]),s.util.enlivenObjectEnlivables(v,v,function(){var O=T?new C(v[T],v):new C(v);y&&y(O)})})},s.Object.__uid=0)}(t),function(){var f=e.util.degreesToRadians,s={left:-.5,center:0,right:.5},d={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(m,o,l,u,p){var w=m.x,_=m.y,v,y,T;return typeof o=="string"?o=s[o]:o-=.5,typeof u=="string"?u=s[u]:u-=.5,v=u-o,typeof l=="string"?l=d[l]:l-=.5,typeof p=="string"?p=d[p]:p-=.5,y=p-l,(v||y)&&(T=this._getTransformedDimensions(),w=m.x+v*T.x,_=m.y+y*T.y),new e.Point(w,_)},translateToCenterPoint:function(m,o,l){var u=this.translateToGivenOrigin(m,o,l,"center","center");return this.angle?e.util.rotatePoint(u,m,f(this.angle)):u},translateToOriginPoint:function(m,o,l){var u=this.translateToGivenOrigin(m,"center","center",o,l);return this.angle?e.util.rotatePoint(u,m,f(this.angle)):u},getCenterPoint:function(){var m=new e.Point(this.left,this.top);return this.translateToCenterPoint(m,this.originX,this.originY)},getPointByOrigin:function(m,o){var l=this.getCenterPoint();return this.translateToOriginPoint(l,m,o)},toLocalPoint:function(m,o,l){var u=this.getCenterPoint(),p,w;return typeof o<"u"&&typeof l<"u"?p=this.translateToGivenOrigin(u,"center","center",o,l):p=new e.Point(this.left,this.top),w=new e.Point(m.x,m.y),this.angle&&(w=e.util.rotatePoint(w,u,-f(this.angle))),w.subtractEquals(p)},setPositionByOrigin:function(m,o,l){var u=this.translateToCenterPoint(m,o,l),p=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",p.x),this.set("top",p.y)},adjustPosition:function(m){var o=f(this.angle),l=this.getScaledWidth(),u=e.util.cos(o)*l,p=e.util.sin(o)*l,w,_;typeof this.originX=="string"?w=s[this.originX]:w=this.originX-.5,typeof m=="string"?_=s[m]:_=m-.5,this.left+=u*(_-w),this.top+=p*(_-w),this.setCoords(),this.originX=m},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var m=this.getCenterPoint();this.originX="center",this.originY="center",this.left=m.x,this.top=m.y},_resetOrigin:function(){var m=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=m.x,this.top=m.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function f(l){return[new e.Point(l.tl.x,l.tl.y),new e.Point(l.tr.x,l.tr.y),new e.Point(l.br.x,l.br.y),new e.Point(l.bl.x,l.bl.y)]}var s=e.util,d=s.degreesToRadians,m=s.multiplyTransformMatrices,o=s.transformPoint;s.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(l,u){return u?l?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),l?this.aCoords:this.lineCoords)},getCoords:function(l,u){return f(this._getCoords(l,u))},intersectsWithRect:function(l,u,p,w){var _=this.getCoords(p,w),v=e.Intersection.intersectPolygonRectangle(_,l,u);return v.status==="Intersection"},intersectsWithObject:function(l,u,p){var w=e.Intersection.intersectPolygonPolygon(this.getCoords(u,p),l.getCoords(u,p));return w.status==="Intersection"||l.isContainedWithinObject(this,u,p)||this.isContainedWithinObject(l,u,p)},isContainedWithinObject:function(l,u,p){for(var w=this.getCoords(u,p),_=u?l.aCoords:l.lineCoords,v=0,y=l._getImageLines(_);v<4;v++)if(!l.containsPoint(w[v],y))return!1;return!0},isContainedWithinRect:function(l,u,p,w){var _=this.getBoundingRect(p,w);return _.left>=l.x&&_.left+_.width<=u.x&&_.top>=l.y&&_.top+_.height<=u.y},containsPoint:function(l,v,p,w){var _=this._getCoords(p,w),v=v||this._getImageLines(_),y=this._findCrossPoints(l,v);return y!==0&&y%2===1},isOnScreen:function(l){if(!this.canvas)return!1;var u=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br,w=this.getCoords(!0,l);return w.some(function(_){return _.x<=p.x&&_.x>=u.x&&_.y<=p.y&&_.y>=u.y})||this.intersectsWithRect(u,p,!0,l)?!0:this._containsCenterOfCanvas(u,p,l)},_containsCenterOfCanvas:function(l,u,p){var w={x:(l.x+u.x)/2,y:(l.y+u.y)/2};return!!this.containsPoint(w,null,!0,p)},isPartiallyOnScreen:function(l){if(!this.canvas)return!1;var u=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br;if(this.intersectsWithRect(u,p,!0,l))return!0;var w=this.getCoords(!0,l).every(function(_){return(_.x>=p.x||_.x<=u.x)&&(_.y>=p.y||_.y<=u.y)});return w&&this._containsCenterOfCanvas(u,p,l)},_getImageLines:function(l){var u={topline:{o:l.tl,d:l.tr},rightline:{o:l.tr,d:l.br},bottomline:{o:l.br,d:l.bl},leftline:{o:l.bl,d:l.tl}};return u},_findCrossPoints:function(l,u){var p,w,_,v,y,T=0,C;for(var P in u)if(C=u[P],!(C.o.y<l.y&&C.d.y<l.y)&&!(C.o.y>=l.y&&C.d.y>=l.y)&&(C.o.x===C.d.x&&C.o.x>=l.x?y=C.o.x:(p=0,w=(C.d.y-C.o.y)/(C.d.x-C.o.x),_=l.y-p*l.x,v=C.o.y-w*C.o.x,y=-(_-v)/(p-w)),y>=l.x&&(T+=1),T===2))break;return T},getBoundingRect:function(l,u){var p=this.getCoords(l,u);return s.makeBoundingBoxFromPoints(p)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(l){return Math.abs(l)<this.minScaleLimit?l<0?-this.minScaleLimit:this.minScaleLimit:l===0?1e-4:l},scale:function(l){return this._set("scaleX",l),this._set("scaleY",l),this.setCoords()},scaleToWidth:function(l,u){var p=this.getBoundingRect(u).width/this.getScaledWidth();return this.scale(l/this.width/p)},scaleToHeight:function(l,u){var p=this.getBoundingRect(u).height/this.getScaledHeight();return this.scale(l/this.height/p)},calcLineCoords:function(){var l=this.getViewportTransform(),u=this.padding,p=d(this.angle),w=s.cos(p),_=s.sin(p),v=w*u,y=_*u,T=v+y,C=v-y,P=this.calcACoords(),O={tl:o(P.tl,l),tr:o(P.tr,l),bl:o(P.bl,l),br:o(P.br,l)};return u&&(O.tl.x-=C,O.tl.y-=T,O.tr.x+=T,O.tr.y-=C,O.bl.x-=T,O.bl.y+=C,O.br.x+=C,O.br.y+=T),O},calcOCoords:function(){var l=this._calcRotateMatrix(),u=this._calcTranslateMatrix(),p=this.getViewportTransform(),w=m(p,u),_=m(w,l),_=m(_,[1/p[0],0,0,1/p[3],0,0]),v=this._calculateCurrentDimensions(),y={};return this.forEachControl(function(T,C,P){y[C]=T.positionHandler(v,_,P)}),y},calcACoords:function(){var l=this._calcRotateMatrix(),u=this._calcTranslateMatrix(),p=m(u,l),w=this._getTransformedDimensions(),_=w.x/2,v=w.y/2;return{tl:o({x:-_,y:-v},p),tr:o({x:_,y:-v},p),bl:o({x:-_,y:v},p),br:o({x:_,y:v},p)}},setCoords:function(l){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),l?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var l=this.getCenterPoint();return[1,0,0,1,l.x,l.y]},transformMatrixKey:function(l){var u="_",p="";return!l&&this.group&&(p=this.group.transformMatrixKey(l)+u),p+this.top+u+this.left+u+this.scaleX+u+this.scaleY+u+this.skewX+u+this.skewY+u+this.angle+u+this.originX+u+this.originY+u+this.width+u+this.height+u+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(l){var u=this.calcOwnMatrix();if(l||!this.group)return u;var p=this.transformMatrixKey(l),w=this.matrixCache||(this.matrixCache={});return w.key===p?w.value:(this.group&&(u=m(this.group.calcTransformMatrix(!1),u)),w.key=p,w.value=u,u)},calcOwnMatrix:function(){var l=this.transformMatrixKey(!0),u=this.ownMatrixCache||(this.ownMatrixCache={});if(u.key===l)return u.value;var p=this._calcTranslateMatrix(),w={angle:this.angle,translateX:p[4],translateY:p[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return u.key=l,u.value=s.composeMatrix(w),u.value},_getNonTransformedDimensions:function(){var l=this.strokeWidth,u=this.width+l,p=this.height+l;return{x:u,y:p}},_getTransformedDimensions:function(l,u){typeof l>"u"&&(l=this.skewX),typeof u>"u"&&(u=this.skewY);var p,w,_,v=l===0&&u===0;if(this.strokeUniform?(w=this.width,_=this.height):(p=this._getNonTransformedDimensions(),w=p.x,_=p.y),v)return this._finalizeDimensions(w*this.scaleX,_*this.scaleY);var y=s.sizeAfterTransform(w,_,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:l,skewY:u});return this._finalizeDimensions(y.x,y.y)},_finalizeDimensions:function(l,u){return this.strokeUniform?{x:l+this.strokeWidth,y:u+this.strokeWidth}:{x:l,y:u}},_calculateCurrentDimensions:function(){var l=this.getViewportTransform(),u=this._getTransformedDimensions(),p=o(u,l,!0);return p.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(f){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,f):this.canvas&&this.canvas.sendBackwards(this,f),this},bringForward:function(f){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,f):this.canvas&&this.canvas.bringForward(this,f),this},moveTo:function(f){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,f):this.canvas&&this.canvas.moveTo(this,f),this}}),function(){function f(d,m){if(m){if(m.toLive)return d+": url(#SVGID_"+m.id+"); ";var o=new e.Color(m),l=d+": "+o.toRgb()+"; ",u=o.getAlpha();return u!==1&&(l+=d+"-opacity: "+u.toString()+"; "),l}else return d+": none; "}var s=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(d){var m=this.fillRule?this.fillRule:"nonzero",o=this.strokeWidth?this.strokeWidth:"0",l=this.strokeDashArray?this.strokeDashArray.join(" "):"none",u=this.strokeDashOffset?this.strokeDashOffset:"0",p=this.strokeLineCap?this.strokeLineCap:"butt",w=this.strokeLineJoin?this.strokeLineJoin:"miter",_=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=typeof this.opacity<"u"?this.opacity:"1",y=this.visible?"":" visibility: hidden;",T=d?"":this.getSvgFilter(),C=f("fill",this.fill),P=f("stroke",this.stroke);return[P,"stroke-width: ",o,"; ","stroke-dasharray: ",l,"; ","stroke-linecap: ",p,"; ","stroke-dashoffset: ",u,"; ","stroke-linejoin: ",w,"; ","stroke-miterlimit: ",_,"; ",C,"fill-rule: ",m,"; ","opacity: ",v,";",T,y].join("")},getSvgSpanStyles:function(d,m){var o="; ",u=d.fontFamily?"font-family: "+(d.fontFamily.indexOf("'")===-1&&d.fontFamily.indexOf('"')===-1?"'"+d.fontFamily+"'":d.fontFamily)+o:"",l=d.strokeWidth?"stroke-width: "+d.strokeWidth+o:"",u=u,p=d.fontSize?"font-size: "+d.fontSize+"px"+o:"",w=d.fontStyle?"font-style: "+d.fontStyle+o:"",_=d.fontWeight?"font-weight: "+d.fontWeight+o:"",v=d.fill?f("fill",d.fill):"",y=d.stroke?f("stroke",d.stroke):"",T=this.getSvgTextDecoration(d),C=d.deltaY?"baseline-shift: "+-d.deltaY+"; ":"";return T&&(T="text-decoration: "+T+o),[y,l,u,p,w,_,T,v,C,m?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(d){return["overline","underline","line-through"].filter(function(m){return d[m.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(d,m){var o=d?this.calcTransformMatrix():this.calcOwnMatrix(),l='transform="'+e.util.matrixToSVG(o);return l+(m||"")+'" '},_setSVGBg:function(d){if(this.backgroundColor){var m=e.Object.NUM_FRACTION_DIGITS;d.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,m),'" y="',s(-this.height/2,m),'" width="',s(this.width,m),'" height="',s(this.height,m),`"></rect>
`)}},toSVG:function(d){return this._createBaseSVGMarkup(this._toSVG(d),{reviver:d})},toClipPathSVG:function(d){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(d),{reviver:d})},_createBaseClipPathSVGMarkup:function(d,m){m=m||{};var o=m.reviver,l=m.additionalTransform||"",u=[this.getSvgTransform(!0,l),this.getSvgCommons()].join(""),p=d.indexOf("COMMON_PARTS");return d[p]=u,o?o(d.join("")):d.join("")},_createBaseSVGMarkup:function(d,m){m=m||{};var o=m.noStyle,l=m.reviver,u=o?"":'style="'+this.getSvgStyles()+'" ',p=m.withShadow?'style="'+this.getSvgFilter()+'" ':"",w=this.clipPath,_=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=w&&w.absolutePositioned,y=this.stroke,T=this.fill,C=this.shadow,P,O=[],D,L=d.indexOf("COMMON_PARTS"),W=m.additionalTransform;return w&&(w.clipPathId="CLIPPATH_"+e.Object.__uid++,D='<clipPath id="'+w.clipPathId+`" >
`+w.toClipPathSVG(l)+`</clipPath>
`),v&&O.push("<g ",p,this.getSvgCommons(),` >
`),O.push("<g ",this.getSvgTransform(!1),v?"":p+this.getSvgCommons(),` >
`),P=[u,_,o?"":this.addPaintOrder()," ",W?'transform="'+W+'" ':""].join(""),d[L]=P,T&&T.toLive&&O.push(T.toSVG(this)),y&&y.toLive&&O.push(y.toSVG(this)),C&&O.push(C.toSVG(this)),w&&O.push(D),O.push(d.join("")),O.push(`</g>
`),v&&O.push(`</g>
`),l?l(O.join("")):O.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var f=e.util.object.extend,s="stateProperties";function d(o,l,u){var p={},w=!0;u.forEach(function(_){p[_]=o[_]}),f(o[l],p,w)}function m(o,l,u){if(o===l)return!0;if(Array.isArray(o)){if(!Array.isArray(l)||o.length!==l.length)return!1;for(var p=0,w=o.length;p<w;p++)if(!m(o[p],l[p]))return!1;return!0}else if(o&&typeof o=="object"){var _=Object.keys(o),v;if(!l||typeof l!="object"||!u&&_.length!==Object.keys(l).length)return!1;for(var p=0,w=_.length;p<w;p++)if(v=_[p],!(v==="canvas"||v==="group")&&!m(o[v],l[v]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(o){o=o||s;var l="_"+o;return Object.keys(this[l]).length<this[o].length?!0:!m(this[l],this,!0)},saveState:function(o){var l=o&&o.propertySet||s,u="_"+l;return this[u]?(d(this,u,this[l]),o&&o.stateProperties&&d(this,u,o.stateProperties),this):this.setupState(o)},setupState:function(o){o=o||{};var l=o.propertySet||s;return o.propertySet=l,this["_"+l]={},this.saveState(o),this}})}(),function(){var f=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(s,d){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var m=s.x,o=s.y,l,u,p=Object.keys(this.oCoords),w=p.length-1,_;for(this.__corner=0;w>=0;w--)if(_=p[w],!!this.isControlVisible(_)&&(u=this._getImageLines(d?this.oCoords[_].touchCorner:this.oCoords[_].corner),l=this._findCrossPoints({x:m,y:o},u),l!==0&&l%2===1))return this.__corner=_,_;return!1},forEachControl:function(s){for(var d in this.controls)s(this.controls[d],d,this)},_setCornerCoords:function(){var s=this.oCoords;for(var d in s){var m=this.controls[d];s[d].corner=m.calcCornerCoords(this.angle,this.cornerSize,s[d].x,s[d].y,!1),s[d].touchCorner=m.calcCornerCoords(this.angle,this.touchCornerSize,s[d].x,s[d].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var d=this.getCenterPoint(),m=this._calculateCurrentDimensions(),o=this.canvas.viewportTransform;return s.translate(d.x,d.y),s.scale(1/o[0],1/o[3]),s.rotate(f(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-m.x/2,-m.y/2,m.x,m.y),s.restore(),this},drawBorders:function(s,d){d=d||{};var m=this._calculateCurrentDimensions(),o=this.borderScaleFactor,l=m.x+o,u=m.y+o,p=typeof d.hasControls<"u"?d.hasControls:this.hasControls,w=!1;return s.save(),s.strokeStyle=d.borderColor||this.borderColor,this._setLineDash(s,d.borderDashArray||this.borderDashArray),s.strokeRect(-l/2,-u/2,l,u),p&&(s.beginPath(),this.forEachControl(function(_,v,y){_.withConnection&&_.getVisibility(y,v)&&(w=!0,s.moveTo(_.x*l,_.y*u),s.lineTo(_.x*l+_.offsetX,_.y*u+_.offsetY))}),w&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,d,m){m=m||{};var o=e.util.sizeAfterTransform(this.width,this.height,d),l=this.strokeWidth,u=this.strokeUniform,p=this.borderScaleFactor,w=o.x+l*(u?this.canvas.getZoom():d.scaleX)+p,_=o.y+l*(u?this.canvas.getZoom():d.scaleY)+p;return s.save(),this._setLineDash(s,m.borderDashArray||this.borderDashArray),s.strokeStyle=m.borderColor||this.borderColor,s.strokeRect(-w/2,-_/2,w,_),s.restore(),this},drawControls:function(s,d){d=d||{},s.save();var m=1,o,l;return this.canvas&&(m=this.canvas.getRetinaScaling()),s.setTransform(m,0,0,m,0,0),s.strokeStyle=s.fillStyle=d.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=d.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,d.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(o=this.group.calcTransformMatrix()),this.forEachControl(function(u,p,w){l=w.oCoords[p],u.getVisibility(w,p)&&(o&&(l=e.util.transformPoint(l,o)),u.render(s,l.x,l.y,d,w))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,d){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=d,this},setControlsVisibility:function(s){s||(s={});for(var d in s)this.setControlVisible(d,s[d]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(f,s){s=s||{};var d=function(){},m=s.onComplete||d,o=s.onChange||d,l=this;return e.util.animate({target:this,startValue:f.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(u){f.set("left",u),l.requestRenderAll(),o()},onComplete:function(){f.setCoords(),m()}})},fxCenterObjectV:function(f,s){s=s||{};var d=function(){},m=s.onComplete||d,o=s.onChange||d,l=this;return e.util.animate({target:this,startValue:f.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(u){f.set("top",u),l.requestRenderAll(),o()},onComplete:function(){f.setCoords(),m()}})},fxRemove:function(f,s){s=s||{};var d=function(){},m=s.onComplete||d,o=s.onChange||d,l=this;return e.util.animate({target:this,startValue:f.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(u){f.set("opacity",u),l.requestRenderAll(),o()},onComplete:function(){l.remove(f),m()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var f=[],s,d,m=[];for(s in arguments[0])f.push(s);for(var o=0,l=f.length;o<l;o++)s=f[o],d=o!==l-1,m.push(this._animate(s,arguments[0][s],arguments[1],d));return m}else return this._animate.apply(this,arguments)},_animate:function(f,s,d,m){var o=this,l;s=s.toString(),d?d=e.util.object.clone(d):d={},~f.indexOf(".")&&(l=f.split("."));var u=o.colorProperties.indexOf(f)>-1||l&&o.colorProperties.indexOf(l[1])>-1,p=l?this.get(l[0])[l[1]]:this.get(f);"from"in d||(d.from=p),u||(~s.indexOf("=")?s=p+parseFloat(s.replace("=","")):s=parseFloat(s));var w={target:this,startValue:d.from,endValue:s,byValue:d.by,easing:d.easing,duration:d.duration,abort:d.abort&&function(_,v,y){return d.abort.call(o,_,v,y)},onChange:function(_,v,y){l?o[l[0]][l[1]]=_:o.set(f,_),!m&&d.onChange&&d.onChange(_,v,y)},onComplete:function(_,v,y){m||(o.setCoords(),d.onComplete&&d.onComplete(_,v,y))}};return u?e.util.animateColor(w.startValue,w.endValue,w.duration,w):e.util.animate(w)}}),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.util.object.clone,o={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(u,p){u||(u=[0,0,0,0]),this.callSuper("initialize",p),this.set("x1",u[0]),this.set("y1",u[1]),this.set("x2",u[2]),this.set("y2",u[3]),this._setWidthHeight(p)},_setWidthHeight:function(u){u||(u={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in u?u.left:this._getLeftToOriginX(),this.top="top"in u?u.top:this._getTopToOriginY()},_set:function(u,p){return this.callSuper("_set",u,p),typeof o[u]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:l({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:l({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(u){u.beginPath();var p=this.calcLinePoints();u.moveTo(p.x1,p.y1),u.lineTo(p.x2,p.y2),u.lineWidth=this.strokeWidth;var w=u.strokeStyle;u.strokeStyle=this.stroke||u.fillStyle,this.stroke&&this._renderStroke(u),u.strokeStyle=w},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(u){return d(this.callSuper("toObject",u),this.calcLinePoints())},_getNonTransformedDimensions:function(){var u=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(u.y-=this.strokeWidth),this.height===0&&(u.x-=this.strokeWidth)),u},calcLinePoints:function(){var u=this.x1<=this.x2?-1:1,p=this.y1<=this.y2?-1:1,w=u*this.width*.5,_=p*this.height*.5,v=u*this.width*-.5,y=p*this.height*-.5;return{x1:w,x2:v,y1:_,y2:y}},_toSVG:function(){var u=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',u.x1,'" y1="',u.y1,'" x2="',u.x2,'" y2="',u.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(u,p,w){w=w||{};var _=s.parseAttributes(u,s.Line.ATTRIBUTE_NAMES),v=[_.x1||0,_.y1||0,_.x2||0,_.y2||0];p(new s.Line(v,d(_,w)))},s.Line.fromObject=function(u,p){function w(v){delete v.points,p&&p(v)}var _=m(u,!0);_.points=[u.x1,u.y1,u.x2,u.y2],s.Object._fromObject("Line",_,w,"points")};function l(u,p){var w=u.origin,_=u.axis1,v=u.axis2,y=u.dimension,T=p.nearest,C=p.center,P=p.farthest;return function(){switch(this.get(w)){case T:return Math.min(this.get(_),this.get(v));case C:return Math.min(this.get(_),this.get(v))+.5*this.get(y);case P:return Math.max(this.get(_),this.get(v))}}}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(o,l){return this.callSuper("_set",o,l),o==="radius"&&this.setRadius(l),this},toObject:function(o){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(o))},_toSVG:function(){var o,l=0,u=0,p=(this.endAngle-this.startAngle)%360;if(p===0)o=["<circle ","COMMON_PARTS",'cx="'+l+'" cy="'+u+'" ','r="',this.radius,`" />
`];else{var w=d(this.startAngle),_=d(this.endAngle),v=this.radius,y=s.util.cos(w)*v,T=s.util.sin(w)*v,C=s.util.cos(_)*v,P=s.util.sin(_)*v,O=p>180?"1":"0";o=['<path d="M '+y+" "+T," A "+v+" "+v," 0 ",+O+" 1"," "+C+" "+P,'" ',"COMMON_PARTS",` />
`]}return o},_render:function(o){o.beginPath(),o.arc(0,0,this.radius,d(this.startAngle),d(this.endAngle),!1),this._renderPaintInOrder(o)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(o){return this.radius=o,this.set("width",o*2).set("height",o*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(o,l){var u=s.parseAttributes(o,s.Circle.ATTRIBUTE_NAMES);if(!m(u))throw new Error("value of `r` attribute is required and can not be negative");u.left=(u.left||0)-u.radius,u.top=(u.top||0)-u.radius,l(new s.Circle(u))};function m(o){return"radius"in o&&o.radius>=0}s.Circle.fromObject=function(o,l){s.Object._fromObject("Circle",o,l)}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(d){var m=this.width/2,o=this.height/2;d.beginPath(),d.moveTo(-m,o),d.lineTo(0,-o),d.lineTo(m,o),d.closePath(),this._renderPaintInOrder(d)},_toSVG:function(){var d=this.width/2,m=this.height/2,o=[-d+" "+m,"0 "+-m,d+" "+m].join(",");return["<polygon ","COMMON_PARTS",'points="',o,'" />']}}),s.Triangle.fromObject=function(d,m){return s.Object._fromObject("Triangle",d,m)}}(t),function(f){var s=f.fabric||(f.fabric={}),d=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(m){this.callSuper("initialize",m),this.set("rx",m&&m.rx||0),this.set("ry",m&&m.ry||0)},_set:function(m,o){switch(this.callSuper("_set",m,o),m){case"rx":this.rx=o,this.set("width",o*2);break;case"ry":this.ry=o,this.set("height",o*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(m){return this.callSuper("toObject",["rx","ry"].concat(m))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(m){m.beginPath(),m.save(),m.transform(1,0,0,this.ry/this.rx,0,0),m.arc(0,0,this.rx,0,d,!1),m.restore(),this._renderPaintInOrder(m)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(m,o){var l=s.parseAttributes(m,s.Ellipse.ATTRIBUTE_NAMES);l.left=(l.left||0)-l.rx,l.top=(l.top||0)-l.ry,o(new s.Ellipse(l))},s.Ellipse.fromObject=function(m,o){s.Object._fromObject("Ellipse",m,o)}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(m){this.callSuper("initialize",m),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(m){var o=this.rx?Math.min(this.rx,this.width/2):0,l=this.ry?Math.min(this.ry,this.height/2):0,u=this.width,p=this.height,w=-this.width/2,_=-this.height/2,v=o!==0||l!==0,y=1-.5522847498;m.beginPath(),m.moveTo(w+o,_),m.lineTo(w+u-o,_),v&&m.bezierCurveTo(w+u-y*o,_,w+u,_+y*l,w+u,_+l),m.lineTo(w+u,_+p-l),v&&m.bezierCurveTo(w+u,_+p-y*l,w+u-y*o,_+p,w+u-o,_+p),m.lineTo(w+o,_+p),v&&m.bezierCurveTo(w+y*o,_+p,w,_+p-y*l,w,_+p-l),m.lineTo(w,_+l),v&&m.bezierCurveTo(w,_+y*l,w+y*o,_,w+o,_),m.closePath(),this._renderPaintInOrder(m)},toObject:function(m){return this.callSuper("toObject",["rx","ry"].concat(m))},_toSVG:function(){var m=-this.width/2,o=-this.height/2;return["<rect ","COMMON_PARTS",'x="',m,'" y="',o,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(m,o,l){if(!m)return o(null);l=l||{};var u=s.parseAttributes(m,s.Rect.ATTRIBUTE_NAMES);u.left=u.left||0,u.top=u.top||0,u.height=u.height||0,u.width=u.width||0;var p=new s.Rect(d(l?s.util.object.clone(l):{},u));p.visible=p.visible&&p.width>0&&p.height>0,o(p)},s.Rect.fromObject=function(m,o){return s.Object._fromObject("Rect",m,o)}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.util.array.min,o=s.util.array.max,l=s.util.toFixed,u=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(p,w){w=w||{},this.points=p||[],this.callSuper("initialize",w),this._setPositionDimensions(w)},_projectStrokeOnPoints:function(){return u(this.points,this,!0)},_setPositionDimensions:function(p){var w=this._calcDimensions(p),_,v=this.exactBoundingBox?this.strokeWidth:0;this.width=w.width-v,this.height=w.height-v,p.fromSVG||(_=this.translateToGivenOrigin({x:w.left-this.strokeWidth/2+v/2,y:w.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),typeof p.left>"u"&&(this.left=p.fromSVG?w.left:_.x),typeof p.top>"u"&&(this.top=p.fromSVG?w.top:_.y),this.pathOffset={x:w.left+this.width/2+v/2,y:w.top+this.height/2+v/2}},_calcDimensions:function(){var p=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,w=m(p,"x")||0,_=m(p,"y")||0,v=o(p,"x")||0,y=o(p,"y")||0,T=v-w,C=y-_;return{left:w,top:_,width:T,height:C}},toObject:function(p){return d(this.callSuper("toObject",p),{points:this.points.concat()})},_toSVG:function(){for(var p=[],w=this.pathOffset.x,_=this.pathOffset.y,v=s.Object.NUM_FRACTION_DIGITS,y=0,T=this.points.length;y<T;y++)p.push(l(this.points[y].x-w,v),",",l(this.points[y].y-_,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',p.join(""),`" />
`]},commonRender:function(p){var w,_=this.points.length,v=this.pathOffset.x,y=this.pathOffset.y;if(!_||isNaN(this.points[_-1].y))return!1;p.beginPath(),p.moveTo(this.points[0].x-v,this.points[0].y-y);for(var T=0;T<_;T++)w=this.points[T],p.lineTo(w.x-v,w.y-y);return!0},_render:function(p){!this.commonRender(p)||this._renderPaintInOrder(p)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(p){return function(w,_,v){if(!w)return _(null);v||(v={});var y=s.parsePointsAttribute(w.getAttribute("points")),T=s.parseAttributes(w,s[p].ATTRIBUTE_NAMES);T.fromSVG=!0,_(new s[p](y,d(T,v)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(p,w){return s.Object._fromObject("Polyline",p,w,"points")}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return d(this.points,this)},_render:function(m){!this.commonRender(m)||(m.closePath(),this._renderPaintInOrder(m))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(m,o){s.Object._fromObject("Polygon",m,o,"points")}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.array.min,m=s.util.array.max,o=s.util.object.extend,l=s.util.object.clone,u=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(p,w){w=l(w||{}),delete w.path,this.callSuper("initialize",w),this._setPath(p||[],w)},_setPath:function(p,w){this.path=s.util.makePathSimpler(Array.isArray(p)?p:s.util.parsePath(p)),s.Polyline.prototype._setPositionDimensions.call(this,w||{})},_renderPathCommands:function(p){var w,_=0,v=0,y=0,T=0,C=0,P=0,O=-this.pathOffset.x,D=-this.pathOffset.y;p.beginPath();for(var L=0,W=this.path.length;L<W;++L)switch(w=this.path[L],w[0]){case"L":y=w[1],T=w[2],p.lineTo(y+O,T+D);break;case"M":y=w[1],T=w[2],_=y,v=T,p.moveTo(y+O,T+D);break;case"C":y=w[5],T=w[6],C=w[3],P=w[4],p.bezierCurveTo(w[1]+O,w[2]+D,C+O,P+D,y+O,T+D);break;case"Q":p.quadraticCurveTo(w[1]+O,w[2]+D,w[3]+O,w[4]+D),y=w[3],T=w[4],C=w[1],P=w[2];break;case"z":case"Z":y=_,T=v,p.closePath();break}},_render:function(p){this._renderPathCommands(p),this._renderPaintInOrder(p)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){return o(this.callSuper("toObject",p),{path:this.path.map(function(w){return w.slice()})})},toDatalessObject:function(p){var w=this.toObject(["sourcePath"].concat(p));return w.sourcePath&&delete w.path,w},_toSVG:function(){var p=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',p,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var p=s.Object.NUM_FRACTION_DIGITS;return" translate("+u(-this.pathOffset.x,p)+", "+u(-this.pathOffset.y,p)+")"},toClipPathSVG:function(p){var w=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:w})},toSVG:function(p){var w=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:w})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var p=[],w=[],_,v=0,y=0,T=0,C=0,P,O=0,D=this.path.length;O<D;++O){switch(_=this.path[O],_[0]){case"L":T=_[1],C=_[2],P=[];break;case"M":T=_[1],C=_[2],v=T,y=C,P=[];break;case"C":P=s.util.getBoundsOfCurve(T,C,_[1],_[2],_[3],_[4],_[5],_[6]),T=_[5],C=_[6];break;case"Q":P=s.util.getBoundsOfCurve(T,C,_[1],_[2],_[1],_[2],_[3],_[4]),T=_[3],C=_[4];break;case"z":case"Z":T=v,C=y;break}P.forEach(function(ye){p.push(ye.x),w.push(ye.y)}),p.push(T),w.push(C)}var L=d(p)||0,W=d(w)||0,U=m(p)||0,te=m(w)||0,pe=U-L,ne=te-W;return{left:L,top:W,width:pe,height:ne}}}),s.Path.fromObject=function(p,w){if(typeof p.sourcePath=="string"){var _=p.sourcePath;s.loadSVGFromURL(_,function(v){var y=v[0];y.setOptions(p),p.clipPath?s.util.enlivenObjects([p.clipPath],function(T){y.clipPath=T[0],w&&w(y)}):w&&w(y)})}else s.Object._fromObject("Path",p,w,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(p,w,_){var v=s.parseAttributes(p,s.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,w(new s.Path(v.d,o(v,_)))}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.array.min,m=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(o,l,u){l=l||{},this._objects=[],u&&this.callSuper("initialize",l),this._objects=o||[];for(var p=this._objects.length;p--;)this._objects[p].group=this;if(u)this._updateObjectsACoords();else{var w=l&&l.centerPoint;l.originX!==void 0&&(this.originX=l.originX),l.originY!==void 0&&(this.originY=l.originY),w||this._calcBounds(),this._updateObjectsCoords(w),delete l.centerPoint,this.callSuper("initialize",l)}this.setCoords()},_updateObjectsACoords:function(){for(var o=!0,l=this._objects.length;l--;)this._objects[l].setCoords(o)},_updateObjectsCoords:function(l){for(var l=l||this.getCenterPoint(),u=this._objects.length;u--;)this._updateObjectCoords(this._objects[u],l)},_updateObjectCoords:function(o,l){var u=o.left,p=o.top,w=!0;o.set({left:u-l.x,top:p-l.y}),o.group=this,o.setCoords(w)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(o){var l=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),o&&(l&&s.util.removeTransformFromObject(o,this.group.calcTransformMatrix()),this._objects.push(o),o.group=this,o._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,l?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(o){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(o),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(o){this.dirty=!0,o.group=this,o._set("canvas",this.canvas)},_onObjectRemoved:function(o){this.dirty=!0,delete o.group},_set:function(o,l){var u=this._objects.length;if(this.useSetOnGroup)for(;u--;)this._objects[u].setOnGroup(o,l);if(o==="canvas")for(;u--;)this._objects[u]._set(o,l);s.Object.prototype._set.call(this,o,l)},toObject:function(o){var l=this.includeDefaultValues,u=this._objects.filter(function(w){return!w.excludeFromExport}).map(function(w){var _=w.includeDefaultValues;w.includeDefaultValues=l;var v=w.toObject(o);return w.includeDefaultValues=_,v}),p=s.Object.prototype.toObject.call(this,o);return p.objects=u,p},toDatalessObject:function(o){var l,u=this.sourcePath;if(u)l=u;else{var p=this.includeDefaultValues;l=this._objects.map(function(_){var v=_.includeDefaultValues;_.includeDefaultValues=p;var y=_.toDatalessObject(o);return _.includeDefaultValues=v,y})}var w=s.Object.prototype.toDatalessObject.call(this,o);return w.objects=l,w},render:function(o){this._transformDone=!0,this.callSuper("render",o),this._transformDone=!1},shouldCache:function(){var o=s.Object.prototype.shouldCache.call(this);if(o){for(var l=0,u=this._objects.length;l<u;l++)if(this._objects[l].willDrawShadow())return this.ownCaching=!1,!1}return o},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var o=0,l=this._objects.length;o<l;o++)if(this._objects[o].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(o){for(var l=0,u=this._objects.length;l<u;l++)this._objects[l].render(o);this._drawClipPath(o,this.clipPath)},isCacheDirty:function(o){if(this.callSuper("isCacheDirty",o))return!0;if(!this.statefullCache)return!1;for(var l=0,u=this._objects.length;l<u;l++)if(this._objects[l].isCacheDirty(!0)){if(this._cacheCanvas){var p=this.cacheWidth/this.zoomX,w=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-w/2,p,w)}return!0}return!1},_restoreObjectsState:function(){var o=this.calcOwnMatrix();return this._objects.forEach(function(l){s.util.addTransformToObject(l,o),delete l.group,l.setCoords()}),this},destroy:function(){return this._objects.forEach(function(o){o.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[]},toActiveSelection:function(){if(!!this.canvas){var o=this._objects,l=this.canvas;this._objects=[];var u=this.toObject();delete u.objects;var p=new s.ActiveSelection([]);return p.set(u),p.type="activeSelection",l.remove(this),o.forEach(function(w){w.group=p,w.dirty=!0,l.add(w)}),p.canvas=l,p._objects=o,l._activeObject=p,p.setCoords(),p}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var o=!0;return this.forEachObject(function(l){l.setCoords(o)}),this},_calcBounds:function(o){for(var l=[],u=[],p,w,_,v=["tr","br","bl","tl"],y=0,T=this._objects.length,C,P=v.length;y<T;++y){for(p=this._objects[y],_=p.calcACoords(),C=0;C<P;C++)w=v[C],l.push(_[w].x),u.push(_[w].y);p.aCoords=_}this._getBounds(l,u,o)},_getBounds:function(o,l,u){var p=new s.Point(d(o),d(l)),w=new s.Point(m(o),m(l)),_=p.y||0,v=p.x||0,y=w.x-p.x||0,T=w.y-p.y||0;this.width=y,this.height=T,u||this.setPositionByOrigin({x:v,y:_},"left","top")},_toSVG:function(o){for(var l=["<g ","COMMON_PARTS",` >
`],u=0,p=this._objects.length;u<p;u++)l.push("		",this._objects[u].toSVG(o));return l.push(`</g>
`),l},getSvgStyles:function(){var o=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",l=this.visible?"":" visibility: hidden;";return[o,this.getSvgFilter(),l].join("")},toClipPathSVG:function(o){for(var l=[],u=0,p=this._objects.length;u<p;u++)l.push("	",this._objects[u].toClipPathSVG(o));return this._createBaseClipPathSVGMarkup(l,{reviver:o})}}),s.Group.fromObject=function(o,l){var u=o.objects,p=s.util.object.clone(o,!0);if(delete p.objects,typeof u=="string"){s.loadSVGFromURL(u,function(w){var _=s.util.groupSVGElements(w,o,u),v=p.clipPath;delete p.clipPath,_.set(p),v?s.util.enlivenObjects([v],function(y){_.clipPath=y[0],l&&l(_)}):l&&l(_)});return}s.util.enlivenObjects(u,function(w){s.util.enlivenObjectEnlivables(o,p,function(){l&&l(new s.Group(w,p,!0))})})})}(t),function(f){var s=f.fabric||(f.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(d,m){m=m||{},this._objects=d||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;m.originX&&(this.originX=m.originX),m.originY&&(this.originY=m.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,m),this.setCoords()},toGroup:function(){var d=this._objects.concat();this._objects=[];var m=s.Object.prototype.toObject.call(this),o=new s.Group([]);if(delete m.type,o.set(m),d.forEach(function(u){u.canvas.remove(u),u.group=o}),o._objects=d,!this.canvas)return o;var l=this.canvas;return l.add(o),l._activeObject=o,o.setCoords(),o},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(d,m,o){d.save(),d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,o=o||{},typeof o.hasControls>"u"&&(o.hasControls=!1),o.forActiveSelection=!0;for(var l=0,u=this._objects.length;l<u;l++)this._objects[l]._renderControls(d,o);this.callSuper("_renderControls",d,m),d.restore()}}),s.ActiveSelection.fromObject=function(d,m){s.util.enlivenObjects(d.objects,function(o){delete d.objects,m&&m(new s.ActiveSelection(o,d,!0))})})}(t),function(f){var s=e.util.object.extend;if(f.fabric||(f.fabric={}),f.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(d,m){m||(m={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",m),this._initElement(d,m)},getElement:function(){return this._element||{}},setElement:function(d,m){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=d,this._originalElement=d,this._initConfig(m),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(d){var m=e.filterBackend;m&&m.evictCachesForKey&&m.evictCachesForKey(d)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(d){e.util.cleanUpJsdomNode(this[d]),this[d]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var d=this.getElement();return{width:d.naturalWidth||d.width,height:d.naturalHeight||d.height}},_stroke:function(d){if(!(!this.stroke||this.strokeWidth===0)){var m=this.width/2,o=this.height/2;d.beginPath(),d.moveTo(-m,-o),d.lineTo(m,-o),d.lineTo(m,o),d.lineTo(-m,o),d.lineTo(-m,-o),d.closePath()}},toObject:function(d){var m=[];this.filters.forEach(function(l){l&&m.push(l.toObject())});var o=s(this.callSuper("toObject",["cropX","cropY"].concat(d)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:m});return this.resizeFilter&&(o.resizeFilter=this.resizeFilter.toObject()),o},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var d=[],m=[],o,l=this._element,u=-this.width/2,p=-this.height/2,w="",_="";if(!l)return[];if(this.hasCrop()){var v=e.Object.__uid++;d.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+u+'" y="'+p+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),w=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(_='" image-rendering="optimizeSpeed'),m.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',u-this.cropX,'" y="',p-this.cropY,'" width="',l.width||l.naturalWidth,'" height="',l.height||l.height,_,'"',w,`></image>
`),this.stroke||this.strokeDashArray){var y=this.fill;this.fill=null,o=["	<rect ",'x="',u,'" y="',p,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=y}return this.paintFirst!=="fill"?d=d.concat(o,m):d=d.concat(m,o),d},getSrc:function(d){var m=d?this._element:this._originalElement;return m?m.toDataURL?m.toDataURL():this.srcFromAttribute?m.getAttribute("src"):m.src:this.src||""},setSrc:function(d,m,o){return e.util.loadImage(d,function(l,u){this.setElement(l,o),this._setWidthHeight(),m&&m(this,u)},this,o&&o.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var d=this.resizeFilter,m=this.minimumScaleTrigger,o=this.getTotalObjectScaling(),l=o.scaleX,u=o.scaleY,p=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!d||l>m&&u>m){this._element=p,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=l,this._lastScaleY=u;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var w=e.util.createCanvasElement(),_=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=p.width,y=p.height;w.width=v,w.height=y,this._element=w,this._lastScaleX=d.scaleX=l,this._lastScaleY=d.scaleY=u,e.filterBackend.applyFilters([d],p,v,y,this._element,_),this._filterScalingX=w.width/this._originalElement.width,this._filterScalingY=w.height/this._originalElement.height},applyFilters:function(d){if(d=d||this.filters||[],d=d.filter(function(p){return p&&!p.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),d.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var m=this._originalElement,o=m.naturalWidth||m.width,l=m.naturalHeight||m.height;if(this._element===this._originalElement){var u=e.util.createCanvasElement();u.width=o,u.height=l,this._element=u,this._filteredEl=u}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,o,l),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(d,this._originalElement,o,l,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(d){e.util.setImageSmoothing(d,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(d),this._renderPaintInOrder(d)},drawCacheOnCanvas:function(d){e.util.setImageSmoothing(d,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,d)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(d){var m=this._element;if(!!m){var o=this._filterScalingX,l=this._filterScalingY,u=this.width,p=this.height,w=Math.min,_=Math.max,v=_(this.cropX,0),y=_(this.cropY,0),T=m.naturalWidth||m.width,C=m.naturalHeight||m.height,P=v*o,O=y*l,D=w(u*o,T-P),L=w(p*l,C-O),W=-u/2,U=-p/2,te=w(u,T/o-v),pe=w(p,C/l-y);m&&d.drawImage(m,P,O,D,L,W,U,te,pe)}},_needsResize:function(){var d=this.getTotalObjectScaling();return d.scaleX!==this._lastScaleX||d.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(d,m){this.setElement(e.util.getById(d),m),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(d){d||(d={}),this.setOptions(d),this._setWidthHeight(d)},_initFilters:function(d,m){d&&d.length?e.util.enlivenObjects(d,function(o){m&&m(o)},"fabric.Image.filters"):m&&m()},_setWidthHeight:function(d){d||(d={});var m=this.getElement();this.width=d.width||m.naturalWidth||m.width||0,this.height=d.height||m.naturalHeight||m.height||0},parsePreserveAspectRatioAttribute:function(){var d=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),m=this._element.width,o=this._element.height,l=1,u=1,p=0,w=0,_=0,v=0,y,T=this.width,C=this.height,P={width:T,height:C};return d&&(d.alignX!=="none"||d.alignY!=="none")?(d.meetOrSlice==="meet"&&(l=u=e.util.findScaleToFit(this._element,P),y=(T-m*l)/2,d.alignX==="Min"&&(p=-y),d.alignX==="Max"&&(p=y),y=(C-o*u)/2,d.alignY==="Min"&&(w=-y),d.alignY==="Max"&&(w=y)),d.meetOrSlice==="slice"&&(l=u=e.util.findScaleToCover(this._element,P),y=m-T/l,d.alignX==="Mid"&&(_=y/2),d.alignX==="Max"&&(_=y),y=o-C/u,d.alignY==="Mid"&&(v=y/2),d.alignY==="Max"&&(v=y),m=T/l,o=C/u)):(l=T/m,u=C/o),{width:m,height:o,scaleX:l,scaleY:u,offsetLeft:p,offsetTop:w,cropX:_,cropY:v}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(d,m){var o=e.util.object.clone(d);e.util.loadImage(o.src,function(l,u){if(u){m&&m(null,!0);return}e.Image.prototype._initFilters.call(o,o.filters,function(p){o.filters=p||[],e.Image.prototype._initFilters.call(o,[o.resizeFilter],function(w){o.resizeFilter=w[0],e.util.enlivenObjectEnlivables(o,o,function(){var _=new e.Image(l,o);m(_,!1)})})})},null,o.crossOrigin)},e.Image.fromURL=function(d,m,o){e.util.loadImage(d,function(l,u){m&&m(new e.Image(l,o),u)},null,o&&o.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(d,m,o){var l=e.parseAttributes(d,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(l["xlink:href"],m,s(o?e.util.object.clone(o):{},l))}}(t),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var f=this.angle%360;return f>0?Math.round((f-1)/90)*90:Math.round(f/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(f){f=f||{};var s=function(){},d=f.onComplete||s,m=f.onChange||s,o=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){o.rotate(l),m()},onComplete:function(){o.setCoords(),d()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(f){return f.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(f){return f.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function f(d,m){var o="precision "+m+` float;
void main(){}`,l=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(l,o),d.compileShader(l),!!d.getShaderParameter(l,d.COMPILE_STATUS)}e.isWebglSupported=function(d){if(e.isLikelyNode)return!1;d=d||e.WebglFilterBackend.prototype.tileSize;var m=document.createElement("canvas"),o=m.getContext("webgl")||m.getContext("experimental-webgl"),l=!1;if(o){e.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),l=e.maxTextureSize>=d;for(var u=["highp","mediump","lowp"],p=0;p<3;p++)if(f(o,u[p])){e.webGlPrecision=u[p];break}}return this.isSupported=l,l},e.WebglFilterBackend=s;function s(d){d&&d.tileSize&&(this.tileSize=d.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(d,m){this.dispose(),this.createWebGLCanvas(d,m),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(d,m)},chooseFastestCopyGLTo2DMethod:function(d,m){var o=typeof window.performance<"u",l;try{new ImageData(1,1),l=!0}catch{l=!1}var u=typeof ArrayBuffer<"u",p=typeof Uint8ClampedArray<"u";if(!!(o&&l&&u&&p)){var w=e.util.createCanvasElement(),_=new ArrayBuffer(d*m*4);if(e.forceGLPutImageData){this.imageBuffer=_,this.copyGLTo2D=x;return}var v={imageBuffer:_,destinationWidth:d,destinationHeight:m,targetCanvas:w},y,T,C;w.width=d,w.height=m,y=window.performance.now(),h.call(v,this.gl,v),T=window.performance.now()-y,y=window.performance.now(),x.call(v,this.gl,v),C=window.performance.now()-y,T>C?(this.imageBuffer=_,this.copyGLTo2D=x):this.copyGLTo2D=h}},createWebGLCanvas:function(d,m){var o=e.util.createCanvasElement();o.width=d,o.height=m;var l={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},u=o.getContext("webgl",l);u||(u=o.getContext("experimental-webgl",l)),u&&(u.clearColor(0,0,0,0),this.canvas=o,this.gl=u)},applyFilters:function(d,m,o,l,u,p){var w=this.gl,_;p&&(_=this.getCachedTexture(p,m));var v={originalWidth:m.width||m.originalWidth,originalHeight:m.height||m.originalHeight,sourceWidth:o,sourceHeight:l,destinationWidth:o,destinationHeight:l,context:w,sourceTexture:this.createTexture(w,o,l,!_&&m),targetTexture:this.createTexture(w,o,l),originalTexture:_||this.createTexture(w,o,l,!_&&m),passes:d.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:u},y=w.createFramebuffer();return w.bindFramebuffer(w.FRAMEBUFFER,y),d.forEach(function(T){T&&T.applyTo(v)}),a(v),this.copyGLTo2D(w,v),w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(v.sourceTexture),w.deleteTexture(v.targetTexture),w.deleteFramebuffer(y),u.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(d,m,o,l,u){var p=d.createTexture();return d.bindTexture(d.TEXTURE_2D,p),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,u||d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,u||d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),l?d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,l):d.texImage2D(d.TEXTURE_2D,0,d.RGBA,m,o,0,d.RGBA,d.UNSIGNED_BYTE,null),p},getCachedTexture:function(d,m){if(this.textureCache[d])return this.textureCache[d];var o=this.createTexture(this.gl,m.width,m.height,m);return this.textureCache[d]=o,o},evictCachesForKey:function(d){this.textureCache[d]&&(this.gl.deleteTexture(this.textureCache[d]),delete this.textureCache[d])},copyGLTo2D:h,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var d=this.gl,m={renderer:"",vendor:""};if(!d)return m;var o=d.getExtension("WEBGL_debug_renderer_info");if(o){var l=d.getParameter(o.UNMASKED_RENDERER_WEBGL),u=d.getParameter(o.UNMASKED_VENDOR_WEBGL);l&&(m.renderer=l.toLowerCase()),u&&(m.vendor=u.toLowerCase())}return this.gpuInfo=m,m}}}();function a(f){var s=f.targetCanvas,d=s.width,m=s.height,o=f.destinationWidth,l=f.destinationHeight;(d!==o||m!==l)&&(s.width=o,s.height=l)}function h(f,s){var d=f.canvas,m=s.targetCanvas,o=m.getContext("2d");o.translate(0,m.height),o.scale(1,-1);var l=d.height-m.height;o.drawImage(d,0,l,m.width,m.height,0,0,m.width,m.height)}function x(f,s){var d=s.targetCanvas,m=d.getContext("2d"),o=s.destinationWidth,l=s.destinationHeight,u=o*l*4,p=new Uint8Array(this.imageBuffer,0,u),w=new Uint8ClampedArray(this.imageBuffer,0,u);f.readPixels(0,0,o,l,f.RGBA,f.UNSIGNED_BYTE,p);var _=new ImageData(w,o,l);m.putImageData(_,0,0)}(function(){var f=function(){};e.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:f,dispose:f,clearWebGLCaches:f,resources:{},applyFilters:function(d,m,o,l,u){var p=u.getContext("2d");p.drawImage(m,0,0,o,l);var w=p.getImageData(0,0,o,l),_=p.getImageData(0,0,o,l),v={sourceWidth:o,sourceHeight:l,imageData:w,originalEl:m,originalImageData:_,canvasEl:u,ctx:p,filterBackend:this};return d.forEach(function(y){y.applyTo(v)}),(v.imageData.width!==o||v.imageData.height!==l)&&(u.width=v.imageData.width,u.height=v.imageData.height),p.putImageData(v.imageData,0,0),v}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(f){f&&this.setOptions(f)},setOptions:function(f){for(var s in f)this[s]=f[s]},createProgram:function(f,s,d){s=s||this.fragmentSource,d=d||this.vertexSource,e.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var m=f.createShader(f.VERTEX_SHADER);if(f.shaderSource(m,d),f.compileShader(m),!f.getShaderParameter(m,f.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+f.getShaderInfoLog(m));var o=f.createShader(f.FRAGMENT_SHADER);if(f.shaderSource(o,s),f.compileShader(o),!f.getShaderParameter(o,f.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+f.getShaderInfoLog(o));var l=f.createProgram();if(f.attachShader(l,m),f.attachShader(l,o),f.linkProgram(l),!f.getProgramParameter(l,f.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+f.getProgramInfoLog(l));var u=this.getAttributeLocations(f,l),p=this.getUniformLocations(f,l)||{};return p.uStepW=f.getUniformLocation(l,"uStepW"),p.uStepH=f.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:u,uniformLocations:p}},getAttributeLocations:function(f,s){return{aPosition:f.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(f,s,d){var m=s.aPosition,o=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,o),f.enableVertexAttribArray(m),f.vertexAttribPointer(m,2,f.FLOAT,!1,0,0),f.bufferData(f.ARRAY_BUFFER,d,f.STATIC_DRAW)},_setupFrameBuffer:function(f){var s=f.context,d,m;f.passes>1?(d=f.destinationWidth,m=f.destinationHeight,(f.sourceWidth!==d||f.sourceHeight!==m)&&(s.deleteTexture(f.targetTexture),f.targetTexture=f.filterBackend.createTexture(s,d,m)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,f.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(f){f.passes--,f.pass++;var s=f.targetTexture;f.targetTexture=f.sourceTexture,f.sourceTexture=s},isNeutralState:function(){var f=this.mainParameter,s=e.Image.filters[this.type].prototype;if(f)if(Array.isArray(s[f])){for(var d=s[f].length;d--;)if(this[f][d]!==s[f][d])return!1;return!0}else return s[f]===this[f];else return!1},applyTo:function(f){f.webgl?(this._setupFrameBuffer(f),this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)},retrieveShader:function(f){return f.programCache.hasOwnProperty(this.type)||(f.programCache[this.type]=this.createProgram(f.context)),f.programCache[this.type]},applyToWebGL:function(f){var s=f.context,d=this.retrieveShader(f);f.pass===0&&f.originalTexture?s.bindTexture(s.TEXTURE_2D,f.originalTexture):s.bindTexture(s.TEXTURE_2D,f.sourceTexture),s.useProgram(d.program),this.sendAttributeData(s,d.attributeLocations,f.aPosition),s.uniform1f(d.uniformLocations.uStepW,1/f.sourceWidth),s.uniform1f(d.uniformLocations.uStepH,1/f.sourceHeight),this.sendUniformData(s,d.uniformLocations),s.viewport(0,0,f.destinationWidth,f.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(f,s,d){f.activeTexture(d),f.bindTexture(f.TEXTURE_2D,s),f.activeTexture(f.TEXTURE0)},unbindAdditionalTexture:function(f,s){f.activeTexture(s),f.bindTexture(f.TEXTURE_2D,null),f.activeTexture(f.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(f){this[this.mainParameter]=f},sendUniformData:function(){},createHelpLayer:function(f){if(!f.helpLayer){var s=document.createElement("canvas");s.width=f.sourceWidth,s.height=f.sourceHeight,f.helpLayer=s}},toObject:function(){var f={type:this.type},s=this.mainParameter;return s&&(f[s]=this[s]),f},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(f,s){var d=new e.Image.filters[f.type](f);return s&&s(d),d},function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.ColorMatrix=m(d.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(o){this.callSuper("initialize",o),this.matrix=this.matrix.slice(0)},applyTo2d:function(o){var l=o.imageData,u=l.data,p=u.length,w=this.matrix,_,v,y,T,C,P=this.colorsOnly;for(C=0;C<p;C+=4)_=u[C],v=u[C+1],y=u[C+2],P?(u[C]=_*w[0]+v*w[1]+y*w[2]+w[4]*255,u[C+1]=_*w[5]+v*w[6]+y*w[7]+w[9]*255,u[C+2]=_*w[10]+v*w[11]+y*w[12]+w[14]*255):(T=u[C+3],u[C]=_*w[0]+v*w[1]+y*w[2]+T*w[3]+w[4]*255,u[C+1]=_*w[5]+v*w[6]+y*w[7]+T*w[8]+w[9]*255,u[C+2]=_*w[10]+v*w[11]+y*w[12]+T*w[13]+w[14]*255,u[C+3]=_*w[15]+v*w[16]+y*w[17]+T*w[18]+w[19]*255)},getUniformLocations:function(o,l){return{uColorMatrix:o.getUniformLocation(l,"uColorMatrix"),uConstants:o.getUniformLocation(l,"uConstants")}},sendUniformData:function(o,l){var u=this.matrix,p=[u[0],u[1],u[2],u[3],u[5],u[6],u[7],u[8],u[10],u[11],u[12],u[13],u[15],u[16],u[17],u[18]],w=[u[4],u[9],u[14],u[19]];o.uniformMatrix4fv(l.uColorMatrix,!1,p),o.uniform4fv(l.uConstants,w)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Brightness=m(d.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(o){if(this.brightness!==0){var l=o.imageData,u=l.data,p,w=u.length,_=Math.round(this.brightness*255);for(p=0;p<w;p+=4)u[p]=u[p]+_,u[p+1]=u[p+1]+_,u[p+2]=u[p+2]+_}},getUniformLocations:function(o,l){return{uBrightness:o.getUniformLocation(l,"uBrightness")}},sendUniformData:function(o,l){o.uniform1f(l.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.Image.filters,o=s.util.createClass;m.Convolute=o(m.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(l){var u=Math.sqrt(this.matrix.length),p=this.type+"_"+u+"_"+(this.opaque?1:0),w=this.fragmentSource[p];return l.programCache.hasOwnProperty(p)||(l.programCache[p]=this.createProgram(l.context,w)),l.programCache[p]},applyTo2d:function(l){var u=l.imageData,p=u.data,w=this.matrix,_=Math.round(Math.sqrt(w.length)),v=Math.floor(_/2),y=u.width,T=u.height,C=l.ctx.createImageData(y,T),P=C.data,O=this.opaque?1:0,D,L,W,U,te,pe,ne,ye,ce,Me,ke,ve,K;for(ke=0;ke<T;ke++)for(Me=0;Me<y;Me++){for(te=(ke*y+Me)*4,D=0,L=0,W=0,U=0,K=0;K<_;K++)for(ve=0;ve<_;ve++)ne=ke+K-v,pe=Me+ve-v,!(ne<0||ne>=T||pe<0||pe>=y)&&(ye=(ne*y+pe)*4,ce=w[K*_+ve],D+=p[ye]*ce,L+=p[ye+1]*ce,W+=p[ye+2]*ce,O||(U+=p[ye+3]*ce));P[te]=D,P[te+1]=L,P[te+2]=W,O?P[te+3]=p[te+3]:P[te+3]=U}l.imageData=C},getUniformLocations:function(l,u){return{uMatrix:l.getUniformLocation(u,"uMatrix"),uOpaque:l.getUniformLocation(u,"uOpaque"),uHalfSize:l.getUniformLocation(u,"uHalfSize"),uSize:l.getUniformLocation(u,"uSize")}},sendUniformData:function(l,u){l.uniform1fv(u.uMatrix,this.matrix)},toObject:function(){return d(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Grayscale=m(d.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(o){var l=o.imageData,u=l.data,p,w=u.length,_,v=this.mode;for(p=0;p<w;p+=4)v==="average"?_=(u[p]+u[p+1]+u[p+2])/3:v==="lightness"?_=(Math.min(u[p],u[p+1],u[p+2])+Math.max(u[p],u[p+1],u[p+2]))/2:v==="luminosity"&&(_=.21*u[p]+.72*u[p+1]+.07*u[p+2]),u[p]=_,u[p+1]=_,u[p+2]=_},retrieveShader:function(o){var l=this.type+"_"+this.mode;if(!o.programCache.hasOwnProperty(l)){var u=this.fragmentSource[this.mode];o.programCache[l]=this.createProgram(o.context,u)}return o.programCache[l]},getUniformLocations:function(o,l){return{uMode:o.getUniformLocation(l,"uMode")}},sendUniformData:function(o,l){var u=1;o.uniform1i(l.uMode,u)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Invert=m(d.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(o){var l=o.imageData,u=l.data,p,w=u.length;for(p=0;p<w;p+=4)u[p]=255-u[p],u[p+1]=255-u[p+1],u[p+2]=255-u[p+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(o,l){return{uInvert:o.getUniformLocation(l,"uInvert")}},sendUniformData:function(o,l){o.uniform1i(l.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.Image.filters,o=s.util.createClass;m.Noise=o(m.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(l){if(this.noise!==0){var u=l.imageData,p=u.data,w,_=p.length,v=this.noise,y;for(w=0,_=p.length;w<_;w+=4)y=(.5-Math.random())*v,p[w]+=y,p[w+1]+=y,p[w+2]+=y}},getUniformLocations:function(l,u){return{uNoise:l.getUniformLocation(u,"uNoise"),uSeed:l.getUniformLocation(u,"uSeed")}},sendUniformData:function(l,u){l.uniform1f(u.uNoise,this.noise/255),l.uniform1f(u.uSeed,Math.random())},toObject:function(){return d(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Pixelate=m(d.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(o){var l=o.imageData,u=l.data,p=l.height,w=l.width,_,v,y,T,C,P,O,D,L,W,U;for(v=0;v<p;v+=this.blocksize)for(y=0;y<w;y+=this.blocksize)for(_=v*4*w+y*4,T=u[_],C=u[_+1],P=u[_+2],O=u[_+3],W=Math.min(v+this.blocksize,p),U=Math.min(y+this.blocksize,w),D=v;D<W;D++)for(L=y;L<U;L++)_=D*4*w+L*4,u[_]=T,u[_+1]=C,u[_+2]=P,u[_+3]=O},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(o,l){return{uBlocksize:o.getUniformLocation(l,"uBlocksize"),uStepW:o.getUniformLocation(l,"uStepW"),uStepH:o.getUniformLocation(l,"uStepH")}},sendUniformData:function(o,l){o.uniform1f(l.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.extend,m=s.Image.filters,o=s.util.createClass;m.RemoveColor=o(m.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(l){var u=l.imageData,p=u.data,w,_=this.distance*255,v,y,T,C=new s.Color(this.color).getSource(),P=[C[0]-_,C[1]-_,C[2]-_],O=[C[0]+_,C[1]+_,C[2]+_];for(w=0;w<p.length;w+=4)v=p[w],y=p[w+1],T=p[w+2],v>P[0]&&y>P[1]&&T>P[2]&&v<O[0]&&y<O[1]&&T<O[2]&&(p[w+3]=0)},getUniformLocations:function(l,u){return{uLow:l.getUniformLocation(u,"uLow"),uHigh:l.getUniformLocation(u,"uHigh")}},sendUniformData:function(l,u){var p=new s.Color(this.color).getSource(),w=parseFloat(this.distance),_=[0+p[0]/255-w,0+p[1]/255-w,0+p[2]/255-w,1],v=[p[0]/255+w,p[1]/255+w,p[2]/255+w,1];l.uniform4fv(u.uLow,_),l.uniform4fv(u.uHigh,v)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass,o={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var l in o)d[l]=m(d.ColorMatrix,{type:l,matrix:o[l],mainParameter:!1,colorsOnly:!0}),s.Image.filters[l].fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric,d=s.Image.filters,m=s.util.createClass;d.BlendColor=m(d.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(o){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[o]+`}
}`},retrieveShader:function(o){var l=this.type+"_"+this.mode,u;return o.programCache.hasOwnProperty(l)||(u=this.buildSource(this.mode),o.programCache[l]=this.createProgram(o.context,u)),o.programCache[l]},applyTo2d:function(o){var l=o.imageData,u=l.data,p=u.length,w,_,v,y,T,C,P,O=1-this.alpha;P=new s.Color(this.color).getSource(),w=P[0]*this.alpha,_=P[1]*this.alpha,v=P[2]*this.alpha;for(var D=0;D<p;D+=4)switch(y=u[D],T=u[D+1],C=u[D+2],this.mode){case"multiply":u[D]=y*w/255,u[D+1]=T*_/255,u[D+2]=C*v/255;break;case"screen":u[D]=255-(255-y)*(255-w)/255,u[D+1]=255-(255-T)*(255-_)/255,u[D+2]=255-(255-C)*(255-v)/255;break;case"add":u[D]=y+w,u[D+1]=T+_,u[D+2]=C+v;break;case"diff":case"difference":u[D]=Math.abs(y-w),u[D+1]=Math.abs(T-_),u[D+2]=Math.abs(C-v);break;case"subtract":u[D]=y-w,u[D+1]=T-_,u[D+2]=C-v;break;case"darken":u[D]=Math.min(y,w),u[D+1]=Math.min(T,_),u[D+2]=Math.min(C,v);break;case"lighten":u[D]=Math.max(y,w),u[D+1]=Math.max(T,_),u[D+2]=Math.max(C,v);break;case"overlay":u[D]=w<128?2*y*w/255:255-2*(255-y)*(255-w)/255,u[D+1]=_<128?2*T*_/255:255-2*(255-T)*(255-_)/255,u[D+2]=v<128?2*C*v/255:255-2*(255-C)*(255-v)/255;break;case"exclusion":u[D]=w+y-2*w*y/255,u[D+1]=_+T-2*_*T/255,u[D+2]=v+C-2*v*C/255;break;case"tint":u[D]=w+y*O,u[D+1]=_+T*O,u[D+2]=v+C*O}},getUniformLocations:function(o,l){return{uColor:o.getUniformLocation(l,"uColor")}},sendUniformData:function(o,l){var u=new s.Color(this.color).getSource();u[0]=this.alpha*u[0]/255,u[1]=this.alpha*u[1]/255,u[2]=this.alpha*u[2]/255,u[3]=this.alpha,o.uniform4fv(l.uColor,u)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric,d=s.Image.filters,m=s.util.createClass;d.BlendImage=m(d.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(o){var l=this.type+"_"+this.mode,u=this.fragmentSource[this.mode];return o.programCache.hasOwnProperty(l)||(o.programCache[l]=this.createProgram(o.context,u)),o.programCache[l]},applyToWebGL:function(o){var l=o.context,u=this.createTexture(o.filterBackend,this.image);this.bindAdditionalTexture(l,u,l.TEXTURE1),this.callSuper("applyToWebGL",o),this.unbindAdditionalTexture(l,l.TEXTURE1)},createTexture:function(o,l){return o.getCachedTexture(l.cacheKey,l._element)},calculateMatrix:function(){var o=this.image,l=o._element.width,u=o._element.height;return[1/o.scaleX,0,0,0,1/o.scaleY,0,-o.left/l,-o.top/u,1]},applyTo2d:function(o){var l=o.imageData,u=o.filterBackend.resources,p=l.data,w=p.length,_=l.width,v=l.height,y,T,C,P,O,D,L,W,U,te,pe=this.image,ne;u.blendImage||(u.blendImage=s.util.createCanvasElement()),U=u.blendImage,te=U.getContext("2d"),U.width!==_||U.height!==v?(U.width=_,U.height=v):te.clearRect(0,0,_,v),te.setTransform(pe.scaleX,0,0,pe.scaleY,pe.left,pe.top),te.drawImage(pe._element,0,0,_,v),ne=te.getImageData(0,0,_,v).data;for(var ye=0;ye<w;ye+=4)switch(O=p[ye],D=p[ye+1],L=p[ye+2],W=p[ye+3],y=ne[ye],T=ne[ye+1],C=ne[ye+2],P=ne[ye+3],this.mode){case"multiply":p[ye]=O*y/255,p[ye+1]=D*T/255,p[ye+2]=L*C/255,p[ye+3]=W*P/255;break;case"mask":p[ye+3]=P;break}},getUniformLocations:function(o,l){return{uTransformMatrix:o.getUniformLocation(l,"uTransformMatrix"),uImage:o.getUniformLocation(l,"uImage")}},sendUniformData:function(o,l){var u=this.calculateMatrix();o.uniform1i(l.uImage,1),o.uniformMatrix3fv(l.uTransformMatrix,!1,u)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(o,l){s.Image.fromObject(o.image,function(u){var p=s.util.object.clone(o);p.image=u,l(new s.Image.filters.BlendImage(p))})}}(t),function(f){var s=f.fabric||(f.fabric={}),d=Math.pow,m=Math.floor,o=Math.sqrt,l=Math.abs,u=Math.round,p=Math.sin,w=Math.ceil,_=s.Image.filters,v=s.util.createClass;_.Resize=v(_.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(y,T){return{uDelta:y.getUniformLocation(T,"uDelta"),uTaps:y.getUniformLocation(T,"uTaps")}},sendUniformData:function(y,T){y.uniform2fv(T.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),y.uniform1fv(T.uTaps,this.taps)},retrieveShader:function(y){var T=this.getFilterWindow(),C=this.type+"_"+T;if(!y.programCache.hasOwnProperty(C)){var P=this.generateShader(T);y.programCache[C]=this.createProgram(y.context,P)}return y.programCache[C]},getFilterWindow:function(){var y=this.tempScale;return Math.ceil(this.lanczosLobes/y)},getTaps:function(){for(var y=this.lanczosCreate(this.lanczosLobes),T=this.tempScale,C=this.getFilterWindow(),P=new Array(C),O=1;O<=C;O++)P[O-1]=y(O*T);return P},generateShader:function(P){for(var T=new Array(P),C=this.fragmentSourceTOP,P,O=1;O<=P;O++)T[O-1]=O+".0 * uDelta";return C+="uniform float uTaps["+P+`];
`,C+=`void main() {
`,C+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,C+=`  float sum = 1.0;
`,T.forEach(function(D,L){C+="  color += texture2D(uTexture, vTexCoord + "+D+") * uTaps["+L+`];
`,C+="  color += texture2D(uTexture, vTexCoord - "+D+") * uTaps["+L+`];
`,C+="  sum += 2.0 * uTaps["+L+`];
`}),C+=`  gl_FragColor = color / sum;
`,C+="}",C},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(y){y.webgl?(y.passes++,this.width=y.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=y.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),y.destinationWidth=this.dW,this._setupFrameBuffer(y),this.applyToWebGL(y),this._swapTextures(y),y.sourceWidth=y.destinationWidth,this.height=y.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),y.destinationHeight=this.dH,this._setupFrameBuffer(y),this.applyToWebGL(y),this._swapTextures(y),y.sourceHeight=y.destinationHeight):this.applyTo2d(y)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(y){return function(T){if(T>=y||T<=-y)return 0;if(T<11920929e-14&&T>-11920929e-14)return 1;T*=Math.PI;var C=T/y;return p(T)/T*p(C)/C}},applyTo2d:function(y){var T=y.imageData,C=this.scaleX,P=this.scaleY;this.rcpScaleX=1/C,this.rcpScaleY=1/P;var O=T.width,D=T.height,L=u(O*C),W=u(D*P),U;this.resizeType==="sliceHack"?U=this.sliceByTwo(y,O,D,L,W):this.resizeType==="hermite"?U=this.hermiteFastResize(y,O,D,L,W):this.resizeType==="bilinear"?U=this.bilinearFiltering(y,O,D,L,W):this.resizeType==="lanczos"&&(U=this.lanczosResize(y,O,D,L,W)),y.imageData=U},sliceByTwo:function(y,T,C,P,O){var D=y.imageData,L=.5,W=!1,U=!1,te=T*L,pe=C*L,ne=s.filterBackend.resources,ye,ce,Me=0,ke=0,ve=T,K=0;for(ne.sliceByTwo||(ne.sliceByTwo=document.createElement("canvas")),ye=ne.sliceByTwo,(ye.width<T*1.5||ye.height<C)&&(ye.width=T*1.5,ye.height=C),ce=ye.getContext("2d"),ce.clearRect(0,0,T*1.5,C),ce.putImageData(D,0,0),P=m(P),O=m(O);!W||!U;)T=te,C=pe,P<m(te*L)?te=m(te*L):(te=P,W=!0),O<m(pe*L)?pe=m(pe*L):(pe=O,U=!0),ce.drawImage(ye,Me,ke,T,C,ve,K,te,pe),Me=ve,ke=K,K+=pe;return ce.getImageData(Me,ke,P,O)},lanczosResize:function(y,T,C,P,O){function D(X){var N,ae,J,Y,be,Ce,Ue,Ve,Ie,he,Fe;for(K.x=(X+.5)*pe,re.x=m(K.x),N=0;N<O;N++){for(K.y=(N+.5)*ne,re.y=m(K.y),be=0,Ce=0,Ue=0,Ve=0,Ie=0,ae=re.x-Me;ae<=re.x+Me;ae++)if(!(ae<0||ae>=T)){he=m(1e3*l(ae-K.x)),ve[he]||(ve[he]={});for(var ee=re.y-ke;ee<=re.y+ke;ee++)ee<0||ee>=C||(Fe=m(1e3*l(ee-K.y)),ve[he][Fe]||(ve[he][Fe]=te(o(d(he*ye,2)+d(Fe*ce,2))/1e3)),J=ve[he][Fe],J>0&&(Y=(ee*T+ae)*4,be+=J,Ce+=J*L[Y],Ue+=J*L[Y+1],Ve+=J*L[Y+2],Ie+=J*L[Y+3]))}Y=(N*P+X)*4,U[Y]=Ce/be,U[Y+1]=Ue/be,U[Y+2]=Ve/be,U[Y+3]=Ie/be}return++X<P?D(X):W}var L=y.imageData.data,W=y.ctx.createImageData(P,O),U=W.data,te=this.lanczosCreate(this.lanczosLobes),pe=this.rcpScaleX,ne=this.rcpScaleY,ye=2/this.rcpScaleX,ce=2/this.rcpScaleY,Me=w(pe*this.lanczosLobes/2),ke=w(ne*this.lanczosLobes/2),ve={},K={},re={};return D(0)},bilinearFiltering:function(y,T,C,P,O){var D,L,W,U,te,pe,ne,ye,ce,Me,ke,ve,K=0,re,X=this.rcpScaleX,N=this.rcpScaleY,ae=4*(T-1),J=y.imageData,Y=J.data,be=y.ctx.createImageData(P,O),Ce=be.data;for(ne=0;ne<O;ne++)for(ye=0;ye<P;ye++)for(te=m(X*ye),pe=m(N*ne),ce=X*ye-te,Me=N*ne-pe,re=4*(pe*T+te),ke=0;ke<4;ke++)D=Y[re+ke],L=Y[re+4+ke],W=Y[re+ae+ke],U=Y[re+ae+4+ke],ve=D*(1-ce)*(1-Me)+L*ce*(1-Me)+W*Me*(1-ce)+U*ce*Me,Ce[K++]=ve;return be},hermiteFastResize:function(y,T,C,P,O){for(var D=this.rcpScaleX,L=this.rcpScaleY,W=w(D/2),U=w(L/2),te=y.imageData,pe=te.data,ne=y.ctx.createImageData(P,O),ye=ne.data,ce=0;ce<O;ce++)for(var Me=0;Me<P;Me++){for(var ke=(Me+ce*P)*4,ve=0,K=0,re=0,X=0,N=0,ae=0,J=0,Y=(ce+.5)*L,be=m(ce*L);be<(ce+1)*L;be++)for(var Ce=l(Y-(be+.5))/U,Ue=(Me+.5)*D,Ve=Ce*Ce,Ie=m(Me*D);Ie<(Me+1)*D;Ie++){var he=l(Ue-(Ie+.5))/W,Fe=o(Ve+he*he);Fe>1&&Fe<-1||(ve=2*Fe*Fe*Fe-3*Fe*Fe+1,ve>0&&(he=4*(Ie+be*T),J+=ve*pe[he+3],re+=ve,pe[he+3]<255&&(ve=ve*pe[he+3]/250),X+=ve*pe[he],N+=ve*pe[he+1],ae+=ve*pe[he+2],K+=ve))}ye[ke]=X/K,ye[ke+1]=N/K,ye[ke+2]=ae/K,ye[ke+3]=J/re}return ne},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Contrast=m(d.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(o){if(this.contrast!==0){var l=o.imageData,u,w,p=l.data,w=p.length,_=Math.floor(this.contrast*255),v=259*(_+255)/(255*(259-_));for(u=0;u<w;u+=4)p[u]=v*(p[u]-128)+128,p[u+1]=v*(p[u+1]-128)+128,p[u+2]=v*(p[u+2]-128)+128}},getUniformLocations:function(o,l){return{uContrast:o.getUniformLocation(l,"uContrast")}},sendUniformData:function(o,l){o.uniform1f(l.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Saturation=m(d.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(o){if(this.saturation!==0){var l=o.imageData,u=l.data,p=u.length,w=-this.saturation,_,v;for(_=0;_<p;_+=4)v=Math.max(u[_],u[_+1],u[_+2]),u[_]+=v!==u[_]?(v-u[_])*w:0,u[_+1]+=v!==u[_+1]?(v-u[_+1])*w:0,u[_+2]+=v!==u[_+2]?(v-u[_+2])*w:0}},getUniformLocations:function(o,l){return{uSaturation:o.getUniformLocation(l,"uSaturation")}},sendUniformData:function(o,l){o.uniform1f(l.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Vibrance=m(d.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(o){if(this.vibrance!==0){var l=o.imageData,u=l.data,p=u.length,w=-this.vibrance,_,v,y,T;for(_=0;_<p;_+=4)v=Math.max(u[_],u[_+1],u[_+2]),y=(u[_]+u[_+1]+u[_+2])/3,T=Math.abs(v-y)*2/255*w,u[_]+=v!==u[_]?(v-u[_])*T:0,u[_+1]+=v!==u[_+1]?(v-u[_+1])*T:0,u[_+2]+=v!==u[_+2]?(v-u[_+2])*T:0}},getUniformLocations:function(o,l){return{uVibrance:o.getUniformLocation(l,"uVibrance")}},sendUniformData:function(o,l){o.uniform1f(l.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Blur=m(d.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(o){o.webgl?(this.aspectRatio=o.sourceWidth/o.sourceHeight,o.passes++,this._setupFrameBuffer(o),this.horizontal=!0,this.applyToWebGL(o),this._swapTextures(o),this._setupFrameBuffer(o),this.horizontal=!1,this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},applyTo2d:function(o){o.imageData=this.simpleBlur(o)},simpleBlur:function(o){var l=o.filterBackend.resources,u,p,w=o.imageData.width,_=o.imageData.height;l.blurLayer1||(l.blurLayer1=s.util.createCanvasElement(),l.blurLayer2=s.util.createCanvasElement()),u=l.blurLayer1,p=l.blurLayer2,(u.width!==w||u.height!==_)&&(p.width=u.width=w,p.height=u.height=_);var v=u.getContext("2d"),y=p.getContext("2d"),T=15,C,P,O,D,L=this.blur*.06*.5;for(v.putImageData(o.imageData,0,0),y.clearRect(0,0,w,_),D=-T;D<=T;D++)C=(Math.random()-.5)/4,P=D/T,O=L*P*w+C,y.globalAlpha=1-Math.abs(P),y.drawImage(u,O,C),v.drawImage(p,0,0),y.globalAlpha=1,y.clearRect(0,0,p.width,p.height);for(D=-T;D<=T;D++)C=(Math.random()-.5)/4,P=D/T,O=L*P*_+C,y.globalAlpha=1-Math.abs(P),y.drawImage(u,C,O),v.drawImage(p,0,0),y.globalAlpha=1,y.clearRect(0,0,p.width,p.height);o.ctx.drawImage(u,0,0);var W=o.ctx.getImageData(0,0,u.width,u.height);return v.globalAlpha=1,v.clearRect(0,0,u.width,u.height),W},getUniformLocations:function(o,l){return{delta:o.getUniformLocation(l,"uDelta")}},sendUniformData:function(o,l){var u=this.chooseRightDelta();o.uniform2fv(l.delta,u)},chooseRightDelta:function(){var o=1,l=[0,0],u;return this.horizontal?this.aspectRatio>1&&(o=1/this.aspectRatio):this.aspectRatio<1&&(o=this.aspectRatio),u=o*this.blur*.12,this.horizontal?l[0]=u:l[1]=u,l}}),d.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Gamma=m(d.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(o){this.gamma=[1,1,1],d.BaseFilter.prototype.initialize.call(this,o)},applyTo2d:function(o){var l=o.imageData,u=l.data,p=this.gamma,w=u.length,_=1/p[0],v=1/p[1],y=1/p[2],T;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),T=0,w=256;T<w;T++)this.rVals[T]=Math.pow(T/255,_)*255,this.gVals[T]=Math.pow(T/255,v)*255,this.bVals[T]=Math.pow(T/255,y)*255;for(T=0,w=u.length;T<w;T+=4)u[T]=this.rVals[u[T]],u[T+1]=this.gVals[u[T+1]],u[T+2]=this.bVals[u[T+2]]},getUniformLocations:function(o,l){return{uGamma:o.getUniformLocation(l,"uGamma")}},sendUniformData:function(o,l){o.uniform3fv(l.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.Composed=m(d.BaseFilter,{type:"Composed",subFilters:[],initialize:function(o){this.callSuper("initialize",o),this.subFilters=this.subFilters.slice(0)},applyTo:function(o){o.passes+=this.subFilters.length-1,this.subFilters.forEach(function(l){l.applyTo(o)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(o){return o.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(o){return!o.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(o,l){var u=o.subFilters||[],p=u.map(function(_){return new s.Image.filters[_.type](_)}),w=new s.Image.filters.Composed({subFilters:p});return l&&l(w),w}}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.Image.filters,m=s.util.createClass;d.HueRotation=m(d.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var o=this.rotation*Math.PI,l=s.util.cos(o),u=s.util.sin(o),p=1/3,w=Math.sqrt(p)*u,_=1-l;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=l+_/3,this.matrix[1]=p*_-w,this.matrix[2]=p*_+w,this.matrix[5]=p*_+w,this.matrix[6]=l+p*_,this.matrix[7]=p*_-w,this.matrix[10]=p*_-w,this.matrix[11]=p*_+w,this.matrix[12]=l+p*_},isNeutralState:function(o){return this.calculateMatrix(),d.BaseFilter.prototype.isNeutralState.call(this,o)},applyTo:function(o){this.calculateMatrix(),d.BaseFilter.prototype.applyTo.call(this,o)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),d=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var m="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(m),cacheProperties:s.Object.prototype.cacheProperties.concat(m),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(o,l){this.styles=l?l.styles||{}:{},this.text=o,this.__skipDimension=!0,this.callSuper("initialize",l),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var o=this.path;o&&(o.segmentsInfo=s.util.getPathSegmentsInfo(o.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var o=this._splitTextIntoLines(this.text);return this.textLines=o.lines,this._textLines=o.graphemeLines,this._unwrappedTextLines=o._unwrappedLines,this._text=o.graphemeText,o},initDimensions:function(){if(!this.__skipDimension){if(this._splitText(),this._clearCache(),this.path){var o=this.getHeightOfLine(0)*1.1;this.width=this.path.width+o,this.height=this.path.height+o}else this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight();this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"})}},enlargeSpaces:function(){for(var o,l,u,p,w,_,v,y=0,T=this._textLines.length;y<T;y++)if(!(this.textAlign!=="justify"&&(y===T-1||this.isEndOfWrapping(y)))&&(p=0,w=this._textLines[y],l=this.getLineWidth(y),l<this.width&&(v=this.textLines[y].match(this._reSpacesAndTabs)))){u=v.length,o=(this.width-l)/u;for(var C=0,P=w.length;C<=P;C++)_=this.__charBounds[y][C],this._reSpaceAndTab.test(w[C])?(_.width+=o,_.kernedWidth+=o,_.left+=p,p+=o):_.left+=p}},isEndOfWrapping:function(o){return o===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var o=this.callSuper("_getCacheCanvasDimensions"),l=this.fontSize;return o.width+=l*o.zoomX,o.height+=l*o.zoomY,o},_render:function(o){var l=this.path;l&&!l.isNotVisible()&&l._render(o),this._setTextStyles(o),this._renderTextLinesBackground(o),this._renderTextDecoration(o,"underline"),this._renderText(o),this._renderTextDecoration(o,"overline"),this._renderTextDecoration(o,"linethrough")},_renderText:function(o){this.paintFirst==="stroke"?(this._renderTextStroke(o),this._renderTextFill(o)):(this._renderTextFill(o),this._renderTextStroke(o))},_setTextStyles:function(o,l,u){if(o.textBaseline="alphabetic",this.path)switch(this.pathAlign){case"center":o.textBaseline="middle";break;case"ascender":o.textBaseline="top";break;case"descender":o.textBaseline="bottom";break}o.font=this._getFontDeclaration(l,u)},calcTextWidth:function(){for(var o=this.getLineWidth(0),l=1,u=this._textLines.length;l<u;l++){var p=this.getLineWidth(l);p>o&&(o=p)}return o},_renderTextLine:function(o,l,u,p,w,_){this._renderChars(o,l,u,p,w,_)},_renderTextLinesBackground:function(o){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var l,u,p=o.fillStyle,w,_,v=this._getLeftOffset(),y=this._getTopOffset(),T=0,C=0,P,O,D=this.path,L,W=0,U=this._textLines.length;W<U;W++){if(l=this.getHeightOfLine(W),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",W)){y+=l;continue}w=this._textLines[W],u=this._getLineLeftOffset(W),C=0,T=0,_=this.getValueOfPropertyAt(W,0,"textBackgroundColor");for(var te=0,pe=w.length;te<pe;te++)P=this.__charBounds[W][te],O=this.getValueOfPropertyAt(W,te,"textBackgroundColor"),D?(o.save(),o.translate(P.renderLeft,P.renderTop),o.rotate(P.angle),o.fillStyle=O,O&&o.fillRect(-P.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),P.width,l/this.lineHeight),o.restore()):O!==_?(L=v+u+T,this.direction==="rtl"&&(L=this.width-L-C),o.fillStyle=_,_&&o.fillRect(L,y,C,l/this.lineHeight),T=P.left,C=P.width,_=O):C+=P.kernedWidth;O&&!D&&(L=v+u+T,this.direction==="rtl"&&(L=this.width-L-C),o.fillStyle=O,o.fillRect(L,y,C,l/this.lineHeight)),y+=l}o.fillStyle=p,this._removeShadow(o)}},getFontCache:function(o){var l=o.fontFamily.toLowerCase();s.charWidthsCache[l]||(s.charWidthsCache[l]={});var u=s.charWidthsCache[l],p=o.fontStyle.toLowerCase()+"_"+(o.fontWeight+"").toLowerCase();return u[p]||(u[p]={}),u[p]},_measureChar:function(o,l,u,p){var w=this.getFontCache(l),_=this._getFontDeclaration(l),v=this._getFontDeclaration(p),y=u+o,T=_===v,C,P,O,D=l.fontSize/this.CACHE_FONT_SIZE,L;if(u&&w[u]!==void 0&&(O=w[u]),w[o]!==void 0&&(L=C=w[o]),T&&w[y]!==void 0&&(P=w[y],L=P-O),C===void 0||O===void 0||P===void 0){var W=this.getMeasuringContext();this._setTextStyles(W,l,!0)}return C===void 0&&(L=C=W.measureText(o).width,w[o]=C),O===void 0&&T&&u&&(O=W.measureText(u).width,w[u]=O),T&&P===void 0&&(P=W.measureText(y).width,w[y]=P,L=P-O),{width:C*D,kernedWidth:L*D}},getHeightOfChar:function(o,l){return this.getValueOfPropertyAt(o,l,"fontSize")},measureLine:function(o){var l=this._measureLine(o);return this.charSpacing!==0&&(l.width-=this._getWidthOfCharSpacing()),l.width<0&&(l.width=0),l},_measureLine:function(o){var l=0,u,p,w=this._textLines[o],_,v,y=0,T=new Array(w.length),C=0,P,O,D=this.path,L=this.pathSide==="right";for(this.__charBounds[o]=T,u=0;u<w.length;u++)p=w[u],v=this._getGraphemeBox(p,o,u,_),T[u]=v,l+=v.kernedWidth,_=p;if(T[u]={left:v?v.left+v.width:0,width:0,kernedWidth:0,height:this.fontSize},D){switch(O=D.segmentsInfo[D.segmentsInfo.length-1].length,P=s.util.getPointOnPath(D.path,0,D.segmentsInfo),P.x+=D.pathOffset.x,P.y+=D.pathOffset.y,this.textAlign){case"left":C=L?O-l:0;break;case"center":C=(O-l)/2;break;case"right":C=L?0:O-l;break}for(C+=this.pathStartOffset*(L?-1:1),u=L?w.length-1:0;L?u>=0:u<w.length;L?u--:u++)v=T[u],C>O?C%=O:C<0&&(C+=O),this._setGraphemeOnPath(C,v,P),C+=v.kernedWidth}return{width:l,numOfSpaces:y}},_setGraphemeOnPath:function(o,l,u){var p=o+l.kernedWidth/2,w=this.path,_=s.util.getPointOnPath(w.path,p,w.segmentsInfo);l.renderLeft=_.x-u.x,l.renderTop=_.y-u.y,l.angle=_.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(o,l,u,p,w){var _=this.getCompleteStyleDeclaration(l,u),v=p?this.getCompleteStyleDeclaration(l,u-1):{},y=this._measureChar(o,_,p,v),T=y.kernedWidth,C=y.width,P;this.charSpacing!==0&&(P=this._getWidthOfCharSpacing(),C+=P,T+=P);var O={width:C,left:0,height:_.fontSize,kernedWidth:T,deltaY:_.deltaY};if(u>0&&!w){var D=this.__charBounds[l][u-1];O.left=D.left+D.width+y.kernedWidth-y.width}return O},getHeightOfLine:function(o){if(this.__lineHeights[o])return this.__lineHeights[o];for(var l=this._textLines[o],u=this.getHeightOfChar(o,0),p=1,w=l.length;p<w;p++)u=Math.max(this.getHeightOfChar(o,p),u);return this.__lineHeights[o]=u*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var o,l=0,u=0,p=this._textLines.length;u<p;u++)o=this.getHeightOfLine(u),l+=u===p-1?o/this.lineHeight:o;return l},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(o,l){o.save();for(var u=0,p=this._getLeftOffset(),w=this._getTopOffset(),_=0,v=this._textLines.length;_<v;_++){var y=this.getHeightOfLine(_),T=y/this.lineHeight,C=this._getLineLeftOffset(_);this._renderTextLine(l,o,this._textLines[_],p+C,w+u+T,_),u+=y}o.restore()},_renderTextFill:function(o){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(o,"fillText")},_renderTextStroke:function(o){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this._setLineDash(o,this.strokeDashArray),o.beginPath(),this._renderTextCommon(o,"strokeText"),o.closePath(),o.restore())},_renderChars:function(o,l,u,p,w,_){var v=this.getHeightOfLine(_),y=this.textAlign.indexOf("justify")!==-1,T,C,P="",O,D=0,L,W=this.path,U=!y&&this.charSpacing===0&&this.isEmptyStyles(_)&&!W,te=this.direction==="ltr",pe=this.direction==="ltr"?1:-1,ne,ye=l.canvas.getAttribute("dir");if(l.save(),ye!==this.direction&&(l.canvas.setAttribute("dir",te?"ltr":"rtl"),l.direction=te?"ltr":"rtl",l.textAlign=te?"left":"right"),w-=v*this._fontSizeFraction/this.lineHeight,U){this._renderChar(o,l,_,0,u.join(""),p,w,v),l.restore();return}for(var ce=0,Me=u.length-1;ce<=Me;ce++)L=ce===Me||this.charSpacing||W,P+=u[ce],O=this.__charBounds[_][ce],D===0?(p+=pe*(O.kernedWidth-O.width),D+=O.width):D+=O.kernedWidth,y&&!L&&this._reSpaceAndTab.test(u[ce])&&(L=!0),L||(T=T||this.getCompleteStyleDeclaration(_,ce),C=this.getCompleteStyleDeclaration(_,ce+1),L=s.util.hasStyleChanged(T,C,!1)),L&&(W?(l.save(),l.translate(O.renderLeft,O.renderTop),l.rotate(O.angle),this._renderChar(o,l,_,ce,P,-D/2,0,v),l.restore()):(ne=p,this._renderChar(o,l,_,ce,P,ne,w,v)),P="",T=C,p+=pe*D,D=0);l.restore()},_applyPatternGradientTransformText:function(o){var l=s.util.createCanvasElement(),u,p=this.width+this.strokeWidth,w=this.height+this.strokeWidth;return l.width=p,l.height=w,u=l.getContext("2d"),u.beginPath(),u.moveTo(0,0),u.lineTo(p,0),u.lineTo(p,w),u.lineTo(0,w),u.closePath(),u.translate(p/2,w/2),u.fillStyle=o.toLive(u),this._applyPatternGradientTransform(u,o),u.fill(),u.createPattern(l,"no-repeat")},handleFiller:function(o,l,u){var p,w;return u.toLive?u.gradientUnits==="percentage"||u.gradientTransform||u.patternTransform?(p=-this.width/2,w=-this.height/2,o.translate(p,w),o[l]=this._applyPatternGradientTransformText(u),{offsetX:p,offsetY:w}):(o[l]=u.toLive(o,this),this._applyPatternGradientTransform(o,u)):(o[l]=u,{offsetX:0,offsetY:0})},_setStrokeStyles:function(o,l){return o.lineWidth=l.strokeWidth,o.lineCap=this.strokeLineCap,o.lineDashOffset=this.strokeDashOffset,o.lineJoin=this.strokeLineJoin,o.miterLimit=this.strokeMiterLimit,this.handleFiller(o,"strokeStyle",l.stroke)},_setFillStyles:function(o,l){return this.handleFiller(o,"fillStyle",l.fill)},_renderChar:function(o,l,u,p,w,_,v){var y=this._getStyleDeclaration(u,p),T=this.getCompleteStyleDeclaration(u,p),C=o==="fillText"&&T.fill,P=o==="strokeText"&&T.stroke&&T.strokeWidth,O,D;!P&&!C||(l.save(),C&&(O=this._setFillStyles(l,T)),P&&(D=this._setStrokeStyles(l,T)),l.font=this._getFontDeclaration(T),y&&y.textBackgroundColor&&this._removeShadow(l),y&&y.deltaY&&(v+=y.deltaY),C&&l.fillText(w,_-O.offsetX,v-O.offsetY),P&&l.strokeText(w,_-D.offsetX,v-D.offsetY),l.restore())},setSuperscript:function(o,l){return this._setScript(o,l,this.superscript)},setSubscript:function(o,l){return this._setScript(o,l,this.subscript)},_setScript:function(o,l,u){var p=this.get2DCursorLocation(o,!0),w=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"fontSize"),_=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"deltaY"),v={fontSize:w*u.size,deltaY:_+w*u.baseline};return this.setSelectionStyles(v,o,l),this},_getLineLeftOffset:function(o){var l=this.getLineWidth(o),u=this.width-l,p=this.textAlign,w=this.direction,v,_=0,v=this.isEndOfWrapping(o);return p==="justify"||p==="justify-center"&&!v||p==="justify-right"&&!v||p==="justify-left"&&!v?0:(p==="center"&&(_=u/2),p==="right"&&(_=u),p==="justify-center"&&(_=u/2),p==="justify-right"&&(_=u),w==="rtl"&&(_-=u),_)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var o=this._forceClearCache;return o||(o=this.hasStateChanged("_dimensionAffectingProps")),o&&(this.dirty=!0,this._forceClearCache=!1),o},getLineWidth:function(o){if(this.__lineWidths[o]!==void 0)return this.__lineWidths[o];var l=this.measureLine(o),u=l.width;return this.__lineWidths[o]=u,u},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(o,l,u){var p=this._getStyleDeclaration(o,l);return p&&typeof p[u]<"u"?p[u]:this[u]},_renderTextDecoration:function(o,l){if(!(!this[l]&&!this.styleHas(l))){o.save(),(l==="overline"||l==="linethrough")&&this._removeShadow(o);for(var u,p,w,_,v,y,T,C,P=this._getLeftOffset(),O=this._getTopOffset(),D,L,W,U,te,pe,ne,ye,ce=this.path,Me=this._getWidthOfCharSpacing(),ke=this.offsets[l],ve=0,K=this._textLines.length;ve<K;ve++){if(u=this.getHeightOfLine(ve),!this[l]&&!this.styleHas(l,ve)){O+=u;continue}T=this._textLines[ve],pe=u/this.lineHeight,_=this._getLineLeftOffset(ve),L=0,W=0,C=this.getValueOfPropertyAt(ve,0,l),ye=this.getValueOfPropertyAt(ve,0,"fill"),D=O+pe*(1-this._fontSizeFraction),p=this.getHeightOfChar(ve,0),v=this.getValueOfPropertyAt(ve,0,"deltaY");for(var re=0,X=T.length;re<X;re++)if(U=this.__charBounds[ve][re],te=this.getValueOfPropertyAt(ve,re,l),ne=this.getValueOfPropertyAt(ve,re,"fill"),w=this.getHeightOfChar(ve,re),y=this.getValueOfPropertyAt(ve,re,"deltaY"),ce&&te&&ne)o.save(),o.fillStyle=ye,o.translate(U.renderLeft,U.renderTop),o.rotate(U.angle),o.fillRect(-U.kernedWidth/2,ke*w+y,U.kernedWidth,this.fontSize/15),o.restore();else if((te!==C||ne!==ye||w!==p||y!==v)&&W>0){var N=P+_+L;this.direction==="rtl"&&(N=this.width-N-W),C&&ye&&(o.fillStyle=ye,o.fillRect(N,D+ke*p+v,W,this.fontSize/15)),L=U.left,W=U.width,C=te,ye=ne,p=w,v=y}else W+=U.kernedWidth;var N=P+_+L;this.direction==="rtl"&&(N=this.width-N-W),o.fillStyle=ne,te&&ne&&o.fillRect(N,D+ke*p+v,W-Me,this.fontSize/15),O+=u}o.restore()}},_getFontDeclaration:function(o,l){var u=o||this,p=this.fontFamily,w=s.Text.genericFonts.indexOf(p.toLowerCase())>-1,_=p===void 0||p.indexOf("'")>-1||p.indexOf(",")>-1||p.indexOf('"')>-1||w?u.fontFamily:'"'+u.fontFamily+'"';return[s.isLikelyNode?u.fontWeight:u.fontStyle,s.isLikelyNode?u.fontStyle:u.fontWeight,l?this.CACHE_FONT_SIZE+"px":u.fontSize+"px",_].join(" ")},render:function(o){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",o))},_splitTextIntoLines:function(o){for(var l=o.split(this._reNewline),u=new Array(l.length),p=[`
`],w=[],_=0;_<l.length;_++)u[_]=s.util.string.graphemeSplit(l[_]),w=w.concat(u[_],p);return w.pop(),{_unwrappedLines:u,lines:l,graphemeText:w,graphemeLines:u}},toObject:function(o){var l=m.concat(o),u=this.callSuper("toObject",l);return u.styles=s.util.stylesToArray(this.styles,this.text),u.path&&(u.path=this.path.toObject()),u},set:function(o,l){this.callSuper("set",o,l);var u=!1,p=!1;if(typeof o=="object")for(var w in o)w==="path"&&this.setPathInfo(),u=u||this._dimensionAffectingProps.indexOf(w)!==-1,p=p||w==="path";else u=this._dimensionAffectingProps.indexOf(o)!==-1,p=o==="path";return p&&this.setPathInfo(),u&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(o,l,u){if(!o)return l(null);var p=s.parseAttributes(o,s.Text.ATTRIBUTE_NAMES),w=p.textAnchor||"left";if(u=s.util.object.extend(u?d(u):{},p),u.top=u.top||0,u.left=u.left||0,p.textDecoration){var _=p.textDecoration;_.indexOf("underline")!==-1&&(u.underline=!0),_.indexOf("overline")!==-1&&(u.overline=!0),_.indexOf("line-through")!==-1&&(u.linethrough=!0),delete u.textDecoration}"dx"in p&&(u.left+=p.dx),"dy"in p&&(u.top+=p.dy),"fontSize"in u||(u.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in o?v=o.textContent:"firstChild"in o&&o.firstChild!==null&&"data"in o.firstChild&&o.firstChild.data!==null&&(v=o.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var y=u.strokeWidth;u.strokeWidth=0;var T=new s.Text(v,u),C=T.getScaledHeight()/T.height,P=(T.height+T.strokeWidth)*T.lineHeight-T.height,O=P*C,D=T.getScaledHeight()+O,L=0;w==="center"&&(L=T.getScaledWidth()/2),w==="right"&&(L=T.getScaledWidth()),T.set({left:T.left-L,top:T.top-(D-T.fontSize*(.07+T._fontSizeFraction))/T.lineHeight,strokeWidth:typeof y<"u"?y:1}),l(T)},s.Text.fromObject=function(o,l){var u=d(o),p=o.path;return delete u.path,s.Object._fromObject("Text",u,function(w){w.styles=s.util.stylesFromArray(o.styles,o.text),p?s.Object._fromObject("Path",p,function(_){w.set("path",_),l(w)},"path"):l(w)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(t),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(f){if(!this.styles||typeof f<"u"&&!this.styles[f])return!0;var s=typeof f>"u"?this.styles:{line:this.styles[f]};for(var d in s)for(var m in s[d])for(var o in s[d][m])return!1;return!0},styleHas:function(f,s){if(!this.styles||!f||f===""||typeof s<"u"&&!this.styles[s])return!1;var d=typeof s>"u"?this.styles:{0:this.styles[s]};for(var m in d)for(var o in d[m])if(typeof d[m][o][f]<"u")return!0;return!1},cleanStyle:function(f){if(!this.styles||!f||f==="")return!1;var s=this.styles,d=0,m,o,l=!0,u=0,p;for(var w in s){m=0;for(var _ in s[w]){var p=s[w][_],v=p.hasOwnProperty(f);d++,v?(o?p[f]!==o&&(l=!1):o=p[f],p[f]===this[f]&&delete p[f]):l=!1,Object.keys(p).length!==0?m++:delete s[w][_]}m===0&&delete s[w]}for(var y=0;y<this._textLines.length;y++)u+=this._textLines[y].length;l&&d===u&&(this[f]=o,this.removeStyle(f))},removeStyle:function(f){if(!(!this.styles||!f||f==="")){var s=this.styles,d,m,o;for(m in s){d=s[m];for(o in d)delete d[o][f],Object.keys(d[o]).length===0&&delete d[o];Object.keys(d).length===0&&delete s[m]}}},_extendStyles:function(f,s){var d=this.get2DCursorLocation(f);this._getLineStyle(d.lineIndex)||this._setLineStyle(d.lineIndex),this._getStyleDeclaration(d.lineIndex,d.charIndex)||this._setStyleDeclaration(d.lineIndex,d.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(d.lineIndex,d.charIndex),s)},get2DCursorLocation:function(f,s){typeof f>"u"&&(f=this.selectionStart);for(var d=s?this._unwrappedTextLines:this._textLines,m=d.length,o=0;o<m;o++){if(f<=d[o].length)return{lineIndex:o,charIndex:f};f-=d[o].length+this.missingNewlineOffset(o,s)}return{lineIndex:o-1,charIndex:d[o-1].length<f?d[o-1].length:f}},getSelectionStyles:function(f,s,d){typeof f>"u"&&(f=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||f);for(var m=[],o=f;o<s;o++)m.push(this.getStyleAtPosition(o,d));return m},getStyleAtPosition:function(f,s){var d=this.get2DCursorLocation(f),m=s?this.getCompleteStyleDeclaration(d.lineIndex,d.charIndex):this._getStyleDeclaration(d.lineIndex,d.charIndex);return m||{}},setSelectionStyles:function(f,s,d){typeof s>"u"&&(s=this.selectionStart||0),typeof d>"u"&&(d=this.selectionEnd||s);for(var m=s;m<d;m++)this._extendStyles(m,f);return this._forceClearCache=!0,this},_getStyleDeclaration:function(f,s){var d=this.styles&&this.styles[f];return d?d[s]:null},getCompleteStyleDeclaration:function(f,s){for(var d=this._getStyleDeclaration(f,s)||{},m={},o,l=0;l<this._styleProperties.length;l++)o=this._styleProperties[l],m[o]=typeof d[o]>"u"?this[o]:d[o];return m},_setStyleDeclaration:function(f,s,d){this.styles[f][s]=d},_deleteStyleDeclaration:function(f,s){delete this.styles[f][s]},_getLineStyle:function(f){return!!this.styles[f]},_setLineStyle:function(f){this.styles[f]={}},_deleteLineStyle:function(f){delete this.styles[f]}})}(),function(){function f(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,d){this.callSuper("initialize",s,d),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,d){this[s]!==d&&(this._fireSelectionChanged(),this[s]=d),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var d=this.canvas.contextTop,m=this.canvas.viewportTransform;d.save(),d.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this.transform(d),this._clearTextArea(d),s||d.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),d=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,d):this.renderSelection(s,d),d.restore()}},_clearTextArea:function(s){var d=this.width+4,m=this.height+4;s.clearRect(-d/2,-m/2,d,m)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var d=this._getLeftOffset(),m=this._getTopOffset(),o=this._getCursorBoundariesOffsets(s);return{left:d,top:m,leftOffset:o.left,topOffset:o.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var d,m,o,l=0,u=0,p,w=this.get2DCursorLocation(s);o=w.charIndex,m=w.lineIndex;for(var _=0;_<m;_++)l+=this.getHeightOfLine(_);d=this._getLineLeftOffset(m);var v=this.__charBounds[m][o];return v&&(u=v.left),this.charSpacing!==0&&o===this._textLines[m].length&&(u-=this._getWidthOfCharSpacing()),p={top:l,left:d+(u>0?u:0)},this.direction==="rtl"&&(p.left*=-1),this.cursorOffsetCache=p,this.cursorOffsetCache},renderCursor:function(s,d){var m=this.get2DCursorLocation(),o=m.lineIndex,l=m.charIndex>0?m.charIndex-1:0,u=this.getValueOfPropertyAt(o,l,"fontSize"),p=this.scaleX*this.canvas.getZoom(),w=this.cursorWidth/p,_=s.topOffset,v=this.getValueOfPropertyAt(o,l,"deltaY");_+=(1-this._fontSizeFraction)*this.getHeightOfLine(o)/this.lineHeight-u*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,d),d.fillStyle=this.cursorColor||this.getValueOfPropertyAt(o,l,"fill"),d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,d.fillRect(s.left+s.leftOffset-w/2,_+s.top+v,w,u)},renderSelection:function(s,d){for(var m=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,o=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,l=this.textAlign.indexOf("justify")!==-1,u=this.get2DCursorLocation(m),p=this.get2DCursorLocation(o),w=u.lineIndex,_=p.lineIndex,v=u.charIndex<0?0:u.charIndex,y=p.charIndex<0?0:p.charIndex,T=w;T<=_;T++){var C=this._getLineLeftOffset(T)||0,P=this.getHeightOfLine(T),O=0,D=0,L=0;if(T===w&&(D=this.__charBounds[w][v].left),T>=w&&T<_)L=l&&!this.isEndOfWrapping(T)?this.width:this.getLineWidth(T)||5;else if(T===_)if(y===0)L=this.__charBounds[_][y].left;else{var W=this._getWidthOfCharSpacing();L=this.__charBounds[_][y-1].left+this.__charBounds[_][y-1].width-W}O=P,(this.lineHeight<1||T===_&&this.lineHeight>1)&&(P/=this.lineHeight);var U=s.left+C+D,te=L-D,pe=P,ne=0;this.inCompositionMode?(d.fillStyle=this.compositionColor||"black",pe=1,ne=P):d.fillStyle=this.selectionColor,this.direction==="rtl"&&(U=this.width-U-te),d.fillRect(U,s.top+s.topOffset+ne,te,pe),s.topOffset+=O}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),d=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:d}}}),e.IText.fromObject=function(s,d){var m=e.util.stylesFromArray(s.styles,s.text),o=Object.assign({},s,{styles:m});if(delete o.path,f(o),o.styles)for(var l in o.styles)for(var u in o.styles[l])f(o.styles[l][u]);e.Object._fromObject("IText",o,function(p){s.path?e.Object._fromObject("Path",s.path,function(w){p.set("path",w),d(p)},"path"):d(p)},"text")}}(),function(){var f=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var d=s.canvas;d&&(d._hasITextHandlers||(d._hasITextHandlers=!0,s._initCanvasHandlers(d)),d._iTextInstances=d._iTextInstances||[],d._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var d=s.canvas;d&&(d._iTextInstances=d._iTextInstances||[],e.util.removeFromArray(d._iTextInstances,s),d._iTextInstances.length===0&&(d._hasITextHandlers=!1,s._removeCanvasHandlers(d)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(d){d.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,d,m,o){var l;return l={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",d,{duration:m,onComplete:function(){l.isAborted||s[o]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return l.isAborted}}),l},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var d=this,m=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){d._tick()},m)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,d=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&d&&d.clearContext(d.contextTop||d.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var d=0,m=s-1;if(this._reSpace.test(this._text[m]))for(;this._reSpace.test(this._text[m]);)d++,m--;for(;/\S/.test(this._text[m])&&m>-1;)d++,m--;return s-d},findWordBoundaryRight:function(s){var d=0,m=s;if(this._reSpace.test(this._text[m]))for(;this._reSpace.test(this._text[m]);)d++,m++;for(;/\S/.test(this._text[m])&&m<this._text.length;)d++,m++;return s+d},findLineBoundaryLeft:function(s){for(var d=0,m=s-1;!/\n/.test(this._text[m])&&m>-1;)d++,m--;return s-d},findLineBoundaryRight:function(s){for(var d=0,m=s;!/\n/.test(this._text[m])&&m<this._text.length;)d++,m++;return s+d},searchWordBoundary:function(s,d){for(var m=this._text,o=this._reSpace.test(m[s])?s-1:s,l=m[o],u=e.reNonWord;!u.test(l)&&o>0&&o<m.length;)o+=d,l=m[o];return u.test(l)&&(o+=d===1?0:1),o},selectWord:function(s){s=s||this.selectionStart;var d=this.searchWordBoundary(s,-1),m=this.searchWordBoundary(s,1);this.selectionStart=d,this.selectionEnd=m,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var d=this.findLineBoundaryLeft(s),m=this.findLineBoundaryRight(s);return this.selectionStart=d,this.selectionEnd=m,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(d){d.selected=!1,d.isEditing&&d.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var d=this.getSelectionStartFromPointer(s.e),m=this.selectionStart,o=this.selectionEnd;(d!==this.__selectionStartOnMouseDown||m===o)&&(m===d||o===d)||(d>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=d):(this.selectionStart=d,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==m||this.selectionEnd!==o)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,d,m){var o=m.slice(0,s),l=e.util.string.graphemeSplit(o).length;if(s===d)return{selectionStart:l,selectionEnd:l};var u=m.slice(s,d),p=e.util.string.graphemeSplit(u).length;return{selectionStart:l,selectionEnd:l+p}},fromGraphemeToStringSelection:function(s,d,m){var o=m.slice(0,s),l=o.join("").length;if(s===d)return{selectionStart:l,selectionEnd:l};var u=m.slice(s,d),p=u.join("").length;return{selectionStart:l,selectionEnd:l+p}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,d=this._getCursorBoundaries(s),m=this.get2DCursorLocation(s),o=m.lineIndex,l=m.charIndex,u=this.getValueOfPropertyAt(o,l,"fontSize")*this.lineHeight,p=d.leftOffset,w=this.calcTransformMatrix(),_={x:d.left+p,y:d.top+d.topOffset+u},v=this.canvas.getRetinaScaling(),y=this.canvas.upperCanvasEl,T=y.width/v,C=y.height/v,P=T-u,O=C-u,D=y.clientWidth/T,L=y.clientHeight/C;return _=e.util.transformPoint(_,w),_=e.util.transformPoint(_,this.canvas.viewportTransform),_.x*=D,_.y*=L,_.x<0&&(_.x=0),_.x>P&&(_.x=P),_.y<0&&(_.y=0),_.y>O&&(_.y=O),_.x+=this.canvas._offset.left,_.y+=this.canvas._offset.top,{left:_.x+"px",top:_.y+"px",fontSize:u+"px",charHeight:u}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,d=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,d&&(d.blur&&d.blur(),d.parentNode&&d.parentNode.removeChild(d)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,d){var m=this.get2DCursorLocation(s,!0),o=this.get2DCursorLocation(d,!0),l=m.lineIndex,u=m.charIndex,p=o.lineIndex,w=o.charIndex,_,v;if(l!==p){if(this.styles[l])for(_=u;_<this._unwrappedTextLines[l].length;_++)delete this.styles[l][_];if(this.styles[p])for(_=w;_<this._unwrappedTextLines[p].length;_++)v=this.styles[p][_],v&&(this.styles[l]||(this.styles[l]={}),this.styles[l][u+_-w]=v);for(_=l+1;_<=p;_++)delete this.styles[_];this.shiftLineStyles(p,l-p)}else if(this.styles[l]){v=this.styles[l];var y=w-u,T,C;for(_=u;_<w;_++)delete v[_];for(C in this.styles[l])T=parseInt(C,10),T>=w&&(v[T-y]=v[C],delete v[C])}},shiftLineStyles:function(s,d){var m=f(this.styles);for(var o in this.styles){var l=parseInt(o,10);l>s&&(this.styles[l+d]=m[l],m[l-d]||delete this.styles[l])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,d,m,o){var l,u={},p=!1,w=this._unwrappedTextLines[s].length,_=w===d;m||(m=1),this.shiftLineStyles(s,m),this.styles[s]&&(l=this.styles[s][d===0?d:d-1]);for(var v in this.styles[s]){var y=parseInt(v,10);y>=d&&(p=!0,u[y-d]=this.styles[s][v],_&&d===0||delete this.styles[s][v])}var T=!1;for(p&&!_&&(this.styles[s+m]=u,T=!0),(T||w>d)&&m--;m>0;)o&&o[m-1]?this.styles[s+m]={0:f(o[m-1])}:l?this.styles[s+m]={0:f(l)}:delete this.styles[s+m],m--;this._forceClearCache=!0},insertCharStyleObject:function(s,d,m,o){this.styles||(this.styles={});var l=this.styles[s],u=l?f(l):{};m||(m=1);for(var p in u){var w=parseInt(p,10);w>=d&&(l[w+m]=u[w],u[w-m]||delete l[w])}if(this._forceClearCache=!0,o){for(;m--;)!Object.keys(o[m]).length||(this.styles[s]||(this.styles[s]={}),this.styles[s][d+m]=f(o[m]));return}if(!!l)for(var _=l[d?d-1:1];_&&m--;)this.styles[s][d+m]=f(_)},insertNewStyleBlock:function(s,d,m){for(var o=this.get2DCursorLocation(d,!0),l=[0],u=0,p=0;p<s.length;p++)s[p]===`
`?(u++,l[u]=0):l[u]++;l[0]>0&&(this.insertCharStyleObject(o.lineIndex,o.charIndex,l[0],m),m=m&&m.slice(l[0]+1)),u&&this.insertNewlineStyleObject(o.lineIndex,o.charIndex+l[0],u);for(var p=1;p<u;p++)l[p]>0?this.insertCharStyleObject(o.lineIndex+p,0,l[p],m):m&&this.styles[o.lineIndex+p]&&m[0]&&(this.styles[o.lineIndex+p][0]=m[0]),m=m&&m.slice(l[p]+1);l[p]>0&&this.insertCharStyleObject(o.lineIndex+p,0,l[p],m)},setSelectionStartEndWithShift:function(s,d,m){m<=s?(d===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=m):m>s&&m<d?this._selectionDirection==="right"?this.selectionEnd=m:this.selectionStart=m:(d===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=d),this.selectionEnd=m)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(f){if(!!this.canvas){this.__newClickTime=+new Date;var s=f.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",f),this._stopEvent(f.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(f){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===f.x&&this.__lastPointer.y===f.y},_stopEvent:function(f){f.preventDefault&&f.preventDefault(),f.stopPropagation&&f.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(f){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(f.e))},tripleClickHandler:function(f){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(f.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(f.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(f){if(this.__isMousedown=!1,!(!this.editable||this.group||f.transform&&f.transform.actionPerformed||f.e.button&&f.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(f.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(f){var s=this.getSelectionStartFromPointer(f),d=this.selectionStart,m=this.selectionEnd;f.shiftKey?this.setSelectionStartEndWithShift(d,m,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(f){for(var s=this.getLocalPointer(f),d=0,m=0,o=0,l=0,u=0,p,w,_=0,v=this._textLines.length;_<v&&o<=s.y;_++)o+=this.getHeightOfLine(_)*this.scaleY,u=_,_>0&&(l+=this._textLines[_-1].length+this.missingNewlineOffset(_-1));p=this._getLineLeftOffset(u),m=p*this.scaleX,w=this._textLines[u],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+m);for(var y=0,T=w.length;y<T&&(d=m,m+=this.__charBounds[u][y].kernedWidth*this.scaleX,m<=s.x);y++)l++;return this._getNewSelectionStartFromOffset(s,d,m,l,T)},_getNewSelectionStartFromOffset:function(f,s,d,m,o){var l=f.x-s,u=d-f.x,p=u>l||u<0?0:1,w=m+p;return this.flipX&&(w=o-w),w>this._text.length&&(w=this._text.length),w}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var f=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+f.top+"; left: "+f.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+f.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(f){if(!!this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(f.keyCode in s)this[s[f.keyCode]](f);else if(f.keyCode in this.ctrlKeysMapDown&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapDown[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),f.keyCode>=33&&f.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(f){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(f.keyCode in this.ctrlKeysMapUp&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapUp[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(f){var s=this.fromPaste;if(this.fromPaste=!1,f&&f.stopPropagation(),!!this.isEditing){var d=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,m=this._text.length,o=d.length,l,u,p=o-m,w=this.selectionStart,_=this.selectionEnd,v=w!==_,y,T,C;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var P=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),O=w>P.selectionStart;v?(l=this._text.slice(w,_),p+=_-w):o<m&&(O?l=this._text.slice(_+p,_):l=this._text.slice(w,w-p)),u=d.slice(P.selectionEnd-p,P.selectionEnd),l&&l.length&&(u.length&&(y=this.getSelectionStyles(w,w+1,!1),y=u.map(function(){return y[0]})),v?(T=w,C=_):O?(T=_-l.length,C=_):(T=_,C=_+l.length),this.removeStyleFromTo(T,C)),u.length&&(s&&u.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(y=e.copiedTextStyle),this.insertNewStyleBlock(u,w,y)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(f){this.compositionStart=f.target.selectionStart,this.compositionEnd=f.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(f){return f&&f.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(f,s){var d=this._getLineLeftOffset(f),m;return s>0&&(m=this.__charBounds[f][s-1],d+=m.left+m.width),d},getDownCursorOffset:function(f,s){var d=this._getSelectionForOffset(f,s),m=this.get2DCursorLocation(d),o=m.lineIndex;if(o===this._textLines.length-1||f.metaKey||f.keyCode===34)return this._text.length-d;var l=m.charIndex,u=this._getWidthBeforeCursor(o,l),p=this._getIndexOnLine(o+1,u),w=this._textLines[o].slice(l);return w.length+p+1+this.missingNewlineOffset(o)},_getSelectionForOffset:function(f,s){return f.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(f,s){var d=this._getSelectionForOffset(f,s),m=this.get2DCursorLocation(d),o=m.lineIndex;if(o===0||f.metaKey||f.keyCode===33)return-d;var l=m.charIndex,u=this._getWidthBeforeCursor(o,l),p=this._getIndexOnLine(o-1,u),w=this._textLines[o].slice(0,l),_=this.missingNewlineOffset(o-1);return-this._textLines[o-1].length+p-w.length+(1-_)},_getIndexOnLine:function(f,s){for(var d=this._textLines[f],m=this._getLineLeftOffset(f),o=m,l=0,u,p,w=0,_=d.length;w<_;w++)if(u=this.__charBounds[f][w].width,o+=u,o>s){p=!0;var v=o-u,y=o,T=Math.abs(v-s),C=Math.abs(y-s);l=C<T?w:w-1;break}return p||(l=d.length-1),l},moveCursorDown:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",f)},moveCursorUp:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",f)},_moveCursorUpOrDown:function(f,s){var d="get"+f+"CursorOffset",m=this[d](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(m):this.moveCursorWithoutShift(m),m!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(f){var s=this._selectionDirection==="left"?this.selectionStart+f:this.selectionEnd+f;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),f!==0},moveCursorWithoutShift:function(f){return f<0?(this.selectionStart+=f,this.selectionEnd=this.selectionStart):(this.selectionEnd+=f,this.selectionStart=this.selectionEnd),f!==0},moveCursorLeft:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",f)},_move:function(f,s,d){var m;if(f.altKey)m=this["findWordBoundary"+d](this[s]);else if(f.metaKey||f.keyCode===35||f.keyCode===36)m=this["findLineBoundary"+d](this[s]);else return this[s]+=d==="Left"?-1:1,!0;if(typeof m<"u"&&this[s]!==m)return this[s]=m,!0},_moveLeft:function(f,s){return this._move(f,s,"Left")},_moveRight:function(f,s){return this._move(f,s,"Right")},moveCursorLeftWithoutShift:function(f){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(f,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(f){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(f,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(f,"selectionStart")},moveCursorRight:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",f)},_moveCursorLeftOrRight:function(f,s){var d="moveCursor"+f+"With";this._currentCursorOpacity=1,s.shiftKey?d+="Shift":d+="outShift",this[d](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(f){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(f,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(f,"selectionEnd")},moveCursorRightWithoutShift:function(f){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(f,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(f,s){typeof s>"u"&&(s=f+1),this.removeStyleFromTo(f,s),this._text.splice(f,s-f),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(f,s,d,m){typeof m>"u"&&(m=d),m>d&&this.removeStyleFromTo(d,m);var o=e.util.string.graphemeSplit(f);this.insertNewStyleBlock(o,d,s),this._text=[].concat(this._text.slice(0,d),o,this._text.slice(m)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var f=e.util.toFixed,s=e.util.radiansToDegrees,d=e.util.calcRotateMatrix,m=e.util.transformPoint,o=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){var u=this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0}),p=this.path;return p?u+p._createBaseSVGMarkup(p._toSVG(),{reviver:l,withShadow:!0}):u},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=!0,p=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",p?'text-decoration="'+p+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var p=[],w=[],_=l,v;this._setSVGBg(w);for(var y=0,T=this._textLines.length;y<T;y++)v=this._getLineLeftOffset(y),(this.textBackgroundColor||this.styleHas("textBackgroundColor",y))&&this._setSVGTextLineBg(w,y,u+v,_),this._setSVGTextLineText(p,y,u+v,_),_+=this.getHeightOfLine(y);return{textSpans:p,textBgRects:w}},_createTextCharSpan:function(l,u,p,w,_){var v=l!==l.trim()||l.match(o),y=this.getSvgSpanStyles(u,v),T=y?'style="'+y+'"':"",C=u.deltaY,P="",O=e.Object.NUM_FRACTION_DIGITS,D="";if(C&&(P=' dy="'+f(C,O)+'" '),_.renderLeft!==void 0){var L=_.angle;D=' rotate="'+f(s(L),e.Object.NUM_FRACTION_DIGITS)+'" ';var W=_.width/2,U=d({angle:s(L)});U[4]=_.renderLeft,U[5]=_.renderTop;var te=m({x:-W,y:0},U);p=te.x,w=te.y}return['<tspan x="',f(p,O),'" y="',f(w,O),'" ',P,T,D,">",e.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,p,w){var _=this.getHeightOfLine(u),v=this.textAlign.indexOf("justify")!==-1,y,T,C="",P,O,D=0,L=this._textLines[u],W;w+=_*(1-this._fontSizeFraction)/this.lineHeight;for(var U=0,te=L.length-1;U<=te;U++)W=U===te||this.charSpacing||this.path,C+=L[U],P=this.__charBounds[u][U],D===0?(p+=P.kernedWidth-P.width,D+=P.width):D+=P.kernedWidth,v&&!W&&this._reSpaceAndTab.test(L[U])&&(W=!0),W||(y=y||this.getCompleteStyleDeclaration(u,U),T=this.getCompleteStyleDeclaration(u,U+1),W=e.util.hasStyleChanged(y,T,!0)),W&&(O=this._getStyleDeclaration(u,U)||{},l.push(this._createTextCharSpan(C,O,p,w,P)),C="",y=T,p+=D,D=0)},_pushTextBgRect:function(l,u,p,w,_,v){var y=e.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',f(p,y),'" y="',f(w,y),'" width="',f(_,y),'" height="',f(v,y),`"></rect>
`)},_setSVGTextLineBg:function(l,u,p,w){for(var _=this._textLines[u],v=this.getHeightOfLine(u)/this.lineHeight,y=0,T=0,C,P,O=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),D=0,L=_.length;D<L;D++)C=this.__charBounds[u][D],P=this.getValueOfPropertyAt(u,D,"textBackgroundColor"),P!==O?(O&&this._pushTextBgRect(l,O,p+T,w,y,v),T=C.left,y=C.width,O=P):y+=C.kernedWidth;P&&this._pushTextBgRect(l,P,p+T,w,y,v)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new e.Color(l):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+l+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var u=0,p=0,w=0;w<l;w++)u+=this.getHeightOfLine(w);return p=this.getHeightOfLine(w),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*p/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var u=e.Object.prototype.getSvgStyles.call(this,l);return u+" white-space: pre;"}})}(),function(f){var s=f.fabric||(f.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(d){for(var m=0,o=0,l=0,u={},p=0;p<d.graphemeLines.length;p++)d.graphemeText[l]===`
`&&p>0?(o=0,l++,m++):!this.splitByGrapheme&&this._reSpaceAndTab.test(d.graphemeText[l])&&p>0&&(o++,l++),u[p]={line:m,offset:o},l+=d.graphemeLines[p].length,o+=d.graphemeLines[p].length;return u},styleHas:function(d,m){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[m];o&&(m=o.line)}return s.Text.prototype.styleHas.call(this,d,m)},isEmptyStyles:function(d){if(!this.styles)return!0;var m=0,o=d+1,l,u,p=!1,w=this._styleMap[d],_=this._styleMap[d+1];w&&(d=w.line,m=w.offset),_&&(o=_.line,p=o===d,l=_.offset),u=typeof d>"u"?this.styles:{line:this.styles[d]};for(var v in u)for(var y in u[v])if(y>=m&&(!p||y<l))for(var T in u[v][y])return!1;return!0},_getStyleDeclaration:function(d,m){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[d];if(!o)return null;d=o.line,m=o.offset+m}return this.callSuper("_getStyleDeclaration",d,m)},_setStyleDeclaration:function(d,m,o){var l=this._styleMap[d];d=l.line,m=l.offset+m,this.styles[d][m]=o},_deleteStyleDeclaration:function(d,m){var o=this._styleMap[d];d=o.line,m=o.offset+m,delete this.styles[d][m]},_getLineStyle:function(d){var m=this._styleMap[d];return!!this.styles[m.line]},_setLineStyle:function(d){var m=this._styleMap[d];this.styles[m.line]={}},_wrapText:function(d,m){var o=[],l;for(this.isWrapping=!0,l=0;l<d.length;l++)o=o.concat(this._wrapLine(d[l],l,m));return this.isWrapping=!1,o},_measureWord:function(d,m,o){var l=0,u,p=!0;o=o||0;for(var w=0,_=d.length;w<_;w++){var v=this._getGraphemeBox(d[w],m,w+o,u,p);l+=v.kernedWidth,u=d[w]}return l},_wrapLine:function(d,m,o,U){var u=0,p=this.splitByGrapheme,w=[],_=[],v=p?s.util.string.graphemeSplit(d):d.split(this._wordJoiners),y="",T=0,C=p?"":" ",P=0,O=0,D=0,L=!0,W=this._getWidthOfCharSpacing(),U=U||0;v.length===0&&v.push([]),o-=U;for(var te=0;te<v.length;te++)y=p?v[te]:s.util.string.graphemeSplit(v[te]),P=this._measureWord(y,m,T),T+=y.length,u+=O+P-W,u>o&&!L?(w.push(_),_=[],u=P,L=!0):u+=W,!L&&!p&&_.push(C),_=_.concat(y),O=p?0:this._measureWord([C],m,T),T++,L=!1,P>D&&(D=P);return te&&w.push(_),D+U>this.dynamicMinWidth&&(this.dynamicMinWidth=D-W+U),w},isEndOfWrapping:function(d){return!this._styleMap[d+1]||this._styleMap[d+1].line!==this._styleMap[d].line},missingNewlineOffset:function(d,m){return this.splitByGrapheme&&!m?this.isEndOfWrapping(d)?1:0:1},_splitTextIntoLines:function(d){for(var m=s.Text.prototype._splitTextIntoLines.call(this,d),o=this._wrapText(m.lines,this.width),l=new Array(o.length),u=0;u<o.length;u++)l[u]=o[u].join("");return m.lines=l,m.graphemeLines=o,m},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var d={};for(var m in this._styleMap)this._textLines[m]&&(d[this._styleMap[m].line]=1);for(var m in this.styles)d[m]||delete this.styles[m]},toObject:function(d){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(d))}}),s.Textbox.fromObject=function(d,m){var o=s.util.stylesFromArray(d.styles,d.text),l=Object.assign({},d,{styles:o});return delete l.path,s.Object._fromObject("Textbox",l,function(u){d.path?s.Object._fromObject("Path",d.path,function(p){u.set("path",p),m(u)},"path"):m(u)},"text")}}(t),function(){var f=e.controlsUtils,s=f.scaleSkewCursorStyleHandler,d=f.scaleCursorStyleHandler,m=f.scalingEqually,o=f.scalingYOrSkewingX,l=f.scalingXOrSkewingY,u=f.scaleOrSkewActionName,p=e.Object.prototype.controls;if(p.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:l,getActionName:u}),p.mr=new e.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:l,getActionName:u}),p.mb=new e.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:o,getActionName:u}),p.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:o,getActionName:u}),p.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:d,actionHandler:m}),p.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:d,actionHandler:m}),p.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:d,actionHandler:m}),p.br=new e.Control({x:.5,y:.5,cursorStyleHandler:d,actionHandler:m}),p.mtr=new e.Control({x:0,y:-.5,actionHandler:f.rotationWithSnapping,cursorStyleHandler:f.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var w=e.Textbox.prototype.controls={};w.mtr=p.mtr,w.tr=p.tr,w.br=p.br,w.tl=p.tl,w.bl=p.bl,w.mt=p.mt,w.mb=p.mb,w.mr=new e.Control({x:.5,y:0,actionHandler:f.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),w.ml=new e.Control({x:-.5,y:0,actionHandler:f.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(aO);(function(){fabric.Object.ENLIVEN_PROPS.push("eraser");var t=fabric.Object.prototype._drawClipPath,e=fabric.Object.prototype.needsItsOwnCache,r=fabric.Object.prototype.toObject,n=fabric.Object.prototype.getSvgCommons,a=fabric.Object.prototype._createBaseClipPathSVGMarkup,h=fabric.Object.prototype._createBaseSVGMarkup;fabric.Object.prototype.cacheProperties.push("eraser"),fabric.Object.prototype.stateProperties.push("eraser"),fabric.util.object.extend(fabric.Object.prototype,{erasable:!0,eraser:void 0,needsItsOwnCache:function(){return e.call(this)||!!this.eraser},_drawClipPath:function(s,d){if(t.call(this,s,d),this.eraser){var m=this._getNonTransformedDimensions();this.eraser.isType("eraser")&&this.eraser.set({width:m.x,height:m.y}),t.call(this,s,this.eraser)}},toObject:function(s){var d=r.call(this,["erasable"].concat(s));return this.eraser&&!this.eraser.excludeFromExport&&(d.eraser=this.eraser.toObject(s)),d},getSvgCommons:function(){return n.call(this)+(this.eraser?'mask="url(#'+this.eraser.clipPathId+')" ':"")},_createEraserSVGMarkup:function(s){return this.eraser?(this.eraser.clipPathId="MASK_"+fabric.Object.__uid++,['<mask id="',this.eraser.clipPathId,'" >',this.eraser.toSVG(s),"</mask>",`
`].join("")):""},_createBaseClipPathSVGMarkup:function(s,d){return[this._createEraserSVGMarkup(d&&d.reviver),a.call(this,s,d)].join("")},_createBaseSVGMarkup:function(s,d){return[this._createEraserSVGMarkup(d&&d.reviver),h.call(this,s,d)].join("")}});var x=fabric.Group.prototype._restoreObjectsState;fabric.util.object.extend(fabric.Group.prototype,{_addEraserPathToObjects:function(s){this._objects.forEach(function(d){fabric.EraserBrush.prototype._addPathToObjectEraser.call(fabric.EraserBrush.prototype,d,s)})},applyEraserToObjects:function(){var s=this,d=this.eraser;if(d){delete this.eraser;var m=s.calcTransformMatrix();d.clone(function(o){var l=s.clipPath;o.getObjects("path").forEach(function(u){var p=fabric.util.multiplyTransformMatrices(m,u.calcTransformMatrix());fabric.util.applyTransformToObject(u,p),l?l.clone(function(w){var _=fabric.EraserBrush.prototype.applyClipPathToPath.call(fabric.EraserBrush.prototype,u,w,m);s._addEraserPathToObjects(_)},["absolutePositioned","inverted"]):s._addEraserPathToObjects(u)})})}},_restoreObjectsState:function(){return this.erasable===!0&&this.applyEraserToObjects(),x.call(this)}}),fabric.Eraser=fabric.util.createClass(fabric.Group,{type:"eraser",originX:"center",originY:"center",drawObject:function(s){s.save(),s.fillStyle="black",s.fillRect(-this.width/2,-this.height/2,this.width,this.height),s.restore(),this.callSuper("drawObject",s)},_getBounds:function(){},_toSVG:function(s){var d=["<g ","COMMON_PARTS",` >
`],m=-this.width/2,o=-this.height/2,l=["<rect ",'fill="white" ','x="',m,'" y="',o,'" width="',this.width,'" height="',this.height,`" />
`].join("");d.push("		",l);for(var u=0,p=this._objects.length;u<p;u++)d.push("		",this._objects[u].toSVG(s));return d.push(`</g>
`),d}}),fabric.Eraser.fromObject=function(s,d){var m=s.objects;fabric.util.enlivenObjects(m,function(o){var l=fabric.util.object.clone(s,!0);delete l.objects,fabric.util.enlivenObjectEnlivables(s,l,function(){d&&d(new fabric.Eraser(o,l,!0))})})};var f=fabric.Canvas.prototype._renderOverlay;fabric.util.object.extend(fabric.Canvas.prototype,{isErasing:function(){return this.isDrawingMode&&this.freeDrawingBrush&&this.freeDrawingBrush.type==="eraser"&&this.freeDrawingBrush._isErasing},_renderOverlay:function(s){f.call(this,s),this.isErasing()&&!this.freeDrawingBrush.inverted&&this.freeDrawingBrush._render()}}),fabric.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{type:"eraser",inverted:!1,_isErasing:!1,_isErasable:function(s){return s.erasable!==!1},_prepareCollectionTraversal:function(s,d,m){s.forEachObject(function(o){o.forEachObject&&o.erasable==="deep"?this._prepareCollectionTraversal(o,d,m):!this.inverted&&o.erasable&&o.visible?(o.visible=!1,s.dirty=!0,m.visibility.push(o),m.collection.push(s)):this.inverted&&o.visible&&(o.erasable&&o.eraser?(o.eraser.inverted=!0,o.dirty=!0,s.dirty=!0,m.eraser.push(o),m.collection.push(s)):(o.visible=!1,s.dirty=!0,m.visibility.push(o),m.collection.push(s)))},this)},preparePattern:function(){this._patternCanvas||(this._patternCanvas=fabric.util.createCanvasElement());var s=this._patternCanvas;s.width=this.canvas.width,s.height=this.canvas.height;var d=s.getContext("2d");if(this.canvas._isRetinaScaling()){var m=this.canvas.getRetinaScaling();this.canvas.__initRetinaScaling(m,s,d)}var o=this.canvas.backgroundImage,l=o&&this._isErasable(o),u=this.canvas.overlayImage,p=u&&this._isErasable(u);if(!this.inverted&&(o&&!l||!!this.canvas.backgroundColor))l&&(this.canvas.backgroundImage=void 0),this.canvas._renderBackground(d),l&&(this.canvas.backgroundImage=o);else if(this.inverted&&o&&l){var w=this.canvas.backgroundColor;this.canvas.backgroundColor=void 0,this.canvas._renderBackground(d),this.canvas.backgroundColor=w}d.save(),d.transform.apply(d,this.canvas.viewportTransform);var _={visibility:[],eraser:[],collection:[]};if(this._prepareCollectionTraversal(this.canvas,d,_),this.canvas._renderObjects(d,this.canvas._objects),_.visibility.forEach(function(v){v.visible=!0}),_.eraser.forEach(function(v){v.eraser.inverted=!1,v.dirty=!0}),_.collection.forEach(function(v){v.dirty=!0}),d.restore(),!this.inverted&&(u&&!p||!!this.canvas.overlayColor))p&&(this.canvas.overlayImage=void 0),f.call(this.canvas,d),p&&(this.canvas.overlayImage=u);else if(this.inverted&&u&&p){var w=this.canvas.overlayColor;this.canvas.overlayColor=void 0,f.call(this.canvas,d),this.canvas.overlayColor=w}},_setBrushStyles:function(s){this.callSuper("_setBrushStyles",s),s.strokeStyle="black"},_saveAndTransform:function(s){this.callSuper("_saveAndTransform",s),this._setBrushStyles(s),s.globalCompositeOperation=s===this.canvas.getContext()?"destination-out":"source-over"},needsFullRender:function(){return!0},onMouseDown:function(s,d){!this.canvas._isMainEvent(d.e)||(this._prepareForDrawing(s),this._captureDrawingPath(s),this.preparePattern(),this._isErasing=!0,this.canvas.fire("erasing:start"),this._render())},_render:function(){var s;this.inverted||(s=this.canvas.getContext(),this.callSuper("_render",s)),s=this.canvas.contextTop,this.canvas.clearContext(s),this.callSuper("_render",s),s.save();var d=this.canvas.getRetinaScaling(),m=1/d;s.scale(m,m),s.globalCompositeOperation="source-in",s.drawImage(this._patternCanvas,0,0),s.restore()},createPath:function(s){var d=this.callSuper("createPath",s);return d.globalCompositeOperation=this.inverted?"source-over":"destination-out",d.stroke=this.inverted?"white":"black",d},applyClipPathToPath:function(s,d,m){var o=fabric.util.invertTransform(s.calcTransformMatrix()),l=d.calcTransformMatrix(),u=d.absolutePositioned?o:fabric.util.multiplyTransformMatrices(o,m);return d.absolutePositioned=!1,fabric.util.applyTransformToObject(d,fabric.util.multiplyTransformMatrices(u,l)),s.clipPath=s.clipPath?fabric.util.mergeClipPaths(d,s.clipPath):d,s},clonePathWithClipPath:function(s,d,m){var o=d.calcTransformMatrix(),l=d.clipPath,u=this;s.clone(function(p){l.clone(function(w){m(u.applyClipPathToPath(p,w,o))},["absolutePositioned","inverted"])})},_addPathToObjectEraser:function(s,d){var m=this;if(s.forEachObject&&s.erasable==="deep"){var o=s._objects.filter(function(u){return u.erasable});o.length>0&&s.clipPath?this.clonePathWithClipPath(d,s,function(u){o.forEach(function(p){m._addPathToObjectEraser(p,u)})}):o.length>0&&o.forEach(function(u){m._addPathToObjectEraser(u,d)});return}var l=s.eraser;l||(l=new fabric.Eraser,s.eraser=l),d.clone(function(u){var p=fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(s.calcTransformMatrix()),u.calcTransformMatrix());fabric.util.applyTransformToObject(u,p),l.addWithUpdate(u),s.set("dirty",!0),s.fire("erasing:end",{path:u}),s.group&&Array.isArray(m.__subTargets)&&m.__subTargets.push(s)})},applyEraserToCanvas:function(s){var d=this.canvas,m={};return["backgroundImage","overlayImage"].forEach(function(o){var l=d[o];l&&l.erasable&&(this._addPathToObjectEraser(l,s),m[o]=l)},this),m},_finalizeAndAddPath:function(){var s=this.canvas.contextTop,d=this.canvas;s.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate)),d.clearContext(d.contextTop),this._isErasing=!1;var m=this._points&&this._points.length>1?this.convertPointsToSVGPath(this._points):null;if(!m||this._isEmptySVGPath(m)){d.fire("erasing:end"),d.requestRenderAll();return}var o=this.createPath(m);o.setCoords(),d.fire("before:path:created",{path:o});var l=this.applyEraserToCanvas(o),u=this;this.__subTargets=[];var p=[];d.forEachObject(function(w){w.erasable&&w.intersectsWithObject(o,!0,!0)&&(u._addPathToObjectEraser(w,o),p.push(w))}),d.fire("erasing:end",{path:o,targets:p,subTargets:this.__subTargets,drawables:l}),delete this.__subTargets,d.requestRenderAll(),this._resetShadow(),d.fire("path:created",{path:o})}})})();const jx=t=>{let e;const r=new Set,n=(m,o)=>{const l=typeof m=="function"?m(e):m;if(!Object.is(l,e)){const u=e;e=(o!=null?o:typeof l!="object"||l===null)?l:Object.assign({},e,l),r.forEach(p=>p(e,u))}},a=()=>e,s={setState:n,getState:a,getInitialState:()=>d,subscribe:m=>(r.add(m),()=>r.delete(m)),destroy:()=>{r.clear()}},d=e=t(n,a,s);return s},cO=t=>t?jx(t):jx;var WT={exports:{}},GT={},HT={exports:{}},KT={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cg=Wr.exports;function dO(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var fO=typeof Object.is=="function"?Object.is:dO,hO=cg.useState,pO=cg.useEffect,mO=cg.useLayoutEffect,gO=cg.useDebugValue;function _O(t,e){var r=e(),n=hO({inst:{value:r,getSnapshot:e}}),a=n[0].inst,h=n[1];return mO(function(){a.value=r,a.getSnapshot=e,Hy(a)&&h({inst:a})},[t,r,e]),pO(function(){return Hy(a)&&h({inst:a}),t(function(){Hy(a)&&h({inst:a})})},[t]),gO(r),r}function Hy(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!fO(t,r)}catch{return!0}}function vO(t,e){return e()}var yO=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?vO:_O;KT.useSyncExternalStore=cg.useSyncExternalStore!==void 0?cg.useSyncExternalStore:yO;(function(t){t.exports=KT})(HT);/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ey=Wr.exports,wO=HT.exports;function xO(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var bO=typeof Object.is=="function"?Object.is:xO,MO=wO.useSyncExternalStore,TO=ey.useRef,SO=ey.useEffect,CO=ey.useMemo,EO=ey.useDebugValue;GT.useSyncExternalStoreWithSelector=function(t,e,r,n,a){var h=TO(null);if(h.current===null){var x={hasValue:!1,value:null};h.current=x}else x=h.current;h=CO(function(){function s(u){if(!d){if(d=!0,m=u,u=n(u),a!==void 0&&x.hasValue){var p=x.value;if(a(p,u))return o=p}return o=u}if(p=o,bO(m,u))return p;var w=n(u);return a!==void 0&&a(p,w)?(m=u,p):(m=u,o=w)}var d=!1,m,o,l=r===void 0?null:r;return[function(){return s(e())},l===null?void 0:function(){return s(l())}]},[e,r,n,a]);var f=MO(t,h[0],h[1]);return SO(function(){x.hasValue=!0,x.value=f},[f]),EO(f),f};(function(t){t.exports=GT})(WT);const PO=pw(WT.exports),{useDebugValue:OO}=Lp,{useSyncExternalStoreWithSelector:kO}=PO;const IO=t=>t;function AO(t,e=IO,r){const n=kO(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return OO(n),n}const Nx=t=>{const e=typeof t=="function"?cO(t):t,r=(n,a)=>AO(e,n,a);return Object.assign(r,e),r},CD=t=>t?Nx(t):Nx;function DO(t,e){let r;try{r=t()}catch{return}return{getItem:a=>{var h;const x=s=>s===null?null:JSON.parse(s,e==null?void 0:e.reviver),f=(h=r.getItem(a))!=null?h:null;return f instanceof Promise?f.then(x):x(f)},setItem:(a,h)=>r.setItem(a,JSON.stringify(h,e==null?void 0:e.replacer)),removeItem:a=>r.removeItem(a)}}const o_=t=>e=>{try{const r=t(e);return r instanceof Promise?r:{then(n){return o_(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return o_(n)(r)}}}},FO=(t,e)=>(r,n,a)=>{let h={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:_=>_,version:0,merge:(_,v)=>({...v,..._}),...e},x=!1;const f=new Set,s=new Set;let d;try{d=h.getStorage()}catch{}if(!d)return t((..._)=>{console.warn(`[zustand persist middleware] Unable to update item '${h.name}', the given storage is currently unavailable.`),r(..._)},n,a);const m=o_(h.serialize),o=()=>{const _=h.partialize({...n()});let v;const y=m({state:_,version:h.version}).then(T=>d.setItem(h.name,T)).catch(T=>{v=T});if(v)throw v;return y},l=a.setState;a.setState=(_,v)=>{l(_,v),o()};const u=t((..._)=>{r(..._),o()},n,a);let p;const w=()=>{var _;if(!d)return;x=!1,f.forEach(y=>y(n()));const v=((_=h.onRehydrateStorage)==null?void 0:_.call(h,n()))||void 0;return o_(d.getItem.bind(d))(h.name).then(y=>{if(y)return h.deserialize(y)}).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==h.version){if(h.migrate)return h.migrate(y.state,y.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return y.state}).then(y=>{var T;return p=h.merge(y,(T=n())!=null?T:u),r(p,!0),o()}).then(()=>{v==null||v(p,void 0),x=!0,s.forEach(y=>y(p))}).catch(y=>{v==null||v(void 0,y)})};return a.persist={setOptions:_=>{h={...h,..._},_.getStorage&&(d=_.getStorage())},clearStorage:()=>{d==null||d.removeItem(h.name)},getOptions:()=>h,rehydrate:()=>w(),hasHydrated:()=>x,onHydrate:_=>(f.add(_),()=>{f.delete(_)}),onFinishHydration:_=>(s.add(_),()=>{s.delete(_)})},w(),p||u},LO=(t,e)=>(r,n,a)=>{let h={storage:DO(()=>localStorage),partialize:w=>w,version:0,merge:(w,_)=>({..._,...w}),...e},x=!1;const f=new Set,s=new Set;let d=h.storage;if(!d)return t((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${h.name}', the given storage is currently unavailable.`),r(...w)},n,a);const m=()=>{const w=h.partialize({...n()});return d.setItem(h.name,{state:w,version:h.version})},o=a.setState;a.setState=(w,_)=>{o(w,_),m()};const l=t((...w)=>{r(...w),m()},n,a);a.getInitialState=()=>l;let u;const p=()=>{var w,_;if(!d)return;x=!1,f.forEach(y=>{var T;return y((T=n())!=null?T:l)});const v=((_=h.onRehydrateStorage)==null?void 0:_.call(h,(w=n())!=null?w:l))||void 0;return o_(d.getItem.bind(d))(h.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==h.version){if(h.migrate)return[!0,h.migrate(y.state,y.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var T;const[C,P]=y;if(u=h.merge(P,(T=n())!=null?T:l),r(u,!0),C)return m()}).then(()=>{v==null||v(u,void 0),u=n(),x=!0,s.forEach(y=>y(u))}).catch(y=>{v==null||v(void 0,y)})};return a.persist={setOptions:w=>{h={...h,...w},w.storage&&(d=w.storage)},clearStorage:()=>{d==null||d.removeItem(h.name)},getOptions:()=>h,rehydrate:()=>p(),hasHydrated:()=>x,onHydrate:w=>(f.add(w),()=>{f.delete(w)}),onFinishHydration:w=>(s.add(w),()=>{s.delete(w)})},h.skipHydration||p(),u||l},$O=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?FO(t,e):LO(t,e),ED=$O;function ty(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function RO(t,e){let r;const n=()=>{if(r)return r;const a=indexedDB.open(t);return a.onupgradeneeded=()=>a.result.createObjectStore(e),r=ty(a),r.then(h=>{h.onclose=()=>r=void 0},()=>{}),r};return(a,h)=>n().then(x=>h(x.transaction(e,a).objectStore(e)))}let Ky;function u1(){return Ky||(Ky=RO("keyval-store","keyval")),Ky}function PD(t,e=u1()){return e("readonly",r=>ty(r.get(t)))}function OD(t,e,r=u1()){return r("readwrite",n=>(n.put(e,t),ty(n.transaction)))}function kD(t,e=u1()){return e("readwrite",r=>(r.delete(t),ty(r.transaction)))}let D_;const BO=new Uint8Array(16);function zO(){if(!D_&&(D_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D_(BO)}const Xi=[];for(let t=0;t<256;++t)Xi.push((t+256).toString(16).slice(1));function jO(t,e=0){return Xi[t[e+0]]+Xi[t[e+1]]+Xi[t[e+2]]+Xi[t[e+3]]+"-"+Xi[t[e+4]]+Xi[t[e+5]]+"-"+Xi[t[e+6]]+Xi[t[e+7]]+"-"+Xi[t[e+8]]+Xi[t[e+9]]+"-"+Xi[t[e+10]]+Xi[t[e+11]]+Xi[t[e+12]]+Xi[t[e+13]]+Xi[t[e+14]]+Xi[t[e+15]]}const NO=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ux={randomUUID:NO};function ID(t,e,r){if(Ux.randomUUID&&!e&&!t)return Ux.randomUUID();t=t||{};const n=t.random||(t.rng||zO)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let a=0;a<16;++a)e[r+a]=n[a];return e}return jO(n)}var UO=Object.defineProperty,Vx=Object.getOwnPropertySymbols,VO=Object.prototype.hasOwnProperty,WO=Object.prototype.propertyIsEnumerable,Wx=(t,e,r)=>e in t?UO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,GO=(t,e)=>{for(var r in e||(e={}))VO.call(e,r)&&Wx(t,r,e[r]);if(Vx)for(var r of Vx(e))WO.call(e,r)&&Wx(t,r,e[r]);return t},XT=Symbol.for("immer-nothing"),Gx=Symbol.for("immer-draftable"),Co=Symbol.for("immer-state");function Va(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var dg=Object.getPrototypeOf;function fg(t){return!!t&&!!t[Co]}function Np(t){var e;return t?YT(t)||Array.isArray(t)||!!t[Gx]||!!((e=t.constructor)!=null&&e[Gx])||ny(t)||iy(t):!1}var HO=Object.prototype.constructor.toString();function YT(t){if(!t||typeof t!="object")return!1;const e=dg(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===HO}function Sv(t,e){ry(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,n)=>e(n,r,t))}function ry(t){const e=t[Co];return e?e.type_:Array.isArray(t)?1:ny(t)?2:iy(t)?3:0}function ew(t,e){return ry(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function qT(t,e,r){const n=ry(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function KO(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function ny(t){return t instanceof Map}function iy(t){return t instanceof Set}function Ep(t){return t.copy_||t.base_}function tw(t,e){if(ny(t))return new Map(t);if(iy(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=YT(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[Co];let a=Reflect.ownKeys(n);for(let h=0;h<a.length;h++){const x=a[h],f=n[x];f.writable===!1&&(f.writable=!0,f.configurable=!0),(f.get||f.set)&&(n[x]={configurable:!0,writable:!0,enumerable:f.enumerable,value:t[x]})}return Object.create(dg(t),n)}else{const n=dg(t);if(n!==null&&r)return GO({},t);const a=Object.create(n);return Object.assign(a,t)}}function c1(t,e=!1){return sy(t)||fg(t)||!Np(t)||(ry(t)>1&&(t.set=t.add=t.clear=t.delete=XO),Object.freeze(t),e&&Object.entries(t).forEach(([r,n])=>c1(n,!0))),t}function XO(){Va(2)}function sy(t){return Object.isFrozen(t)}var YO={};function Up(t){const e=YO[t];return e||Va(0,t),e}var a_;function QT(){return a_}function qO(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Hx(t,e){e&&(Up("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function rw(t){nw(t),t.drafts_.forEach(QO),t.drafts_=null}function nw(t){t===a_&&(a_=t.parent_)}function Kx(t){return a_=qO(a_,t)}function QO(t){const e=t[Co];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Xx(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[Co].modified_&&(rw(e),Va(4)),Np(t)&&(t=Cv(e,t),e.parent_||Ev(e,t)),e.patches_&&Up("Patches").generateReplacementPatches_(r[Co].base_,t,e.patches_,e.inversePatches_)):t=Cv(e,r,[]),rw(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==XT?t:void 0}function Cv(t,e,r){if(sy(e))return e;const n=e[Co];if(!n)return Sv(e,(a,h)=>Yx(t,n,e,a,h,r)),e;if(n.scope_!==t)return e;if(!n.modified_)return Ev(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const a=n.copy_;let h=a,x=!1;n.type_===3&&(h=new Set(a),a.clear(),x=!0),Sv(h,(f,s)=>Yx(t,n,a,f,s,r,x)),Ev(t,a,!1),r&&t.patches_&&Up("Patches").generatePatches_(n,r,t.patches_,t.inversePatches_)}return n.copy_}function Yx(t,e,r,n,a,h,x){if(fg(a)){const f=h&&e&&e.type_!==3&&!ew(e.assigned_,n)?h.concat(n):void 0,s=Cv(t,a,f);if(qT(r,n,s),fg(s))t.canAutoFreeze_=!1;else return}else x&&r.add(a);if(Np(a)&&!sy(a)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Cv(t,a),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&Ev(t,a)}}function Ev(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&c1(e,r)}function JO(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:QT(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=n,h=d1;r&&(a=[n],h=l_);const{revoke:x,proxy:f}=Proxy.revocable(a,h);return n.draft_=f,n.revoke_=x,f}var d1={get(t,e){if(e===Co)return t;const r=Ep(t);if(!ew(r,e))return ZO(t,r,e);const n=r[e];return t.finalized_||!Np(n)?n:n===Xy(t.base_,e)?(Yy(t),t.copy_[e]=sw(n,t)):n},has(t,e){return e in Ep(t)},ownKeys(t){return Reflect.ownKeys(Ep(t))},set(t,e,r){const n=JT(Ep(t),e);if(n!=null&&n.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const a=Xy(Ep(t),e),h=a==null?void 0:a[Co];if(h&&h.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(KO(r,a)&&(r!==void 0||ew(t.base_,e)))return!0;Yy(t),iw(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return Xy(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,Yy(t),iw(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=Ep(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){Va(11)},getPrototypeOf(t){return dg(t.base_)},setPrototypeOf(){Va(12)}},l_={};Sv(d1,(t,e)=>{l_[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});l_.deleteProperty=function(t,e){return l_.set.call(this,t,e,void 0)};l_.set=function(t,e,r){return d1.set.call(this,t[0],e,r,t[0])};function Xy(t,e){const r=t[Co];return(r?Ep(r):t)[e]}function ZO(t,e,r){var n;const a=JT(e,r);return a?"value"in a?a.value:(n=a.get)==null?void 0:n.call(t.draft_):void 0}function JT(t,e){if(!(e in t))return;let r=dg(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=dg(r)}}function iw(t){t.modified_||(t.modified_=!0,t.parent_&&iw(t.parent_))}function Yy(t){t.copy_||(t.copy_=tw(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var ek=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const h=r;r=e;const x=this;return function(s=h,...d){return x.produce(s,m=>r.call(this,m,...d))}}typeof r!="function"&&Va(6),n!==void 0&&typeof n!="function"&&Va(7);let a;if(Np(e)){const h=Kx(this),x=sw(e,void 0);let f=!0;try{a=r(x),f=!1}finally{f?rw(h):nw(h)}return Hx(h,n),Xx(a,h)}else if(!e||typeof e!="object"){if(a=r(e),a===void 0&&(a=e),a===XT&&(a=void 0),this.autoFreeze_&&c1(a,!0),n){const h=[],x=[];Up("Patches").generateReplacementPatches_(e,a,h,x),n(h,x)}return a}else Va(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(x,...f)=>this.produceWithPatches(x,s=>e(s,...f));let n,a;return[this.produce(e,r,(x,f)=>{n=x,a=f}),n,a]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Np(t)||Va(8),fg(t)&&(t=tk(t));const e=Kx(this),r=sw(t,void 0);return r[Co].isManual_=!0,nw(e),r}finishDraft(t,e){const r=t&&t[Co];(!r||!r.isManual_)&&Va(9);const{scope_:n}=r;return Hx(n,e),Xx(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const a=e[r];if(a.path.length===0&&a.op==="replace"){t=a.value;break}}r>-1&&(e=e.slice(r+1));const n=Up("Patches").applyPatches_;return fg(t)?n(t,e):this.produce(t,a=>n(a,e))}};function sw(t,e){const r=ny(t)?Up("MapSet").proxyMap_(t,e):iy(t)?Up("MapSet").proxySet_(t,e):JO(t,e);return(e?e.scope_:QT()).drafts_.push(r),r}function tk(t){return fg(t)||Va(10,t),ZT(t)}function ZT(t){if(!Np(t)||sy(t))return t;const e=t[Co];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=tw(t,e.scope_.immer_.useStrictShallowCopy_)}else r=tw(t,!0);return Sv(r,(n,a)=>{qT(r,n,ZT(a))}),e&&(e.finalized_=!1),r}var Eo=new ek,AD=Eo.produce;Eo.produceWithPatches.bind(Eo);Eo.setAutoFreeze.bind(Eo);Eo.setUseStrictShallowCopy.bind(Eo);Eo.applyPatches.bind(Eo);Eo.createDraft.bind(Eo);Eo.finishDraft.bind(Eo);class rk{constructor(e){this.selfOptions=e||{},this.pipes={}}options(e){return e&&(this.selfOptions=e),this.selfOptions}pipe(e,r){let n=r;if(typeof e=="string"){if(typeof n>"u")return this.pipes[e];this.pipes[e]=n}if(e&&e.name){if(n=e,n.processor===this)return n;this.pipes[n.name]=n}return n.processor=this,n}process(e,r){let n=e;n.options=this.options();let a=r||e.pipe||"default",h;for(;a;)typeof n.nextAfterChildren<"u"&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),typeof a=="string"&&(a=this.pipe(a)),a.process(n),h=a,a=null,n&&n.next&&(n=n.next,a=n.pipe||h);return n.hasResult?n.result:void 0}}const nk=rk;class ik{constructor(e){this.name=e,this.filters=[]}process(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");const r=this.debug,n=this.filters.length,a=e;for(let h=0;h<n;h++){const x=this.filters[h];if(r&&this.log(`filter: ${x.filterName}`),x(a),typeof a=="object"&&a.exiting){a.exiting=!1;break}}!a.next&&this.resultCheck&&this.resultCheck(a)}log(e){console.log(`[jsondiffpatch] ${this.name} pipe, ${e}`)}append(...e){return this.filters.push(...e),this}prepend(...e){return this.filters.unshift(...e),this}indexOf(e){if(!e)throw new Error("a filter name is required");for(let r=0;r<this.filters.length;r++)if(this.filters[r].filterName===e)return r;throw new Error(`filter not found: ${e}`)}list(){return this.filters.map(e=>e.filterName)}after(e,...r){const n=this.indexOf(e);return this.filters.splice(n+1,0,...r),this}before(e,...r){const n=this.indexOf(e);return this.filters.splice(n,0,...r),this}replace(e,...r){const n=this.indexOf(e);return this.filters.splice(n,1,...r),this}remove(e){const r=this.indexOf(e);return this.filters.splice(r,1),this}clear(){return this.filters.length=0,this}shouldHaveResult(e){if(e===!1){this.resultCheck=null;return}if(!this.resultCheck)return this.resultCheck=r=>{if(!r.hasResult){console.log(r);const n=new Error(`${this.name} failed`);throw n.noResult=!0,n}},this}}const qy=ik;class f1{setResult(e){return this.result=e,this.hasResult=!0,this}exit(){return this.exiting=!0,this}push(e,r){return e.parent=this,typeof r<"u"&&(e.childName=r),e.root=this.root||this,e.options=e.options||this.options,this.children?(this.children[this.children.length-1].next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this}}function sk(t){const e=/^\/(.*)\/([gimyu]*)$/.exec(t.toString());return new RegExp(e[1],e[2])}function Pv(t){if(typeof t!="object")return t;if(t===null)return null;if(Array.isArray(t))return t.map(Pv);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return sk(t);const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=Pv(t[r]));return e}class ok extends f1{constructor(e,r){super(),this.left=e,this.right=r,this.pipe="diff"}setResult(e){if(this.options.cloneDiffValues&&typeof e=="object"){const r=typeof this.options.cloneDiffValues=="function"?this.options.cloneDiffValues:Pv;typeof e[0]=="object"&&(e[0]=r(e[0])),typeof e[1]=="object"&&(e[1]=r(e[1]))}return super.setResult(e)}}const Ap=ok;class ak extends f1{constructor(e,r){super(),this.left=e,this.delta=r,this.pipe="patch"}}const h1=ak;class lk extends f1{constructor(e){super(),this.delta=e,this.pipe="reverse"}}const p1=lk,eS=function(e){if(e.left===e.right){e.setResult(void 0).exit();return}if(typeof e.left>"u"){if(typeof e.right=="function")throw new Error("functions are not supported");e.setResult([e.right]).exit();return}if(typeof e.right>"u"){e.setResult([e.left,0,0]).exit();return}if(typeof e.left=="function"||typeof e.right=="function")throw new Error("functions are not supported");if(e.leftType=e.left===null?"null":typeof e.left,e.rightType=e.right===null?"null":typeof e.right,e.leftType!==e.rightType){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="boolean"||e.leftType==="number"){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="object"&&(e.leftIsArray=Array.isArray(e.left)),e.rightType==="object"&&(e.rightIsArray=Array.isArray(e.right)),e.leftIsArray!==e.rightIsArray){e.setResult([e.left,e.right]).exit();return}e.left instanceof RegExp&&(e.right instanceof RegExp?e.setResult([e.left.toString(),e.right.toString()]).exit():e.setResult([e.left,e.right]).exit())};eS.filterName="trivial";const tS=function(e){if(typeof e.delta>"u"){e.setResult(e.left).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const r=e.delta;if(r.length===1){e.setResult(r[0]).exit();return}if(r.length===2){if(e.left instanceof RegExp){const n=/^\/(.*)\/([gimyu]+)$/.exec(r[1]);if(n){e.setResult(new RegExp(n[1],n[2])).exit();return}}e.setResult(r[1]).exit();return}r.length===3&&r[2]===0&&e.setResult(void 0).exit()};tS.filterName="trivial";const rS=function(e){if(typeof e.delta>"u"){e.setResult(e.delta).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const r=e.delta;if(r.length===1){e.setResult([r[0],0,0]).exit();return}if(r.length===2){e.setResult([r[1],r[0]]).exit();return}r.length===3&&r[2]===0&&e.setResult([r[0]]).exit()};rS.filterName="trivial";const nS=t=>{if(!t||!t.children)return;const e=t.children.length;let r,n=t.result;for(let a=0;a<e;a++)r=t.children[a],!(typeof r.result>"u")&&(n=n||{},n[r.childName]=r.result);n&&t.leftIsArray&&(n._t="a"),t.setResult(n).exit()};nS.filterName="collectChildren";const iS=t=>{if(t.leftIsArray||t.leftType!=="object")return;const e=t.left,r=t.right;let n,a;const h=t.options.propertyFilter;for(n in e)!Object.prototype.hasOwnProperty.call(e,n)||h&&!h(n,t)||(a=new Ap(e[n],r[n]),t.push(a,n));for(n in r)!Object.prototype.hasOwnProperty.call(r,n)||h&&!h(n,t)||typeof e[n]>"u"&&(a=new Ap(void 0,r[n]),t.push(a,n));if(!t.children||t.children.length===0){t.setResult(void 0).exit();return}t.exit()};iS.filterName="objects";const sS=function(e){if(!e.nested)return;const r=e.delta;if(r._t)return;const n=r;let a,h;for(a in n)h=new h1(e.left[a],n[a]),e.push(h,a);e.exit()};sS.filterName="objects";const oS=function(e){if(!e||!e.children||e.delta._t)return;const n=e.left,a=e.children.length;let h;for(let x=0;x<a;x++){h=e.children[x];const f=h.childName;Object.prototype.hasOwnProperty.call(e.left,f)&&h.result===void 0?delete n[f]:n[f]!==h.result&&(n[f]=h.result)}e.setResult(n).exit()};oS.filterName="collectChildren";const aS=function(e){if(!e.nested||e.delta._t)return;const n=e.delta;let a,h;for(a in n)h=new p1(n[a]),e.push(h,a);e.exit()};aS.filterName="objects";const lS=t=>{if(!t||!t.children||t.delta._t)return;const r=t.children.length;let n;const a={};for(let h=0;h<r;h++){n=t.children[h];const x=n.childName;a[x]!==n.result&&(a[x]=n.result)}t.setResult(a).exit()};lS.filterName="collectChildren";const uk=function(t,e,r,n){return t[r]===e[n]},ck=function(t,e,r,n){const a=t.length,h=e.length;let x,f;const s=new Array(a+1);for(x=0;x<a+1;x++)for(s[x]=new Array(h+1),f=0;f<h+1;f++)s[x][f]=0;for(s.match=r,x=1;x<a+1;x++)for(f=1;f<h+1;f++)r(t,e,x-1,f-1,n)?s[x][f]=s[x-1][f-1]+1:s[x][f]=Math.max(s[x-1][f],s[x][f-1]);return s},dk=function(t,e,r,n){let a=e.length,h=r.length;const x={sequence:[],indices1:[],indices2:[]};for(;a!==0&&h!==0;)if(t.match(e,r,a-1,h-1,n))x.sequence.unshift(e[a-1]),x.indices1.unshift(a-1),x.indices2.unshift(h-1),--a,--h;else{const s=t[a][h-1],d=t[a-1][h];s>d?--h:--a}return x},fk=function(t,e,r,n){const a=n||{},h=ck(t,e,r||uk,a);return dk(h,t,e,a)},hk={get:fk},hg=3;function pk(t,e,r,n){for(let a=0;a<r;a++){const h=t[a];for(let x=0;x<n;x++){const f=e[x];if(a!==x&&h===f)return!0}}}function F_(t,e,r,n,a){const h=t[r],x=e[n];if(h===x)return!0;if(typeof h!="object"||typeof x!="object")return!1;const f=a.objectHash;if(!f)return a.matchByPosition&&r===n;a.hashCache1=a.hashCache1||[];let s=a.hashCache1[r];if(typeof s>"u"&&(a.hashCache1[r]=s=f(h,r)),typeof s>"u")return!1;a.hashCache2=a.hashCache2||[];let d=a.hashCache2[n];return typeof d>"u"&&(a.hashCache2[n]=d=f(x,n)),typeof d>"u"?!1:s===d}const uS=function(e){if(!e.leftIsArray)return;const r={objectHash:e.options&&e.options.objectHash,matchByPosition:e.options&&e.options.matchByPosition};let n=0,a=0,h,x,f;const s=e.left,d=e.right,m=s.length,o=d.length;let l;for(m>0&&o>0&&!r.objectHash&&typeof r.matchByPosition!="boolean"&&(r.matchByPosition=!pk(s,d,m,o));n<m&&n<o&&F_(s,d,n,n,r);)h=n,l=new Ap(s[h],d[h]),e.push(l,h),n++;for(;a+n<m&&a+n<o&&F_(s,d,m-1-a,o-1-a,r);)x=m-1-a,f=o-1-a,l=new Ap(s[x],d[f]),e.push(l,f),a++;let u;if(n+a===m){if(m===o){e.setResult(void 0).exit();return}for(u=u||{_t:"a"},h=n;h<o-a;h++)u[h]=[d[h]];e.setResult(u).exit();return}if(n+a===o){for(u=u||{_t:"a"},h=n;h<m-a;h++)u[`_${h}`]=[s[h],0,0];e.setResult(u).exit();return}delete r.hashCache1,delete r.hashCache2;const p=s.slice(n,m-a),w=d.slice(n,o-a),_=hk.get(p,w,F_,r),v=[];for(u=u||{_t:"a"},h=n;h<m-a;h++)_.indices1.indexOf(h-n)<0&&(u[`_${h}`]=[s[h],0,0],v.push(h));let y=!0;e.options&&e.options.arrays&&e.options.arrays.detectMove===!1&&(y=!1);let T=!1;e.options&&e.options.arrays&&e.options.arrays.includeValueOnMove&&(T=!0);const C=v.length;for(h=n;h<o-a;h++){const P=_.indices2.indexOf(h-n);if(P<0){let O=!1;if(y&&C>0){for(let D=0;D<C;D++)if(x=v[D],F_(p,w,x-n,h-n,r)){u[`_${x}`].splice(1,2,h,hg),T||(u[`_${x}`][0]=""),f=h,l=new Ap(s[x],d[f]),e.push(l,f),v.splice(D,1),O=!0;break}}O||(u[h]=[d[h]])}else x=_.indices1[P]+n,f=_.indices2[P]+n,l=new Ap(s[x],d[f]),e.push(l,f)}e.setResult(u).exit()};uS.filterName="arrays";const qx={numerically(t,e){return t-e},numericallyBy(t){return(e,r)=>e[t]-r[t]}},cS=function(e){if(!e.nested)return;const r=e.delta;if(r._t!=="a")return;let n,a;const h=r,x=e.left;let f=[],s=[];const d=[];for(n in h)if(n!=="_t")if(n[0]==="_"){const u=n;if(h[u][2]===0||h[u][2]===hg)f.push(parseInt(n.slice(1),10));else throw new Error(`only removal or move can be applied at original array indices, invalid diff type: ${h[u][2]}`)}else{const u=n;h[u].length===1?s.push({index:parseInt(u,10),value:h[u][0]}):d.push({index:parseInt(u,10),delta:h[u]})}for(f=f.sort(qx.numerically),n=f.length-1;n>=0;n--){a=f[n];const u=h[`_${a}`],p=x.splice(a,1)[0];u[2]===hg&&s.push({index:u[1],value:p})}s=s.sort(qx.numericallyBy("index"));const m=s.length;for(n=0;n<m;n++){const u=s[n];x.splice(u.index,0,u.value)}const o=d.length;let l;if(o>0)for(n=0;n<o;n++){const u=d[n];l=new h1(x[u.index],u.delta),e.push(l,u.index)}if(!e.children){e.setResult(x).exit();return}e.exit()};cS.filterName="arrays";const dS=function(e){if(!e||!e.children||e.delta._t!=="a")return;const n=e.left,a=e.children.length;let h;for(let x=0;x<a;x++){h=e.children[x];const f=h.childName;n[f]=h.result}e.setResult(n).exit()};dS.filterName="arraysCollectChildren";const fS=function(e){if(!e.nested){const x=e.delta;if(x[2]===hg){const f=x;e.newName=`_${f[1]}`,e.setResult([f[0],parseInt(e.childName.substring(1),10),hg]).exit()}return}const r=e.delta;if(r._t!=="a")return;const n=r;let a,h;for(a in n)a!=="_t"&&(h=new p1(n[a]),e.push(h,a));e.exit()};fS.filterName="arrays";const mk=(t,e,r)=>{if(typeof e=="string"&&e[0]==="_")return parseInt(e.substring(1),10);if(Array.isArray(r)&&r[2]===0)return`_${e}`;let n=+e;for(const a in t){const h=t[a];if(Array.isArray(h))if(h[2]===hg){const x=parseInt(a.substring(1),10),f=h[1];if(f===+e)return x;x<=n&&f>n?n++:x>=n&&f<n&&n--}else h[2]===0?parseInt(a.substring(1),10)<=n&&n++:h.length===1&&parseInt(a,10)<=n&&n--}return n},hS=t=>{if(!t||!t.children)return;const e=t.delta;if(e._t!=="a")return;const r=e,n=t.children.length;let a;const h={_t:"a"};for(let x=0;x<n;x++){a=t.children[x];let f=a.newName;typeof f>"u"&&(f=mk(r,a.childName,a.result)),h[f]!==a.result&&(h[f]=a.result)}t.setResult(h).exit()};hS.filterName="arraysCollectChildren";const pS=function(e){e.left instanceof Date?(e.right instanceof Date?e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0):e.setResult([e.left,e.right]),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()};pS.filterName="dates";const Ov=2,gk=60;let Qy=null;function mS(t,e){var r;if(!Qy){let n;if(!((r=t==null?void 0:t.textDiff)===null||r===void 0)&&r.diffMatchPatch)n=new t.textDiff.diffMatchPatch;else{if(!e)return null;const a=new Error("The diff-match-patch library was not provided. Pass the library in through the options or use the `jsondiffpatch/with-text-diffs` entry-point.");throw a.diff_match_patch_not_found=!0,a}Qy={diff:function(a,h){return n.patch_toText(n.patch_make(a,h))},patch:function(a,h){const x=n.patch_apply(n.patch_fromText(h),a);for(let f=0;f<x[1].length;f++)if(!x[1][f]){const s=new Error("text patch failed");s.textPatchFailed=!0}return x[0]}}}return Qy}const gS=function(e){if(e.leftType!=="string")return;const r=e.left,n=e.right,a=e.options&&e.options.textDiff&&e.options.textDiff.minLength||gk;if(r.length<a||n.length<a){e.setResult([r,n]).exit();return}const h=mS(e.options);if(!h){e.setResult([r,n]).exit();return}const x=h.diff;e.setResult([x(r,n),0,Ov]).exit()};gS.filterName="texts";const _S=function(e){if(e.nested)return;const r=e.delta;if(r[2]!==Ov)return;const n=r,a=mS(e.options,!0).patch;e.setResult(a(e.left,n[0])).exit()};_S.filterName="texts";const _k=function(t){let e,r,n,a,h=null;const x=/^@@ +-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;let f;const s=t.split(`
`);for(e=0,r=s.length;e<r;e++){n=s[e];const d=n.slice(0,1);d==="@"?(h=x.exec(n),f=e,s[f]="@@ -"+h[3]+","+h[4]+" +"+h[1]+","+h[2]+" @@"):d==="+"?(s[e]="-"+s[e].slice(1),s[e-1].slice(0,1)==="+"&&(a=s[e],s[e]=s[e-1],s[e-1]=a)):d==="-"&&(s[e]="+"+s[e].slice(1))}return s.join(`
`)},vS=function(e){if(e.nested)return;const r=e.delta;if(r[2]!==Ov)return;const n=r;e.setResult([_k(n[0]),0,Ov]).exit()};vS.filterName="texts";class vk{constructor(e){this.processor=new nk(e),this.processor.pipe(new qy("diff").append(nS,eS,pS,gS,iS,uS).shouldHaveResult()),this.processor.pipe(new qy("patch").append(oS,dS,tS,_S,sS,cS).shouldHaveResult()),this.processor.pipe(new qy("reverse").append(lS,hS,rS,vS,aS,fS).shouldHaveResult())}options(e){return this.processor.options(e)}diff(e,r){return this.processor.process(new Ap(e,r))}patch(e,r){return this.processor.process(new h1(e,r))}reverse(e){return this.processor.process(new p1(e))}unpatch(e,r){return this.patch(e,this.reverse(r))}clone(e){return Pv(e)}}const m1=vk;let Xu;function DD(t,e){return Xu||(Xu=new m1),Xu.diff(t,e)}function FD(t,e){return Xu||(Xu=new m1),Xu.patch(t,e)}function LD(t,e){return Xu||(Xu=new m1),Xu.unpatch(t,e)}var Qx={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(t,e){(function(){var r,n="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",x="Expected a function",f="Invalid `variable` option passed into `_.template`",s="__lodash_hash_undefined__",d=500,m="__lodash_placeholder__",o=1,l=2,u=4,p=1,w=2,_=1,v=2,y=4,T=8,C=16,P=32,O=64,D=128,L=256,W=512,U=30,te="...",pe=800,ne=16,ye=1,ce=2,Me=3,ke=1/0,ve=9007199254740991,K=17976931348623157e292,re=0/0,X=4294967295,N=X-1,ae=X>>>1,J=[["ary",D],["bind",_],["bindKey",v],["curry",T],["curryRight",C],["flip",W],["partial",P],["partialRight",O],["rearg",L]],Y="[object Arguments]",be="[object Array]",Ce="[object AsyncFunction]",Ue="[object Boolean]",Ve="[object Date]",Ie="[object DOMException]",he="[object Error]",Fe="[object Function]",ee="[object GeneratorFunction]",we="[object Map]",Re="[object Number]",Be="[object Null]",Se="[object Object]",Ne="[object Promise]",ze="[object Proxy]",rt="[object RegExp]",nt="[object Set]",Ge="[object String]",qe="[object Symbol]",gt="[object Undefined]",ct="[object WeakMap]",wt="[object WeakSet]",bt="[object ArrayBuffer]",Ct="[object DataView]",It="[object Float32Array]",jt="[object Float64Array]",Fr="[object Int8Array]",lr="[object Int16Array]",cr="[object Int32Array]",gn="[object Uint8Array]",Jr="[object Uint8ClampedArray]",Zn="[object Uint16Array]",ai="[object Uint32Array]",vn=/\b__p \+= '';/g,Nn=/\b(__p \+=) '' \+/g,Ji=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Zi=/&(?:amp|lt|gt|quot|#39);/g,io=/[&<>"']/g,oa=RegExp(Zi.source),dr=RegExp(io.source),ko=/<%-([\s\S]+?)%>/g,so=/<%([\s\S]+?)%>/g,yr=/<%=([\s\S]+?)%>/g,As=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,H=/^\w*$/,Pe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fe=/[\\^$.*+?()[\]{}|]/g,Le=RegExp(fe.source),Xe=/^\s+/,ft=/\s/,pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,nr=/\{\n\/\* \[wrapped with (.+)\] \*/,vr=/,? & /,or=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Nt=/[()=,{}\[\]\/\s]/,qt=/\\(\\)?/g,jr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Sn=/\w*$/,bi=/^[-+]0x[0-9a-f]+$/i,hi=/^0b[01]+$/i,bn=/^\[object .+?Constructor\]$/,wr=/^0o[0-7]+$/i,ir=/^(?:0|[1-9]\d*)$/,Ar=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gr=/($^)/,nn=/['\n\r\u2028\u2029\\]/g,Nr="\\ud800-\\udfff",yn="\\u0300-\\u036f",pi="\\ufe20-\\ufe2f",sn="\\u20d0-\\u20ff",ei=yn+pi+sn,ti="\\u2700-\\u27bf",Mi="a-z\\xdf-\\xf6\\xf8-\\xff",rr="\\xac\\xb1\\xd7\\xf7",Ds="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",oo="\\u2000-\\u206f",Io=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Un="A-Z\\xc0-\\xd6\\xd8-\\xde",Tt="\\ufe0e\\ufe0f",Ot=rr+Ds+oo+Io,Ut="['\u2019]",pn="["+Nr+"]",xr="["+Ot+"]",Vn="["+ei+"]",ao="\\d+",Fs="["+ti+"]",st="["+Mi+"]",lo="[^"+Nr+Ot+ao+ti+Mi+Un+"]",cs="\\ud83c[\\udffb-\\udfff]",Je="(?:"+Vn+"|"+cs+")",Q="[^"+Nr+"]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",De="[\\ud800-\\udbff][\\udc00-\\udfff]",We="["+Un+"]",Ye="\\u200d",at="(?:"+st+"|"+lo+")",_t="(?:"+We+"|"+lo+")",Dt="(?:"+Ut+"(?:d|ll|m|re|s|t|ve))?",Et="(?:"+Ut+"(?:D|LL|M|RE|S|T|VE))?",zt=Je+"?",pr="["+Tt+"]?",Hr="(?:"+Ye+"(?:"+[Q,ue,De].join("|")+")"+pr+zt+")*",ri="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ur=pr+zt+Hr,Mn="(?:"+[Fs,ue,De].join("|")+")"+Ur,Wn="(?:"+[Q+Vn+"?",Vn,ue,De,pn].join("|")+")",li=RegExp(Ut,"g"),Ls=RegExp(Vn,"g"),Gn=RegExp(cs+"(?="+cs+")|"+Wn+Ur,"g"),$s=RegExp([We+"?"+st+"+"+Dt+"(?="+[xr,We,"$"].join("|")+")",_t+"+"+Et+"(?="+[xr,We+at,"$"].join("|")+")",We+"?"+at+"+"+Dt,We+"+"+Et,rn,ri,ao,Mn].join("|"),"g"),un=RegExp("["+Ye+Nr+ei+Tt+"]"),In=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ti=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ds=-1,qr={};qr[It]=qr[jt]=qr[Fr]=qr[lr]=qr[cr]=qr[gn]=qr[Jr]=qr[Zn]=qr[ai]=!0,qr[Y]=qr[be]=qr[bt]=qr[Ue]=qr[Ct]=qr[Ve]=qr[he]=qr[Fe]=qr[we]=qr[Re]=qr[Se]=qr[rt]=qr[nt]=qr[Ge]=qr[ct]=!1;var Lr={};Lr[Y]=Lr[be]=Lr[bt]=Lr[Ct]=Lr[Ue]=Lr[Ve]=Lr[It]=Lr[jt]=Lr[Fr]=Lr[lr]=Lr[cr]=Lr[we]=Lr[Re]=Lr[Se]=Lr[rt]=Lr[nt]=Lr[Ge]=Lr[qe]=Lr[gn]=Lr[Jr]=Lr[Zn]=Lr[ai]=!0,Lr[he]=Lr[Fe]=Lr[ct]=!1;var fs={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Hn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},En={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},An={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},_r=parseFloat,Br=parseInt,es=typeof _g=="object"&&_g&&_g.Object===Object&&_g,aa=typeof self=="object"&&self&&self.Object===Object&&self,Kr=es||aa||Function("return this")(),Kn=e&&!e.nodeType&&e,Gt=Kn&&!0&&t&&!t.nodeType&&t,cn=Gt&&Gt.exports===Kn,Qa=cn&&es.process,ni=function(){try{var Qe=Gt&&Gt.require&&Gt.require("util").types;return Qe||Qa&&Qa.binding&&Qa.binding("util")}catch{}}(),Rs=ni&&ni.isArrayBuffer,Yt=ni&&ni.isDate,la=ni&&ni.isMap,dt=ni&&ni.isRegExp,Xt=ni&&ni.isSet,ec=ni&&ni.isTypedArray;function mi(Qe,ht,ot){switch(ot.length){case 0:return Qe.call(ht);case 1:return Qe.call(ht,ot[0]);case 2:return Qe.call(ht,ot[0],ot[1]);case 3:return Qe.call(ht,ot[0],ot[1],ot[2])}return Qe.apply(ht,ot)}function Tf(Qe,ht,ot,Ht){for(var Tr=-1,Zr=Qe==null?0:Qe.length;++Tr<Zr;){var Dn=Qe[Tr];ht(Ht,Dn,ot(Dn),Qe)}return Ht}function ki(Qe,ht){for(var ot=-1,Ht=Qe==null?0:Qe.length;++ot<Ht&&ht(Qe[ot],ot,Qe)!==!1;);return Qe}function br(Qe,ht){for(var ot=Qe==null?0:Qe.length;ot--&&ht(Qe[ot],ot,Qe)!==!1;);return Qe}function tc(Qe,ht){for(var ot=-1,Ht=Qe==null?0:Qe.length;++ot<Ht;)if(!ht(Qe[ot],ot,Qe))return!1;return!0}function hs(Qe,ht){for(var ot=-1,Ht=Qe==null?0:Qe.length,Tr=0,Zr=[];++ot<Ht;){var Dn=Qe[ot];ht(Dn,ot,Qe)&&(Zr[Tr++]=Dn)}return Zr}function ua(Qe,ht){var ot=Qe==null?0:Qe.length;return!!ot&&Ao(Qe,ht,0)>-1}function Ul(Qe,ht,ot){for(var Ht=-1,Tr=Qe==null?0:Qe.length;++Ht<Tr;)if(ot(ht,Qe[Ht]))return!0;return!1}function _n(Qe,ht){for(var ot=-1,Ht=Qe==null?0:Qe.length,Tr=Array(Ht);++ot<Ht;)Tr[ot]=ht(Qe[ot],ot,Qe);return Tr}function Bs(Qe,ht){for(var ot=-1,Ht=ht.length,Tr=Qe.length;++ot<Ht;)Qe[Tr+ot]=ht[ot];return Qe}function ui(Qe,ht,ot,Ht){var Tr=-1,Zr=Qe==null?0:Qe.length;for(Ht&&Zr&&(ot=Qe[++Tr]);++Tr<Zr;)ot=ht(ot,Qe[Tr],Tr,Qe);return ot}function Kp(Qe,ht,ot,Ht){var Tr=Qe==null?0:Qe.length;for(Ht&&Tr&&(ot=Qe[--Tr]);Tr--;)ot=ht(ot,Qe[Tr],Tr,Qe);return ot}function Vl(Qe,ht){for(var ot=-1,Ht=Qe==null?0:Qe.length;++ot<Ht;)if(ht(Qe[ot],ot,Qe))return!0;return!1}var zs=Gl("length");function rc(Qe){return Qe.split("")}function Wl(Qe){return Qe.match(or)||[]}function nc(Qe,ht,ot){var Ht;return ot(Qe,function(Tr,Zr,Dn){if(ht(Tr,Zr,Dn))return Ht=Zr,!1}),Ht}function Ja(Qe,ht,ot,Ht){for(var Tr=Qe.length,Zr=ot+(Ht?1:-1);Ht?Zr--:++Zr<Tr;)if(ht(Qe[Zr],Zr,Qe))return Zr;return-1}function Ao(Qe,ht,ot){return ht===ht?Af(Qe,ht,ot):Ja(Qe,ic,ot)}function Sf(Qe,ht,ot,Ht){for(var Tr=ot-1,Zr=Qe.length;++Tr<Zr;)if(Ht(Qe[Tr],ht))return Tr;return-1}function ic(Qe){return Qe!==Qe}function sc(Qe,ht){var ot=Qe==null?0:Qe.length;return ot?ca(Qe,ht)/ot:re}function Gl(Qe){return function(ht){return ht==null?r:ht[Qe]}}function Hl(Qe){return function(ht){return Qe==null?r:Qe[ht]}}function Ii(Qe,ht,ot,Ht,Tr){return Tr(Qe,function(Zr,Dn,dn){ot=Ht?(Ht=!1,Zr):ht(ot,Zr,Dn,dn)}),ot}function Cf(Qe,ht){var ot=Qe.length;for(Qe.sort(ht);ot--;)Qe[ot]=Qe[ot].value;return Qe}function ca(Qe,ht){for(var ot,Ht=-1,Tr=Qe.length;++Ht<Tr;){var Zr=ht(Qe[Ht]);Zr!==r&&(ot=ot===r?Zr:ot+Zr)}return ot}function Za(Qe,ht){for(var ot=-1,Ht=Array(Qe);++ot<Qe;)Ht[ot]=ht(ot);return Ht}function Ef(Qe,ht){return _n(ht,function(ot){return[ot,Qe[ot]]})}function Kl(Qe){return Qe&&Qe.slice(0,Jl(Qe)+1).replace(Xe,"")}function Rn(Qe){return function(ht){return Qe(ht)}}function Xl(Qe,ht){return _n(ht,function(ot){return Qe[ot]})}function el(Qe,ht){return Qe.has(ht)}function oc(Qe,ht){for(var ot=-1,Ht=Qe.length;++ot<Ht&&Ao(ht,Qe[ot],0)>-1;);return ot}function Pf(Qe,ht){for(var ot=Qe.length;ot--&&Ao(ht,Qe[ot],0)>-1;);return ot}function Xp(Qe,ht){for(var ot=Qe.length,Ht=0;ot--;)Qe[ot]===ht&&++Ht;return Ht}var ji=Hl(fs),Of=Hl(Hn);function Yl(Qe){return"\\"+An[Qe]}function ac(Qe,ht){return Qe==null?r:Qe[ht]}function ci(Qe){return un.test(Qe)}function kf(Qe){return In.test(Qe)}function ql(Qe){for(var ht,ot=[];!(ht=Qe.next()).done;)ot.push(ht.value);return ot}function Ql(Qe){var ht=-1,ot=Array(Qe.size);return Qe.forEach(function(Ht,Tr){ot[++ht]=[Tr,Ht]}),ot}function lc(Qe,ht){return function(ot){return Qe(ht(ot))}}function js(Qe,ht){for(var ot=-1,Ht=Qe.length,Tr=0,Zr=[];++ot<Ht;){var Dn=Qe[ot];(Dn===ht||Dn===m)&&(Qe[ot]=m,Zr[Tr++]=ot)}return Zr}function da(Qe){var ht=-1,ot=Array(Qe.size);return Qe.forEach(function(Ht){ot[++ht]=Ht}),ot}function If(Qe){var ht=-1,ot=Array(Qe.size);return Qe.forEach(function(Ht){ot[++ht]=[Ht,Ht]}),ot}function Af(Qe,ht,ot){for(var Ht=ot-1,Tr=Qe.length;++Ht<Tr;)if(Qe[Ht]===ht)return Ht;return-1}function uc(Qe,ht,ot){for(var Ht=ot+1;Ht--;)if(Qe[Ht]===ht)return Ht;return Ht}function Do(Qe){return ci(Qe)?Ff(Qe):zs(Qe)}function Pn(Qe){return ci(Qe)?cc(Qe):rc(Qe)}function Jl(Qe){for(var ht=Qe.length;ht--&&ft.test(Qe.charAt(ht)););return ht}var Df=Hl(En);function Ff(Qe){for(var ht=Gn.lastIndex=0;Gn.test(Qe);)++ht;return ht}function cc(Qe){return Qe.match(Gn)||[]}function Lf(Qe){return Qe.match($s)||[]}var $f=function Qe(ht){ht=ht==null?Kr:uo.defaults(Kr.Object(),ht,uo.pick(Kr,Ti));var ot=ht.Array,Ht=ht.Date,Tr=ht.Error,Zr=ht.Function,Dn=ht.Math,dn=ht.Object,Zl=ht.RegExp,Rf=ht.String,gi=ht.TypeError,fa=ot.prototype,Bf=Zr.prototype,Fo=dn.prototype,Ns=ht["__core-js_shared__"],tl=Bf.toString,on=Fo.hasOwnProperty,eu=0,dc=function(){var g=/[^.]+$/.exec(Ns&&Ns.keys&&Ns.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),rl=Fo.toString,fc=tl.call(dn),zf=Kr._,Yp=Zl("^"+tl.call(on).replace(fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ha=cn?ht.Buffer:r,Us=ht.Symbol,nl=ht.Uint8Array,hc=ha?ha.allocUnsafe:r,il=lc(dn.getPrototypeOf,dn),Xr=dn.create,tu=Fo.propertyIsEnumerable,sl=fa.splice,pc=Us?Us.isConcatSpreadable:r,Lo=Us?Us.iterator:r,co=Us?Us.toStringTag:r,ol=function(){try{var g=Xo(dn,"defineProperty");return g({},"",{}),g}catch{}}(),mc=ht.clearTimeout!==Kr.clearTimeout&&ht.clearTimeout,jf=Ht&&Ht.now!==Kr.Date.now&&Ht.now,Nf=ht.setTimeout!==Kr.setTimeout&&ht.setTimeout,pa=Dn.ceil,al=Dn.floor,ru=dn.getOwnPropertySymbols,gc=ha?ha.isBuffer:r,_c=ht.isFinite,ll=fa.join,vc=lc(dn.keys,dn),Cn=Dn.max,ii=Dn.min,yc=Ht.now,Uf=ht.parseInt,wc=Dn.random,xc=fa.reverse,nu=Xo(ht,"DataView"),ma=Xo(ht,"Map"),ul=Xo(ht,"Promise"),$o=Xo(ht,"Set"),ga=Xo(ht,"WeakMap"),Ro=Xo(dn,"create"),cl=ga&&new ga,Bo={},Vf=Ts(nu),Wf=Ts(ma),bc=Ts(ul),Mc=Ts($o),Gf=Ts(ga),zo=Us?Us.prototype:r,jo=zo?zo.valueOf:r,Tc=zo?zo.toString:r;function ge(g){if(Oe(g)&&!S(g)&&!(g instanceof Vr)){if(g instanceof Si)return g;if(on.call(g,"__wrapped__"))return Cd(g)}return new Si(g)}var No=function(){function g(){}return function(M){if(!Ae(M))return{};if(Xr)return Xr(M);g.prototype=M;var A=new g;return g.prototype=r,A}}();function dl(){}function Si(g,M){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!M,this.__index__=0,this.__values__=r}ge.templateSettings={escape:ko,evaluate:so,interpolate:yr,variable:"",imports:{_:ge}},ge.prototype=dl.prototype,ge.prototype.constructor=ge,Si.prototype=No(dl.prototype),Si.prototype.constructor=Si;function Vr(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function Sc(){var g=new Vr(this.__wrapped__);return g.__actions__=vi(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=vi(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=vi(this.__views__),g}function Cc(){if(this.__filtered__){var g=new Vr(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function Hf(){var g=this.__wrapped__.value(),M=this.__dir__,A=S(g),j=M<0,ie=A?g.length:0,xe=am(0,ie,this.__views__),je=xe.start,Ke=xe.end,et=Ke-je,vt=j?Ke:je-1,yt=this.__iteratees__,kt=yt.length,Wt=0,ur=ii(et,this.__takeCount__);if(!A||!j&&ie==et&&ur==et)return nd(g,this.__actions__);var kr=[];e:for(;et--&&Wt<ur;){vt+=M;for(var Yr=-1,Ir=g[vt];++Yr<kt;){var en=yt[Yr],ln=en.iteratee,vo=en.type,Ss=ln(Ir);if(vo==ce)Ir=Ss;else if(!Ss){if(vo==ye)continue e;break e}}kr[Wt++]=Ir}return kr}Vr.prototype=No(dl.prototype),Vr.prototype.constructor=Vr;function fo(g){var M=-1,A=g==null?0:g.length;for(this.clear();++M<A;){var j=g[M];this.set(j[0],j[1])}}function Kf(){this.__data__=Ro?Ro(null):{},this.size=0}function Xf(g){var M=this.has(g)&&delete this.__data__[g];return this.size-=M?1:0,M}function Yf(g){var M=this.__data__;if(Ro){var A=M[g];return A===s?r:A}return on.call(M,g)?M[g]:r}function Ni(g){var M=this.__data__;return Ro?M[g]!==r:on.call(M,g)}function qf(g,M){var A=this.__data__;return this.size+=this.has(g)?0:1,A[g]=Ro&&M===r?s:M,this}fo.prototype.clear=Kf,fo.prototype.delete=Xf,fo.prototype.get=Yf,fo.prototype.has=Ni,fo.prototype.set=qf;function ps(g){var M=-1,A=g==null?0:g.length;for(this.clear();++M<A;){var j=g[M];this.set(j[0],j[1])}}function Qf(){this.__data__=[],this.size=0}function Jf(g){var M=this.__data__,A=Ws(M,g);if(A<0)return!1;var j=M.length-1;return A==j?M.pop():sl.call(M,A,1),--this.size,!0}function Ec(g){var M=this.__data__,A=Ws(M,g);return A<0?r:M[A][1]}function Zf(g){return Ws(this.__data__,g)>-1}function eh(g,M){var A=this.__data__,j=Ws(A,g);return j<0?(++this.size,A.push([g,M])):A[j][1]=M,this}ps.prototype.clear=Qf,ps.prototype.delete=Jf,ps.prototype.get=Ec,ps.prototype.has=Zf,ps.prototype.set=eh;function ms(g){var M=-1,A=g==null?0:g.length;for(this.clear();++M<A;){var j=g[M];this.set(j[0],j[1])}}function th(){this.size=0,this.__data__={hash:new fo,map:new(ma||ps),string:new fo}}function Pc(g){var M=ka(this,g).delete(g);return this.size-=M?1:0,M}function qp(g){return ka(this,g).get(g)}function rh(g){return ka(this,g).has(g)}function nh(g,M){var A=ka(this,g),j=A.size;return A.set(g,M),this.size+=A.size==j?0:1,this}ms.prototype.clear=th,ms.prototype.delete=Pc,ms.prototype.get=qp,ms.prototype.has=rh,ms.prototype.set=nh;function ho(g){var M=-1,A=g==null?0:g.length;for(this.__data__=new ms;++M<A;)this.add(g[M])}function Oc(g){return this.__data__.set(g,s),this}function ih(g){return this.__data__.has(g)}ho.prototype.add=ho.prototype.push=Oc,ho.prototype.has=ih;function Ui(g){var M=this.__data__=new ps(g);this.size=M.size}function Qp(){this.__data__=new ps,this.size=0}function Uo(g){var M=this.__data__,A=M.delete(g);return this.size=M.size,A}function po(g){return this.__data__.get(g)}function Vo(g){return this.__data__.has(g)}function kc(g,M){var A=this.__data__;if(A instanceof ps){var j=A.__data__;if(!ma||j.length<a-1)return j.push([g,M]),this.size=++A.size,this;A=this.__data__=new ms(j)}return A.set(g,M),this.size=A.size,this}Ui.prototype.clear=Qp,Ui.prototype.delete=Uo,Ui.prototype.get=po,Ui.prototype.has=Vo,Ui.prototype.set=kc;function Vs(g,M){var A=S(g),j=!A&&b(g),ie=!A&&!j&&B(g),xe=!A&&!j&&!ie&&ar(g),je=A||j||ie||xe,Ke=je?Za(g.length,Rf):[],et=Ke.length;for(var vt in g)(M||on.call(g,vt))&&!(je&&(vt=="length"||ie&&(vt=="offset"||vt=="parent")||xe&&(vt=="buffer"||vt=="byteLength"||vt=="byteOffset")||Hi(vt,et)))&&Ke.push(vt);return Ke}function Bn(g){var M=g.length;return M?g[gl(0,M-1)]:r}function sh(g,M){return Aa(vi(g),ts(M,0,g.length))}function iu(g){return Aa(vi(g))}function su(g,M,A){(A!==r&&!mn(g[M],A)||A===r&&!(M in g))&&gs(g,M,A)}function fl(g,M,A){var j=g[M];(!(on.call(g,M)&&mn(j,A))||A===r&&!(M in g))&&gs(g,M,A)}function Ws(g,M){for(var A=g.length;A--;)if(mn(g[A][0],M))return A;return-1}function Ic(g,M,A,j){return _s(g,function(ie,xe,je){M(j,ie,A(ie),je)}),j}function ou(g,M){return g&&Vi(M,Ri(M),g)}function Ac(g,M){return g&&Vi(M,Qs(M),g)}function gs(g,M,A){M=="__proto__"&&ol?ol(g,M,{configurable:!0,enumerable:!0,value:A,writable:!0}):g[M]=A}function hl(g,M){for(var A=-1,j=M.length,ie=ot(j),xe=g==null;++A<j;)ie[A]=xe?r:cy(g,M[A]);return ie}function ts(g,M,A){return g===g&&(A!==r&&(g=g<=A?g:A),M!==r&&(g=g>=M?g:M)),g}function Ai(g,M,A,j,ie,xe){var je,Ke=M&o,et=M&l,vt=M&u;if(A&&(je=ie?A(g,j,ie,xe):A(g)),je!==r)return je;if(!Ae(g))return g;var yt=S(g);if(yt){if(je=wh(g),!Ke)return vi(g,je)}else{var kt=Yn(g),Wt=kt==Fe||kt==ee;if(B(g))return Mu(g,Ke);if(kt==Se||kt==Y||Wt&&!ie){if(je=et||Wt?{}:xh(g),!Ke)return et?vs(g,Ac(je,g)):sm(g,ou(je,g))}else{if(!Lr[kt])return ie?g:{};je=bh(g,kt,Ke)}}xe||(xe=new Ui);var ur=xe.get(g);if(ur)return ur;xe.set(g,je),Jt(g)?g.forEach(function(Ir){je.add(Ai(Ir,M,A,Ir,g,xe))}):He(g)&&g.forEach(function(Ir,en){je.set(en,Ai(Ir,M,A,en,g,xe))});var kr=vt?et?Ou:Pa:et?Qs:Ri,Yr=yt?r:kr(g);return ki(Yr||g,function(Ir,en){Yr&&(en=Ir,Ir=g[en]),fl(je,en,Ai(Ir,M,A,en,g,xe))}),je}function Dc(g){var M=Ri(g);return function(A){return au(A,g,M)}}function au(g,M,A){var j=A.length;if(g==null)return!j;for(g=dn(g);j--;){var ie=A[j],xe=M[ie],je=g[ie];if(je===r&&!(ie in g)||!xe(je))return!1}return!0}function _a(g,M,A){if(typeof g!="function")throw new gi(x);return qo(function(){g.apply(r,A)},M)}function Wo(g,M,A,j){var ie=-1,xe=ua,je=!0,Ke=g.length,et=[],vt=M.length;if(!Ke)return et;A&&(M=_n(M,Rn(A))),j?(xe=Ul,je=!1):M.length>=a&&(xe=el,je=!1,M=new ho(M));e:for(;++ie<Ke;){var yt=g[ie],kt=A==null?yt:A(yt);if(yt=j||yt!==0?yt:0,je&&kt===kt){for(var Wt=vt;Wt--;)if(M[Wt]===kt)continue e;et.push(yt)}else xe(M,kt,j)||et.push(yt)}return et}var _s=ys(rs),Fc=ys(cu,!0);function Jp(g,M){var A=!0;return _s(g,function(j,ie,xe){return A=!!M(j,ie,xe),A}),A}function mo(g,M,A){for(var j=-1,ie=g.length;++j<ie;){var xe=g[j],je=M(xe);if(je!=null&&(Ke===r?je===je&&!$r(je):A(je,Ke)))var Ke=je,et=xe}return et}function lu(g,M,A,j){var ie=g.length;for(A=zr(A),A<0&&(A=-A>ie?0:ie+A),j=j===r||j>ie?ie:zr(j),j<0&&(j+=ie),j=A>j?0:Il(j);A<j;)g[A++]=M;return g}function va(g,M){var A=[];return _s(g,function(j,ie,xe){M(j,ie,xe)&&A.push(j)}),A}function Xn(g,M,A,j,ie){var xe=-1,je=g.length;for(A||(A=Th),ie||(ie=[]);++xe<je;){var Ke=g[xe];M>0&&A(Ke)?M>1?Xn(Ke,M-1,A,j,ie):Bs(ie,Ke):j||(ie[ie.length]=Ke)}return ie}var pl=cd(),uu=cd(!0);function rs(g,M){return g&&pl(g,M,Ri)}function cu(g,M){return g&&uu(g,M,Ri)}function du(g,M){return hs(M,function(A){return Te(g[A])})}function Gs(g,M){M=Ks(M,g);for(var A=0,j=M.length;g!=null&&A<j;)g=g[ns(M[A++])];return A&&A==j?g:r}function Lc(g,M,A){var j=M(g);return S(g)?j:Bs(j,A(g))}function _i(g){return g==null?g===r?gt:Be:co&&co in dn(g)?Au(g):Md(g)}function ml(g,M){return g>M}function fu(g,M){return g!=null&&on.call(g,M)}function oh(g,M){return g!=null&&M in dn(g)}function hu(g,M,A){return g>=ii(M,A)&&g<Cn(M,A)}function ya(g,M,A){for(var j=A?Ul:ua,ie=g[0].length,xe=g.length,je=xe,Ke=ot(xe),et=1/0,vt=[];je--;){var yt=g[je];je&&M&&(yt=_n(yt,Rn(M))),et=ii(yt.length,et),Ke[je]=!A&&(M||ie>=120&&yt.length>=120)?new ho(je&&yt):r}yt=g[0];var kt=-1,Wt=Ke[0];e:for(;++kt<ie&&vt.length<et;){var ur=yt[kt],kr=M?M(ur):ur;if(ur=A||ur!==0?ur:0,!(Wt?el(Wt,kr):j(vt,kr,A))){for(je=xe;--je;){var Yr=Ke[je];if(!(Yr?el(Yr,kr):j(g[je],kr,A)))continue e}Wt&&Wt.push(kr),vt.push(ur)}}return vt}function $c(g,M,A,j){return rs(g,function(ie,xe,je){M(j,A(ie),xe,je)}),j}function wa(g,M,A){M=Ks(M,g),g=Eh(g,M);var j=g==null?g:g[ns(Fi(M))];return j==null?r:mi(j,g,A)}function pu(g){return Oe(g)&&_i(g)==Y}function Rc(g){return Oe(g)&&_i(g)==bt}function Zp(g){return Oe(g)&&_i(g)==Ve}function Go(g,M,A,j,ie){return g===M?!0:g==null||M==null||!Oe(g)&&!Oe(M)?g!==g&&M!==M:em(g,M,A,j,Go,ie)}function em(g,M,A,j,ie,xe){var je=S(g),Ke=S(M),et=je?be:Yn(g),vt=Ke?be:Yn(M);et=et==Y?Se:et,vt=vt==Y?Se:vt;var yt=et==Se,kt=vt==Se,Wt=et==vt;if(Wt&&B(g)){if(!B(M))return!1;je=!0,yt=!1}if(Wt&&!yt)return xe||(xe=new Ui),je||ar(g)?yl(g,M,A,j,ie,xe):om(g,M,et,A,j,ie,xe);if(!(A&p)){var ur=yt&&on.call(g,"__wrapped__"),kr=kt&&on.call(M,"__wrapped__");if(ur||kr){var Yr=ur?g.value():g,Ir=kr?M.value():M;return xe||(xe=new Ui),ie(Yr,Ir,A,j,xe)}}return Wt?(xe||(xe=new Ui),vh(g,M,A,j,ie,xe)):!1}function ah(g){return Oe(g)&&Yn(g)==we}function xa(g,M,A,j){var ie=A.length,xe=ie,je=!j;if(g==null)return!xe;for(g=dn(g);ie--;){var Ke=A[ie];if(je&&Ke[2]?Ke[1]!==g[Ke[0]]:!(Ke[0]in g))return!1}for(;++ie<xe;){Ke=A[ie];var et=Ke[0],vt=g[et],yt=Ke[1];if(je&&Ke[2]){if(vt===r&&!(et in g))return!1}else{var kt=new Ui;if(j)var Wt=j(vt,yt,et,g,M,kt);if(!(Wt===r?Go(yt,vt,p|w,j,kt):Wt))return!1}}return!0}function Bc(g){if(!Ae(g)||lm(g))return!1;var M=Te(g)?Yp:bn;return M.test(Ts(g))}function zc(g){return Oe(g)&&_i(g)==rt}function lh(g){return Oe(g)&&Yn(g)==nt}function jc(g){return Oe(g)&&_e(g.length)&&!!qr[_i(g)]}function mu(g){return typeof g=="function"?g:g==null?Js:typeof g=="object"?S(g)?Gc(g[0],g[1]):Wc(g):P1(g)}function gu(g){if(!Yo(g))return vc(g);var M=[];for(var A in dn(g))on.call(g,A)&&A!="constructor"&&M.push(A);return M}function Nc(g){if(!Ae(g))return cm(g);var M=Yo(g),A=[];for(var j in g)j=="constructor"&&(M||!on.call(g,j))||A.push(j);return A}function Uc(g,M){return g<M}function Vc(g,M){var A=-1,j=I(g)?ot(g.length):[];return _s(g,function(ie,xe,je){j[++A]=M(ie,xe,je)}),j}function Wc(g){var M=Iu(g);return M.length==1&&M[0][2]?xd(M[0][0],M[0][1]):function(A){return A===g||xa(A,g,M)}}function Gc(g,M){return Fu(g)&&wd(M)?xd(ns(g),M):function(A){var j=cy(A,g);return j===r&&j===M?dy(A,g):Go(M,j,p|w)}}function ba(g,M,A,j,ie){g!==M&&pl(M,function(xe,je){if(ie||(ie=new Ui),Ae(xe))uh(g,M,je,A,ba,j,ie);else{var Ke=j?j(Tl(g,je),xe,je+"",g,M,ie):r;Ke===r&&(Ke=xe),su(g,je,Ke)}},Qs)}function uh(g,M,A,j,ie,xe,je){var Ke=Tl(g,A),et=Tl(M,A),vt=je.get(et);if(vt){su(g,A,vt);return}var yt=xe?xe(Ke,et,A+"",g,M,je):r,kt=yt===r;if(kt){var Wt=S(et),ur=!Wt&&B(et),kr=!Wt&&!ur&&ar(et);yt=et,Wt||ur||kr?S(Ke)?yt=Ke:k(Ke)?yt=vi(Ke):ur?(kt=!1,yt=Mu(et,!0)):kr?(kt=!1,yt=ad(et,!0)):yt=[]:Kt(et)||b(et)?(yt=Ke,b(Ke)?yt=Tp(Ke):(!Ae(Ke)||Te(Ke))&&(yt=xh(et))):kt=!1}kt&&(je.set(et,yt),ie(yt,et,j,xe,je),je.delete(et)),su(g,A,yt)}function Hc(g,M){var A=g.length;if(!!A)return M+=M<0?A:0,Hi(M,A)?g[M]:r}function Kc(g,M,A){M.length?M=_n(M,function(xe){return S(xe)?function(je){return Gs(je,xe.length===1?xe[0]:xe)}:xe}):M=[Js];var j=-1;M=_n(M,Rn(fr()));var ie=Vc(g,function(xe,je,Ke){var et=_n(M,function(vt){return vt(xe)});return{criteria:et,index:++j,value:xe}});return Cf(ie,function(xe,je){return im(xe,je,A)})}function ch(g,M){return Xc(g,M,function(A,j){return dy(g,j)})}function Xc(g,M,A){for(var j=-1,ie=M.length,xe={};++j<ie;){var je=M[j],Ke=Gs(g,je);A(Ke,je)&&Sa(xe,Ks(je,g),Ke)}return xe}function tm(g){return function(M){return Gs(M,g)}}function Ma(g,M,A,j){var ie=j?Sf:Ao,xe=-1,je=M.length,Ke=g;for(g===M&&(M=vi(M)),A&&(Ke=_n(g,Rn(A)));++xe<je;)for(var et=0,vt=M[xe],yt=A?A(vt):vt;(et=ie(Ke,yt,et,j))>-1;)Ke!==g&&sl.call(Ke,et,1),sl.call(g,et,1);return g}function Ta(g,M){for(var A=g?M.length:0,j=A-1;A--;){var ie=M[A];if(A==j||ie!==xe){var xe=ie;Hi(ie)?sl.call(g,ie,1):yu(g,ie)}}return g}function gl(g,M){return g+al(wc()*(M-g+1))}function Yc(g,M,A,j){for(var ie=-1,xe=Cn(pa((M-g)/(A||1)),0),je=ot(xe);xe--;)je[j?xe:++ie]=g,g+=A;return je}function _u(g,M){var A="";if(!g||M<1||M>ve)return A;do M%2&&(A+=g),M=al(M/2),M&&(g+=g);while(M);return A}function Rr(g,M){return Sl(bl(g,M,Js),g+"")}function qc(g){return Bn(Pm(g))}function Qc(g,M){var A=Pm(g);return Aa(A,ts(M,0,A.length))}function Sa(g,M,A,j){if(!Ae(g))return g;M=Ks(M,g);for(var ie=-1,xe=M.length,je=xe-1,Ke=g;Ke!=null&&++ie<xe;){var et=ns(M[ie]),vt=A;if(et==="__proto__"||et==="constructor"||et==="prototype")return g;if(ie!=je){var yt=Ke[et];vt=j?j(yt,et,Ke):r,vt===r&&(vt=Ae(yt)?yt:Hi(M[ie+1])?[]:{})}fl(Ke,et,vt),Ke=Ke[et]}return g}var Jc=cl?function(g,M){return cl.set(g,M),g}:Js,dh=ol?function(g,M){return ol(g,"toString",{configurable:!0,enumerable:!1,value:hy(M),writable:!0})}:Js;function fh(g){return Aa(Pm(g))}function Di(g,M,A){var j=-1,ie=g.length;M<0&&(M=-M>ie?0:ie+M),A=A>ie?ie:A,A<0&&(A+=ie),ie=M>A?0:A-M>>>0,M>>>=0;for(var xe=ot(ie);++j<ie;)xe[j]=g[j+M];return xe}function Zc(g,M){var A;return _s(g,function(j,ie,xe){return A=M(j,ie,xe),!A}),!!A}function Ca(g,M,A){var j=0,ie=g==null?j:g.length;if(typeof M=="number"&&M===M&&ie<=ae){for(;j<ie;){var xe=j+ie>>>1,je=g[xe];je!==null&&!$r(je)&&(A?je<=M:je<M)?j=xe+1:ie=xe}return ie}return vu(g,M,Js,A)}function vu(g,M,A,j){var ie=0,xe=g==null?0:g.length;if(xe===0)return 0;M=A(M);for(var je=M!==M,Ke=M===null,et=$r(M),vt=M===r;ie<xe;){var yt=al((ie+xe)/2),kt=A(g[yt]),Wt=kt!==r,ur=kt===null,kr=kt===kt,Yr=$r(kt);if(je)var Ir=j||kr;else vt?Ir=kr&&(j||Wt):Ke?Ir=kr&&Wt&&(j||!ur):et?Ir=kr&&Wt&&!ur&&(j||!Yr):ur||Yr?Ir=!1:Ir=j?kt<=M:kt<M;Ir?ie=yt+1:xe=yt}return ii(xe,N)}function ed(g,M){for(var A=-1,j=g.length,ie=0,xe=[];++A<j;){var je=g[A],Ke=M?M(je):je;if(!A||!mn(Ke,et)){var et=Ke;xe[ie++]=je===0?0:je}}return xe}function td(g){return typeof g=="number"?g:$r(g)?re:+g}function Ci(g){if(typeof g=="string")return g;if(S(g))return _n(g,Ci)+"";if($r(g))return Tc?Tc.call(g):"";var M=g+"";return M=="0"&&1/g==-ke?"-0":M}function Hs(g,M,A){var j=-1,ie=ua,xe=g.length,je=!0,Ke=[],et=Ke;if(A)je=!1,ie=Ul;else if(xe>=a){var vt=M?null:_h(g);if(vt)return da(vt);je=!1,ie=el,et=new ho}else et=M?[]:Ke;e:for(;++j<xe;){var yt=g[j],kt=M?M(yt):yt;if(yt=A||yt!==0?yt:0,je&&kt===kt){for(var Wt=et.length;Wt--;)if(et[Wt]===kt)continue e;M&&et.push(kt),Ke.push(yt)}else ie(et,kt,A)||(et!==Ke&&et.push(kt),Ke.push(yt))}return Ke}function yu(g,M){return M=Ks(M,g),g=Eh(g,M),g==null||delete g[ns(Fi(M))]}function rd(g,M,A,j){return Sa(g,M,A(Gs(g,M)),j)}function _l(g,M,A,j){for(var ie=g.length,xe=j?ie:-1;(j?xe--:++xe<ie)&&M(g[xe],xe,g););return A?Di(g,j?0:xe,j?xe+1:ie):Di(g,j?xe+1:0,j?ie:xe)}function nd(g,M){var A=g;return A instanceof Vr&&(A=A.value()),ui(M,function(j,ie){return ie.func.apply(ie.thisArg,Bs([j],ie.args))},A)}function wu(g,M,A){var j=g.length;if(j<2)return j?Hs(g[0]):[];for(var ie=-1,xe=ot(j);++ie<j;)for(var je=g[ie],Ke=-1;++Ke<j;)Ke!=ie&&(xe[ie]=Wo(xe[ie]||je,g[Ke],M,A));return Hs(Xn(xe,1),M,A)}function id(g,M,A){for(var j=-1,ie=g.length,xe=M.length,je={};++j<ie;){var Ke=j<xe?M[j]:r;A(je,g[j],Ke)}return je}function xu(g){return k(g)?g:[]}function bu(g){return typeof g=="function"?g:Js}function Ks(g,M){return S(g)?g:Fu(g,M)?[g]:Lu(Or(g))}var rm=Rr;function Xs(g,M,A){var j=g.length;return A=A===r?j:A,!M&&A>=j?g:Di(g,M,A)}var sd=mc||function(g){return Kr.clearTimeout(g)};function Mu(g,M){if(M)return g.slice();var A=g.length,j=hc?hc(A):new g.constructor(A);return g.copy(j),j}function Tu(g){var M=new g.constructor(g.byteLength);return new nl(M).set(new nl(g)),M}function nm(g,M){var A=M?Tu(g.buffer):g.buffer;return new g.constructor(A,g.byteOffset,g.byteLength)}function od(g){var M=new g.constructor(g.source,Sn.exec(g));return M.lastIndex=g.lastIndex,M}function hh(g){return jo?dn(jo.call(g)):{}}function ad(g,M){var A=M?Tu(g.buffer):g.buffer;return new g.constructor(A,g.byteOffset,g.length)}function Ys(g,M){if(g!==M){var A=g!==r,j=g===null,ie=g===g,xe=$r(g),je=M!==r,Ke=M===null,et=M===M,vt=$r(M);if(!Ke&&!vt&&!xe&&g>M||xe&&je&&et&&!Ke&&!vt||j&&je&&et||!A&&et||!ie)return 1;if(!j&&!xe&&!vt&&g<M||vt&&A&&ie&&!j&&!xe||Ke&&A&&ie||!je&&ie||!et)return-1}return 0}function im(g,M,A){for(var j=-1,ie=g.criteria,xe=M.criteria,je=ie.length,Ke=A.length;++j<je;){var et=Ys(ie[j],xe[j]);if(et){if(j>=Ke)return et;var vt=A[j];return et*(vt=="desc"?-1:1)}}return g.index-M.index}function ld(g,M,A,j){for(var ie=-1,xe=g.length,je=A.length,Ke=-1,et=M.length,vt=Cn(xe-je,0),yt=ot(et+vt),kt=!j;++Ke<et;)yt[Ke]=M[Ke];for(;++ie<je;)(kt||ie<xe)&&(yt[A[ie]]=g[ie]);for(;vt--;)yt[Ke++]=g[ie++];return yt}function ud(g,M,A,j){for(var ie=-1,xe=g.length,je=-1,Ke=A.length,et=-1,vt=M.length,yt=Cn(xe-Ke,0),kt=ot(yt+vt),Wt=!j;++ie<yt;)kt[ie]=g[ie];for(var ur=ie;++et<vt;)kt[ur+et]=M[et];for(;++je<Ke;)(Wt||ie<xe)&&(kt[ur+A[je]]=g[ie++]);return kt}function vi(g,M){var A=-1,j=g.length;for(M||(M=ot(j));++A<j;)M[A]=g[A];return M}function Vi(g,M,A,j){var ie=!A;A||(A={});for(var xe=-1,je=M.length;++xe<je;){var Ke=M[xe],et=j?j(A[Ke],g[Ke],Ke,A,g):r;et===r&&(et=g[Ke]),ie?gs(A,Ke,et):fl(A,Ke,et)}return A}function sm(g,M){return Vi(g,Du(g),M)}function vs(g,M){return Vi(g,yd(g),M)}function Wi(g,M){return function(A,j){var ie=S(A)?Tf:Ic,xe=M?M():{};return ie(A,g,fr(j,2),xe)}}function Gi(g){return Rr(function(M,A){var j=-1,ie=A.length,xe=ie>1?A[ie-1]:r,je=ie>2?A[2]:r;for(xe=g.length>3&&typeof xe=="function"?(ie--,xe):r,je&&yi(A[0],A[1],je)&&(xe=ie<3?r:xe,ie=1),M=dn(M);++j<ie;){var Ke=A[j];Ke&&g(M,Ke,j,xe)}return M})}function ys(g,M){return function(A,j){if(A==null)return A;if(!I(A))return g(A,j);for(var ie=A.length,xe=M?ie:-1,je=dn(A);(M?xe--:++xe<ie)&&j(je[xe],xe,je)!==!1;);return A}}function cd(g){return function(M,A,j){for(var ie=-1,xe=dn(M),je=j(M),Ke=je.length;Ke--;){var et=je[g?Ke:++ie];if(A(xe[et],et,xe)===!1)break}return M}}function ph(g,M,A){var j=M&_,ie=Ea(g);function xe(){var je=this&&this!==Kr&&this instanceof xe?ie:g;return je.apply(j?A:this,arguments)}return xe}function dd(g){return function(M){M=Or(M);var A=ci(M)?Pn(M):r,j=A?A[0]:M.charAt(0),ie=A?Xs(A,1).join(""):M.slice(1);return j[g]()+ie}}function ws(g){return function(M){return ui(C1(S1(M).replace(li,"")),g,"")}}function Ea(g){return function(){var M=arguments;switch(M.length){case 0:return new g;case 1:return new g(M[0]);case 2:return new g(M[0],M[1]);case 3:return new g(M[0],M[1],M[2]);case 4:return new g(M[0],M[1],M[2],M[3]);case 5:return new g(M[0],M[1],M[2],M[3],M[4]);case 6:return new g(M[0],M[1],M[2],M[3],M[4],M[5]);case 7:return new g(M[0],M[1],M[2],M[3],M[4],M[5],M[6])}var A=No(g.prototype),j=g.apply(A,M);return Ae(j)?j:A}}function mh(g,M,A){var j=Ea(g);function ie(){for(var xe=arguments.length,je=ot(xe),Ke=xe,et=Ko(ie);Ke--;)je[Ke]=arguments[Ke];var vt=xe<3&&je[0]!==et&&je[xe-1]!==et?[]:js(je,et);if(xe-=vt.length,xe<A)return xs(g,M,Ho,ie.placeholder,r,je,vt,r,r,A-xe);var yt=this&&this!==Kr&&this instanceof ie?j:g;return mi(yt,this,je)}return ie}function fd(g){return function(M,A,j){var ie=dn(M);if(!I(M)){var xe=fr(A,3);M=Ri(M),A=function(Ke){return xe(ie[Ke],Ke,ie)}}var je=g(M,A,j);return je>-1?ie[xe?M[je]:je]:r}}function hd(g){return Ms(function(M){var A=M.length,j=A,ie=Si.prototype.thru;for(g&&M.reverse();j--;){var xe=M[j];if(typeof xe!="function")throw new gi(x);if(ie&&!je&&Oa(xe)=="wrapper")var je=new Si([],!0)}for(j=je?j:A;++j<A;){xe=M[j];var Ke=Oa(xe),et=Ke=="wrapper"?ku(xe):r;et&&xl(et[0])&&et[1]==(D|T|P|L)&&!et[4].length&&et[9]==1?je=je[Oa(et[0])].apply(je,et[3]):je=xe.length==1&&xl(xe)?je[Ke]():je.thru(xe)}return function(){var vt=arguments,yt=vt[0];if(je&&vt.length==1&&S(yt))return je.plant(yt).value();for(var kt=0,Wt=A?M[kt].apply(this,vt):yt;++kt<A;)Wt=M[kt].call(this,Wt);return Wt}})}function Ho(g,M,A,j,ie,xe,je,Ke,et,vt){var yt=M&D,kt=M&_,Wt=M&v,ur=M&(T|C),kr=M&W,Yr=Wt?r:Ea(g);function Ir(){for(var en=arguments.length,ln=ot(en),vo=en;vo--;)ln[vo]=arguments[vo];if(ur)var Ss=Ko(Ir),yo=Xp(ln,Ss);if(j&&(ln=ld(ln,j,ie,ur)),xe&&(ln=ud(ln,xe,je,ur)),en-=yo,ur&&en<vt){var di=js(ln,Ss);return xs(g,M,Ho,Ir.placeholder,A,ln,di,Ke,et,vt-en)}var $a=kt?A:this,ju=Wt?$a[g]:g;return en=ln.length,Ke?ln=Ml(ln,Ke):kr&&en>1&&ln.reverse(),yt&&et<en&&(ln.length=et),this&&this!==Kr&&this instanceof Ir&&(ju=Yr||Ea(ju)),ju.apply($a,ln)}return Ir}function pd(g,M){return function(A,j){return $c(A,g,M(j),{})}}function Su(g,M){return function(A,j){var ie;if(A===r&&j===r)return M;if(A!==r&&(ie=A),j!==r){if(ie===r)return j;typeof A=="string"||typeof j=="string"?(A=Ci(A),j=Ci(j)):(A=td(A),j=td(j)),ie=g(A,j)}return ie}}function si(g){return Ms(function(M){return M=_n(M,Rn(fr())),Rr(function(A){var j=this;return g(M,function(ie){return mi(ie,j,A)})})})}function Cu(g,M){M=M===r?" ":Ci(M);var A=M.length;if(A<2)return A?_u(M,g):M;var j=_u(M,pa(g/Do(M)));return ci(M)?Xs(Pn(j),0,g).join(""):j.slice(0,g)}function gh(g,M,A,j){var ie=M&_,xe=Ea(g);function je(){for(var Ke=-1,et=arguments.length,vt=-1,yt=j.length,kt=ot(yt+et),Wt=this&&this!==Kr&&this instanceof je?xe:g;++vt<yt;)kt[vt]=j[vt];for(;et--;)kt[vt++]=arguments[++Ke];return mi(Wt,ie?A:this,kt)}return je}function Eu(g){return function(M,A,j){return j&&typeof j!="number"&&yi(M,A,j)&&(A=j=r),M=qs(M),A===r?(A=M,M=0):A=qs(A),j=j===r?M<A?1:-1:qs(j),Yc(M,A,j,g)}}function vl(g){return function(M,A){return typeof M=="string"&&typeof A=="string"||(M=wi(M),A=wi(A)),g(M,A)}}function xs(g,M,A,j,ie,xe,je,Ke,et,vt){var yt=M&T,kt=yt?je:r,Wt=yt?r:je,ur=yt?xe:r,kr=yt?r:xe;M|=yt?P:O,M&=~(yt?O:P),M&y||(M&=~(_|v));var Yr=[g,M,ie,ur,kt,kr,Wt,Ke,et,vt],Ir=A.apply(r,Yr);return xl(g)&&Ia(Ir,Yr),Ir.placeholder=j,Td(Ir,g,M)}function Pu(g){var M=Dn[g];return function(A,j){if(A=wi(A),j=j==null?0:ii(zr(j),292),j&&_c(A)){var ie=(Or(A)+"e").split("e"),xe=M(ie[0]+"e"+(+ie[1]+j));return ie=(Or(xe)+"e").split("e"),+(ie[0]+"e"+(+ie[1]-j))}return M(A)}}var _h=$o&&1/da(new $o([,-0]))[1]==ke?function(g){return new $o(g)}:gy;function md(g){return function(M){var A=Yn(M);return A==we?Ql(M):A==nt?If(M):Ef(M,g(M))}}function bs(g,M,A,j,ie,xe,je,Ke){var et=M&v;if(!et&&typeof g!="function")throw new gi(x);var vt=j?j.length:0;if(vt||(M&=~(P|O),j=ie=r),je=je===r?je:Cn(zr(je),0),Ke=Ke===r?Ke:zr(Ke),vt-=ie?ie.length:0,M&O){var yt=j,kt=ie;j=ie=r}var Wt=et?r:ku(g),ur=[g,M,A,j,ie,yt,kt,xe,je,Ke];if(Wt&&um(ur,Wt),g=ur[0],M=ur[1],A=ur[2],j=ur[3],ie=ur[4],Ke=ur[9]=ur[9]===r?et?0:g.length:Cn(ur[9]-vt,0),!Ke&&M&(T|C)&&(M&=~(T|C)),!M||M==_)var kr=ph(g,M,A);else M==T||M==C?kr=mh(g,M,Ke):(M==P||M==(_|P))&&!ie.length?kr=gh(g,M,A,j):kr=Ho.apply(r,ur);var Yr=Wt?Jc:Ia;return Td(Yr(kr,ur),g,M)}function gd(g,M,A,j){return g===r||mn(g,Fo[A])&&!on.call(j,A)?M:g}function _d(g,M,A,j,ie,xe){return Ae(g)&&Ae(M)&&(xe.set(M,g),ba(g,M,r,_d,xe),xe.delete(M)),g}function vd(g){return Kt(g)?r:g}function yl(g,M,A,j,ie,xe){var je=A&p,Ke=g.length,et=M.length;if(Ke!=et&&!(je&&et>Ke))return!1;var vt=xe.get(g),yt=xe.get(M);if(vt&&yt)return vt==M&&yt==g;var kt=-1,Wt=!0,ur=A&w?new ho:r;for(xe.set(g,M),xe.set(M,g);++kt<Ke;){var kr=g[kt],Yr=M[kt];if(j)var Ir=je?j(Yr,kr,kt,M,g,xe):j(kr,Yr,kt,g,M,xe);if(Ir!==r){if(Ir)continue;Wt=!1;break}if(ur){if(!Vl(M,function(en,ln){if(!el(ur,ln)&&(kr===en||ie(kr,en,A,j,xe)))return ur.push(ln)})){Wt=!1;break}}else if(!(kr===Yr||ie(kr,Yr,A,j,xe))){Wt=!1;break}}return xe.delete(g),xe.delete(M),Wt}function om(g,M,A,j,ie,xe,je){switch(A){case Ct:if(g.byteLength!=M.byteLength||g.byteOffset!=M.byteOffset)return!1;g=g.buffer,M=M.buffer;case bt:return!(g.byteLength!=M.byteLength||!xe(new nl(g),new nl(M)));case Ue:case Ve:case Re:return mn(+g,+M);case he:return g.name==M.name&&g.message==M.message;case rt:case Ge:return g==M+"";case we:var Ke=Ql;case nt:var et=j&p;if(Ke||(Ke=da),g.size!=M.size&&!et)return!1;var vt=je.get(g);if(vt)return vt==M;j|=w,je.set(g,M);var yt=yl(Ke(g),Ke(M),j,ie,xe,je);return je.delete(g),yt;case qe:if(jo)return jo.call(g)==jo.call(M)}return!1}function vh(g,M,A,j,ie,xe){var je=A&p,Ke=Pa(g),et=Ke.length,vt=Pa(M),yt=vt.length;if(et!=yt&&!je)return!1;for(var kt=et;kt--;){var Wt=Ke[kt];if(!(je?Wt in M:on.call(M,Wt)))return!1}var ur=xe.get(g),kr=xe.get(M);if(ur&&kr)return ur==M&&kr==g;var Yr=!0;xe.set(g,M),xe.set(M,g);for(var Ir=je;++kt<et;){Wt=Ke[kt];var en=g[Wt],ln=M[Wt];if(j)var vo=je?j(ln,en,Wt,M,g,xe):j(en,ln,Wt,g,M,xe);if(!(vo===r?en===ln||ie(en,ln,A,j,xe):vo)){Yr=!1;break}Ir||(Ir=Wt=="constructor")}if(Yr&&!Ir){var Ss=g.constructor,yo=M.constructor;Ss!=yo&&"constructor"in g&&"constructor"in M&&!(typeof Ss=="function"&&Ss instanceof Ss&&typeof yo=="function"&&yo instanceof yo)&&(Yr=!1)}return xe.delete(g),xe.delete(M),Yr}function Ms(g){return Sl(bl(g,r,Id),g+"")}function Pa(g){return Lc(g,Ri,Du)}function Ou(g){return Lc(g,Qs,yd)}var ku=cl?function(g){return cl.get(g)}:gy;function Oa(g){for(var M=g.name+"",A=Bo[M],j=on.call(Bo,M)?A.length:0;j--;){var ie=A[j],xe=ie.func;if(xe==null||xe==g)return ie.name}return M}function Ko(g){var M=on.call(ge,"placeholder")?ge:g;return M.placeholder}function fr(){var g=ge.iteratee||py;return g=g===py?mu:g,arguments.length?g(arguments[0],arguments[1]):g}function ka(g,M){var A=g.__data__;return Sh(M)?A[typeof M=="string"?"string":"hash"]:A.map}function Iu(g){for(var M=Ri(g),A=M.length;A--;){var j=M[A],ie=g[j];M[A]=[j,ie,wd(ie)]}return M}function Xo(g,M){var A=ac(g,M);return Bc(A)?A:r}function Au(g){var M=on.call(g,co),A=g[co];try{g[co]=r;var j=!0}catch{}var ie=rl.call(g);return j&&(M?g[co]=A:delete g[co]),ie}var Du=ru?function(g){return g==null?[]:(g=dn(g),hs(ru(g),function(M){return tu.call(g,M)}))}:_y,yd=ru?function(g){for(var M=[];g;)Bs(M,Du(g)),g=il(g);return M}:_y,Yn=_i;(nu&&Yn(new nu(new ArrayBuffer(1)))!=Ct||ma&&Yn(new ma)!=we||ul&&Yn(ul.resolve())!=Ne||$o&&Yn(new $o)!=nt||ga&&Yn(new ga)!=ct)&&(Yn=function(g){var M=_i(g),A=M==Se?g.constructor:r,j=A?Ts(A):"";if(j)switch(j){case Vf:return Ct;case Wf:return we;case bc:return Ne;case Mc:return nt;case Gf:return ct}return M});function am(g,M,A){for(var j=-1,ie=A.length;++j<ie;){var xe=A[j],je=xe.size;switch(xe.type){case"drop":g+=je;break;case"dropRight":M-=je;break;case"take":M=ii(M,g+je);break;case"takeRight":g=Cn(g,M-je);break}}return{start:g,end:M}}function yh(g){var M=g.match(nr);return M?M[1].split(vr):[]}function wl(g,M,A){M=Ks(M,g);for(var j=-1,ie=M.length,xe=!1;++j<ie;){var je=ns(M[j]);if(!(xe=g!=null&&A(g,je)))break;g=g[je]}return xe||++j!=ie?xe:(ie=g==null?0:g.length,!!ie&&_e(ie)&&Hi(je,ie)&&(S(g)||b(g)))}function wh(g){var M=g.length,A=new g.constructor(M);return M&&typeof g[0]=="string"&&on.call(g,"index")&&(A.index=g.index,A.input=g.input),A}function xh(g){return typeof g.constructor=="function"&&!Yo(g)?No(il(g)):{}}function bh(g,M,A){var j=g.constructor;switch(M){case bt:return Tu(g);case Ue:case Ve:return new j(+g);case Ct:return nm(g,A);case It:case jt:case Fr:case lr:case cr:case gn:case Jr:case Zn:case ai:return ad(g,A);case we:return new j;case Re:case Ge:return new j(g);case rt:return od(g);case nt:return new j;case qe:return hh(g)}}function Mh(g,M){var A=M.length;if(!A)return g;var j=A-1;return M[j]=(A>1?"& ":"")+M[j],M=M.join(A>2?", ":" "),g.replace(pt,`{
/* [wrapped with `+M+`] */
`)}function Th(g){return S(g)||b(g)||!!(pc&&g&&g[pc])}function Hi(g,M){var A=typeof g;return M=M==null?ve:M,!!M&&(A=="number"||A!="symbol"&&ir.test(g))&&g>-1&&g%1==0&&g<M}function yi(g,M,A){if(!Ae(A))return!1;var j=typeof M;return(j=="number"?I(A)&&Hi(M,A.length):j=="string"&&M in A)?mn(A[M],g):!1}function Fu(g,M){if(S(g))return!1;var A=typeof g;return A=="number"||A=="symbol"||A=="boolean"||g==null||$r(g)?!0:H.test(g)||!As.test(g)||M!=null&&g in dn(M)}function Sh(g){var M=typeof g;return M=="string"||M=="number"||M=="symbol"||M=="boolean"?g!=="__proto__":g===null}function xl(g){var M=Oa(g),A=ge[M];if(typeof A!="function"||!(M in Vr.prototype))return!1;if(g===A)return!0;var j=ku(A);return!!j&&g===j[0]}function lm(g){return!!dc&&dc in g}var Ch=Ns?Te:vy;function Yo(g){var M=g&&g.constructor,A=typeof M=="function"&&M.prototype||Fo;return g===A}function wd(g){return g===g&&!Ae(g)}function xd(g,M){return function(A){return A==null?!1:A[g]===M&&(M!==r||g in dn(A))}}function bd(g){var M=R(g,function(j){return A.size===d&&A.clear(),j}),A=M.cache;return M}function um(g,M){var A=g[1],j=M[1],ie=A|j,xe=ie<(_|v|D),je=j==D&&A==T||j==D&&A==L&&g[7].length<=M[8]||j==(D|L)&&M[7].length<=M[8]&&A==T;if(!(xe||je))return g;j&_&&(g[2]=M[2],ie|=A&_?0:y);var Ke=M[3];if(Ke){var et=g[3];g[3]=et?ld(et,Ke,M[4]):Ke,g[4]=et?js(g[3],m):M[4]}return Ke=M[5],Ke&&(et=g[5],g[5]=et?ud(et,Ke,M[6]):Ke,g[6]=et?js(g[5],m):M[6]),Ke=M[7],Ke&&(g[7]=Ke),j&D&&(g[8]=g[8]==null?M[8]:ii(g[8],M[8])),g[9]==null&&(g[9]=M[9]),g[0]=M[0],g[1]=ie,g}function cm(g){var M=[];if(g!=null)for(var A in dn(g))M.push(A);return M}function Md(g){return rl.call(g)}function bl(g,M,A){return M=Cn(M===r?g.length-1:M,0),function(){for(var j=arguments,ie=-1,xe=Cn(j.length-M,0),je=ot(xe);++ie<xe;)je[ie]=j[M+ie];ie=-1;for(var Ke=ot(M+1);++ie<M;)Ke[ie]=j[ie];return Ke[M]=A(je),mi(g,this,Ke)}}function Eh(g,M){return M.length<2?g:Gs(g,Di(M,0,-1))}function Ml(g,M){for(var A=g.length,j=ii(M.length,A),ie=vi(g);j--;){var xe=M[j];g[j]=Hi(xe,A)?ie[xe]:r}return g}function Tl(g,M){if(!(M==="constructor"&&typeof g[M]=="function")&&M!="__proto__")return g[M]}var Ia=Cl(Jc),qo=Nf||function(g,M){return Kr.setTimeout(g,M)},Sl=Cl(dh);function Td(g,M,A){var j=M+"";return Sl(g,Mh(j,Sd(yh(j),A)))}function Cl(g){var M=0,A=0;return function(){var j=yc(),ie=ne-(j-A);if(A=j,ie>0){if(++M>=pe)return arguments[0]}else M=0;return g.apply(r,arguments)}}function Aa(g,M){var A=-1,j=g.length,ie=j-1;for(M=M===r?j:M;++A<M;){var xe=gl(A,ie),je=g[xe];g[xe]=g[A],g[A]=je}return g.length=M,g}var Lu=bd(function(g){var M=[];return g.charCodeAt(0)===46&&M.push(""),g.replace(Pe,function(A,j,ie,xe){M.push(ie?xe.replace(qt,"$1"):j||A)}),M});function ns(g){if(typeof g=="string"||$r(g))return g;var M=g+"";return M=="0"&&1/g==-ke?"-0":M}function Ts(g){if(g!=null){try{return tl.call(g)}catch{}try{return g+""}catch{}}return""}function Sd(g,M){return ki(J,function(A){var j="_."+A[0];M&A[1]&&!ua(g,j)&&g.push(j)}),g.sort()}function Cd(g){if(g instanceof Vr)return g.clone();var M=new Si(g.__wrapped__,g.__chain__);return M.__actions__=vi(g.__actions__),M.__index__=g.__index__,M.__values__=g.__values__,M}function Ph(g,M,A){(A?yi(g,M,A):M===r)?M=1:M=Cn(zr(M),0);var j=g==null?0:g.length;if(!j||M<1)return[];for(var ie=0,xe=0,je=ot(pa(j/M));ie<j;)je[xe++]=Di(g,ie,ie+=M);return je}function Ed(g){for(var M=-1,A=g==null?0:g.length,j=0,ie=[];++M<A;){var xe=g[M];xe&&(ie[j++]=xe)}return ie}function Oh(){var g=arguments.length;if(!g)return[];for(var M=ot(g-1),A=arguments[0],j=g;j--;)M[j-1]=arguments[j];return Bs(S(A)?vi(A):[A],Xn(M,1))}var kh=Rr(function(g,M){return k(g)?Wo(g,Xn(M,1,k,!0)):[]}),Ih=Rr(function(g,M){var A=Fi(M);return k(A)&&(A=r),k(g)?Wo(g,Xn(M,1,k,!0),fr(A,2)):[]}),Ah=Rr(function(g,M){var A=Fi(M);return k(A)&&(A=r),k(g)?Wo(g,Xn(M,1,k,!0),r,A):[]});function dm(g,M,A){var j=g==null?0:g.length;return j?(M=A||M===r?1:zr(M),Di(g,M<0?0:M,j)):[]}function Dh(g,M,A){var j=g==null?0:g.length;return j?(M=A||M===r?1:zr(M),M=j-M,Di(g,0,M<0?0:M)):[]}function Pd(g,M){return g&&g.length?_l(g,fr(M,3),!0,!0):[]}function Fh(g,M){return g&&g.length?_l(g,fr(M,3),!0):[]}function Lh(g,M,A,j){var ie=g==null?0:g.length;return ie?(A&&typeof A!="number"&&yi(g,M,A)&&(A=0,j=ie),lu(g,M,A,j)):[]}function Od(g,M,A){var j=g==null?0:g.length;if(!j)return-1;var ie=A==null?0:zr(A);return ie<0&&(ie=Cn(j+ie,0)),Ja(g,fr(M,3),ie)}function kd(g,M,A){var j=g==null?0:g.length;if(!j)return-1;var ie=j-1;return A!==r&&(ie=zr(A),ie=A<0?Cn(j+ie,0):ii(ie,j-1)),Ja(g,fr(M,3),ie,!0)}function Id(g){var M=g==null?0:g.length;return M?Xn(g,1):[]}function $h(g){var M=g==null?0:g.length;return M?Xn(g,ke):[]}function fm(g,M){var A=g==null?0:g.length;return A?(M=M===r?1:zr(M),Xn(g,M)):[]}function $u(g){for(var M=-1,A=g==null?0:g.length,j={};++M<A;){var ie=g[M];j[ie[0]]=ie[1]}return j}function Ru(g){return g&&g.length?g[0]:r}function Ad(g,M,A){var j=g==null?0:g.length;if(!j)return-1;var ie=A==null?0:zr(A);return ie<0&&(ie=Cn(j+ie,0)),Ao(g,M,ie)}function Rh(g){var M=g==null?0:g.length;return M?Di(g,0,-1):[]}var Bh=Rr(function(g){var M=_n(g,xu);return M.length&&M[0]===g[0]?ya(M):[]}),zh=Rr(function(g){var M=Fi(g),A=_n(g,xu);return M===Fi(A)?M=r:A.pop(),A.length&&A[0]===g[0]?ya(A,fr(M,2)):[]}),Dd=Rr(function(g){var M=Fi(g),A=_n(g,xu);return M=typeof M=="function"?M:r,M&&A.pop(),A.length&&A[0]===g[0]?ya(A,r,M):[]});function jh(g,M){return g==null?"":ll.call(g,M)}function Fi(g){var M=g==null?0:g.length;return M?g[M-1]:r}function Nh(g,M,A){var j=g==null?0:g.length;if(!j)return-1;var ie=j;return A!==r&&(ie=zr(A),ie=ie<0?Cn(j+ie,0):ii(ie,j-1)),M===M?uc(g,M,ie):Ja(g,ic,ie,!0)}function Fd(g,M){return g&&g.length?Hc(g,zr(M)):r}var Uh=Rr(El);function El(g,M){return g&&g.length&&M&&M.length?Ma(g,M):g}function Vh(g,M,A){return g&&g.length&&M&&M.length?Ma(g,M,fr(A,2)):g}function Wh(g,M,A){return g&&g.length&&M&&M.length?Ma(g,M,r,A):g}var Gh=Ms(function(g,M){var A=g==null?0:g.length,j=hl(g,M);return Ta(g,_n(M,function(ie){return Hi(ie,A)?+ie:ie}).sort(Ys)),j});function Qr(g,M){var A=[];if(!(g&&g.length))return A;var j=-1,ie=[],xe=g.length;for(M=fr(M,3);++j<xe;){var je=g[j];M(je,j,g)&&(A.push(je),ie.push(j))}return Ta(g,ie),A}function Ld(g){return g==null?g:xc.call(g)}function hm(g,M,A){var j=g==null?0:g.length;return j?(A&&typeof A!="number"&&yi(g,M,A)?(M=0,A=j):(M=M==null?0:zr(M),A=A===r?j:zr(A)),Di(g,M,A)):[]}function Hh(g,M){return Ca(g,M)}function pm(g,M,A){return vu(g,M,fr(A,2))}function $d(g,M){var A=g==null?0:g.length;if(A){var j=Ca(g,M);if(j<A&&mn(g[j],M))return j}return-1}function Kh(g,M){return Ca(g,M,!0)}function Xh(g,M,A){return vu(g,M,fr(A,2),!0)}function Yh(g,M){var A=g==null?0:g.length;if(A){var j=Ca(g,M,!0)-1;if(mn(g[j],M))return j}return-1}function qh(g){return g&&g.length?ed(g):[]}function Rd(g,M){return g&&g.length?ed(g,fr(M,2)):[]}function Qh(g){var M=g==null?0:g.length;return M?Di(g,1,M):[]}function mm(g,M,A){return g&&g.length?(M=A||M===r?1:zr(M),Di(g,0,M<0?0:M)):[]}function Jh(g,M,A){var j=g==null?0:g.length;return j?(M=A||M===r?1:zr(M),M=j-M,Di(g,M<0?0:M,j)):[]}function Zh(g,M){return g&&g.length?_l(g,fr(M,3),!1,!0):[]}function ep(g,M){return g&&g.length?_l(g,fr(M,3)):[]}var tp=Rr(function(g){return Hs(Xn(g,1,k,!0))}),Pl=Rr(function(g){var M=Fi(g);return k(M)&&(M=r),Hs(Xn(g,1,k,!0),fr(M,2))}),gm=Rr(function(g){var M=Fi(g);return M=typeof M=="function"?M:r,Hs(Xn(g,1,k,!0),r,M)});function Bd(g){return g&&g.length?Hs(g):[]}function rp(g,M){return g&&g.length?Hs(g,fr(M,2)):[]}function np(g,M){return M=typeof M=="function"?M:r,g&&g.length?Hs(g,r,M):[]}function go(g){if(!(g&&g.length))return[];var M=0;return g=hs(g,function(A){if(k(A))return M=Cn(A.length,M),!0}),Za(M,function(A){return _n(g,Gl(A))})}function zd(g,M){if(!(g&&g.length))return[];var A=go(g);return M==null?A:_n(A,function(j){return mi(M,r,j)})}var _m=Rr(function(g,M){return k(g)?Wo(g,M):[]}),ip=Rr(function(g){return wu(hs(g,k))}),sp=Rr(function(g){var M=Fi(g);return k(M)&&(M=r),wu(hs(g,k),fr(M,2))}),op=Rr(function(g){var M=Fi(g);return M=typeof M=="function"?M:r,wu(hs(g,k),r,M)}),ap=Rr(go);function vm(g,M){return id(g||[],M||[],fl)}function jd(g,M){return id(g||[],M||[],Sa)}var ym=Rr(function(g){var M=g.length,A=M>1?g[M-1]:r;return A=typeof A=="function"?(g.pop(),A):r,zd(g,A)});function Nd(g){var M=ge(g);return M.__chain__=!0,M}function lp(g,M){return M(g),g}function Ol(g,M){return M(g)}var wm=Ms(function(g){var M=g.length,A=M?g[0]:0,j=this.__wrapped__,ie=function(xe){return hl(xe,g)};return M>1||this.__actions__.length||!(j instanceof Vr)||!Hi(A)?this.thru(ie):(j=j.slice(A,+A+(M?1:0)),j.__actions__.push({func:Ol,args:[ie],thisArg:r}),new Si(j,this.__chain__).thru(function(xe){return M&&!xe.length&&xe.push(r),xe}))});function up(){return Nd(this)}function cp(){return new Si(this.value(),this.__chain__)}function xm(){this.__values__===r&&(this.__values__=Ki(this.value()));var g=this.__index__>=this.__values__.length,M=g?r:this.__values__[this.__index__++];return{done:g,value:M}}function bm(){return this}function Ud(g){for(var M,A=this;A instanceof dl;){var j=Cd(A);j.__index__=0,j.__values__=r,M?ie.__wrapped__=j:M=j;var ie=j;A=A.__wrapped__}return ie.__wrapped__=g,M}function Mm(){var g=this.__wrapped__;if(g instanceof Vr){var M=g;return this.__actions__.length&&(M=new Vr(this)),M=M.reverse(),M.__actions__.push({func:Ol,args:[Ld],thisArg:r}),new Si(M,this.__chain__)}return this.thru(Ld)}function dp(){return nd(this.__wrapped__,this.__actions__)}var Tm=Wi(function(g,M,A){on.call(g,A)?++g[A]:gs(g,A,1)});function fp(g,M,A){var j=S(g)?tc:Jp;return A&&yi(g,M,A)&&(M=r),j(g,fr(M,3))}function hp(g,M){var A=S(g)?hs:va;return A(g,fr(M,3))}var pp=fd(Od),mp=fd(kd);function gp(g,M){return Xn(Da(g,M),1)}function Sm(g,M){return Xn(Da(g,M),ke)}function _p(g,M,A){return A=A===r?1:zr(A),Xn(Da(g,M),A)}function kl(g,M){var A=S(g)?ki:_s;return A(g,fr(M,3))}function Vd(g,M){var A=S(g)?br:Fc;return A(g,fr(M,3))}var vp=Wi(function(g,M,A){on.call(g,A)?g[A].push(M):gs(g,A,[M])});function Cm(g,M,A,j){g=I(g)?g:Pm(g),A=A&&!j?zr(A):0;var ie=g.length;return A<0&&(A=Cn(ie+A,0)),Lt(g)?A<=ie&&g.indexOf(M,A)>-1:!!ie&&Ao(g,M,A)>-1}var yp=Rr(function(g,M,A){var j=-1,ie=typeof M=="function",xe=I(g)?ot(g.length):[];return _s(g,function(je){xe[++j]=ie?mi(M,je,A):wa(je,M,A)}),xe}),Wd=Wi(function(g,M,A){gs(g,A,M)});function Da(g,M){var A=S(g)?_n:Vc;return A(g,fr(M,3))}function _o(g,M,A,j){return g==null?[]:(S(M)||(M=M==null?[]:[M]),A=j?r:A,S(A)||(A=A==null?[]:[A]),Kc(g,M,A))}var wp=Wi(function(g,M,A){g[A?0:1].push(M)},function(){return[[],[]]});function Gd(g,M,A){var j=S(g)?ui:Ii,ie=arguments.length<3;return j(g,fr(M,4),A,ie,_s)}function Bu(g,M,A){var j=S(g)?Kp:Ii,ie=arguments.length<3;return j(g,fr(M,4),A,ie,Fc)}function Hd(g,M){var A=S(g)?hs:va;return A(g,V(fr(M,3)))}function Kd(g){var M=S(g)?Bn:qc;return M(g)}function Xd(g,M,A){(A?yi(g,M,A):M===r)?M=1:M=zr(M);var j=S(g)?sh:Qc;return j(g,M)}function Yd(g){var M=S(g)?iu:fh;return M(g)}function qd(g){if(g==null)return 0;if(I(g))return Lt(g)?Do(g):g.length;var M=Yn(g);return M==we||M==nt?g.size:gu(g).length}function Qd(g,M,A){var j=S(g)?Vl:Zc;return A&&yi(g,M,A)&&(M=r),j(g,fr(M,3))}var xp=Rr(function(g,M){if(g==null)return[];var A=M.length;return A>1&&yi(g,M[0],M[1])?M=[]:A>2&&yi(M[0],M[1],M[2])&&(M=[M[0]]),Kc(g,Xn(M,1),[])}),is=jf||function(){return Kr.Date.now()};function Ei(g,M){if(typeof M!="function")throw new gi(x);return g=zr(g),function(){if(--g<1)return M.apply(this,arguments)}}function Fa(g,M,A){return M=A?r:M,M=g&&M==null?g.length:M,bs(g,D,r,r,r,r,M)}function mr(g,M){var A;if(typeof M!="function")throw new gi(x);return g=zr(g),function(){return--g>0&&(A=M.apply(this,arguments)),g<=1&&(M=r),A}}var Qo=Rr(function(g,M,A){var j=_;if(A.length){var ie=js(A,Ko(Qo));j|=P}return bs(g,j,M,A,ie)}),Tn=Rr(function(g,M,A){var j=_|v;if(A.length){var ie=js(A,Ko(Tn));j|=P}return bs(M,j,g,A,ie)});function On(g,M,A){M=A?r:M;var j=bs(g,T,r,r,r,r,r,M);return j.placeholder=On.placeholder,j}function Fn(g,M,A){M=A?r:M;var j=bs(g,C,r,r,r,r,r,M);return j.placeholder=Fn.placeholder,j}function Li(g,M,A){var j,ie,xe,je,Ke,et,vt=0,yt=!1,kt=!1,Wt=!0;if(typeof g!="function")throw new gi(x);M=wi(M)||0,Ae(A)&&(yt=!!A.leading,kt="maxWait"in A,xe=kt?Cn(wi(A.maxWait)||0,M):xe,Wt="trailing"in A?!!A.trailing:Wt);function ur(di){var $a=j,ju=ie;return j=ie=r,vt=di,je=g.apply(ju,$a),je}function kr(di){return vt=di,Ke=qo(en,M),yt?ur(di):je}function Yr(di){var $a=di-et,ju=di-vt,O1=M-$a;return kt?ii(O1,xe-ju):O1}function Ir(di){var $a=di-et,ju=di-vt;return et===r||$a>=M||$a<0||kt&&ju>=xe}function en(){var di=is();if(Ir(di))return ln(di);Ke=qo(en,Yr(di))}function ln(di){return Ke=r,Wt&&j?ur(di):(j=ie=r,je)}function vo(){Ke!==r&&sd(Ke),vt=0,j=et=ie=Ke=r}function Ss(){return Ke===r?je:ln(is())}function yo(){var di=is(),$a=Ir(di);if(j=arguments,ie=this,et=di,$a){if(Ke===r)return kr(et);if(kt)return sd(Ke),Ke=qo(en,M),ur(et)}return Ke===r&&(Ke=qo(en,M)),je}return yo.cancel=vo,yo.flush=Ss,yo}var La=Rr(function(g,M){return _a(g,1,M)}),bp=Rr(function(g,M,A){return _a(g,wi(M)||0,A)});function Mp(g){return bs(g,W)}function R(g,M){if(typeof g!="function"||M!=null&&typeof M!="function")throw new gi(x);var A=function(){var j=arguments,ie=M?M.apply(this,j):j[0],xe=A.cache;if(xe.has(ie))return xe.get(ie);var je=g.apply(this,j);return A.cache=xe.set(ie,je)||xe,je};return A.cache=new(R.Cache||ms),A}R.Cache=ms;function V(g){if(typeof g!="function")throw new gi(x);return function(){var M=arguments;switch(M.length){case 0:return!g.call(this);case 1:return!g.call(this,M[0]);case 2:return!g.call(this,M[0],M[1]);case 3:return!g.call(this,M[0],M[1],M[2])}return!g.apply(this,M)}}function oe(g){return mr(2,g)}var Ee=rm(function(g,M){M=M.length==1&&S(M[0])?_n(M[0],Rn(fr())):_n(Xn(M,1),Rn(fr()));var A=M.length;return Rr(function(j){for(var ie=-1,xe=ii(j.length,A);++ie<xe;)j[ie]=M[ie].call(this,j[ie]);return mi(g,this,j)})}),tt=Rr(function(g,M){var A=js(M,Ko(tt));return bs(g,P,r,M,A)}),Ze=Rr(function(g,M){var A=js(M,Ko(Ze));return bs(g,O,r,M,A)}),ut=Ms(function(g,M){return bs(g,L,r,r,r,M)});function xt(g,M){if(typeof g!="function")throw new gi(x);return M=M===r?M:zr(M),Rr(g,M)}function Pt(g,M){if(typeof g!="function")throw new gi(x);return M=M==null?0:Cn(zr(M),0),Rr(function(A){var j=A[M],ie=Xs(A,0,M);return j&&Bs(ie,j),mi(g,this,ie)})}function Bt(g,M,A){var j=!0,ie=!0;if(typeof g!="function")throw new gi(x);return Ae(A)&&(j="leading"in A?!!A.leading:j,ie="trailing"in A?!!A.trailing:ie),Li(g,M,{leading:j,maxWait:M,trailing:ie})}function Zt(g){return Fa(g,1)}function Er(g,M){return tt(bu(M),g)}function hr(){if(!arguments.length)return[];var g=arguments[0];return S(g)?g:[g]}function Pr(g){return Ai(g,u)}function sr(g,M){return M=typeof M=="function"?M:r,Ai(g,u,M)}function Sr(g){return Ai(g,o|u)}function Qt(g,M){return M=typeof M=="function"?M:r,Ai(g,o|u,M)}function Dr(g,M){return M==null||au(g,M,Ri(M))}function mn(g,M){return g===M||g!==g&&M!==M}var i=vl(ml),c=vl(function(g,M){return g>=M}),b=pu(function(){return arguments}())?pu:function(g){return Oe(g)&&on.call(g,"callee")&&!tu.call(g,"callee")},S=ot.isArray,E=Rs?Rn(Rs):Rc;function I(g){return g!=null&&_e(g.length)&&!Te(g)}function k(g){return Oe(g)&&I(g)}function $(g){return g===!0||g===!1||Oe(g)&&_i(g)==Ue}var B=gc||vy,z=Yt?Rn(Yt):Zp;function G(g){return Oe(g)&&g.nodeType===1&&!Kt(g)}function q(g){if(g==null)return!0;if(I(g)&&(S(g)||typeof g=="string"||typeof g.splice=="function"||B(g)||ar(g)||b(g)))return!g.length;var M=Yn(g);if(M==we||M==nt)return!g.size;if(Yo(g))return!gu(g).length;for(var A in g)if(on.call(g,A))return!1;return!0}function Z(g,M){return Go(g,M)}function se(g,M,A){A=typeof A=="function"?A:r;var j=A?A(g,M):r;return j===r?Go(g,M,r,A):!!j}function le(g){if(!Oe(g))return!1;var M=_i(g);return M==he||M==Ie||typeof g.message=="string"&&typeof g.name=="string"&&!Kt(g)}function me(g){return typeof g=="number"&&_c(g)}function Te(g){if(!Ae(g))return!1;var M=_i(g);return M==Fe||M==ee||M==Ce||M==ze}function de(g){return typeof g=="number"&&g==zr(g)}function _e(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=ve}function Ae(g){var M=typeof g;return g!=null&&(M=="object"||M=="function")}function Oe(g){return g!=null&&typeof g=="object"}var He=la?Rn(la):ah;function lt(g,M){return g===M||xa(g,M,Iu(M))}function it(g,M,A){return A=typeof A=="function"?A:r,xa(g,M,Iu(M),A)}function mt(g){return Vt(g)&&g!=+g}function Mt(g){if(Ch(g))throw new Tr(h);return Bc(g)}function At(g){return g===null}function $t(g){return g==null}function Vt(g){return typeof g=="number"||Oe(g)&&_i(g)==Re}function Kt(g){if(!Oe(g)||_i(g)!=Se)return!1;var M=il(g);if(M===null)return!0;var A=on.call(M,"constructor")&&M.constructor;return typeof A=="function"&&A instanceof A&&tl.call(A)==fc}var Mr=dt?Rn(dt):zc;function tr(g){return de(g)&&g>=-ve&&g<=ve}var Jt=Xt?Rn(Xt):lh;function Lt(g){return typeof g=="string"||!S(g)&&Oe(g)&&_i(g)==Ge}function $r(g){return typeof g=="symbol"||Oe(g)&&_i(g)==qe}var ar=ec?Rn(ec):jc;function Cr(g){return g===r}function St(g){return Oe(g)&&Yn(g)==ct}function Rt(g){return Oe(g)&&_i(g)==wt}var gr=vl(Uc),an=vl(function(g,M){return g<=M});function Ki(g){if(!g)return[];if(I(g))return Lt(g)?Pn(g):vi(g);if(Lo&&g[Lo])return ql(g[Lo]());var M=Yn(g),A=M==we?Ql:M==nt?da:Pm;return A(g)}function qs(g){if(!g)return g===0?g:0;if(g=wi(g),g===ke||g===-ke){var M=g<0?-1:1;return M*K}return g===g?g:0}function zr(g){var M=qs(g),A=M%1;return M===M?A?M-A:M:0}function Il(g){return g?ts(zr(g),0,X):0}function wi(g){if(typeof g=="number")return g;if($r(g))return re;if(Ae(g)){var M=typeof g.valueOf=="function"?g.valueOf():g;g=Ae(M)?M+"":M}if(typeof g!="string")return g===0?g:+g;g=Kl(g);var A=hi.test(g);return A||wr.test(g)?Br(g.slice(2),A?2:8):bi.test(g)?re:+g}function Tp(g){return Vi(g,Qs(g))}function $i(g){return g?ts(zr(g),-ve,ve):g===0?g:0}function Or(g){return g==null?"":Ci(g)}var zu=Gi(function(g,M){if(Yo(M)||I(M)){Vi(M,Ri(M),g);return}for(var A in M)on.call(M,A)&&fl(g,A,M[A])}),m_=Gi(function(g,M){Vi(M,Qs(M),g)}),Em=Gi(function(g,M,A,j){Vi(M,Qs(M),g,j)}),XS=Gi(function(g,M,A,j){Vi(M,Ri(M),g,j)}),YS=Ms(hl);function qS(g,M){var A=No(g);return M==null?A:ou(A,M)}var QS=Rr(function(g,M){g=dn(g);var A=-1,j=M.length,ie=j>2?M[2]:r;for(ie&&yi(M[0],M[1],ie)&&(j=1);++A<j;)for(var xe=M[A],je=Qs(xe),Ke=-1,et=je.length;++Ke<et;){var vt=je[Ke],yt=g[vt];(yt===r||mn(yt,Fo[vt])&&!on.call(g,vt))&&(g[vt]=xe[vt])}return g}),JS=Rr(function(g){return g.push(r,_d),mi(w1,r,g)});function ZS(g,M){return nc(g,fr(M,3),rs)}function eC(g,M){return nc(g,fr(M,3),cu)}function tC(g,M){return g==null?g:pl(g,fr(M,3),Qs)}function rC(g,M){return g==null?g:uu(g,fr(M,3),Qs)}function nC(g,M){return g&&rs(g,fr(M,3))}function iC(g,M){return g&&cu(g,fr(M,3))}function sC(g){return g==null?[]:du(g,Ri(g))}function oC(g){return g==null?[]:du(g,Qs(g))}function cy(g,M,A){var j=g==null?r:Gs(g,M);return j===r?A:j}function aC(g,M){return g!=null&&wl(g,M,fu)}function dy(g,M){return g!=null&&wl(g,M,oh)}var lC=pd(function(g,M,A){M!=null&&typeof M.toString!="function"&&(M=rl.call(M)),g[M]=A},hy(Js)),uC=pd(function(g,M,A){M!=null&&typeof M.toString!="function"&&(M=rl.call(M)),on.call(g,M)?g[M].push(A):g[M]=[A]},fr),cC=Rr(wa);function Ri(g){return I(g)?Vs(g):gu(g)}function Qs(g){return I(g)?Vs(g,!0):Nc(g)}function dC(g,M){var A={};return M=fr(M,3),rs(g,function(j,ie,xe){gs(A,M(j,ie,xe),j)}),A}function fC(g,M){var A={};return M=fr(M,3),rs(g,function(j,ie,xe){gs(A,ie,M(j,ie,xe))}),A}var hC=Gi(function(g,M,A){ba(g,M,A)}),w1=Gi(function(g,M,A,j){ba(g,M,A,j)}),pC=Ms(function(g,M){var A={};if(g==null)return A;var j=!1;M=_n(M,function(xe){return xe=Ks(xe,g),j||(j=xe.length>1),xe}),Vi(g,Ou(g),A),j&&(A=Ai(A,o|l|u,vd));for(var ie=M.length;ie--;)yu(A,M[ie]);return A});function mC(g,M){return x1(g,V(fr(M)))}var gC=Ms(function(g,M){return g==null?{}:ch(g,M)});function x1(g,M){if(g==null)return{};var A=_n(Ou(g),function(j){return[j]});return M=fr(M),Xc(g,A,function(j,ie){return M(j,ie[0])})}function _C(g,M,A){M=Ks(M,g);var j=-1,ie=M.length;for(ie||(ie=1,g=r);++j<ie;){var xe=g==null?r:g[ns(M[j])];xe===r&&(j=ie,xe=A),g=Te(xe)?xe.call(g):xe}return g}function vC(g,M,A){return g==null?g:Sa(g,M,A)}function yC(g,M,A,j){return j=typeof j=="function"?j:r,g==null?g:Sa(g,M,A,j)}var b1=md(Ri),M1=md(Qs);function wC(g,M,A){var j=S(g),ie=j||B(g)||ar(g);if(M=fr(M,4),A==null){var xe=g&&g.constructor;ie?A=j?new xe:[]:Ae(g)?A=Te(xe)?No(il(g)):{}:A={}}return(ie?ki:rs)(g,function(je,Ke,et){return M(A,je,Ke,et)}),A}function xC(g,M){return g==null?!0:yu(g,M)}function bC(g,M,A){return g==null?g:rd(g,M,bu(A))}function MC(g,M,A,j){return j=typeof j=="function"?j:r,g==null?g:rd(g,M,bu(A),j)}function Pm(g){return g==null?[]:Xl(g,Ri(g))}function TC(g){return g==null?[]:Xl(g,Qs(g))}function SC(g,M,A){return A===r&&(A=M,M=r),A!==r&&(A=wi(A),A=A===A?A:0),M!==r&&(M=wi(M),M=M===M?M:0),ts(wi(g),M,A)}function CC(g,M,A){return M=qs(M),A===r?(A=M,M=0):A=qs(A),g=wi(g),hu(g,M,A)}function EC(g,M,A){if(A&&typeof A!="boolean"&&yi(g,M,A)&&(M=A=r),A===r&&(typeof M=="boolean"?(A=M,M=r):typeof g=="boolean"&&(A=g,g=r)),g===r&&M===r?(g=0,M=1):(g=qs(g),M===r?(M=g,g=0):M=qs(M)),g>M){var j=g;g=M,M=j}if(A||g%1||M%1){var ie=wc();return ii(g+ie*(M-g+_r("1e-"+((ie+"").length-1))),M)}return gl(g,M)}var PC=ws(function(g,M,A){return M=M.toLowerCase(),g+(A?T1(M):M)});function T1(g){return fy(Or(g).toLowerCase())}function S1(g){return g=Or(g),g&&g.replace(Ar,ji).replace(Ls,"")}function OC(g,M,A){g=Or(g),M=Ci(M);var j=g.length;A=A===r?j:ts(zr(A),0,j);var ie=A;return A-=M.length,A>=0&&g.slice(A,ie)==M}function kC(g){return g=Or(g),g&&dr.test(g)?g.replace(io,Of):g}function IC(g){return g=Or(g),g&&Le.test(g)?g.replace(fe,"\\$&"):g}var AC=ws(function(g,M,A){return g+(A?"-":"")+M.toLowerCase()}),DC=ws(function(g,M,A){return g+(A?" ":"")+M.toLowerCase()}),FC=dd("toLowerCase");function LC(g,M,A){g=Or(g),M=zr(M);var j=M?Do(g):0;if(!M||j>=M)return g;var ie=(M-j)/2;return Cu(al(ie),A)+g+Cu(pa(ie),A)}function $C(g,M,A){g=Or(g),M=zr(M);var j=M?Do(g):0;return M&&j<M?g+Cu(M-j,A):g}function RC(g,M,A){g=Or(g),M=zr(M);var j=M?Do(g):0;return M&&j<M?Cu(M-j,A)+g:g}function BC(g,M,A){return A||M==null?M=0:M&&(M=+M),Uf(Or(g).replace(Xe,""),M||0)}function zC(g,M,A){return(A?yi(g,M,A):M===r)?M=1:M=zr(M),_u(Or(g),M)}function jC(){var g=arguments,M=Or(g[0]);return g.length<3?M:M.replace(g[1],g[2])}var NC=ws(function(g,M,A){return g+(A?"_":"")+M.toLowerCase()});function UC(g,M,A){return A&&typeof A!="number"&&yi(g,M,A)&&(M=A=r),A=A===r?X:A>>>0,A?(g=Or(g),g&&(typeof M=="string"||M!=null&&!Mr(M))&&(M=Ci(M),!M&&ci(g))?Xs(Pn(g),0,A):g.split(M,A)):[]}var VC=ws(function(g,M,A){return g+(A?" ":"")+fy(M)});function WC(g,M,A){return g=Or(g),A=A==null?0:ts(zr(A),0,g.length),M=Ci(M),g.slice(A,A+M.length)==M}function GC(g,M,A){var j=ge.templateSettings;A&&yi(g,M,A)&&(M=r),g=Or(g),M=Em({},M,j,gd);var ie=Em({},M.imports,j.imports,gd),xe=Ri(ie),je=Xl(ie,xe),Ke,et,vt=0,yt=M.interpolate||Gr,kt="__p += '",Wt=Zl((M.escape||Gr).source+"|"+yt.source+"|"+(yt===yr?jr:Gr).source+"|"+(M.evaluate||Gr).source+"|$","g"),ur="//# sourceURL="+(on.call(M,"sourceURL")?(M.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ds+"]")+`
`;g.replace(Wt,function(Ir,en,ln,vo,Ss,yo){return ln||(ln=vo),kt+=g.slice(vt,yo).replace(nn,Yl),en&&(Ke=!0,kt+=`' +
__e(`+en+`) +
'`),Ss&&(et=!0,kt+=`';
`+Ss+`;
__p += '`),ln&&(kt+=`' +
((__t = (`+ln+`)) == null ? '' : __t) +
'`),vt=yo+Ir.length,Ir}),kt+=`';
`;var kr=on.call(M,"variable")&&M.variable;if(!kr)kt=`with (obj) {
`+kt+`
}
`;else if(Nt.test(kr))throw new Tr(f);kt=(et?kt.replace(vn,""):kt).replace(Nn,"$1").replace(Ji,"$1;"),kt="function("+(kr||"obj")+`) {
`+(kr?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ke?", __e = _.escape":"")+(et?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+kt+`return __p
}`;var Yr=E1(function(){return Zr(xe,ur+"return "+kt).apply(r,je)});if(Yr.source=kt,le(Yr))throw Yr;return Yr}function HC(g){return Or(g).toLowerCase()}function KC(g){return Or(g).toUpperCase()}function XC(g,M,A){if(g=Or(g),g&&(A||M===r))return Kl(g);if(!g||!(M=Ci(M)))return g;var j=Pn(g),ie=Pn(M),xe=oc(j,ie),je=Pf(j,ie)+1;return Xs(j,xe,je).join("")}function YC(g,M,A){if(g=Or(g),g&&(A||M===r))return g.slice(0,Jl(g)+1);if(!g||!(M=Ci(M)))return g;var j=Pn(g),ie=Pf(j,Pn(M))+1;return Xs(j,0,ie).join("")}function qC(g,M,A){if(g=Or(g),g&&(A||M===r))return g.replace(Xe,"");if(!g||!(M=Ci(M)))return g;var j=Pn(g),ie=oc(j,Pn(M));return Xs(j,ie).join("")}function QC(g,M){var A=U,j=te;if(Ae(M)){var ie="separator"in M?M.separator:ie;A="length"in M?zr(M.length):A,j="omission"in M?Ci(M.omission):j}g=Or(g);var xe=g.length;if(ci(g)){var je=Pn(g);xe=je.length}if(A>=xe)return g;var Ke=A-Do(j);if(Ke<1)return j;var et=je?Xs(je,0,Ke).join(""):g.slice(0,Ke);if(ie===r)return et+j;if(je&&(Ke+=et.length-Ke),Mr(ie)){if(g.slice(Ke).search(ie)){var vt,yt=et;for(ie.global||(ie=Zl(ie.source,Or(Sn.exec(ie))+"g")),ie.lastIndex=0;vt=ie.exec(yt);)var kt=vt.index;et=et.slice(0,kt===r?Ke:kt)}}else if(g.indexOf(Ci(ie),Ke)!=Ke){var Wt=et.lastIndexOf(ie);Wt>-1&&(et=et.slice(0,Wt))}return et+j}function JC(g){return g=Or(g),g&&oa.test(g)?g.replace(Zi,Df):g}var ZC=ws(function(g,M,A){return g+(A?" ":"")+M.toUpperCase()}),fy=dd("toUpperCase");function C1(g,M,A){return g=Or(g),M=A?r:M,M===r?kf(g)?Lf(g):Wl(g):g.match(M)||[]}var E1=Rr(function(g,M){try{return mi(g,r,M)}catch(A){return le(A)?A:new Tr(A)}}),eE=Ms(function(g,M){return ki(M,function(A){A=ns(A),gs(g,A,Qo(g[A],g))}),g});function tE(g){var M=g==null?0:g.length,A=fr();return g=M?_n(g,function(j){if(typeof j[1]!="function")throw new gi(x);return[A(j[0]),j[1]]}):[],Rr(function(j){for(var ie=-1;++ie<M;){var xe=g[ie];if(mi(xe[0],this,j))return mi(xe[1],this,j)}})}function rE(g){return Dc(Ai(g,o))}function hy(g){return function(){return g}}function nE(g,M){return g==null||g!==g?M:g}var iE=hd(),sE=hd(!0);function Js(g){return g}function py(g){return mu(typeof g=="function"?g:Ai(g,o))}function oE(g){return Wc(Ai(g,o))}function aE(g,M){return Gc(g,Ai(M,o))}var lE=Rr(function(g,M){return function(A){return wa(A,g,M)}}),uE=Rr(function(g,M){return function(A){return wa(g,A,M)}});function my(g,M,A){var j=Ri(M),ie=du(M,j);A==null&&!(Ae(M)&&(ie.length||!j.length))&&(A=M,M=g,g=this,ie=du(M,Ri(M)));var xe=!(Ae(A)&&"chain"in A)||!!A.chain,je=Te(g);return ki(ie,function(Ke){var et=M[Ke];g[Ke]=et,je&&(g.prototype[Ke]=function(){var vt=this.__chain__;if(xe||vt){var yt=g(this.__wrapped__),kt=yt.__actions__=vi(this.__actions__);return kt.push({func:et,args:arguments,thisArg:g}),yt.__chain__=vt,yt}return et.apply(g,Bs([this.value()],arguments))})}),g}function cE(){return Kr._===this&&(Kr._=zf),this}function gy(){}function dE(g){return g=zr(g),Rr(function(M){return Hc(M,g)})}var fE=si(_n),hE=si(tc),pE=si(Vl);function P1(g){return Fu(g)?Gl(ns(g)):tm(g)}function mE(g){return function(M){return g==null?r:Gs(g,M)}}var gE=Eu(),_E=Eu(!0);function _y(){return[]}function vy(){return!1}function vE(){return{}}function yE(){return""}function wE(){return!0}function xE(g,M){if(g=zr(g),g<1||g>ve)return[];var A=X,j=ii(g,X);M=fr(M),g-=X;for(var ie=Za(j,M);++A<g;)M(A);return ie}function bE(g){return S(g)?_n(g,ns):$r(g)?[g]:vi(Lu(Or(g)))}function ME(g){var M=++eu;return Or(g)+M}var TE=Su(function(g,M){return g+M},0),SE=Pu("ceil"),CE=Su(function(g,M){return g/M},1),EE=Pu("floor");function PE(g){return g&&g.length?mo(g,Js,ml):r}function OE(g,M){return g&&g.length?mo(g,fr(M,2),ml):r}function kE(g){return sc(g,Js)}function IE(g,M){return sc(g,fr(M,2))}function AE(g){return g&&g.length?mo(g,Js,Uc):r}function DE(g,M){return g&&g.length?mo(g,fr(M,2),Uc):r}var FE=Su(function(g,M){return g*M},1),LE=Pu("round"),$E=Su(function(g,M){return g-M},0);function RE(g){return g&&g.length?ca(g,Js):0}function BE(g,M){return g&&g.length?ca(g,fr(M,2)):0}return ge.after=Ei,ge.ary=Fa,ge.assign=zu,ge.assignIn=m_,ge.assignInWith=Em,ge.assignWith=XS,ge.at=YS,ge.before=mr,ge.bind=Qo,ge.bindAll=eE,ge.bindKey=Tn,ge.castArray=hr,ge.chain=Nd,ge.chunk=Ph,ge.compact=Ed,ge.concat=Oh,ge.cond=tE,ge.conforms=rE,ge.constant=hy,ge.countBy=Tm,ge.create=qS,ge.curry=On,ge.curryRight=Fn,ge.debounce=Li,ge.defaults=QS,ge.defaultsDeep=JS,ge.defer=La,ge.delay=bp,ge.difference=kh,ge.differenceBy=Ih,ge.differenceWith=Ah,ge.drop=dm,ge.dropRight=Dh,ge.dropRightWhile=Pd,ge.dropWhile=Fh,ge.fill=Lh,ge.filter=hp,ge.flatMap=gp,ge.flatMapDeep=Sm,ge.flatMapDepth=_p,ge.flatten=Id,ge.flattenDeep=$h,ge.flattenDepth=fm,ge.flip=Mp,ge.flow=iE,ge.flowRight=sE,ge.fromPairs=$u,ge.functions=sC,ge.functionsIn=oC,ge.groupBy=vp,ge.initial=Rh,ge.intersection=Bh,ge.intersectionBy=zh,ge.intersectionWith=Dd,ge.invert=lC,ge.invertBy=uC,ge.invokeMap=yp,ge.iteratee=py,ge.keyBy=Wd,ge.keys=Ri,ge.keysIn=Qs,ge.map=Da,ge.mapKeys=dC,ge.mapValues=fC,ge.matches=oE,ge.matchesProperty=aE,ge.memoize=R,ge.merge=hC,ge.mergeWith=w1,ge.method=lE,ge.methodOf=uE,ge.mixin=my,ge.negate=V,ge.nthArg=dE,ge.omit=pC,ge.omitBy=mC,ge.once=oe,ge.orderBy=_o,ge.over=fE,ge.overArgs=Ee,ge.overEvery=hE,ge.overSome=pE,ge.partial=tt,ge.partialRight=Ze,ge.partition=wp,ge.pick=gC,ge.pickBy=x1,ge.property=P1,ge.propertyOf=mE,ge.pull=Uh,ge.pullAll=El,ge.pullAllBy=Vh,ge.pullAllWith=Wh,ge.pullAt=Gh,ge.range=gE,ge.rangeRight=_E,ge.rearg=ut,ge.reject=Hd,ge.remove=Qr,ge.rest=xt,ge.reverse=Ld,ge.sampleSize=Xd,ge.set=vC,ge.setWith=yC,ge.shuffle=Yd,ge.slice=hm,ge.sortBy=xp,ge.sortedUniq=qh,ge.sortedUniqBy=Rd,ge.split=UC,ge.spread=Pt,ge.tail=Qh,ge.take=mm,ge.takeRight=Jh,ge.takeRightWhile=Zh,ge.takeWhile=ep,ge.tap=lp,ge.throttle=Bt,ge.thru=Ol,ge.toArray=Ki,ge.toPairs=b1,ge.toPairsIn=M1,ge.toPath=bE,ge.toPlainObject=Tp,ge.transform=wC,ge.unary=Zt,ge.union=tp,ge.unionBy=Pl,ge.unionWith=gm,ge.uniq=Bd,ge.uniqBy=rp,ge.uniqWith=np,ge.unset=xC,ge.unzip=go,ge.unzipWith=zd,ge.update=bC,ge.updateWith=MC,ge.values=Pm,ge.valuesIn=TC,ge.without=_m,ge.words=C1,ge.wrap=Er,ge.xor=ip,ge.xorBy=sp,ge.xorWith=op,ge.zip=ap,ge.zipObject=vm,ge.zipObjectDeep=jd,ge.zipWith=ym,ge.entries=b1,ge.entriesIn=M1,ge.extend=m_,ge.extendWith=Em,my(ge,ge),ge.add=TE,ge.attempt=E1,ge.camelCase=PC,ge.capitalize=T1,ge.ceil=SE,ge.clamp=SC,ge.clone=Pr,ge.cloneDeep=Sr,ge.cloneDeepWith=Qt,ge.cloneWith=sr,ge.conformsTo=Dr,ge.deburr=S1,ge.defaultTo=nE,ge.divide=CE,ge.endsWith=OC,ge.eq=mn,ge.escape=kC,ge.escapeRegExp=IC,ge.every=fp,ge.find=pp,ge.findIndex=Od,ge.findKey=ZS,ge.findLast=mp,ge.findLastIndex=kd,ge.findLastKey=eC,ge.floor=EE,ge.forEach=kl,ge.forEachRight=Vd,ge.forIn=tC,ge.forInRight=rC,ge.forOwn=nC,ge.forOwnRight=iC,ge.get=cy,ge.gt=i,ge.gte=c,ge.has=aC,ge.hasIn=dy,ge.head=Ru,ge.identity=Js,ge.includes=Cm,ge.indexOf=Ad,ge.inRange=CC,ge.invoke=cC,ge.isArguments=b,ge.isArray=S,ge.isArrayBuffer=E,ge.isArrayLike=I,ge.isArrayLikeObject=k,ge.isBoolean=$,ge.isBuffer=B,ge.isDate=z,ge.isElement=G,ge.isEmpty=q,ge.isEqual=Z,ge.isEqualWith=se,ge.isError=le,ge.isFinite=me,ge.isFunction=Te,ge.isInteger=de,ge.isLength=_e,ge.isMap=He,ge.isMatch=lt,ge.isMatchWith=it,ge.isNaN=mt,ge.isNative=Mt,ge.isNil=$t,ge.isNull=At,ge.isNumber=Vt,ge.isObject=Ae,ge.isObjectLike=Oe,ge.isPlainObject=Kt,ge.isRegExp=Mr,ge.isSafeInteger=tr,ge.isSet=Jt,ge.isString=Lt,ge.isSymbol=$r,ge.isTypedArray=ar,ge.isUndefined=Cr,ge.isWeakMap=St,ge.isWeakSet=Rt,ge.join=jh,ge.kebabCase=AC,ge.last=Fi,ge.lastIndexOf=Nh,ge.lowerCase=DC,ge.lowerFirst=FC,ge.lt=gr,ge.lte=an,ge.max=PE,ge.maxBy=OE,ge.mean=kE,ge.meanBy=IE,ge.min=AE,ge.minBy=DE,ge.stubArray=_y,ge.stubFalse=vy,ge.stubObject=vE,ge.stubString=yE,ge.stubTrue=wE,ge.multiply=FE,ge.nth=Fd,ge.noConflict=cE,ge.noop=gy,ge.now=is,ge.pad=LC,ge.padEnd=$C,ge.padStart=RC,ge.parseInt=BC,ge.random=EC,ge.reduce=Gd,ge.reduceRight=Bu,ge.repeat=zC,ge.replace=jC,ge.result=_C,ge.round=LE,ge.runInContext=Qe,ge.sample=Kd,ge.size=qd,ge.snakeCase=NC,ge.some=Qd,ge.sortedIndex=Hh,ge.sortedIndexBy=pm,ge.sortedIndexOf=$d,ge.sortedLastIndex=Kh,ge.sortedLastIndexBy=Xh,ge.sortedLastIndexOf=Yh,ge.startCase=VC,ge.startsWith=WC,ge.subtract=$E,ge.sum=RE,ge.sumBy=BE,ge.template=GC,ge.times=xE,ge.toFinite=qs,ge.toInteger=zr,ge.toLength=Il,ge.toLower=HC,ge.toNumber=wi,ge.toSafeInteger=$i,ge.toString=Or,ge.toUpper=KC,ge.trim=XC,ge.trimEnd=YC,ge.trimStart=qC,ge.truncate=QC,ge.unescape=JC,ge.uniqueId=ME,ge.upperCase=ZC,ge.upperFirst=fy,ge.each=kl,ge.eachRight=Vd,ge.first=Ru,my(ge,function(){var g={};return rs(ge,function(M,A){on.call(ge.prototype,A)||(g[A]=M)}),g}(),{chain:!1}),ge.VERSION=n,ki(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){ge[g].placeholder=ge}),ki(["drop","take"],function(g,M){Vr.prototype[g]=function(A){A=A===r?1:Cn(zr(A),0);var j=this.__filtered__&&!M?new Vr(this):this.clone();return j.__filtered__?j.__takeCount__=ii(A,j.__takeCount__):j.__views__.push({size:ii(A,X),type:g+(j.__dir__<0?"Right":"")}),j},Vr.prototype[g+"Right"]=function(A){return this.reverse()[g](A).reverse()}}),ki(["filter","map","takeWhile"],function(g,M){var A=M+1,j=A==ye||A==Me;Vr.prototype[g]=function(ie){var xe=this.clone();return xe.__iteratees__.push({iteratee:fr(ie,3),type:A}),xe.__filtered__=xe.__filtered__||j,xe}}),ki(["head","last"],function(g,M){var A="take"+(M?"Right":"");Vr.prototype[g]=function(){return this[A](1).value()[0]}}),ki(["initial","tail"],function(g,M){var A="drop"+(M?"":"Right");Vr.prototype[g]=function(){return this.__filtered__?new Vr(this):this[A](1)}}),Vr.prototype.compact=function(){return this.filter(Js)},Vr.prototype.find=function(g){return this.filter(g).head()},Vr.prototype.findLast=function(g){return this.reverse().find(g)},Vr.prototype.invokeMap=Rr(function(g,M){return typeof g=="function"?new Vr(this):this.map(function(A){return wa(A,g,M)})}),Vr.prototype.reject=function(g){return this.filter(V(fr(g)))},Vr.prototype.slice=function(g,M){g=zr(g);var A=this;return A.__filtered__&&(g>0||M<0)?new Vr(A):(g<0?A=A.takeRight(-g):g&&(A=A.drop(g)),M!==r&&(M=zr(M),A=M<0?A.dropRight(-M):A.take(M-g)),A)},Vr.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},Vr.prototype.toArray=function(){return this.take(X)},rs(Vr.prototype,function(g,M){var A=/^(?:filter|find|map|reject)|While$/.test(M),j=/^(?:head|last)$/.test(M),ie=ge[j?"take"+(M=="last"?"Right":""):M],xe=j||/^find/.test(M);!ie||(ge.prototype[M]=function(){var je=this.__wrapped__,Ke=j?[1]:arguments,et=je instanceof Vr,vt=Ke[0],yt=et||S(je),kt=function(en){var ln=ie.apply(ge,Bs([en],Ke));return j&&Wt?ln[0]:ln};yt&&A&&typeof vt=="function"&&vt.length!=1&&(et=yt=!1);var Wt=this.__chain__,ur=!!this.__actions__.length,kr=xe&&!Wt,Yr=et&&!ur;if(!xe&&yt){je=Yr?je:new Vr(this);var Ir=g.apply(je,Ke);return Ir.__actions__.push({func:Ol,args:[kt],thisArg:r}),new Si(Ir,Wt)}return kr&&Yr?g.apply(this,Ke):(Ir=this.thru(kt),kr?j?Ir.value()[0]:Ir.value():Ir)})}),ki(["pop","push","shift","sort","splice","unshift"],function(g){var M=fa[g],A=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",j=/^(?:pop|shift)$/.test(g);ge.prototype[g]=function(){var ie=arguments;if(j&&!this.__chain__){var xe=this.value();return M.apply(S(xe)?xe:[],ie)}return this[A](function(je){return M.apply(S(je)?je:[],ie)})}}),rs(Vr.prototype,function(g,M){var A=ge[M];if(A){var j=A.name+"";on.call(Bo,j)||(Bo[j]=[]),Bo[j].push({name:M,func:A})}}),Bo[Ho(r,v).name]=[{name:"wrapper",func:r}],Vr.prototype.clone=Sc,Vr.prototype.reverse=Cc,Vr.prototype.value=Hf,ge.prototype.at=wm,ge.prototype.chain=up,ge.prototype.commit=cp,ge.prototype.next=xm,ge.prototype.plant=Ud,ge.prototype.reverse=Mm,ge.prototype.toJSON=ge.prototype.valueOf=ge.prototype.value=dp,ge.prototype.first=ge.prototype.head,Lo&&(ge.prototype[Lo]=bm),ge},uo=$f();Gt?((Gt.exports=uo)._=uo,Kn._=uo):Kr._=uo}).call(_g)})(Qx,Qx.exports);function To(t){return To=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},To(t)}function yk(t,e){if(To(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(To(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function yS(t){var e=yk(t,"string");return To(e)=="symbol"?e:e+""}function Nl(t,e,r){return(e=yS(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function wk(){if(console&&console.warn){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];typeof r[0]=="string"&&(r[0]="react-i18next:: ".concat(r[0])),(t=console).warn.apply(t,r)}}var Jx={};function ow(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];typeof e[0]=="string"&&Jx[e[0]]||(typeof e[0]=="string"&&(Jx[e[0]]=new Date),wk.apply(void 0,e))}var wS=function(e,r){return function(){if(e.isInitialized)r();else{var n=function a(){setTimeout(function(){e.off("initialized",a)},0),r()};e.on("initialized",n)}}};function Zx(t,e,r){t.loadNamespaces(e,wS(t,r))}function eb(t,e,r,n){typeof r=="string"&&(r=[r]),r.forEach(function(a){t.options.ns.indexOf(a)<0&&t.options.ns.push(a)}),t.loadLanguages(e,wS(t,n))}function xk(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.languages[0],a=e.options?e.options.fallbackLng:!1,h=e.languages[e.languages.length-1];if(n.toLowerCase()==="cimode")return!0;var x=function(s,d){var m=e.services.backendConnector.state["".concat(s,"|").concat(d)];return m===-1||m===2};return r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&e.services.backendConnector.backend&&e.isLanguageChangingTo&&!x(e.isLanguageChangingTo,t)?!1:!!(e.hasResourceBundle(n,t)||!e.services.backendConnector.backend||e.options.resources&&!e.options.partialBundledLanguages||x(n,t)&&(!a||x(h,t)))}function bk(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e.languages||!e.languages.length)return ow("i18n.languages were undefined or empty",e.languages),!0;var n=e.options.ignoreJSONStructure!==void 0;return n?e.hasLoadedNamespace(t,{lng:r.lng,precheck:function(h,x){if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&h.services.backendConnector.backend&&h.isLanguageChangingTo&&!x(h.isLanguageChangingTo,t))return!1}}):xk(t,e,r)}var Mk=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Tk={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"\xA9","&#169;":"\xA9","&reg;":"\xAE","&#174;":"\xAE","&hellip;":"\u2026","&#8230;":"\u2026","&#x2F;":"/","&#47;":"/"},Sk=function(e){return Tk[e]},Ck=function(e){return e.replace(Mk,Sk)};function tb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function rb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?tb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var aw={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Ck};function Ek(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};aw=rb(rb({},aw),t)}function Pk(){return aw}var xS;function Ok(t){xS=t}function kk(){return xS}function Ya(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nb(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,yS(n.key),n)}}function qa(t,e,r){return e&&nb(t.prototype,e),r&&nb(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var $D={type:"3rdParty",init:function(e){Ek(e.options.react),Ok(e)}},Ik=Wr.exports.createContext(),Ak=function(){function t(){Ya(this,t),this.usedNamespaces={}}return qa(t,[{key:"addUsedNamespaces",value:function(r){var n=this;r.forEach(function(a){n.usedNamespaces[a]||(n.usedNamespaces[a]=!0)})}},{key:"getUsedNamespaces",value:function(){return Object.keys(this.usedNamespaces)}}]),t}();function bS(t){if(Array.isArray(t))return t}function Dk(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,a,h,x,f=[],s=!0,d=!1;try{if(h=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=h.call(r)).done)&&(f.push(n.value),f.length!==e);s=!0);}catch(m){d=!0,a=m}finally{try{if(!s&&r.return!=null&&(x=r.return(),Object(x)!==x))return}finally{if(d)throw a}}return f}}function ib(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function MS(t,e){if(t){if(typeof t=="string")return ib(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ib(t,e):void 0}}function TS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fk(t,e){return bS(t)||Dk(t,e)||MS(t,e)||TS()}function sb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Jy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?sb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Lk=function(e,r){var n=Wr.exports.useRef();return Wr.exports.useEffect(function(){n.current=r?n.current:e},[e,r]),n.current};function RD(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.i18n,n=Wr.exports.useContext(Ik)||{},a=n.i18n,h=n.defaultNS,x=r||a||kk();if(x&&!x.reportNamespaces&&(x.reportNamespaces=new Ak),!x){ow("You will need to pass in an i18next instance by using initReactI18next");var f=function(W,U){return typeof U=="string"?U:U&&To(U)==="object"&&typeof U.defaultValue=="string"?U.defaultValue:Array.isArray(W)?W[W.length-1]:W},s=[f,{},!1];return s.t=f,s.i18n={},s.ready=!1,s}x.options.react&&x.options.react.wait!==void 0&&ow("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");var d=Jy(Jy(Jy({},Pk()),x.options.react),e),m=d.useSuspense,o=d.keyPrefix,l=t||h||x.options&&x.options.defaultNS;l=typeof l=="string"?[l]:l||["translation"],x.reportNamespaces.addUsedNamespaces&&x.reportNamespaces.addUsedNamespaces(l);var u=(x.isInitialized||x.initializedStoreOnce)&&l.every(function(L){return bk(L,x,d)});function p(){return x.getFixedT(e.lng||null,d.nsMode==="fallback"?l:l[0],o)}var w=Wr.exports.useState(p),_=Fk(w,2),v=_[0],y=_[1],T=l.join();e.lng&&(T="".concat(e.lng).concat(T));var C=Lk(T),P=Wr.exports.useRef(!0);Wr.exports.useEffect(function(){var L=d.bindI18n,W=d.bindI18nStore;P.current=!0,!u&&!m&&(e.lng?eb(x,e.lng,l,function(){P.current&&y(p)}):Zx(x,l,function(){P.current&&y(p)})),u&&C&&C!==T&&P.current&&y(p);function U(){P.current&&y(p)}return L&&x&&x.on(L,U),W&&x&&x.store.on(W,U),function(){P.current=!1,L&&x&&L.split(" ").forEach(function(te){return x.off(te,U)}),W&&x&&W.split(" ").forEach(function(te){return x.store.off(te,U)})}},[x,T]);var O=Wr.exports.useRef(!0);Wr.exports.useEffect(function(){P.current&&!O.current&&y(p),O.current=!1},[x,o]);var D=[v,x,u];if(D.t=v,D.i18n=x,D.ready=u,u||!u&&!m)return D;throw new Promise(function(L){e.lng?eb(x,e.lng,l,function(){return L()}):Zx(x,l,function(){return L()})})}var oy={exports:{}},ay={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $k=Wr.exports,Rk=Symbol.for("react.element"),Bk=Symbol.for("react.fragment"),zk=Object.prototype.hasOwnProperty,jk=$k.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nk={key:!0,ref:!0,__self:!0,__source:!0};function SS(t,e,r){var n,a={},h=null,x=null;r!==void 0&&(h=""+r),e.key!==void 0&&(h=""+e.key),e.ref!==void 0&&(x=e.ref);for(n in e)zk.call(e,n)&&!Nk.hasOwnProperty(n)&&(a[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:Rk,type:t,key:h,ref:x,props:a,_owner:jk.current}}ay.Fragment=Bk;ay.jsx=SS;ay.jsxs=SS;(function(t){t.exports=ay})(oy);const Uk=oy.exports.Fragment,wn=oy.exports.jsx,Wa=oy.exports.jsxs;function ob(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function g1(t,e){t===void 0&&(t={}),e===void 0&&(e={});const r=["__proto__","constructor","prototype"];Object.keys(e).filter(n=>r.indexOf(n)<0).forEach(n=>{typeof t[n]>"u"?t[n]=e[n]:ob(e[n])&&ob(t[n])&&Object.keys(e[n]).length>0&&g1(t[n],e[n])})}const CS={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Hp(){const t=typeof document<"u"?document:{};return g1(t,CS),t}const Vk={document:CS,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(t){return typeof setTimeout>"u"?(t(),null):setTimeout(t,0)},cancelAnimationFrame(t){typeof setTimeout>"u"||clearTimeout(t)}};function ks(){const t=typeof window<"u"?window:{};return g1(t,Vk),t}function Wk(t){return t===void 0&&(t=""),t.trim().split(" ").filter(e=>!!e.trim())}function Gk(t){const e=t;Object.keys(e).forEach(r=>{try{e[r]=null}catch{}try{delete e[r]}catch{}})}function ES(t,e){return e===void 0&&(e=0),setTimeout(t,e)}function kv(){return Date.now()}function Hk(t){const e=ks();let r;return e.getComputedStyle&&(r=e.getComputedStyle(t,null)),!r&&t.currentStyle&&(r=t.currentStyle),r||(r=t.style),r}function Kk(t,e){e===void 0&&(e="x");const r=ks();let n,a,h;const x=Hk(t);return r.WebKitCSSMatrix?(a=x.transform||x.webkitTransform,a.split(",").length>6&&(a=a.split(", ").map(f=>f.replace(",",".")).join(", ")),h=new r.WebKitCSSMatrix(a==="none"?"":a)):(h=x.MozTransform||x.OTransform||x.MsTransform||x.msTransform||x.transform||x.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=h.toString().split(",")),e==="x"&&(r.WebKitCSSMatrix?a=h.m41:n.length===16?a=parseFloat(n[12]):a=parseFloat(n[4])),e==="y"&&(r.WebKitCSSMatrix?a=h.m42:n.length===16?a=parseFloat(n[13]):a=parseFloat(n[5])),a||0}function L_(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function Xk(t){return typeof window<"u"&&typeof window.HTMLElement<"u"?t instanceof HTMLElement:t&&(t.nodeType===1||t.nodeType===11)}function xo(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let r=1;r<arguments.length;r+=1){const n=r<0||arguments.length<=r?void 0:arguments[r];if(n!=null&&!Xk(n)){const a=Object.keys(Object(n)).filter(h=>e.indexOf(h)<0);for(let h=0,x=a.length;h<x;h+=1){const f=a[h],s=Object.getOwnPropertyDescriptor(n,f);s!==void 0&&s.enumerable&&(L_(t[f])&&L_(n[f])?n[f].__swiper__?t[f]=n[f]:xo(t[f],n[f]):!L_(t[f])&&L_(n[f])?(t[f]={},n[f].__swiper__?t[f]=n[f]:xo(t[f],n[f])):t[f]=n[f])}}}return t}function $_(t,e,r){t.style.setProperty(e,r)}function PS(t){let{swiper:e,targetPosition:r,side:n}=t;const a=ks(),h=-e.translate;let x=null,f;const s=e.params.speed;e.wrapperEl.style.scrollSnapType="none",a.cancelAnimationFrame(e.cssModeFrameID);const d=r>h?"next":"prev",m=(l,u)=>d==="next"&&l>=u||d==="prev"&&l<=u,o=()=>{f=new Date().getTime(),x===null&&(x=f);const l=Math.max(Math.min((f-x)/s,1),0),u=.5-Math.cos(l*Math.PI)/2;let p=h+u*(r-h);if(m(p,r)&&(p=r),e.wrapperEl.scrollTo({[n]:p}),m(p,r)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[n]:p})}),a.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=a.requestAnimationFrame(o)};o()}function $l(t,e){e===void 0&&(e="");const r=ks(),n=[...t.children];return r.HTMLSlotElement&&t instanceof HTMLSlotElement&&n.push(...t.assignedElements()),e?n.filter(a=>a.matches(e)):n}function Yk(t,e){const r=[e];for(;r.length>0;){const n=r.shift();if(t===n)return!0;r.push(...n.children,...n.shadowRoot?n.shadowRoot.children:[],...n.assignedElements?n.assignedElements():[])}}function qk(t,e){const r=ks();let n=e.contains(t);return!n&&r.HTMLSlotElement&&e instanceof HTMLSlotElement&&(n=[...e.assignedElements()].includes(t),n||(n=Yk(t,e))),n}function Iv(t){try{console.warn(t);return}catch{}}function Av(t,e){e===void 0&&(e=[]);const r=document.createElement(t);return r.classList.add(...Array.isArray(e)?e:Wk(e)),r}function Qk(t,e){const r=[];for(;t.previousElementSibling;){const n=t.previousElementSibling;e?n.matches(e)&&r.push(n):r.push(n),t=n}return r}function Jk(t,e){const r=[];for(;t.nextElementSibling;){const n=t.nextElementSibling;e?n.matches(e)&&r.push(n):r.push(n),t=n}return r}function lf(t,e){return ks().getComputedStyle(t,null).getPropertyValue(e)}function Dv(t){let e=t,r;if(e){for(r=0;(e=e.previousSibling)!==null;)e.nodeType===1&&(r+=1);return r}}function OS(t,e){const r=[];let n=t.parentElement;for(;n;)e?n.matches(e)&&r.push(n):r.push(n),n=n.parentElement;return r}function lw(t,e,r){const n=ks();return r?t[e==="width"?"offsetWidth":"offsetHeight"]+parseFloat(n.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-right":"margin-top"))+parseFloat(n.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-left":"margin-bottom")):t.offsetWidth}function Nu(t){return(Array.isArray(t)?t:[t]).filter(e=>!!e)}function Fv(t,e){e===void 0&&(e=""),typeof trustedTypes<"u"?t.innerHTML=trustedTypes.createPolicy("html",{createHTML:r=>r}).createHTML(e):t.innerHTML=e}function Zk(t,e,r,n){return t.params.createElements&&Object.keys(n).forEach(a=>{if(!r[a]&&r.auto===!0){let h=$l(t.el,`.${n[a]}`)[0];h||(h=Av("div",n[a]),h.className=n[a],t.el.append(h)),r[a]=h,e[a]=h}}),r}function Cg(t){return t===void 0&&(t=""),`.${t.trim().replace(/([\.:!+\/()[\]])/g,"\\$1").replace(/ /g,".")}`}function BD(t){let{swiper:e,extendParams:r,on:n,emit:a}=t;const h="swiper-pagination";r({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:y=>y,formatFractionTotal:y=>y,bulletClass:`${h}-bullet`,bulletActiveClass:`${h}-bullet-active`,modifierClass:`${h}-`,currentClass:`${h}-current`,totalClass:`${h}-total`,hiddenClass:`${h}-hidden`,progressbarFillClass:`${h}-progressbar-fill`,progressbarOppositeClass:`${h}-progressbar-opposite`,clickableClass:`${h}-clickable`,lockClass:`${h}-lock`,horizontalClass:`${h}-horizontal`,verticalClass:`${h}-vertical`,paginationDisabledClass:`${h}-disabled`}}),e.pagination={el:null,bullets:[]};let x,f=0;function s(){return!e.params.pagination.el||!e.pagination.el||Array.isArray(e.pagination.el)&&e.pagination.el.length===0}function d(y,T){const{bulletActiveClass:C}=e.params.pagination;!y||(y=y[`${T==="prev"?"previous":"next"}ElementSibling`],y&&(y.classList.add(`${C}-${T}`),y=y[`${T==="prev"?"previous":"next"}ElementSibling`],y&&y.classList.add(`${C}-${T}-${T}`)))}function m(y,T,C){if(y=y%C,T=T%C,T===y+1)return"next";if(T===y-1)return"previous"}function o(y){const T=y.target.closest(Cg(e.params.pagination.bulletClass));if(!T)return;y.preventDefault();const C=Dv(T)*e.params.slidesPerGroup;if(e.params.loop){if(e.realIndex===C)return;const P=m(e.realIndex,C,e.slides.length);P==="next"?e.slideNext():P==="previous"?e.slidePrev():e.slideToLoop(C)}else e.slideTo(C)}function l(){const y=e.rtl,T=e.params.pagination;if(s())return;let C=e.pagination.el;C=Nu(C);let P,O;const D=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,L=e.params.loop?Math.ceil(D/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?(O=e.previousRealIndex||0,P=e.params.slidesPerGroup>1?Math.floor(e.realIndex/e.params.slidesPerGroup):e.realIndex):typeof e.snapIndex<"u"?(P=e.snapIndex,O=e.previousSnapIndex):(O=e.previousIndex||0,P=e.activeIndex||0),T.type==="bullets"&&e.pagination.bullets&&e.pagination.bullets.length>0){const W=e.pagination.bullets;let U,te,pe;if(T.dynamicBullets&&(x=lw(W[0],e.isHorizontal()?"width":"height",!0),C.forEach(ne=>{ne.style[e.isHorizontal()?"width":"height"]=`${x*(T.dynamicMainBullets+4)}px`}),T.dynamicMainBullets>1&&O!==void 0&&(f+=P-(O||0),f>T.dynamicMainBullets-1?f=T.dynamicMainBullets-1:f<0&&(f=0)),U=Math.max(P-f,0),te=U+(Math.min(W.length,T.dynamicMainBullets)-1),pe=(te+U)/2),W.forEach(ne=>{const ye=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(ce=>`${T.bulletActiveClass}${ce}`)].map(ce=>typeof ce=="string"&&ce.includes(" ")?ce.split(" "):ce).flat();ne.classList.remove(...ye)}),C.length>1)W.forEach(ne=>{const ye=Dv(ne);ye===P?ne.classList.add(...T.bulletActiveClass.split(" ")):e.isElement&&ne.setAttribute("part","bullet"),T.dynamicBullets&&(ye>=U&&ye<=te&&ne.classList.add(...`${T.bulletActiveClass}-main`.split(" ")),ye===U&&d(ne,"prev"),ye===te&&d(ne,"next"))});else{const ne=W[P];if(ne&&ne.classList.add(...T.bulletActiveClass.split(" ")),e.isElement&&W.forEach((ye,ce)=>{ye.setAttribute("part",ce===P?"bullet-active":"bullet")}),T.dynamicBullets){const ye=W[U],ce=W[te];for(let Me=U;Me<=te;Me+=1)W[Me]&&W[Me].classList.add(...`${T.bulletActiveClass}-main`.split(" "));d(ye,"prev"),d(ce,"next")}}if(T.dynamicBullets){const ne=Math.min(W.length,T.dynamicMainBullets+4),ye=(x*ne-x)/2-pe*x,ce=y?"right":"left";W.forEach(Me=>{Me.style[e.isHorizontal()?ce:"top"]=`${ye}px`})}}C.forEach((W,U)=>{if(T.type==="fraction"&&(W.querySelectorAll(Cg(T.currentClass)).forEach(te=>{te.textContent=T.formatFractionCurrent(P+1)}),W.querySelectorAll(Cg(T.totalClass)).forEach(te=>{te.textContent=T.formatFractionTotal(L)})),T.type==="progressbar"){let te;T.progressbarOpposite?te=e.isHorizontal()?"vertical":"horizontal":te=e.isHorizontal()?"horizontal":"vertical";const pe=(P+1)/L;let ne=1,ye=1;te==="horizontal"?ne=pe:ye=pe,W.querySelectorAll(Cg(T.progressbarFillClass)).forEach(ce=>{ce.style.transform=`translate3d(0,0,0) scaleX(${ne}) scaleY(${ye})`,ce.style.transitionDuration=`${e.params.speed}ms`})}T.type==="custom"&&T.renderCustom?(Fv(W,T.renderCustom(e,P+1,L)),U===0&&a("paginationRender",W)):(U===0&&a("paginationRender",W),a("paginationUpdate",W)),e.params.watchOverflow&&e.enabled&&W.classList[e.isLocked?"add":"remove"](T.lockClass)})}function u(){const y=e.params.pagination;if(s())return;const T=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.grid&&e.params.grid.rows>1?e.slides.length/Math.ceil(e.params.grid.rows):e.slides.length;let C=e.pagination.el;C=Nu(C);let P="";if(y.type==="bullets"){let O=e.params.loop?Math.ceil(T/e.params.slidesPerGroup):e.snapGrid.length;e.params.freeMode&&e.params.freeMode.enabled&&O>T&&(O=T);for(let D=0;D<O;D+=1)y.renderBullet?P+=y.renderBullet.call(e,D,y.bulletClass):P+=`<${y.bulletElement} ${e.isElement?'part="bullet"':""} class="${y.bulletClass}"></${y.bulletElement}>`}y.type==="fraction"&&(y.renderFraction?P=y.renderFraction.call(e,y.currentClass,y.totalClass):P=`<span class="${y.currentClass}"></span> / <span class="${y.totalClass}"></span>`),y.type==="progressbar"&&(y.renderProgressbar?P=y.renderProgressbar.call(e,y.progressbarFillClass):P=`<span class="${y.progressbarFillClass}"></span>`),e.pagination.bullets=[],C.forEach(O=>{y.type!=="custom"&&Fv(O,P||""),y.type==="bullets"&&e.pagination.bullets.push(...O.querySelectorAll(Cg(y.bulletClass)))}),y.type!=="custom"&&a("paginationRender",C[0])}function p(){e.params.pagination=Zk(e,e.originalParams.pagination,e.params.pagination,{el:"swiper-pagination"});const y=e.params.pagination;if(!y.el)return;let T;typeof y.el=="string"&&e.isElement&&(T=e.el.querySelector(y.el)),!T&&typeof y.el=="string"&&(T=[...document.querySelectorAll(y.el)]),T||(T=y.el),!(!T||T.length===0)&&(e.params.uniqueNavElements&&typeof y.el=="string"&&Array.isArray(T)&&T.length>1&&(T=[...e.el.querySelectorAll(y.el)],T.length>1&&(T=T.find(C=>OS(C,".swiper")[0]===e.el))),Array.isArray(T)&&T.length===1&&(T=T[0]),Object.assign(e.pagination,{el:T}),T=Nu(T),T.forEach(C=>{y.type==="bullets"&&y.clickable&&C.classList.add(...(y.clickableClass||"").split(" ")),C.classList.add(y.modifierClass+y.type),C.classList.add(e.isHorizontal()?y.horizontalClass:y.verticalClass),y.type==="bullets"&&y.dynamicBullets&&(C.classList.add(`${y.modifierClass}${y.type}-dynamic`),f=0,y.dynamicMainBullets<1&&(y.dynamicMainBullets=1)),y.type==="progressbar"&&y.progressbarOpposite&&C.classList.add(y.progressbarOppositeClass),y.clickable&&C.addEventListener("click",o),e.enabled||C.classList.add(y.lockClass)}))}function w(){const y=e.params.pagination;if(s())return;let T=e.pagination.el;T&&(T=Nu(T),T.forEach(C=>{C.classList.remove(y.hiddenClass),C.classList.remove(y.modifierClass+y.type),C.classList.remove(e.isHorizontal()?y.horizontalClass:y.verticalClass),y.clickable&&(C.classList.remove(...(y.clickableClass||"").split(" ")),C.removeEventListener("click",o))})),e.pagination.bullets&&e.pagination.bullets.forEach(C=>C.classList.remove(...y.bulletActiveClass.split(" ")))}n("changeDirection",()=>{if(!e.pagination||!e.pagination.el)return;const y=e.params.pagination;let{el:T}=e.pagination;T=Nu(T),T.forEach(C=>{C.classList.remove(y.horizontalClass,y.verticalClass),C.classList.add(e.isHorizontal()?y.horizontalClass:y.verticalClass)})}),n("init",()=>{e.params.pagination.enabled===!1?v():(p(),u(),l())}),n("activeIndexChange",()=>{typeof e.snapIndex>"u"&&l()}),n("snapIndexChange",()=>{l()}),n("snapGridLengthChange",()=>{u(),l()}),n("destroy",()=>{w()}),n("enable disable",()=>{let{el:y}=e.pagination;y&&(y=Nu(y),y.forEach(T=>T.classList[e.enabled?"remove":"add"](e.params.pagination.lockClass)))}),n("lock unlock",()=>{l()}),n("click",(y,T)=>{const C=T.target,P=Nu(e.pagination.el);if(e.params.pagination.el&&e.params.pagination.hideOnClick&&P&&P.length>0&&!C.classList.contains(e.params.pagination.bulletClass)){if(e.navigation&&(e.navigation.nextEl&&C===e.navigation.nextEl||e.navigation.prevEl&&C===e.navigation.prevEl))return;const O=P[0].classList.contains(e.params.pagination.hiddenClass);a(O===!0?"paginationShow":"paginationHide"),P.forEach(D=>D.classList.toggle(e.params.pagination.hiddenClass))}});const _=()=>{e.el.classList.remove(e.params.pagination.paginationDisabledClass);let{el:y}=e.pagination;y&&(y=Nu(y),y.forEach(T=>T.classList.remove(e.params.pagination.paginationDisabledClass))),p(),u(),l()},v=()=>{e.el.classList.add(e.params.pagination.paginationDisabledClass);let{el:y}=e.pagination;y&&(y=Nu(y),y.forEach(T=>T.classList.add(e.params.pagination.paginationDisabledClass))),w()};Object.assign(e.pagination,{enable:_,disable:v,render:u,update:l,init:p,destroy:w})}let Zy;function eI(){const t=ks(),e=Hp();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}function kS(){return Zy||(Zy=eI()),Zy}let e0;function tI(t){let{userAgent:e}=t===void 0?{}:t;const r=kS(),n=ks(),a=n.navigator.platform,h=e||n.navigator.userAgent,x={ios:!1,android:!1},f=n.screen.width,s=n.screen.height,d=h.match(/(Android);?[\s\/]+([\d.]+)?/);let m=h.match(/(iPad).*OS\s([\d_]+)/);const o=h.match(/(iPod)(.*OS\s([\d_]+))?/),l=!m&&h.match(/(iPhone\sOS|iOS)\s([\d_]+)/),u=a==="Win32";let p=a==="MacIntel";const w=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!m&&p&&r.touch&&w.indexOf(`${f}x${s}`)>=0&&(m=h.match(/(Version)\/([\d.]+)/),m||(m=[0,1,"13_0_0"]),p=!1),d&&!u&&(x.os="android",x.android=!0),(m||l||o)&&(x.os="ios",x.ios=!0),x}function IS(t){return t===void 0&&(t={}),e0||(e0=tI(t)),e0}let t0;function rI(){const t=ks(),e=IS();let r=!1;function n(){const f=t.navigator.userAgent.toLowerCase();return f.indexOf("safari")>=0&&f.indexOf("chrome")<0&&f.indexOf("android")<0}if(n()){const f=String(t.navigator.userAgent);if(f.includes("Version/")){const[s,d]=f.split("Version/")[1].split(" ")[0].split(".").map(m=>Number(m));r=s<16||s===16&&d<2}}const a=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent),h=n(),x=h||a&&e.ios;return{isSafari:r||h,needPerspectiveFix:r,need3dFix:x,isWebView:a}}function AS(){return t0||(t0=rI()),t0}function nI(t){let{swiper:e,on:r,emit:n}=t;const a=ks();let h=null,x=null;const f=()=>{!e||e.destroyed||!e.initialized||(n("beforeResize"),n("resize"))},s=()=>{!e||e.destroyed||!e.initialized||(h=new ResizeObserver(o=>{x=a.requestAnimationFrame(()=>{const{width:l,height:u}=e;let p=l,w=u;o.forEach(_=>{let{contentBoxSize:v,contentRect:y,target:T}=_;T&&T!==e.el||(p=y?y.width:(v[0]||v).inlineSize,w=y?y.height:(v[0]||v).blockSize)}),(p!==l||w!==u)&&f()})}),h.observe(e.el))},d=()=>{x&&a.cancelAnimationFrame(x),h&&h.unobserve&&e.el&&(h.unobserve(e.el),h=null)},m=()=>{!e||e.destroyed||!e.initialized||n("orientationchange")};r("init",()=>{if(e.params.resizeObserver&&typeof a.ResizeObserver<"u"){s();return}a.addEventListener("resize",f),a.addEventListener("orientationchange",m)}),r("destroy",()=>{d(),a.removeEventListener("resize",f),a.removeEventListener("orientationchange",m)})}function iI(t){let{swiper:e,extendParams:r,on:n,emit:a}=t;const h=[],x=ks(),f=function(m,o){o===void 0&&(o={});const l=x.MutationObserver||x.WebkitMutationObserver,u=new l(p=>{if(e.__preventObserver__)return;if(p.length===1){a("observerUpdate",p[0]);return}const w=function(){a("observerUpdate",p[0])};x.requestAnimationFrame?x.requestAnimationFrame(w):x.setTimeout(w,0)});u.observe(m,{attributes:typeof o.attributes>"u"?!0:o.attributes,childList:e.isElement||(typeof o.childList>"u"?!0:o).childList,characterData:typeof o.characterData>"u"?!0:o.characterData}),h.push(u)},s=()=>{if(!!e.params.observer){if(e.params.observeParents){const m=OS(e.hostEl);for(let o=0;o<m.length;o+=1)f(m[o])}f(e.hostEl,{childList:e.params.observeSlideChildren}),f(e.wrapperEl,{attributes:!1})}},d=()=>{h.forEach(m=>{m.disconnect()}),h.splice(0,h.length)};r({observer:!1,observeParents:!1,observeSlideChildren:!1}),n("init",s),n("destroy",d)}var sI={on(t,e,r){const n=this;if(!n.eventsListeners||n.destroyed||typeof e!="function")return n;const a=r?"unshift":"push";return t.split(" ").forEach(h=>{n.eventsListeners[h]||(n.eventsListeners[h]=[]),n.eventsListeners[h][a](e)}),n},once(t,e,r){const n=this;if(!n.eventsListeners||n.destroyed||typeof e!="function")return n;function a(){n.off(t,a),a.__emitterProxy&&delete a.__emitterProxy;for(var h=arguments.length,x=new Array(h),f=0;f<h;f++)x[f]=arguments[f];e.apply(n,x)}return a.__emitterProxy=e,n.on(t,a,r)},onAny(t,e){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;const n=e?"unshift":"push";return r.eventsAnyListeners.indexOf(t)<0&&r.eventsAnyListeners[n](t),r},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed||!e.eventsAnyListeners)return e;const r=e.eventsAnyListeners.indexOf(t);return r>=0&&e.eventsAnyListeners.splice(r,1),e},off(t,e){const r=this;return!r.eventsListeners||r.destroyed||!r.eventsListeners||t.split(" ").forEach(n=>{typeof e>"u"?r.eventsListeners[n]=[]:r.eventsListeners[n]&&r.eventsListeners[n].forEach((a,h)=>{(a===e||a.__emitterProxy&&a.__emitterProxy===e)&&r.eventsListeners[n].splice(h,1)})}),r},emit(){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsListeners)return t;let e,r,n;for(var a=arguments.length,h=new Array(a),x=0;x<a;x++)h[x]=arguments[x];return typeof h[0]=="string"||Array.isArray(h[0])?(e=h[0],r=h.slice(1,h.length),n=t):(e=h[0].events,r=h[0].data,n=h[0].context||t),r.unshift(n),(Array.isArray(e)?e:e.split(" ")).forEach(s=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(d=>{d.apply(n,[s,...r])}),t.eventsListeners&&t.eventsListeners[s]&&t.eventsListeners[s].forEach(d=>{d.apply(n,r)})}),t}};function oI(){const t=this;let e,r;const n=t.el;typeof t.params.width<"u"&&t.params.width!==null?e=t.params.width:e=n.clientWidth,typeof t.params.height<"u"&&t.params.height!==null?r=t.params.height:r=n.clientHeight,!(e===0&&t.isHorizontal()||r===0&&t.isVertical())&&(e=e-parseInt(lf(n,"padding-left")||0,10)-parseInt(lf(n,"padding-right")||0,10),r=r-parseInt(lf(n,"padding-top")||0,10)-parseInt(lf(n,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(r)&&(r=0),Object.assign(t,{width:e,height:r,size:t.isHorizontal()?e:r}))}function aI(){const t=this;function e(U,te){return parseFloat(U.getPropertyValue(t.getDirectionLabel(te))||0)}const r=t.params,{wrapperEl:n,slidesEl:a,size:h,rtlTranslate:x,wrongRTL:f}=t,s=t.virtual&&r.virtual.enabled,d=s?t.virtual.slides.length:t.slides.length,m=$l(a,`.${t.params.slideClass}, swiper-slide`),o=s?t.virtual.slides.length:m.length;let l=[];const u=[],p=[];let w=r.slidesOffsetBefore;typeof w=="function"&&(w=r.slidesOffsetBefore.call(t));let _=r.slidesOffsetAfter;typeof _=="function"&&(_=r.slidesOffsetAfter.call(t));const v=t.snapGrid.length,y=t.slidesGrid.length;let T=r.spaceBetween,C=-w,P=0,O=0;if(typeof h>"u")return;typeof T=="string"&&T.indexOf("%")>=0?T=parseFloat(T.replace("%",""))/100*h:typeof T=="string"&&(T=parseFloat(T)),t.virtualSize=-T,m.forEach(U=>{x?U.style.marginLeft="":U.style.marginRight="",U.style.marginBottom="",U.style.marginTop=""}),r.centeredSlides&&r.cssMode&&($_(n,"--swiper-centered-offset-before",""),$_(n,"--swiper-centered-offset-after",""));const D=r.grid&&r.grid.rows>1&&t.grid;D?t.grid.initSlides(m):t.grid&&t.grid.unsetSlides();let L;const W=r.slidesPerView==="auto"&&r.breakpoints&&Object.keys(r.breakpoints).filter(U=>typeof r.breakpoints[U].slidesPerView<"u").length>0;for(let U=0;U<o;U+=1){L=0;let te;if(m[U]&&(te=m[U]),D&&t.grid.updateSlide(U,te,m),!(m[U]&&lf(te,"display")==="none")){if(r.slidesPerView==="auto"){W&&(m[U].style[t.getDirectionLabel("width")]="");const pe=getComputedStyle(te),ne=te.style.transform,ye=te.style.webkitTransform;if(ne&&(te.style.transform="none"),ye&&(te.style.webkitTransform="none"),r.roundLengths)L=t.isHorizontal()?lw(te,"width",!0):lw(te,"height",!0);else{const ce=e(pe,"width"),Me=e(pe,"padding-left"),ke=e(pe,"padding-right"),ve=e(pe,"margin-left"),K=e(pe,"margin-right"),re=pe.getPropertyValue("box-sizing");if(re&&re==="border-box")L=ce+ve+K;else{const{clientWidth:X,offsetWidth:N}=te;L=ce+Me+ke+ve+K+(N-X)}}ne&&(te.style.transform=ne),ye&&(te.style.webkitTransform=ye),r.roundLengths&&(L=Math.floor(L))}else L=(h-(r.slidesPerView-1)*T)/r.slidesPerView,r.roundLengths&&(L=Math.floor(L)),m[U]&&(m[U].style[t.getDirectionLabel("width")]=`${L}px`);m[U]&&(m[U].swiperSlideSize=L),p.push(L),r.centeredSlides?(C=C+L/2+P/2+T,P===0&&U!==0&&(C=C-h/2-T),U===0&&(C=C-h/2-T),Math.abs(C)<1/1e3&&(C=0),r.roundLengths&&(C=Math.floor(C)),O%r.slidesPerGroup===0&&l.push(C),u.push(C)):(r.roundLengths&&(C=Math.floor(C)),(O-Math.min(t.params.slidesPerGroupSkip,O))%t.params.slidesPerGroup===0&&l.push(C),u.push(C),C=C+L+T),t.virtualSize+=L+T,P=L,O+=1}}if(t.virtualSize=Math.max(t.virtualSize,h)+_,x&&f&&(r.effect==="slide"||r.effect==="coverflow")&&(n.style.width=`${t.virtualSize+T}px`),r.setWrapperSize&&(n.style[t.getDirectionLabel("width")]=`${t.virtualSize+T}px`),D&&t.grid.updateWrapperSize(L,l),!r.centeredSlides){const U=[];for(let te=0;te<l.length;te+=1){let pe=l[te];r.roundLengths&&(pe=Math.floor(pe)),l[te]<=t.virtualSize-h&&U.push(pe)}l=U,Math.floor(t.virtualSize-h)-Math.floor(l[l.length-1])>1&&l.push(t.virtualSize-h)}if(s&&r.loop){const U=p[0]+T;if(r.slidesPerGroup>1){const te=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/r.slidesPerGroup),pe=U*r.slidesPerGroup;for(let ne=0;ne<te;ne+=1)l.push(l[l.length-1]+pe)}for(let te=0;te<t.virtual.slidesBefore+t.virtual.slidesAfter;te+=1)r.slidesPerGroup===1&&l.push(l[l.length-1]+U),u.push(u[u.length-1]+U),t.virtualSize+=U}if(l.length===0&&(l=[0]),T!==0){const U=t.isHorizontal()&&x?"marginLeft":t.getDirectionLabel("marginRight");m.filter((te,pe)=>!r.cssMode||r.loop?!0:pe!==m.length-1).forEach(te=>{te.style[U]=`${T}px`})}if(r.centeredSlides&&r.centeredSlidesBounds){let U=0;p.forEach(pe=>{U+=pe+(T||0)}),U-=T;const te=U>h?U-h:0;l=l.map(pe=>pe<=0?-w:pe>te?te+_:pe)}if(r.centerInsufficientSlides){let U=0;p.forEach(pe=>{U+=pe+(T||0)}),U-=T;const te=(r.slidesOffsetBefore||0)+(r.slidesOffsetAfter||0);if(U+te<h){const pe=(h-U-te)/2;l.forEach((ne,ye)=>{l[ye]=ne-pe}),u.forEach((ne,ye)=>{u[ye]=ne+pe})}}if(Object.assign(t,{slides:m,snapGrid:l,slidesGrid:u,slidesSizesGrid:p}),r.centeredSlides&&r.cssMode&&!r.centeredSlidesBounds){$_(n,"--swiper-centered-offset-before",`${-l[0]}px`),$_(n,"--swiper-centered-offset-after",`${t.size/2-p[p.length-1]/2}px`);const U=-t.snapGrid[0],te=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(pe=>pe+U),t.slidesGrid=t.slidesGrid.map(pe=>pe+te)}if(o!==d&&t.emit("slidesLengthChange"),l.length!==v&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),u.length!==y&&t.emit("slidesGridLengthChange"),r.watchSlidesProgress&&t.updateSlidesOffset(),t.emit("slidesUpdated"),!s&&!r.cssMode&&(r.effect==="slide"||r.effect==="fade")){const U=`${r.containerModifierClass}backface-hidden`,te=t.el.classList.contains(U);o<=r.maxBackfaceHiddenSlides?te||t.el.classList.add(U):te&&t.el.classList.remove(U)}}function lI(t){const e=this,r=[],n=e.virtual&&e.params.virtual.enabled;let a=0,h;typeof t=="number"?e.setTransition(t):t===!0&&e.setTransition(e.params.speed);const x=f=>n?e.slides[e.getSlideIndexByData(f)]:e.slides[f];if(e.params.slidesPerView!=="auto"&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(f=>{r.push(f)});else for(h=0;h<Math.ceil(e.params.slidesPerView);h+=1){const f=e.activeIndex+h;if(f>e.slides.length&&!n)break;r.push(x(f))}else r.push(x(e.activeIndex));for(h=0;h<r.length;h+=1)if(typeof r[h]<"u"){const f=r[h].offsetHeight;a=f>a?f:a}(a||a===0)&&(e.wrapperEl.style.height=`${a}px`)}function uI(){const t=this,e=t.slides,r=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let n=0;n<e.length;n+=1)e[n].swiperSlideOffset=(t.isHorizontal()?e[n].offsetLeft:e[n].offsetTop)-r-t.cssOverflowAdjustment()}const ab=(t,e,r)=>{e&&!t.classList.contains(r)?t.classList.add(r):!e&&t.classList.contains(r)&&t.classList.remove(r)};function cI(t){t===void 0&&(t=this&&this.translate||0);const e=this,r=e.params,{slides:n,rtlTranslate:a,snapGrid:h}=e;if(n.length===0)return;typeof n[0].swiperSlideOffset>"u"&&e.updateSlidesOffset();let x=-t;a&&(x=t),e.visibleSlidesIndexes=[],e.visibleSlides=[];let f=r.spaceBetween;typeof f=="string"&&f.indexOf("%")>=0?f=parseFloat(f.replace("%",""))/100*e.size:typeof f=="string"&&(f=parseFloat(f));for(let s=0;s<n.length;s+=1){const d=n[s];let m=d.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(m-=n[0].swiperSlideOffset);const o=(x+(r.centeredSlides?e.minTranslate():0)-m)/(d.swiperSlideSize+f),l=(x-h[0]+(r.centeredSlides?e.minTranslate():0)-m)/(d.swiperSlideSize+f),u=-(x-m),p=u+e.slidesSizesGrid[s],w=u>=0&&u<=e.size-e.slidesSizesGrid[s],_=u>=0&&u<e.size-1||p>1&&p<=e.size||u<=0&&p>=e.size;_&&(e.visibleSlides.push(d),e.visibleSlidesIndexes.push(s)),ab(d,_,r.slideVisibleClass),ab(d,w,r.slideFullyVisibleClass),d.progress=a?-o:o,d.originalProgress=a?-l:l}}function dI(t){const e=this;if(typeof t>"u"){const m=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*m||0}const r=e.params,n=e.maxTranslate()-e.minTranslate();let{progress:a,isBeginning:h,isEnd:x,progressLoop:f}=e;const s=h,d=x;if(n===0)a=0,h=!0,x=!0;else{a=(t-e.minTranslate())/n;const m=Math.abs(t-e.minTranslate())<1,o=Math.abs(t-e.maxTranslate())<1;h=m||a<=0,x=o||a>=1,m&&(a=0),o&&(a=1)}if(r.loop){const m=e.getSlideIndexByData(0),o=e.getSlideIndexByData(e.slides.length-1),l=e.slidesGrid[m],u=e.slidesGrid[o],p=e.slidesGrid[e.slidesGrid.length-1],w=Math.abs(t);w>=l?f=(w-l)/p:f=(w+p-u)/p,f>1&&(f-=1)}Object.assign(e,{progress:a,progressLoop:f,isBeginning:h,isEnd:x}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&e.updateSlidesProgress(t),h&&!s&&e.emit("reachBeginning toEdge"),x&&!d&&e.emit("reachEnd toEdge"),(s&&!h||d&&!x)&&e.emit("fromEdge"),e.emit("progress",a)}const r0=(t,e,r)=>{e&&!t.classList.contains(r)?t.classList.add(r):!e&&t.classList.contains(r)&&t.classList.remove(r)};function fI(){const t=this,{slides:e,params:r,slidesEl:n,activeIndex:a}=t,h=t.virtual&&r.virtual.enabled,x=t.grid&&r.grid&&r.grid.rows>1,f=o=>$l(n,`.${r.slideClass}${o}, swiper-slide${o}`)[0];let s,d,m;if(h)if(r.loop){let o=a-t.virtual.slidesBefore;o<0&&(o=t.virtual.slides.length+o),o>=t.virtual.slides.length&&(o-=t.virtual.slides.length),s=f(`[data-swiper-slide-index="${o}"]`)}else s=f(`[data-swiper-slide-index="${a}"]`);else x?(s=e.find(o=>o.column===a),m=e.find(o=>o.column===a+1),d=e.find(o=>o.column===a-1)):s=e[a];s&&(x||(m=Jk(s,`.${r.slideClass}, swiper-slide`)[0],r.loop&&!m&&(m=e[0]),d=Qk(s,`.${r.slideClass}, swiper-slide`)[0],r.loop&&!d===0&&(d=e[e.length-1]))),e.forEach(o=>{r0(o,o===s,r.slideActiveClass),r0(o,o===m,r.slideNextClass),r0(o,o===d,r.slidePrevClass)}),t.emitSlidesClasses()}const Q_=(t,e)=>{if(!t||t.destroyed||!t.params)return;const r=()=>t.isElement?"swiper-slide":`.${t.params.slideClass}`,n=e.closest(r());if(n){let a=n.querySelector(`.${t.params.lazyPreloaderClass}`);!a&&t.isElement&&(n.shadowRoot?a=n.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{n.shadowRoot&&(a=n.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`),a&&a.remove())})),a&&a.remove()}},n0=(t,e)=>{if(!t.slides[e])return;const r=t.slides[e].querySelector('[loading="lazy"]');r&&r.removeAttribute("loading")},uw=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const r=t.slides.length;if(!r||!e||e<0)return;e=Math.min(e,r);const n=t.params.slidesPerView==="auto"?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),a=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const x=a,f=[x-e];f.push(...Array.from({length:e}).map((s,d)=>x+n+d)),t.slides.forEach((s,d)=>{f.includes(s.column)&&n0(t,d)});return}const h=a+n-1;if(t.params.rewind||t.params.loop)for(let x=a-e;x<=h+e;x+=1){const f=(x%r+r)%r;(f<a||f>h)&&n0(t,f)}else for(let x=Math.max(a-e,0);x<=Math.min(h+e,r-1);x+=1)x!==a&&(x>h||x<a)&&n0(t,x)};function hI(t){const{slidesGrid:e,params:r}=t,n=t.rtlTranslate?t.translate:-t.translate;let a;for(let h=0;h<e.length;h+=1)typeof e[h+1]<"u"?n>=e[h]&&n<e[h+1]-(e[h+1]-e[h])/2?a=h:n>=e[h]&&n<e[h+1]&&(a=h+1):n>=e[h]&&(a=h);return r.normalizeSlideIndex&&(a<0||typeof a>"u")&&(a=0),a}function pI(t){const e=this,r=e.rtlTranslate?e.translate:-e.translate,{snapGrid:n,params:a,activeIndex:h,realIndex:x,snapIndex:f}=e;let s=t,d;const m=u=>{let p=u-e.virtual.slidesBefore;return p<0&&(p=e.virtual.slides.length+p),p>=e.virtual.slides.length&&(p-=e.virtual.slides.length),p};if(typeof s>"u"&&(s=hI(e)),n.indexOf(r)>=0)d=n.indexOf(r);else{const u=Math.min(a.slidesPerGroupSkip,s);d=u+Math.floor((s-u)/a.slidesPerGroup)}if(d>=n.length&&(d=n.length-1),s===h&&!e.params.loop){d!==f&&(e.snapIndex=d,e.emit("snapIndexChange"));return}if(s===h&&e.params.loop&&e.virtual&&e.params.virtual.enabled){e.realIndex=m(s);return}const o=e.grid&&a.grid&&a.grid.rows>1;let l;if(e.virtual&&a.virtual.enabled&&a.loop)l=m(s);else if(o){const u=e.slides.find(w=>w.column===s);let p=parseInt(u.getAttribute("data-swiper-slide-index"),10);Number.isNaN(p)&&(p=Math.max(e.slides.indexOf(u),0)),l=Math.floor(p/a.grid.rows)}else if(e.slides[s]){const u=e.slides[s].getAttribute("data-swiper-slide-index");u?l=parseInt(u,10):l=s}else l=s;Object.assign(e,{previousSnapIndex:f,snapIndex:d,previousRealIndex:x,realIndex:l,previousIndex:h,activeIndex:s}),e.initialized&&uw(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&(x!==l&&e.emit("realIndexChange"),e.emit("slideChange"))}function mI(t,e){const r=this,n=r.params;let a=t.closest(`.${n.slideClass}, swiper-slide`);!a&&r.isElement&&e&&e.length>1&&e.includes(t)&&[...e.slice(e.indexOf(t)+1,e.length)].forEach(f=>{!a&&f.matches&&f.matches(`.${n.slideClass}, swiper-slide`)&&(a=f)});let h=!1,x;if(a){for(let f=0;f<r.slides.length;f+=1)if(r.slides[f]===a){h=!0,x=f;break}}if(a&&h)r.clickedSlide=a,r.virtual&&r.params.virtual.enabled?r.clickedIndex=parseInt(a.getAttribute("data-swiper-slide-index"),10):r.clickedIndex=x;else{r.clickedSlide=void 0,r.clickedIndex=void 0;return}n.slideToClickedSlide&&r.clickedIndex!==void 0&&r.clickedIndex!==r.activeIndex&&r.slideToClickedSlide()}var gI={updateSize:oI,updateSlides:aI,updateAutoHeight:lI,updateSlidesOffset:uI,updateSlidesProgress:cI,updateProgress:dI,updateSlidesClasses:fI,updateActiveIndex:pI,updateClickedSlide:mI};function _I(t){t===void 0&&(t=this.isHorizontal()?"x":"y");const e=this,{params:r,rtlTranslate:n,translate:a,wrapperEl:h}=e;if(r.virtualTranslate)return n?-a:a;if(r.cssMode)return a;let x=Kk(h,t);return x+=e.cssOverflowAdjustment(),n&&(x=-x),x||0}function vI(t,e){const r=this,{rtlTranslate:n,params:a,wrapperEl:h,progress:x}=r;let f=0,s=0;const d=0;r.isHorizontal()?f=n?-t:t:s=t,a.roundLengths&&(f=Math.floor(f),s=Math.floor(s)),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?f:s,a.cssMode?h[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-f:-s:a.virtualTranslate||(r.isHorizontal()?f-=r.cssOverflowAdjustment():s-=r.cssOverflowAdjustment(),h.style.transform=`translate3d(${f}px, ${s}px, ${d}px)`);let m;const o=r.maxTranslate()-r.minTranslate();o===0?m=0:m=(t-r.minTranslate())/o,m!==x&&r.updateProgress(t),r.emit("setTranslate",r.translate,e)}function yI(){return-this.snapGrid[0]}function wI(){return-this.snapGrid[this.snapGrid.length-1]}function xI(t,e,r,n,a){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),n===void 0&&(n=!0);const h=this,{params:x,wrapperEl:f}=h;if(h.animating&&x.preventInteractionOnTransition)return!1;const s=h.minTranslate(),d=h.maxTranslate();let m;if(n&&t>s?m=s:n&&t<d?m=d:m=t,h.updateProgress(m),x.cssMode){const o=h.isHorizontal();if(e===0)f[o?"scrollLeft":"scrollTop"]=-m;else{if(!h.support.smoothScroll)return PS({swiper:h,targetPosition:-m,side:o?"left":"top"}),!0;f.scrollTo({[o?"left":"top"]:-m,behavior:"smooth"})}return!0}return e===0?(h.setTransition(0),h.setTranslate(m),r&&(h.emit("beforeTransitionStart",e,a),h.emit("transitionEnd"))):(h.setTransition(e),h.setTranslate(m),r&&(h.emit("beforeTransitionStart",e,a),h.emit("transitionStart")),h.animating||(h.animating=!0,h.onTranslateToWrapperTransitionEnd||(h.onTranslateToWrapperTransitionEnd=function(l){!h||h.destroyed||l.target===this&&(h.wrapperEl.removeEventListener("transitionend",h.onTranslateToWrapperTransitionEnd),h.onTranslateToWrapperTransitionEnd=null,delete h.onTranslateToWrapperTransitionEnd,h.animating=!1,r&&h.emit("transitionEnd"))}),h.wrapperEl.addEventListener("transitionend",h.onTranslateToWrapperTransitionEnd))),!0}var bI={getTranslate:_I,setTranslate:vI,minTranslate:yI,maxTranslate:wI,translateTo:xI};function MI(t,e){const r=this;r.params.cssMode||(r.wrapperEl.style.transitionDuration=`${t}ms`,r.wrapperEl.style.transitionDelay=t===0?"0ms":""),r.emit("setTransition",t,e)}function DS(t){let{swiper:e,runCallbacks:r,direction:n,step:a}=t;const{activeIndex:h,previousIndex:x}=e;let f=n;f||(h>x?f="next":h<x?f="prev":f="reset"),e.emit(`transition${a}`),r&&f==="reset"?e.emit(`slideResetTransition${a}`):r&&h!==x&&(e.emit(`slideChangeTransition${a}`),f==="next"?e.emit(`slideNextTransition${a}`):e.emit(`slidePrevTransition${a}`))}function TI(t,e){t===void 0&&(t=!0);const r=this,{params:n}=r;n.cssMode||(n.autoHeight&&r.updateAutoHeight(),DS({swiper:r,runCallbacks:t,direction:e,step:"Start"}))}function SI(t,e){t===void 0&&(t=!0);const r=this,{params:n}=r;r.animating=!1,!n.cssMode&&(r.setTransition(0),DS({swiper:r,runCallbacks:t,direction:e,step:"End"}))}var CI={setTransition:MI,transitionStart:TI,transitionEnd:SI};function EI(t,e,r,n,a){t===void 0&&(t=0),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const h=this;let x=t;x<0&&(x=0);const{params:f,snapGrid:s,slidesGrid:d,previousIndex:m,activeIndex:o,rtlTranslate:l,wrapperEl:u,enabled:p}=h;if(!p&&!n&&!a||h.destroyed||h.animating&&f.preventInteractionOnTransition)return!1;typeof e>"u"&&(e=h.params.speed);const w=Math.min(h.params.slidesPerGroupSkip,x);let _=w+Math.floor((x-w)/h.params.slidesPerGroup);_>=s.length&&(_=s.length-1);const v=-s[_];if(f.normalizeSlideIndex)for(let D=0;D<d.length;D+=1){const L=-Math.floor(v*100),W=Math.floor(d[D]*100),U=Math.floor(d[D+1]*100);typeof d[D+1]<"u"?L>=W&&L<U-(U-W)/2?x=D:L>=W&&L<U&&(x=D+1):L>=W&&(x=D)}if(h.initialized&&x!==o&&(!h.allowSlideNext&&(l?v>h.translate&&v>h.minTranslate():v<h.translate&&v<h.minTranslate())||!h.allowSlidePrev&&v>h.translate&&v>h.maxTranslate()&&(o||0)!==x))return!1;x!==(m||0)&&r&&h.emit("beforeSlideChangeStart"),h.updateProgress(v);let y;x>o?y="next":x<o?y="prev":y="reset";const T=h.virtual&&h.params.virtual.enabled;if(!(T&&a)&&(l&&-v===h.translate||!l&&v===h.translate))return h.updateActiveIndex(x),f.autoHeight&&h.updateAutoHeight(),h.updateSlidesClasses(),f.effect!=="slide"&&h.setTranslate(v),y!=="reset"&&(h.transitionStart(r,y),h.transitionEnd(r,y)),!1;if(f.cssMode){const D=h.isHorizontal(),L=l?v:-v;if(e===0)T&&(h.wrapperEl.style.scrollSnapType="none",h._immediateVirtual=!0),T&&!h._cssModeVirtualInitialSet&&h.params.initialSlide>0?(h._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{u[D?"scrollLeft":"scrollTop"]=L})):u[D?"scrollLeft":"scrollTop"]=L,T&&requestAnimationFrame(()=>{h.wrapperEl.style.scrollSnapType="",h._immediateVirtual=!1});else{if(!h.support.smoothScroll)return PS({swiper:h,targetPosition:L,side:D?"left":"top"}),!0;u.scrollTo({[D?"left":"top"]:L,behavior:"smooth"})}return!0}const O=AS().isSafari;return T&&!a&&O&&h.isElement&&h.virtual.update(!1,!1,x),h.setTransition(e),h.setTranslate(v),h.updateActiveIndex(x),h.updateSlidesClasses(),h.emit("beforeTransitionStart",e,n),h.transitionStart(r,y),e===0?h.transitionEnd(r,y):h.animating||(h.animating=!0,h.onSlideToWrapperTransitionEnd||(h.onSlideToWrapperTransitionEnd=function(L){!h||h.destroyed||L.target===this&&(h.wrapperEl.removeEventListener("transitionend",h.onSlideToWrapperTransitionEnd),h.onSlideToWrapperTransitionEnd=null,delete h.onSlideToWrapperTransitionEnd,h.transitionEnd(r,y))}),h.wrapperEl.addEventListener("transitionend",h.onSlideToWrapperTransitionEnd)),!0}function PI(t,e,r,n){t===void 0&&(t=0),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const a=this;if(a.destroyed)return;typeof e>"u"&&(e=a.params.speed);const h=a.grid&&a.params.grid&&a.params.grid.rows>1;let x=t;if(a.params.loop)if(a.virtual&&a.params.virtual.enabled)x=x+a.virtual.slidesBefore;else{let f;if(h){const l=x*a.params.grid.rows;f=a.slides.find(u=>u.getAttribute("data-swiper-slide-index")*1===l).column}else f=a.getSlideIndexByData(x);const s=h?Math.ceil(a.slides.length/a.params.grid.rows):a.slides.length,{centeredSlides:d}=a.params;let m=a.params.slidesPerView;m==="auto"?m=a.slidesPerViewDynamic():(m=Math.ceil(parseFloat(a.params.slidesPerView,10)),d&&m%2===0&&(m=m+1));let o=s-f<m;if(d&&(o=o||f<Math.ceil(m/2)),n&&d&&a.params.slidesPerView!=="auto"&&!h&&(o=!1),o){const l=d?f<a.activeIndex?"prev":"next":f-a.activeIndex-1<a.params.slidesPerView?"next":"prev";a.loopFix({direction:l,slideTo:!0,activeSlideIndex:l==="next"?f+1:f-s+1,slideRealIndex:l==="next"?a.realIndex:void 0})}if(h){const l=x*a.params.grid.rows;x=a.slides.find(u=>u.getAttribute("data-swiper-slide-index")*1===l).column}else x=a.getSlideIndexByData(x)}return requestAnimationFrame(()=>{a.slideTo(x,e,r,n)}),a}function OI(t,e,r){e===void 0&&(e=!0);const n=this,{enabled:a,params:h,animating:x}=n;if(!a||n.destroyed)return n;typeof t>"u"&&(t=n.params.speed);let f=h.slidesPerGroup;h.slidesPerView==="auto"&&h.slidesPerGroup===1&&h.slidesPerGroupAuto&&(f=Math.max(n.slidesPerViewDynamic("current",!0),1));const s=n.activeIndex<h.slidesPerGroupSkip?1:f,d=n.virtual&&h.virtual.enabled;if(h.loop){if(x&&!d&&h.loopPreventsSliding)return!1;if(n.loopFix({direction:"next"}),n._clientLeft=n.wrapperEl.clientLeft,n.activeIndex===n.slides.length-1&&h.cssMode)return requestAnimationFrame(()=>{n.slideTo(n.activeIndex+s,t,e,r)}),!0}return h.rewind&&n.isEnd?n.slideTo(0,t,e,r):n.slideTo(n.activeIndex+s,t,e,r)}function kI(t,e,r){e===void 0&&(e=!0);const n=this,{params:a,snapGrid:h,slidesGrid:x,rtlTranslate:f,enabled:s,animating:d}=n;if(!s||n.destroyed)return n;typeof t>"u"&&(t=n.params.speed);const m=n.virtual&&a.virtual.enabled;if(a.loop){if(d&&!m&&a.loopPreventsSliding)return!1;n.loopFix({direction:"prev"}),n._clientLeft=n.wrapperEl.clientLeft}const o=f?n.translate:-n.translate;function l(y){return y<0?-Math.floor(Math.abs(y)):Math.floor(y)}const u=l(o),p=h.map(y=>l(y)),w=a.freeMode&&a.freeMode.enabled;let _=h[p.indexOf(u)-1];if(typeof _>"u"&&(a.cssMode||w)){let y;h.forEach((T,C)=>{u>=T&&(y=C)}),typeof y<"u"&&(_=w?h[y]:h[y>0?y-1:y])}let v=0;if(typeof _<"u"&&(v=x.indexOf(_),v<0&&(v=n.activeIndex-1),a.slidesPerView==="auto"&&a.slidesPerGroup===1&&a.slidesPerGroupAuto&&(v=v-n.slidesPerViewDynamic("previous",!0)+1,v=Math.max(v,0))),a.rewind&&n.isBeginning){const y=n.params.virtual&&n.params.virtual.enabled&&n.virtual?n.virtual.slides.length-1:n.slides.length-1;return n.slideTo(y,t,e,r)}else if(a.loop&&n.activeIndex===0&&a.cssMode)return requestAnimationFrame(()=>{n.slideTo(v,t,e,r)}),!0;return n.slideTo(v,t,e,r)}function II(t,e,r){e===void 0&&(e=!0);const n=this;if(!n.destroyed)return typeof t>"u"&&(t=n.params.speed),n.slideTo(n.activeIndex,t,e,r)}function AI(t,e,r,n){e===void 0&&(e=!0),n===void 0&&(n=.5);const a=this;if(a.destroyed)return;typeof t>"u"&&(t=a.params.speed);let h=a.activeIndex;const x=Math.min(a.params.slidesPerGroupSkip,h),f=x+Math.floor((h-x)/a.params.slidesPerGroup),s=a.rtlTranslate?a.translate:-a.translate;if(s>=a.snapGrid[f]){const d=a.snapGrid[f],m=a.snapGrid[f+1];s-d>(m-d)*n&&(h+=a.params.slidesPerGroup)}else{const d=a.snapGrid[f-1],m=a.snapGrid[f];s-d<=(m-d)*n&&(h-=a.params.slidesPerGroup)}return h=Math.max(h,0),h=Math.min(h,a.slidesGrid.length-1),a.slideTo(h,t,e,r)}function DI(){const t=this;if(t.destroyed)return;const{params:e,slidesEl:r}=t,n=e.slidesPerView==="auto"?t.slidesPerViewDynamic():e.slidesPerView;let a=t.getSlideIndexWhenGrid(t.clickedIndex),h;const x=t.isElement?"swiper-slide":`.${e.slideClass}`,f=t.grid&&t.params.grid&&t.params.grid.rows>1;if(e.loop){if(t.animating)return;h=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?t.slideToLoop(h):a>(f?(t.slides.length-n)/2-(t.params.grid.rows-1):t.slides.length-n)?(t.loopFix(),a=t.getSlideIndex($l(r,`${x}[data-swiper-slide-index="${h}"]`)[0]),ES(()=>{t.slideTo(a)})):t.slideTo(a)}else t.slideTo(a)}var FI={slideTo:EI,slideToLoop:PI,slideNext:OI,slidePrev:kI,slideReset:II,slideToClosest:AI,slideToClickedSlide:DI};function LI(t,e){const r=this,{params:n,slidesEl:a}=r;if(!n.loop||r.virtual&&r.params.virtual.enabled)return;const h=()=>{$l(a,`.${n.slideClass}, swiper-slide`).forEach((u,p)=>{u.setAttribute("data-swiper-slide-index",p)})},x=()=>{const l=$l(a,`.${n.slideBlankClass}`);l.forEach(u=>{u.remove()}),l.length>0&&(r.recalcSlides(),r.updateSlides())},f=r.grid&&n.grid&&n.grid.rows>1;n.loopAddBlankSlides&&(n.slidesPerGroup>1||f)&&x();const s=n.slidesPerGroup*(f?n.grid.rows:1),d=r.slides.length%s!==0,m=f&&r.slides.length%n.grid.rows!==0,o=l=>{for(let u=0;u<l;u+=1){const p=r.isElement?Av("swiper-slide",[n.slideBlankClass]):Av("div",[n.slideClass,n.slideBlankClass]);r.slidesEl.append(p)}};if(d){if(n.loopAddBlankSlides){const l=s-r.slides.length%s;o(l),r.recalcSlides(),r.updateSlides()}else Iv("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");h()}else if(m){if(n.loopAddBlankSlides){const l=n.grid.rows-r.slides.length%n.grid.rows;o(l),r.recalcSlides(),r.updateSlides()}else Iv("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");h()}else h();r.loopFix({slideRealIndex:t,direction:n.centeredSlides?void 0:"next",initial:e})}function $I(t){let{slideRealIndex:e,slideTo:r=!0,direction:n,setTranslate:a,activeSlideIndex:h,initial:x,byController:f,byMousewheel:s}=t===void 0?{}:t;const d=this;if(!d.params.loop)return;d.emit("beforeLoopFix");const{slides:m,allowSlidePrev:o,allowSlideNext:l,slidesEl:u,params:p}=d,{centeredSlides:w,initialSlide:_}=p;if(d.allowSlidePrev=!0,d.allowSlideNext=!0,d.virtual&&p.virtual.enabled){r&&(!p.centeredSlides&&d.snapIndex===0?d.slideTo(d.virtual.slides.length,0,!1,!0):p.centeredSlides&&d.snapIndex<p.slidesPerView?d.slideTo(d.virtual.slides.length+d.snapIndex,0,!1,!0):d.snapIndex===d.snapGrid.length-1&&d.slideTo(d.virtual.slidesBefore,0,!1,!0)),d.allowSlidePrev=o,d.allowSlideNext=l,d.emit("loopFix");return}let v=p.slidesPerView;v==="auto"?v=d.slidesPerViewDynamic():(v=Math.ceil(parseFloat(p.slidesPerView,10)),w&&v%2===0&&(v=v+1));const y=p.slidesPerGroupAuto?v:p.slidesPerGroup;let T=w?Math.max(y,Math.ceil(v/2)):y;T%y!==0&&(T+=y-T%y),T+=p.loopAdditionalSlides,d.loopedSlides=T;const C=d.grid&&p.grid&&p.grid.rows>1;m.length<v+T||d.params.effect==="cards"&&m.length<v+T*2?Iv("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled or not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):C&&p.grid.fill==="row"&&Iv("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const P=[],O=[],D=C?Math.ceil(m.length/p.grid.rows):m.length,L=x&&D-_<v&&!w;let W=L?_:d.activeIndex;typeof h>"u"?h=d.getSlideIndex(m.find(Me=>Me.classList.contains(p.slideActiveClass))):W=h;const U=n==="next"||!n,te=n==="prev"||!n;let pe=0,ne=0;const ce=(C?m[h].column:h)+(w&&typeof a>"u"?-v/2+.5:0);if(ce<T){pe=Math.max(T-ce,y);for(let Me=0;Me<T-ce;Me+=1){const ke=Me-Math.floor(Me/D)*D;if(C){const ve=D-ke-1;for(let K=m.length-1;K>=0;K-=1)m[K].column===ve&&P.push(K)}else P.push(D-ke-1)}}else if(ce+v>D-T){ne=Math.max(ce-(D-T*2),y),L&&(ne=Math.max(ne,v-D+_+1));for(let Me=0;Me<ne;Me+=1){const ke=Me-Math.floor(Me/D)*D;C?m.forEach((ve,K)=>{ve.column===ke&&O.push(K)}):O.push(ke)}}if(d.__preventObserver__=!0,requestAnimationFrame(()=>{d.__preventObserver__=!1}),d.params.effect==="cards"&&m.length<v+T*2&&(O.includes(h)&&O.splice(O.indexOf(h),1),P.includes(h)&&P.splice(P.indexOf(h),1)),te&&P.forEach(Me=>{m[Me].swiperLoopMoveDOM=!0,u.prepend(m[Me]),m[Me].swiperLoopMoveDOM=!1}),U&&O.forEach(Me=>{m[Me].swiperLoopMoveDOM=!0,u.append(m[Me]),m[Me].swiperLoopMoveDOM=!1}),d.recalcSlides(),p.slidesPerView==="auto"?d.updateSlides():C&&(P.length>0&&te||O.length>0&&U)&&d.slides.forEach((Me,ke)=>{d.grid.updateSlide(ke,Me,d.slides)}),p.watchSlidesProgress&&d.updateSlidesOffset(),r){if(P.length>0&&te){if(typeof e>"u"){const Me=d.slidesGrid[W],ve=d.slidesGrid[W+pe]-Me;s?d.setTranslate(d.translate-ve):(d.slideTo(W+Math.ceil(pe),0,!1,!0),a&&(d.touchEventsData.startTranslate=d.touchEventsData.startTranslate-ve,d.touchEventsData.currentTranslate=d.touchEventsData.currentTranslate-ve))}else if(a){const Me=C?P.length/p.grid.rows:P.length;d.slideTo(d.activeIndex+Me,0,!1,!0),d.touchEventsData.currentTranslate=d.translate}}else if(O.length>0&&U)if(typeof e>"u"){const Me=d.slidesGrid[W],ve=d.slidesGrid[W-ne]-Me;s?d.setTranslate(d.translate-ve):(d.slideTo(W-ne,0,!1,!0),a&&(d.touchEventsData.startTranslate=d.touchEventsData.startTranslate-ve,d.touchEventsData.currentTranslate=d.touchEventsData.currentTranslate-ve))}else{const Me=C?O.length/p.grid.rows:O.length;d.slideTo(d.activeIndex-Me,0,!1,!0)}}if(d.allowSlidePrev=o,d.allowSlideNext=l,d.controller&&d.controller.control&&!f){const Me={slideRealIndex:e,direction:n,setTranslate:a,activeSlideIndex:h,byController:!0};Array.isArray(d.controller.control)?d.controller.control.forEach(ke=>{!ke.destroyed&&ke.params.loop&&ke.loopFix({...Me,slideTo:ke.params.slidesPerView===p.slidesPerView?r:!1})}):d.controller.control instanceof d.constructor&&d.controller.control.params.loop&&d.controller.control.loopFix({...Me,slideTo:d.controller.control.params.slidesPerView===p.slidesPerView?r:!1})}d.emit("loopFix")}function RI(){const t=this,{params:e,slidesEl:r}=t;if(!e.loop||!r||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const n=[];t.slides.forEach(a=>{const h=typeof a.swiperSlideIndex>"u"?a.getAttribute("data-swiper-slide-index")*1:a.swiperSlideIndex;n[h]=a}),t.slides.forEach(a=>{a.removeAttribute("data-swiper-slide-index")}),n.forEach(a=>{r.append(a)}),t.recalcSlides(),t.slideTo(t.realIndex,0)}var BI={loopCreate:LI,loopFix:$I,loopDestroy:RI};function zI(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const r=e.params.touchEventsTarget==="container"?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),r.style.cursor="move",r.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})}function jI(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t[t.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}var NI={setGrabCursor:zI,unsetGrabCursor:jI};function UI(t,e){e===void 0&&(e=this);function r(n){if(!n||n===Hp()||n===ks())return null;n.assignedSlot&&(n=n.assignedSlot);const a=n.closest(t);return!a&&!n.getRootNode?null:a||r(n.getRootNode().host)}return r(e)}function lb(t,e,r){const n=ks(),{params:a}=t,h=a.edgeSwipeDetection,x=a.edgeSwipeThreshold;return h&&(r<=x||r>=n.innerWidth-x)?h==="prevent"?(e.preventDefault(),!0):!1:!0}function VI(t){const e=this,r=Hp();let n=t;n.originalEvent&&(n=n.originalEvent);const a=e.touchEventsData;if(n.type==="pointerdown"){if(a.pointerId!==null&&a.pointerId!==n.pointerId)return;a.pointerId=n.pointerId}else n.type==="touchstart"&&n.targetTouches.length===1&&(a.touchId=n.targetTouches[0].identifier);if(n.type==="touchstart"){lb(e,n,n.targetTouches[0].pageX);return}const{params:h,touches:x,enabled:f}=e;if(!f||!h.simulateTouch&&n.pointerType==="mouse"||e.animating&&h.preventInteractionOnTransition)return;!e.animating&&h.cssMode&&h.loop&&e.loopFix();let s=n.target;if(h.touchEventsTarget==="wrapper"&&!qk(s,e.wrapperEl)||"which"in n&&n.which===3||"button"in n&&n.button>0||a.isTouched&&a.isMoved)return;const d=!!h.noSwipingClass&&h.noSwipingClass!=="",m=n.composedPath?n.composedPath():n.path;d&&n.target&&n.target.shadowRoot&&m&&(s=m[0]);const o=h.noSwipingSelector?h.noSwipingSelector:`.${h.noSwipingClass}`,l=!!(n.target&&n.target.shadowRoot);if(h.noSwiping&&(l?UI(o,s):s.closest(o))){e.allowClick=!0;return}if(h.swipeHandler&&!s.closest(h.swipeHandler))return;x.currentX=n.pageX,x.currentY=n.pageY;const u=x.currentX,p=x.currentY;if(!lb(e,n,u))return;Object.assign(a,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),x.startX=u,x.startY=p,a.touchStartTime=kv(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,h.threshold>0&&(a.allowThresholdMove=!1);let w=!0;s.matches(a.focusableElements)&&(w=!1,s.nodeName==="SELECT"&&(a.isTouched=!1)),r.activeElement&&r.activeElement.matches(a.focusableElements)&&r.activeElement!==s&&(n.pointerType==="mouse"||n.pointerType!=="mouse"&&!s.matches(a.focusableElements))&&r.activeElement.blur();const _=w&&e.allowTouchMove&&h.touchStartPreventDefault;(h.touchStartForcePreventDefault||_)&&!s.isContentEditable&&n.preventDefault(),h.freeMode&&h.freeMode.enabled&&e.freeMode&&e.animating&&!h.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",n)}function WI(t){const e=Hp(),r=this,n=r.touchEventsData,{params:a,touches:h,rtlTranslate:x,enabled:f}=r;if(!f||!a.simulateTouch&&t.pointerType==="mouse")return;let s=t;if(s.originalEvent&&(s=s.originalEvent),s.type==="pointermove"&&(n.touchId!==null||s.pointerId!==n.pointerId))return;let d;if(s.type==="touchmove"){if(d=[...s.changedTouches].find(O=>O.identifier===n.touchId),!d||d.identifier!==n.touchId)return}else d=s;if(!n.isTouched){n.startMoving&&n.isScrolling&&r.emit("touchMoveOpposite",s);return}const m=d.pageX,o=d.pageY;if(s.preventedByNestedSwiper){h.startX=m,h.startY=o;return}if(!r.allowTouchMove){s.target.matches(n.focusableElements)||(r.allowClick=!1),n.isTouched&&(Object.assign(h,{startX:m,startY:o,currentX:m,currentY:o}),n.touchStartTime=kv());return}if(a.touchReleaseOnEdges&&!a.loop)if(r.isVertical()){if(o<h.startY&&r.translate<=r.maxTranslate()||o>h.startY&&r.translate>=r.minTranslate()){n.isTouched=!1,n.isMoved=!1;return}}else{if(x&&(m>h.startX&&-r.translate<=r.maxTranslate()||m<h.startX&&-r.translate>=r.minTranslate()))return;if(!x&&(m<h.startX&&r.translate<=r.maxTranslate()||m>h.startX&&r.translate>=r.minTranslate()))return}if(e.activeElement&&e.activeElement.matches(n.focusableElements)&&e.activeElement!==s.target&&s.pointerType!=="mouse"&&e.activeElement.blur(),e.activeElement&&s.target===e.activeElement&&s.target.matches(n.focusableElements)){n.isMoved=!0,r.allowClick=!1;return}n.allowTouchCallbacks&&r.emit("touchMove",s),h.previousX=h.currentX,h.previousY=h.currentY,h.currentX=m,h.currentY=o;const l=h.currentX-h.startX,u=h.currentY-h.startY;if(r.params.threshold&&Math.sqrt(l**2+u**2)<r.params.threshold)return;if(typeof n.isScrolling>"u"){let O;r.isHorizontal()&&h.currentY===h.startY||r.isVertical()&&h.currentX===h.startX?n.isScrolling=!1:l*l+u*u>=25&&(O=Math.atan2(Math.abs(u),Math.abs(l))*180/Math.PI,n.isScrolling=r.isHorizontal()?O>a.touchAngle:90-O>a.touchAngle)}if(n.isScrolling&&r.emit("touchMoveOpposite",s),typeof n.startMoving>"u"&&(h.currentX!==h.startX||h.currentY!==h.startY)&&(n.startMoving=!0),n.isScrolling||s.type==="touchmove"&&n.preventTouchMoveFromPointerMove){n.isTouched=!1;return}if(!n.startMoving)return;r.allowClick=!1,!a.cssMode&&s.cancelable&&s.preventDefault(),a.touchMoveStopPropagation&&!a.nested&&s.stopPropagation();let p=r.isHorizontal()?l:u,w=r.isHorizontal()?h.currentX-h.previousX:h.currentY-h.previousY;a.oneWayMovement&&(p=Math.abs(p)*(x?1:-1),w=Math.abs(w)*(x?1:-1)),h.diff=p,p*=a.touchRatio,x&&(p=-p,w=-w);const _=r.touchesDirection;r.swipeDirection=p>0?"prev":"next",r.touchesDirection=w>0?"prev":"next";const v=r.params.loop&&!a.cssMode,y=r.touchesDirection==="next"&&r.allowSlideNext||r.touchesDirection==="prev"&&r.allowSlidePrev;if(!n.isMoved){if(v&&y&&r.loopFix({direction:r.swipeDirection}),n.startTranslate=r.getTranslate(),r.setTransition(0),r.animating){const O=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});r.wrapperEl.dispatchEvent(O)}n.allowMomentumBounce=!1,a.grabCursor&&(r.allowSlideNext===!0||r.allowSlidePrev===!0)&&r.setGrabCursor(!0),r.emit("sliderFirstMove",s)}let T;if(new Date().getTime(),a._loopSwapReset!==!1&&n.isMoved&&n.allowThresholdMove&&_!==r.touchesDirection&&v&&y&&Math.abs(p)>=1){Object.assign(h,{startX:m,startY:o,currentX:m,currentY:o,startTranslate:n.currentTranslate}),n.loopSwapReset=!0,n.startTranslate=n.currentTranslate;return}r.emit("sliderMove",s),n.isMoved=!0,n.currentTranslate=p+n.startTranslate;let C=!0,P=a.resistanceRatio;if(a.touchReleaseOnEdges&&(P=0),p>0?(v&&y&&!T&&n.allowThresholdMove&&n.currentTranslate>(a.centeredSlides?r.minTranslate()-r.slidesSizesGrid[r.activeIndex+1]-(a.slidesPerView!=="auto"&&r.slides.length-a.slidesPerView>=2?r.slidesSizesGrid[r.activeIndex+1]+r.params.spaceBetween:0)-r.params.spaceBetween:r.minTranslate())&&r.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),n.currentTranslate>r.minTranslate()&&(C=!1,a.resistance&&(n.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+n.startTranslate+p)**P))):p<0&&(v&&y&&!T&&n.allowThresholdMove&&n.currentTranslate<(a.centeredSlides?r.maxTranslate()+r.slidesSizesGrid[r.slidesSizesGrid.length-1]+r.params.spaceBetween+(a.slidesPerView!=="auto"&&r.slides.length-a.slidesPerView>=2?r.slidesSizesGrid[r.slidesSizesGrid.length-1]+r.params.spaceBetween:0):r.maxTranslate())&&r.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:r.slides.length-(a.slidesPerView==="auto"?r.slidesPerViewDynamic():Math.ceil(parseFloat(a.slidesPerView,10)))}),n.currentTranslate<r.maxTranslate()&&(C=!1,a.resistance&&(n.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-n.startTranslate-p)**P))),C&&(s.preventedByNestedSwiper=!0),!r.allowSlideNext&&r.swipeDirection==="next"&&n.currentTranslate<n.startTranslate&&(n.currentTranslate=n.startTranslate),!r.allowSlidePrev&&r.swipeDirection==="prev"&&n.currentTranslate>n.startTranslate&&(n.currentTranslate=n.startTranslate),!r.allowSlidePrev&&!r.allowSlideNext&&(n.currentTranslate=n.startTranslate),a.threshold>0)if(Math.abs(p)>a.threshold||n.allowThresholdMove){if(!n.allowThresholdMove){n.allowThresholdMove=!0,h.startX=h.currentX,h.startY=h.currentY,n.currentTranslate=n.startTranslate,h.diff=r.isHorizontal()?h.currentX-h.startX:h.currentY-h.startY;return}}else{n.currentTranslate=n.startTranslate;return}!a.followFinger||a.cssMode||((a.freeMode&&a.freeMode.enabled&&r.freeMode||a.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),a.freeMode&&a.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(n.currentTranslate),r.setTranslate(n.currentTranslate))}function GI(t){const e=this,r=e.touchEventsData;let n=t;n.originalEvent&&(n=n.originalEvent);let a;if(n.type==="touchend"||n.type==="touchcancel"){if(a=[...n.changedTouches].find(P=>P.identifier===r.touchId),!a||a.identifier!==r.touchId)return}else{if(r.touchId!==null||n.pointerId!==r.pointerId)return;a=n}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(n.type)&&!(["pointercancel","contextmenu"].includes(n.type)&&(e.browser.isSafari||e.browser.isWebView)))return;r.pointerId=null,r.touchId=null;const{params:x,touches:f,rtlTranslate:s,slidesGrid:d,enabled:m}=e;if(!m||!x.simulateTouch&&n.pointerType==="mouse")return;if(r.allowTouchCallbacks&&e.emit("touchEnd",n),r.allowTouchCallbacks=!1,!r.isTouched){r.isMoved&&x.grabCursor&&e.setGrabCursor(!1),r.isMoved=!1,r.startMoving=!1;return}x.grabCursor&&r.isMoved&&r.isTouched&&(e.allowSlideNext===!0||e.allowSlidePrev===!0)&&e.setGrabCursor(!1);const o=kv(),l=o-r.touchStartTime;if(e.allowClick){const P=n.path||n.composedPath&&n.composedPath();e.updateClickedSlide(P&&P[0]||n.target,P),e.emit("tap click",n),l<300&&o-r.lastClickTime<300&&e.emit("doubleTap doubleClick",n)}if(r.lastClickTime=kv(),ES(()=>{e.destroyed||(e.allowClick=!0)}),!r.isTouched||!r.isMoved||!e.swipeDirection||f.diff===0&&!r.loopSwapReset||r.currentTranslate===r.startTranslate&&!r.loopSwapReset){r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;return}r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;let u;if(x.followFinger?u=s?e.translate:-e.translate:u=-r.currentTranslate,x.cssMode)return;if(x.freeMode&&x.freeMode.enabled){e.freeMode.onTouchEnd({currentPos:u});return}const p=u>=-e.maxTranslate()&&!e.params.loop;let w=0,_=e.slidesSizesGrid[0];for(let P=0;P<d.length;P+=P<x.slidesPerGroupSkip?1:x.slidesPerGroup){const O=P<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;typeof d[P+O]<"u"?(p||u>=d[P]&&u<d[P+O])&&(w=P,_=d[P+O]-d[P]):(p||u>=d[P])&&(w=P,_=d[d.length-1]-d[d.length-2])}let v=null,y=null;x.rewind&&(e.isBeginning?y=x.virtual&&x.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(v=0));const T=(u-d[w])/_,C=w<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;if(l>x.longSwipesMs){if(!x.longSwipes){e.slideTo(e.activeIndex);return}e.swipeDirection==="next"&&(T>=x.longSwipesRatio?e.slideTo(x.rewind&&e.isEnd?v:w+C):e.slideTo(w)),e.swipeDirection==="prev"&&(T>1-x.longSwipesRatio?e.slideTo(w+C):y!==null&&T<0&&Math.abs(T)>x.longSwipesRatio?e.slideTo(y):e.slideTo(w))}else{if(!x.shortSwipes){e.slideTo(e.activeIndex);return}e.navigation&&(n.target===e.navigation.nextEl||n.target===e.navigation.prevEl)?n.target===e.navigation.nextEl?e.slideTo(w+C):e.slideTo(w):(e.swipeDirection==="next"&&e.slideTo(v!==null?v:w+C),e.swipeDirection==="prev"&&e.slideTo(y!==null?y:w))}}function ub(){const t=this,{params:e,el:r}=t;if(r&&r.offsetWidth===0)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:n,allowSlidePrev:a,snapGrid:h}=t,x=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const f=x&&e.loop;(e.slidesPerView==="auto"||e.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides&&!f?t.slideTo(t.slides.length-1,0,!1,!0):t.params.loop&&!x?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=a,t.allowSlideNext=n,t.params.watchOverflow&&h!==t.snapGrid&&t.checkOverflow()}function HI(t){const e=this;!e.enabled||e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation()))}function KI(){const t=this,{wrapperEl:e,rtlTranslate:r,enabled:n}=t;if(!n)return;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,t.translate===0&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let a;const h=t.maxTranslate()-t.minTranslate();h===0?a=0:a=(t.translate-t.minTranslate())/h,a!==t.progress&&t.updateProgress(r?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function XI(t){const e=this;Q_(e,t.target),!(e.params.cssMode||e.params.slidesPerView!=="auto"&&!e.params.autoHeight)&&e.update()}function YI(){const t=this;t.documentTouchHandlerProceeded||(t.documentTouchHandlerProceeded=!0,t.params.touchReleaseOnEdges&&(t.el.style.touchAction="auto"))}const FS=(t,e)=>{const r=Hp(),{params:n,el:a,wrapperEl:h,device:x}=t,f=!!n.nested,s=e==="on"?"addEventListener":"removeEventListener",d=e;!a||typeof a=="string"||(r[s]("touchstart",t.onDocumentTouchStart,{passive:!1,capture:f}),a[s]("touchstart",t.onTouchStart,{passive:!1}),a[s]("pointerdown",t.onTouchStart,{passive:!1}),r[s]("touchmove",t.onTouchMove,{passive:!1,capture:f}),r[s]("pointermove",t.onTouchMove,{passive:!1,capture:f}),r[s]("touchend",t.onTouchEnd,{passive:!0}),r[s]("pointerup",t.onTouchEnd,{passive:!0}),r[s]("pointercancel",t.onTouchEnd,{passive:!0}),r[s]("touchcancel",t.onTouchEnd,{passive:!0}),r[s]("pointerout",t.onTouchEnd,{passive:!0}),r[s]("pointerleave",t.onTouchEnd,{passive:!0}),r[s]("contextmenu",t.onTouchEnd,{passive:!0}),(n.preventClicks||n.preventClicksPropagation)&&a[s]("click",t.onClick,!0),n.cssMode&&h[s]("scroll",t.onScroll),n.updateOnWindowResize?t[d](x.ios||x.android?"resize orientationchange observerUpdate":"resize observerUpdate",ub,!0):t[d]("observerUpdate",ub,!0),a[s]("load",t.onLoad,{capture:!0}))};function qI(){const t=this,{params:e}=t;t.onTouchStart=VI.bind(t),t.onTouchMove=WI.bind(t),t.onTouchEnd=GI.bind(t),t.onDocumentTouchStart=YI.bind(t),e.cssMode&&(t.onScroll=KI.bind(t)),t.onClick=HI.bind(t),t.onLoad=XI.bind(t),FS(t,"on")}function QI(){FS(this,"off")}var JI={attachEvents:qI,detachEvents:QI};const cb=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;function ZI(){const t=this,{realIndex:e,initialized:r,params:n,el:a}=t,h=n.breakpoints;if(!h||h&&Object.keys(h).length===0)return;const x=Hp(),f=n.breakpointsBase==="window"||!n.breakpointsBase?n.breakpointsBase:"container",s=["window","container"].includes(n.breakpointsBase)||!n.breakpointsBase?t.el:x.querySelector(n.breakpointsBase),d=t.getBreakpoint(h,f,s);if(!d||t.currentBreakpoint===d)return;const o=(d in h?h[d]:void 0)||t.originalParams,l=cb(t,n),u=cb(t,o),p=t.params.grabCursor,w=o.grabCursor,_=n.enabled;l&&!u?(a.classList.remove(`${n.containerModifierClass}grid`,`${n.containerModifierClass}grid-column`),t.emitContainerClasses()):!l&&u&&(a.classList.add(`${n.containerModifierClass}grid`),(o.grid.fill&&o.grid.fill==="column"||!o.grid.fill&&n.grid.fill==="column")&&a.classList.add(`${n.containerModifierClass}grid-column`),t.emitContainerClasses()),p&&!w?t.unsetGrabCursor():!p&&w&&t.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(O=>{if(typeof o[O]>"u")return;const D=n[O]&&n[O].enabled,L=o[O]&&o[O].enabled;D&&!L&&t[O].disable(),!D&&L&&t[O].enable()});const v=o.direction&&o.direction!==n.direction,y=n.loop&&(o.slidesPerView!==n.slidesPerView||v),T=n.loop;v&&r&&t.changeDirection(),xo(t.params,o);const C=t.params.enabled,P=t.params.loop;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),_&&!C?t.disable():!_&&C&&t.enable(),t.currentBreakpoint=d,t.emit("_beforeBreakpoint",o),r&&(y?(t.loopDestroy(),t.loopCreate(e),t.updateSlides()):!T&&P?(t.loopCreate(e),t.updateSlides()):T&&!P&&t.loopDestroy()),t.emit("breakpoint",o)}function eA(t,e,r){if(e===void 0&&(e="window"),!t||e==="container"&&!r)return;let n=!1;const a=ks(),h=e==="window"?a.innerHeight:r.clientHeight,x=Object.keys(t).map(f=>{if(typeof f=="string"&&f.indexOf("@")===0){const s=parseFloat(f.substr(1));return{value:h*s,point:f}}return{value:f,point:f}});x.sort((f,s)=>parseInt(f.value,10)-parseInt(s.value,10));for(let f=0;f<x.length;f+=1){const{point:s,value:d}=x[f];e==="window"?a.matchMedia(`(min-width: ${d}px)`).matches&&(n=s):d<=r.clientWidth&&(n=s)}return n||"max"}var tA={setBreakpoint:ZI,getBreakpoint:eA};function rA(t,e){const r=[];return t.forEach(n=>{typeof n=="object"?Object.keys(n).forEach(a=>{n[a]&&r.push(e+a)}):typeof n=="string"&&r.push(e+n)}),r}function nA(){const t=this,{classNames:e,params:r,rtl:n,el:a,device:h}=t,x=rA(["initialized",r.direction,{"free-mode":t.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:n},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&r.grid.fill==="column"},{android:h.android},{ios:h.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);e.push(...x),a.classList.add(...e),t.emitContainerClasses()}function iA(){const t=this,{el:e,classNames:r}=t;!e||typeof e=="string"||(e.classList.remove(...r),t.emitContainerClasses())}var sA={addClasses:nA,removeClasses:iA};function oA(){const t=this,{isLocked:e,params:r}=t,{slidesOffsetBefore:n}=r;if(n){const a=t.slides.length-1,h=t.slidesGrid[a]+t.slidesSizesGrid[a]+n*2;t.isLocked=t.size>h}else t.isLocked=t.snapGrid.length===1;r.allowSlideNext===!0&&(t.allowSlideNext=!t.isLocked),r.allowSlidePrev===!0&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var aA={checkOverflow:oA},cw={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function lA(t,e){return function(n){n===void 0&&(n={});const a=Object.keys(n)[0],h=n[a];if(typeof h!="object"||h===null){xo(e,n);return}if(t[a]===!0&&(t[a]={enabled:!0}),a==="navigation"&&t[a]&&t[a].enabled&&!t[a].prevEl&&!t[a].nextEl&&(t[a].auto=!0),["pagination","scrollbar"].indexOf(a)>=0&&t[a]&&t[a].enabled&&!t[a].el&&(t[a].auto=!0),!(a in t&&"enabled"in h)){xo(e,n);return}typeof t[a]=="object"&&!("enabled"in t[a])&&(t[a].enabled=!0),t[a]||(t[a]={enabled:!1}),xo(e,n)}}const i0={eventsEmitter:sI,update:gI,translate:bI,transition:CI,slide:FI,loop:BI,grabCursor:NI,events:JI,breakpoints:tA,checkOverflow:aA,classes:sA},s0={};class Jo{constructor(){let e,r;for(var n=arguments.length,a=new Array(n),h=0;h<n;h++)a[h]=arguments[h];a.length===1&&a[0].constructor&&Object.prototype.toString.call(a[0]).slice(8,-1)==="Object"?r=a[0]:[e,r]=a,r||(r={}),r=xo({},r),e&&!r.el&&(r.el=e);const x=Hp();if(r.el&&typeof r.el=="string"&&x.querySelectorAll(r.el).length>1){const m=[];return x.querySelectorAll(r.el).forEach(o=>{const l=xo({},r,{el:o});m.push(new Jo(l))}),m}const f=this;f.__swiper__=!0,f.support=kS(),f.device=IS({userAgent:r.userAgent}),f.browser=AS(),f.eventsListeners={},f.eventsAnyListeners=[],f.modules=[...f.__modules__],r.modules&&Array.isArray(r.modules)&&f.modules.push(...r.modules);const s={};f.modules.forEach(m=>{m({params:r,swiper:f,extendParams:lA(r,s),on:f.on.bind(f),once:f.once.bind(f),off:f.off.bind(f),emit:f.emit.bind(f)})});const d=xo({},cw,s);return f.params=xo({},d,s0,r),f.originalParams=xo({},f.params),f.passedParams=xo({},r),f.params&&f.params.on&&Object.keys(f.params.on).forEach(m=>{f.on(m,f.params.on[m])}),f.params&&f.params.onAny&&f.onAny(f.params.onAny),Object.assign(f,{enabled:f.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return f.params.direction==="horizontal"},isVertical(){return f.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:f.params.allowSlideNext,allowSlidePrev:f.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:f.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:f.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),f.emit("_swiper"),f.params.init&&f.init(),f}getDirectionLabel(e){return this.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}getSlideIndex(e){const{slidesEl:r,params:n}=this,a=$l(r,`.${n.slideClass}, swiper-slide`),h=Dv(a[0]);return Dv(e)-h}getSlideIndexByData(e){return this.getSlideIndex(this.slides.find(r=>r.getAttribute("data-swiper-slide-index")*1===e))}getSlideIndexWhenGrid(e){return this.grid&&this.params.grid&&this.params.grid.rows>1&&(this.params.grid.fill==="column"?e=Math.floor(e/this.params.grid.rows):this.params.grid.fill==="row"&&(e=e%Math.ceil(this.slides.length/this.params.grid.rows))),e}recalcSlides(){const e=this,{slidesEl:r,params:n}=e;e.slides=$l(r,`.${n.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;!e.enabled||(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,r){const n=this;e=Math.min(Math.max(e,0),1);const a=n.minTranslate(),x=(n.maxTranslate()-a)*e+a;n.translateTo(x,typeof r>"u"?0:r),n.updateActiveIndex(),n.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=e.el.className.split(" ").filter(n=>n.indexOf("swiper")===0||n.indexOf(e.params.containerModifierClass)===0);e.emit("_containerClasses",r.join(" "))}getSlideClasses(e){const r=this;return r.destroyed?"":e.className.split(" ").filter(n=>n.indexOf("swiper-slide")===0||n.indexOf(r.params.slideClass)===0).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=[];e.slides.forEach(n=>{const a=e.getSlideClasses(n);r.push({slideEl:n,classNames:a}),e.emit("_slideClass",n,a)}),e.emit("_slideClasses",r)}slidesPerViewDynamic(e,r){e===void 0&&(e="current"),r===void 0&&(r=!1);const n=this,{params:a,slides:h,slidesGrid:x,slidesSizesGrid:f,size:s,activeIndex:d}=n;let m=1;if(typeof a.slidesPerView=="number")return a.slidesPerView;if(a.centeredSlides){let o=h[d]?Math.ceil(h[d].swiperSlideSize):0,l;for(let u=d+1;u<h.length;u+=1)h[u]&&!l&&(o+=Math.ceil(h[u].swiperSlideSize),m+=1,o>s&&(l=!0));for(let u=d-1;u>=0;u-=1)h[u]&&!l&&(o+=h[u].swiperSlideSize,m+=1,o>s&&(l=!0))}else if(e==="current")for(let o=d+1;o<h.length;o+=1)(r?x[o]+f[o]-x[d]<s:x[o]-x[d]<s)&&(m+=1);else for(let o=d-1;o>=0;o-=1)x[d]-x[o]<s&&(m+=1);return m}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:r,params:n}=e;n.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach(x=>{x.complete&&Q_(e,x)}),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses();function a(){const x=e.rtlTranslate?e.translate*-1:e.translate,f=Math.min(Math.max(x,e.maxTranslate()),e.minTranslate());e.setTranslate(f),e.updateActiveIndex(),e.updateSlidesClasses()}let h;if(n.freeMode&&n.freeMode.enabled&&!n.cssMode)a(),n.autoHeight&&e.updateAutoHeight();else{if((n.slidesPerView==="auto"||n.slidesPerView>1)&&e.isEnd&&!n.centeredSlides){const x=e.virtual&&n.virtual.enabled?e.virtual.slides:e.slides;h=e.slideTo(x.length-1,0,!1,!0)}else h=e.slideTo(e.activeIndex,0,!1,!0);h||a()}n.watchOverflow&&r!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,r){r===void 0&&(r=!0);const n=this,a=n.params.direction;return e||(e=a==="horizontal"?"vertical":"horizontal"),e===a||e!=="horizontal"&&e!=="vertical"||(n.el.classList.remove(`${n.params.containerModifierClass}${a}`),n.el.classList.add(`${n.params.containerModifierClass}${e}`),n.emitContainerClasses(),n.params.direction=e,n.slides.forEach(h=>{e==="vertical"?h.style.width="":h.style.height=""}),n.emit("changeDirection"),r&&n.update()),n}changeLanguageDirection(e){const r=this;r.rtl&&e==="rtl"||!r.rtl&&e==="ltr"||(r.rtl=e==="rtl",r.rtlTranslate=r.params.direction==="horizontal"&&r.rtl,r.rtl?(r.el.classList.add(`${r.params.containerModifierClass}rtl`),r.el.dir="rtl"):(r.el.classList.remove(`${r.params.containerModifierClass}rtl`),r.el.dir="ltr"),r.update())}mount(e){const r=this;if(r.mounted)return!0;let n=e||r.params.el;if(typeof n=="string"&&(n=document.querySelector(n)),!n)return!1;n.swiper=r,n.parentNode&&n.parentNode.host&&n.parentNode.host.nodeName===r.params.swiperElementNodeName.toUpperCase()&&(r.isElement=!0);const a=()=>`.${(r.params.wrapperClass||"").trim().split(" ").join(".")}`;let x=(()=>n&&n.shadowRoot&&n.shadowRoot.querySelector?n.shadowRoot.querySelector(a()):$l(n,a())[0])();return!x&&r.params.createElements&&(x=Av("div",r.params.wrapperClass),n.append(x),$l(n,`.${r.params.slideClass}`).forEach(f=>{x.append(f)})),Object.assign(r,{el:n,wrapperEl:x,slidesEl:r.isElement&&!n.parentNode.host.slideSlots?n.parentNode.host:x,hostEl:r.isElement?n.parentNode.host:n,mounted:!0,rtl:n.dir.toLowerCase()==="rtl"||lf(n,"direction")==="rtl",rtlTranslate:r.params.direction==="horizontal"&&(n.dir.toLowerCase()==="rtl"||lf(n,"direction")==="rtl"),wrongRTL:lf(x,"display")==="-webkit-box"}),!0}init(e){const r=this;if(r.initialized||r.mount(e)===!1)return r;r.emit("beforeInit"),r.params.breakpoints&&r.setBreakpoint(),r.addClasses(),r.updateSize(),r.updateSlides(),r.params.watchOverflow&&r.checkOverflow(),r.params.grabCursor&&r.enabled&&r.setGrabCursor(),r.params.loop&&r.virtual&&r.params.virtual.enabled?r.slideTo(r.params.initialSlide+r.virtual.slidesBefore,0,r.params.runCallbacksOnInit,!1,!0):r.slideTo(r.params.initialSlide,0,r.params.runCallbacksOnInit,!1,!0),r.params.loop&&r.loopCreate(void 0,!0),r.attachEvents();const a=[...r.el.querySelectorAll('[loading="lazy"]')];return r.isElement&&a.push(...r.hostEl.querySelectorAll('[loading="lazy"]')),a.forEach(h=>{h.complete?Q_(r,h):h.addEventListener("load",x=>{Q_(r,x.target)})}),uw(r),r.initialized=!0,uw(r),r.emit("init"),r.emit("afterInit"),r}destroy(e,r){e===void 0&&(e=!0),r===void 0&&(r=!0);const n=this,{params:a,el:h,wrapperEl:x,slides:f}=n;return typeof n.params>"u"||n.destroyed||(n.emit("beforeDestroy"),n.initialized=!1,n.detachEvents(),a.loop&&n.loopDestroy(),r&&(n.removeClasses(),h&&typeof h!="string"&&h.removeAttribute("style"),x&&x.removeAttribute("style"),f&&f.length&&f.forEach(s=>{s.classList.remove(a.slideVisibleClass,a.slideFullyVisibleClass,a.slideActiveClass,a.slideNextClass,a.slidePrevClass),s.removeAttribute("style"),s.removeAttribute("data-swiper-slide-index")})),n.emit("destroy"),Object.keys(n.eventsListeners).forEach(s=>{n.off(s)}),e!==!1&&(n.el&&typeof n.el!="string"&&(n.el.swiper=null),Gk(n)),n.destroyed=!0),null}static extendDefaults(e){xo(s0,e)}static get extendedDefaults(){return s0}static get defaults(){return cw}static installModule(e){Jo.prototype.__modules__||(Jo.prototype.__modules__=[]);const r=Jo.prototype.__modules__;typeof e=="function"&&r.indexOf(e)<0&&r.push(e)}static use(e){return Array.isArray(e)?(e.forEach(r=>Jo.installModule(r)),Jo):(Jo.installModule(e),Jo)}}Object.keys(i0).forEach(t=>{Object.keys(i0[t]).forEach(e=>{Jo.prototype[e]=i0[t][e]})});Jo.use([nI,iI]);const LS=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function Vp(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"&&!t.__swiper__}function rg(t,e){const r=["__proto__","constructor","prototype"];Object.keys(e).filter(n=>r.indexOf(n)<0).forEach(n=>{typeof t[n]>"u"?t[n]=e[n]:Vp(e[n])&&Vp(t[n])&&Object.keys(e[n]).length>0?e[n].__swiper__?t[n]=e[n]:rg(t[n],e[n]):t[n]=e[n]})}function $S(t){return t===void 0&&(t={}),t.navigation&&typeof t.navigation.nextEl>"u"&&typeof t.navigation.prevEl>"u"}function RS(t){return t===void 0&&(t={}),t.pagination&&typeof t.pagination.el>"u"}function BS(t){return t===void 0&&(t={}),t.scrollbar&&typeof t.scrollbar.el>"u"}function zS(t){t===void 0&&(t="");const e=t.split(" ").map(n=>n.trim()).filter(n=>!!n),r=[];return e.forEach(n=>{r.indexOf(n)<0&&r.push(n)}),r.join(" ")}function uA(t){return t===void 0&&(t=""),t?t.includes("swiper-wrapper")?t:`swiper-wrapper ${t}`:"swiper-wrapper"}function cA(t){let{swiper:e,slides:r,passedParams:n,changedParams:a,nextEl:h,prevEl:x,scrollbarEl:f,paginationEl:s}=t;const d=a.filter(W=>W!=="children"&&W!=="direction"&&W!=="wrapperClass"),{params:m,pagination:o,navigation:l,scrollbar:u,virtual:p,thumbs:w}=e;let _,v,y,T,C,P,O,D;a.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&!n.thumbs.swiper.destroyed&&m.thumbs&&(!m.thumbs.swiper||m.thumbs.swiper.destroyed)&&(_=!0),a.includes("controller")&&n.controller&&n.controller.control&&m.controller&&!m.controller.control&&(v=!0),a.includes("pagination")&&n.pagination&&(n.pagination.el||s)&&(m.pagination||m.pagination===!1)&&o&&!o.el&&(y=!0),a.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||f)&&(m.scrollbar||m.scrollbar===!1)&&u&&!u.el&&(T=!0),a.includes("navigation")&&n.navigation&&(n.navigation.prevEl||x)&&(n.navigation.nextEl||h)&&(m.navigation||m.navigation===!1)&&l&&!l.prevEl&&!l.nextEl&&(C=!0);const L=W=>{!e[W]||(e[W].destroy(),W==="navigation"?(e.isElement&&(e[W].prevEl.remove(),e[W].nextEl.remove()),m[W].prevEl=void 0,m[W].nextEl=void 0,e[W].prevEl=void 0,e[W].nextEl=void 0):(e.isElement&&e[W].el.remove(),m[W].el=void 0,e[W].el=void 0))};a.includes("loop")&&e.isElement&&(m.loop&&!n.loop?P=!0:!m.loop&&n.loop?O=!0:D=!0),d.forEach(W=>{if(Vp(m[W])&&Vp(n[W]))Object.assign(m[W],n[W]),(W==="navigation"||W==="pagination"||W==="scrollbar")&&"enabled"in n[W]&&!n[W].enabled&&L(W);else{const U=n[W];(U===!0||U===!1)&&(W==="navigation"||W==="pagination"||W==="scrollbar")?U===!1&&L(W):m[W]=n[W]}}),d.includes("controller")&&!v&&e.controller&&e.controller.control&&m.controller&&m.controller.control&&(e.controller.control=m.controller.control),a.includes("children")&&r&&p&&m.virtual.enabled?(p.slides=r,p.update(!0)):a.includes("virtual")&&p&&m.virtual.enabled&&(r&&(p.slides=r),p.update(!0)),a.includes("children")&&r&&m.loop&&(D=!0),_&&w.init()&&w.update(!0),v&&(e.controller.control=m.controller.control),y&&(e.isElement&&(!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-pagination"),s.part.add("pagination"),e.el.appendChild(s)),s&&(m.pagination.el=s),o.init(),o.render(),o.update()),T&&(e.isElement&&(!f||typeof f=="string")&&(f=document.createElement("div"),f.classList.add("swiper-scrollbar"),f.part.add("scrollbar"),e.el.appendChild(f)),f&&(m.scrollbar.el=f),u.init(),u.updateSize(),u.setTranslate()),C&&(e.isElement&&((!h||typeof h=="string")&&(h=document.createElement("div"),h.classList.add("swiper-button-next"),Fv(h,e.hostEl.constructor.nextButtonSvg),h.part.add("button-next"),e.el.appendChild(h)),(!x||typeof x=="string")&&(x=document.createElement("div"),x.classList.add("swiper-button-prev"),Fv(x,e.hostEl.constructor.prevButtonSvg),x.part.add("button-prev"),e.el.appendChild(x))),h&&(m.navigation.nextEl=h),x&&(m.navigation.prevEl=x),l.init(),l.update()),a.includes("allowSlideNext")&&(e.allowSlideNext=n.allowSlideNext),a.includes("allowSlidePrev")&&(e.allowSlidePrev=n.allowSlidePrev),a.includes("direction")&&e.changeDirection(n.direction,!1),(P||D)&&e.loopDestroy(),(O||D)&&e.loopCreate(),e.update()}function dA(t,e){t===void 0&&(t={}),e===void 0&&(e=!0);const r={on:{}},n={},a={};rg(r,cw),r._emitClasses=!0,r.init=!1;const h={},x=LS.map(s=>s.replace(/_/,"")),f=Object.assign({},t);return Object.keys(f).forEach(s=>{typeof t[s]>"u"||(x.indexOf(s)>=0?Vp(t[s])?(r[s]={},a[s]={},rg(r[s],t[s]),rg(a[s],t[s])):(r[s]=t[s],a[s]=t[s]):s.search(/on[A-Z]/)===0&&typeof t[s]=="function"?e?n[`${s[2].toLowerCase()}${s.substr(3)}`]=t[s]:r.on[`${s[2].toLowerCase()}${s.substr(3)}`]=t[s]:h[s]=t[s])}),["navigation","pagination","scrollbar"].forEach(s=>{r[s]===!0&&(r[s]={}),r[s]===!1&&delete r[s]}),{params:r,passedParams:a,rest:h,events:n}}function fA(t,e){let{el:r,nextEl:n,prevEl:a,paginationEl:h,scrollbarEl:x,swiper:f}=t;$S(e)&&n&&a&&(f.params.navigation.nextEl=n,f.originalParams.navigation.nextEl=n,f.params.navigation.prevEl=a,f.originalParams.navigation.prevEl=a),RS(e)&&h&&(f.params.pagination.el=h,f.originalParams.pagination.el=h),BS(e)&&x&&(f.params.scrollbar.el=x,f.originalParams.scrollbar.el=x),f.init(r)}function hA(t,e,r,n,a){const h=[];if(!e)return h;const x=s=>{h.indexOf(s)<0&&h.push(s)};if(r&&n){const s=n.map(a),d=r.map(a);s.join("")!==d.join("")&&x("children"),n.length!==r.length&&x("children")}return LS.filter(s=>s[0]==="_").map(s=>s.replace(/_/,"")).forEach(s=>{if(s in t&&s in e)if(Vp(t[s])&&Vp(e[s])){const d=Object.keys(t[s]),m=Object.keys(e[s]);d.length!==m.length?x(s):(d.forEach(o=>{t[s][o]!==e[s][o]&&x(s)}),m.forEach(o=>{t[s][o]!==e[s][o]&&x(s)}))}else t[s]!==e[s]&&x(s)}),h}const pA=t=>{!t||t.destroyed||!t.params.virtual||t.params.virtual&&!t.params.virtual.enabled||(t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.emit("_virtualUpdated"),t.parallax&&t.params.parallax&&t.params.parallax.enabled&&t.parallax.setTranslate())};function jS(t){return t.type&&t.type.displayName&&t.type.displayName.includes("SwiperSlide")}function NS(t){const e=[];return Lp.Children.toArray(t).forEach(r=>{jS(r)?e.push(r):r.props&&r.props.children&&NS(r.props.children).forEach(n=>e.push(n))}),e}function mA(t){const e=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return Lp.Children.toArray(t).forEach(n=>{if(jS(n))e.push(n);else if(n.props&&n.props.slot&&r[n.props.slot])r[n.props.slot].push(n);else if(n.props&&n.props.children){const a=NS(n.props.children);a.length>0?a.forEach(h=>e.push(h)):r["container-end"].push(n)}else r["container-end"].push(n)}),{slides:e,slots:r}}function gA(t,e,r){if(!r)return null;const n=m=>{let o=m;return m<0?o=e.length+m:o>=e.length&&(o=o-e.length),o},a=t.isHorizontal()?{[t.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`},{from:h,to:x}=r,f=t.params.loop?-e.length:0,s=t.params.loop?e.length*2:e.length,d=[];for(let m=f;m<s;m+=1)m>=h&&m<=x&&d.push(e[n(m)]);return d.map((m,o)=>Lp.cloneElement(m,{swiper:t,style:a,key:m.props.virtualIndex||m.key||`slide-${o}`}))}function Ug(t,e){return typeof window>"u"?Wr.exports.useEffect(t,e):Wr.exports.useLayoutEffect(t,e)}const db=Wr.exports.createContext(null),_A=Wr.exports.createContext(null),vA=Wr.exports.forwardRef(function(t,e){let{className:r,tag:n="div",wrapperTag:a="div",children:h,onSwiper:x,...f}=t===void 0?{}:t,s=!1;const[d,m]=Wr.exports.useState("swiper"),[o,l]=Wr.exports.useState(null),[u,p]=Wr.exports.useState(!1),w=Wr.exports.useRef(!1),_=Wr.exports.useRef(null),v=Wr.exports.useRef(null),y=Wr.exports.useRef(null),T=Wr.exports.useRef(null),C=Wr.exports.useRef(null),P=Wr.exports.useRef(null),O=Wr.exports.useRef(null),D=Wr.exports.useRef(null),{params:L,passedParams:W,rest:U,events:te}=dA(f),{slides:pe,slots:ne}=mA(h),ye=()=>{p(!u)};Object.assign(L.on,{_containerClasses(K,re){m(re)}});const ce=()=>{Object.assign(L.on,te),s=!0;const K={...L};if(delete K.wrapperClass,v.current=new Jo(K),v.current.virtual&&v.current.params.virtual.enabled){v.current.virtual.slides=pe;const re={cache:!1,slides:pe,renderExternal:l,renderExternalUpdate:!1};rg(v.current.params.virtual,re),rg(v.current.originalParams.virtual,re)}};_.current||ce(),v.current&&v.current.on("_beforeBreakpoint",ye);const Me=()=>{s||!te||!v.current||Object.keys(te).forEach(K=>{v.current.on(K,te[K])})},ke=()=>{!te||!v.current||Object.keys(te).forEach(K=>{v.current.off(K,te[K])})};Wr.exports.useEffect(()=>()=>{v.current&&v.current.off("_beforeBreakpoint",ye)}),Wr.exports.useEffect(()=>{!w.current&&v.current&&(v.current.emitSlidesClasses(),w.current=!0)}),Ug(()=>{if(e&&(e.current=_.current),!!_.current)return v.current.destroyed&&ce(),fA({el:_.current,nextEl:C.current,prevEl:P.current,paginationEl:O.current,scrollbarEl:D.current,swiper:v.current},L),x&&!v.current.destroyed&&x(v.current),()=>{v.current&&!v.current.destroyed&&v.current.destroy(!0,!1)}},[]),Ug(()=>{Me();const K=hA(W,y.current,pe,T.current,re=>re.key);return y.current=W,T.current=pe,K.length&&v.current&&!v.current.destroyed&&cA({swiper:v.current,slides:pe,passedParams:W,changedParams:K,nextEl:C.current,prevEl:P.current,scrollbarEl:D.current,paginationEl:O.current}),()=>{ke()}}),Ug(()=>{pA(v.current)},[o]);function ve(){return L.virtual?gA(v.current,pe,o):pe.map((K,re)=>Lp.cloneElement(K,{swiper:v.current,swiperSlideIndex:re}))}return wn(n,{ref:_,className:zS(`${d}${r?` ${r}`:""}`),...U,children:Wa(_A.Provider,{value:v.current,children:[ne["container-start"],Wa(a,{className:uA(L.wrapperClass),children:[ne["wrapper-start"],ve(),ne["wrapper-end"]]}),$S(L)&&Wa(Uk,{children:[wn("div",{ref:P,className:"swiper-button-prev"}),wn("div",{ref:C,className:"swiper-button-next"})]}),BS(L)&&wn("div",{ref:D,className:"swiper-scrollbar"}),RS(L)&&wn("div",{ref:O,className:"swiper-pagination"}),ne["container-end"]]})})});vA.displayName="Swiper";const yA=Wr.exports.forwardRef(function(t,e){let{tag:r="div",children:n,className:a="",swiper:h,zoom:x,lazy:f,virtualIndex:s,swiperSlideIndex:d,...m}=t===void 0?{}:t;const o=Wr.exports.useRef(null),[l,u]=Wr.exports.useState("swiper-slide"),[p,w]=Wr.exports.useState(!1);function _(C,P,O){P===o.current&&u(O)}Ug(()=>{if(typeof d<"u"&&(o.current.swiperSlideIndex=d),e&&(e.current=o.current),!(!o.current||!h)){if(h.destroyed){l!=="swiper-slide"&&u("swiper-slide");return}return h.on("_slideClass",_),()=>{!h||h.off("_slideClass",_)}}}),Ug(()=>{h&&o.current&&!h.destroyed&&u(h.getSlideClasses(o.current))},[h]);const v={isActive:l.indexOf("swiper-slide-active")>=0,isVisible:l.indexOf("swiper-slide-visible")>=0,isPrev:l.indexOf("swiper-slide-prev")>=0,isNext:l.indexOf("swiper-slide-next")>=0},y=()=>typeof n=="function"?n(v):n,T=()=>{w(!0)};return Wa(r,{ref:o,className:zS(`${l}${a?` ${a}`:""}`),"data-swiper-slide-index":s,onLoad:T,...m,children:[x&&wn(db.Provider,{value:v,children:Wa("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof x=="number"?x:void 0,children:[y(),f&&!p&&wn("div",{className:"swiper-lazy-preloader"})]})}),!x&&Wa(db.Provider,{value:v,children:[y(),f&&!p&&wn("div",{className:"swiper-lazy-preloader"})]})]})});yA.displayName="SwiperSlide";var wA=Object.defineProperty,xA=(t,e,r)=>e in t?wA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zn=(t,e,r)=>xA(t,typeof e!="symbol"?e+"":e,r);const Lv={x:0,y:0,width:0,height:0,unit:"px"},km=(t,e,r)=>Math.min(Math.max(t,e),r),bA=(...t)=>t.filter(e=>e&&typeof e=="string").join(" "),fb=(t,e)=>t===e||t.width===e.width&&t.height===e.height&&t.x===e.x&&t.y===e.y&&t.unit===e.unit;function Im(t,e,r){return t.unit==="%"?{...Lv,...t,unit:"%"}:{unit:"%",x:t.x?t.x/e*100:0,y:t.y?t.y/r*100:0,width:t.width?t.width/e*100:0,height:t.height?t.height/r*100:0}}function Zd(t,e,r){return t.unit?t.unit==="px"?{...Lv,...t,unit:"px"}:{unit:"px",x:t.x?t.x*e/100:0,y:t.y?t.y*r/100:0,width:t.width?t.width*e/100:0,height:t.height?t.height*r/100:0}:{...Lv,...t,unit:"px"}}function hb(t,e,r,n,a,h=0,x=0,f=n,s=a){const d={...t};let m=Math.min(h,n),o=Math.min(x,a),l=Math.min(f,n),u=Math.min(s,a);e&&(e>1?(m=x?x*e:m,o=m/e,l=f*e):(o=h?h/e:o,m=o*e,u=s/e)),d.y<0&&(d.height=Math.max(d.height+d.y,o),d.y=0),d.x<0&&(d.width=Math.max(d.width+d.x,m),d.x=0);const p=n-(d.x+d.width);p<0&&(d.x=Math.min(d.x,n-m),d.width+=p);const w=a-(d.y+d.height);if(w<0&&(d.y=Math.min(d.y,a-o),d.height+=w),d.width<m&&((r==="sw"||r=="nw")&&(d.x-=m-d.width),d.width=m),d.height<o&&((r==="nw"||r=="ne")&&(d.y-=o-d.height),d.height=o),d.width>l&&((r==="sw"||r=="nw")&&(d.x-=l-d.width),d.width=l),d.height>u&&((r==="nw"||r=="ne")&&(d.y-=u-d.height),d.height=u),e){const _=d.width/d.height;if(_<e){const v=Math.max(d.width/e,o);(r==="nw"||r=="ne")&&(d.y-=v-d.height),d.height=v}else if(_>e){const v=Math.max(d.height*e,m);(r==="sw"||r=="nw")&&(d.x-=v-d.width),d.width=v}}return d}function MA(t,e,r,n){const a={...t};return e==="ArrowLeft"?n==="nw"?(a.x-=r,a.y-=r,a.width+=r,a.height+=r):n==="w"?(a.x-=r,a.width+=r):n==="sw"?(a.x-=r,a.width+=r,a.height+=r):n==="ne"?(a.y+=r,a.width-=r,a.height-=r):n==="e"?a.width-=r:n==="se"&&(a.width-=r,a.height-=r):e==="ArrowRight"&&(n==="nw"?(a.x+=r,a.y+=r,a.width-=r,a.height-=r):n==="w"?(a.x+=r,a.width-=r):n==="sw"?(a.x+=r,a.width-=r,a.height-=r):n==="ne"?(a.y-=r,a.width+=r,a.height+=r):n==="e"?a.width+=r:n==="se"&&(a.width+=r,a.height+=r)),e==="ArrowUp"?n==="nw"?(a.x-=r,a.y-=r,a.width+=r,a.height+=r):n==="n"?(a.y-=r,a.height+=r):n==="ne"?(a.y-=r,a.width+=r,a.height+=r):n==="sw"?(a.x+=r,a.width-=r,a.height-=r):n==="s"?a.height-=r:n==="se"&&(a.width-=r,a.height-=r):e==="ArrowDown"&&(n==="nw"?(a.x+=r,a.y+=r,a.width-=r,a.height-=r):n==="n"?(a.y+=r,a.height-=r):n==="ne"?(a.y+=r,a.width-=r,a.height-=r):n==="sw"?(a.x-=r,a.width+=r,a.height+=r):n==="s"?a.height+=r:n==="se"&&(a.width+=r,a.height+=r)),a}const Am={capture:!0,passive:!1};let TA=0;const ef=class za extends Wr.exports.PureComponent{constructor(){super(...arguments),zn(this,"docMoveBound",!1),zn(this,"mouseDownOnCrop",!1),zn(this,"dragStarted",!1),zn(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),zn(this,"componentRef",Wr.exports.createRef()),zn(this,"mediaRef",Wr.exports.createRef()),zn(this,"resizeObserver"),zn(this,"initChangeCalled",!1),zn(this,"instanceId",`rc-${TA++}`),zn(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),zn(this,"onCropPointerDown",e=>{const{crop:r,disabled:n}=this.props,a=this.getBox();if(!r)return;const h=Zd(r,a.width,a.height);if(n)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const x=e.target.dataset.ord,f=!!x;let s=e.clientX,d=e.clientY,m=h.x,o=h.y;if(x){const l=e.clientX-a.x,u=e.clientY-a.y;let p=0,w=0;x==="ne"||x=="e"?(p=l-(h.x+h.width),w=u-h.y,m=h.x,o=h.y+h.height):x==="se"||x==="s"?(p=l-(h.x+h.width),w=u-(h.y+h.height),m=h.x,o=h.y):x==="sw"||x=="w"?(p=l-h.x,w=u-(h.y+h.height),m=h.x+h.width,o=h.y):(x==="nw"||x=="n")&&(p=l-h.x,w=u-h.y,m=h.x+h.width,o=h.y+h.height),s=m+a.x+p,d=o+a.y+w}this.evData={startClientX:s,startClientY:d,startCropX:m,startCropY:o,clientX:e.clientX,clientY:e.clientY,isResize:f,ord:x},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),zn(this,"onComponentPointerDown",e=>{const{crop:r,disabled:n,locked:a,keepSelection:h,onChange:x}=this.props,f=this.getBox();if(n||a||h&&r)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.clientX-f.x,d=e.clientY-f.y,m={unit:"px",x:s,y:d,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:s,startCropY:d,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,x(Zd(m,f.width,f.height),Im(m,f.width,f.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),zn(this,"onDocPointerMove",e=>{const{crop:r,disabled:n,onChange:a,onDragStart:h}=this.props,x=this.getBox();if(n||!r||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,h&&h(e));const{evData:f}=this;f.clientX=e.clientX,f.clientY=e.clientY;let s;f.isResize?s=this.resizeCrop():s=this.dragCrop(),fb(r,s)||a(Zd(s,x.width,x.height),Im(s,x.width,x.height))}),zn(this,"onComponentKeyDown",e=>{const{crop:r,disabled:n,onChange:a,onComplete:h}=this.props;if(n)return;const x=e.key;let f=!1;if(!r)return;const s=this.getBox(),d=this.makePixelCrop(s),m=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?za.nudgeStepLarge:e.shiftKey?za.nudgeStepMedium:za.nudgeStep;if(x==="ArrowLeft"?(d.x-=m,f=!0):x==="ArrowRight"?(d.x+=m,f=!0):x==="ArrowUp"?(d.y-=m,f=!0):x==="ArrowDown"&&(d.y+=m,f=!0),f){e.cancelable&&e.preventDefault(),d.x=km(d.x,0,s.width-d.width),d.y=km(d.y,0,s.height-d.height);const o=Zd(d,s.width,s.height),l=Im(d,s.width,s.height);a(o,l),h&&h(o,l)}}),zn(this,"onHandlerKeyDown",(e,r)=>{const{aspect:n=0,crop:a,disabled:h,minWidth:x=0,minHeight:f=0,maxWidth:s,maxHeight:d,onChange:m,onComplete:o}=this.props,l=this.getBox();if(h||!a)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const u=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?za.nudgeStepLarge:e.shiftKey?za.nudgeStepMedium:za.nudgeStep,p=Zd(a,l.width,l.height),w=MA(p,e.key,u,r),_=hb(w,n,r,l.width,l.height,x,f,s,d);if(!fb(a,_)){const v=Im(_,l.width,l.height);m(_,v),o&&o(_,v)}}),zn(this,"onDocPointerDone",e=>{const{crop:r,disabled:n,onComplete:a,onDragEnd:h}=this.props,x=this.getBox();this.unbindDocMove(),!(n||!r)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,h&&h(e),a&&a(Zd(r,x.width,x.height),Im(r,x.width,x.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),zn(this,"onDragFocus",()=>{var e;(e=this.componentRef.current)==null||e.scrollTo(0,0)})}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:r,y:n,width:a,height:h}=e.getBoundingClientRect();return{x:r,y:n,width:a,height:h}}componentDidUpdate(e){const{crop:r,onComplete:n}=this.props;if(n&&!e.crop&&r){const{width:a,height:h}=this.getBox();a&&h&&n(Zd(r,a,h),Im(r,a,h))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,Am),this.document.addEventListener("pointerup",this.onDocPointerDone,Am),this.document.addEventListener("pointercancel",this.onDocPointerDone,Am),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,Am),this.document.removeEventListener("pointerup",this.onDocPointerDone,Am),this.document.removeEventListener("pointercancel",this.onDocPointerDone,Am),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,r=this.getBox(),n=this.makePixelCrop(r),a=e.clientX-e.startClientX,h=e.clientY-e.startClientY;return n.x=km(e.startCropX+a,0,r.width-n.width),n.y=km(e.startCropY+h,0,r.height-n.height),n}getPointRegion(e,r,n,a){const{evData:h}=this,x=h.clientX-e.x,f=h.clientY-e.y;let s;a&&r?s=r==="nw"||r==="n"||r==="ne":s=f<h.startCropY;let d;return n&&r?d=r==="nw"||r==="w"||r==="sw":d=x<h.startCropX,d?s?"nw":"sw":s?"ne":"se"}resolveMinDimensions(e,r,n=0,a=0){const h=Math.min(n,e.width),x=Math.min(a,e.height);return!r||!h&&!x?[h,x]:r>1?h?[h,h/r]:[x*r,x]:x?[x*r,x]:[h,h/r]}resizeCrop(){const{evData:e}=this,{aspect:r=0,maxWidth:n,maxHeight:a}=this.props,h=this.getBox(),[x,f]=this.resolveMinDimensions(h,r,this.props.minWidth,this.props.minHeight);let s=this.makePixelCrop(h);const d=this.getPointRegion(h,e.ord,x,f),m=e.ord||d;let o=e.clientX-e.startClientX,l=e.clientY-e.startClientY;(x&&m==="nw"||m==="w"||m==="sw")&&(o=Math.min(o,-x)),(f&&m==="nw"||m==="n"||m==="ne")&&(l=Math.min(l,-f));const u={unit:"px",x:0,y:0,width:0,height:0};d==="ne"?(u.x=e.startCropX,u.width=o,r?(u.height=u.width/r,u.y=e.startCropY-u.height):(u.height=Math.abs(l),u.y=e.startCropY-u.height)):d==="se"?(u.x=e.startCropX,u.y=e.startCropY,u.width=o,r?u.height=u.width/r:u.height=l):d==="sw"?(u.x=e.startCropX+o,u.y=e.startCropY,u.width=Math.abs(o),r?u.height=u.width/r:u.height=l):d==="nw"&&(u.x=e.startCropX+o,u.width=Math.abs(o),r?(u.height=u.width/r,u.y=e.startCropY-u.height):(u.height=Math.abs(l),u.y=e.startCropY+l));const p=hb(u,r,d,h.width,h.height,x,f,n,a);return r||za.xyOrds.indexOf(m)>-1?s=p:za.xOrds.indexOf(m)>-1?(s.x=p.x,s.width=p.width):za.yOrds.indexOf(m)>-1&&(s.y=p.y,s.height=p.height),s.x=km(s.x,0,h.width-s.width),s.y=km(s.y,0,h.height-s.height),s}renderCropSelection(){const{ariaLabels:e=za.defaultProps.ariaLabels,disabled:r,locked:n,renderSelectionAddon:a,ruleOfThirds:h,crop:x}=this.props,f=this.getCropStyle();if(x)return Wa("div",{style:f,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group",children:[!r&&!n&&Wa("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus,children:[wn("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),wn("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),wn("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),wn("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),wn("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"nw"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"n"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"ne"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"e"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"se"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"s"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"sw"),role:"button"}),wn("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:s=>this.onHandlerKeyDown(s,"w"),role:"button"})]}),a&&wn("div",{className:"ReactCrop__selection-addon",onPointerDown:s=>s.stopPropagation(),children:a(this.state)}),h&&Lp.createElement(Lp.Fragment,null,wn("div",{className:"ReactCrop__rule-of-thirds-hz"}),wn("div",{className:"ReactCrop__rule-of-thirds-vt"}))]})}makePixelCrop(e){const r={...Lv,...this.props.crop||{}};return Zd(r,e.width,e.height)}render(){const{aspect:e,children:r,circularCrop:n,className:a,crop:h,disabled:x,locked:f,style:s,ruleOfThirds:d}=this.props,{cropIsActive:m,newCropIsBeingDrawn:o}=this.state,l=h?this.renderCropSelection():null,u=bA("ReactCrop",a,m&&"ReactCrop--active",x&&"ReactCrop--disabled",f&&"ReactCrop--locked",o&&"ReactCrop--new-crop",h&&e&&"ReactCrop--fixed-aspect",h&&n&&"ReactCrop--circular-crop",h&&d&&"ReactCrop--rule-of-thirds",!this.dragStarted&&h&&!h.width&&!h.height&&"ReactCrop--invisible-crop",n&&"ReactCrop--no-animate");return Wa("div",{ref:this.componentRef,className:u,style:s,children:[wn("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown,children:r}),h?Wa("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%",children:[wn("defs",{children:Wa("mask",{id:`hole-${this.instanceId}`,children:[wn("rect",{width:"100%",height:"100%",fill:"white"}),n?wn("ellipse",{cx:`${h.x+h.width/2}${h.unit}`,cy:`${h.y+h.height/2}${h.unit}`,rx:`${h.width/2}${h.unit}`,ry:`${h.height/2}${h.unit}`,fill:"black"}):wn("rect",{x:`${h.x}${h.unit}`,y:`${h.y}${h.unit}`,width:`${h.width}${h.unit}`,height:`${h.height}${h.unit}`,fill:"black"})]})}),wn("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})]}):void 0,l]})}};zn(ef,"xOrds",["e","w"]),zn(ef,"yOrds",["n","s"]),zn(ef,"xyOrds",["nw","ne","se","sw"]),zn(ef,"nudgeStep",1),zn(ef,"nudgeStepMedium",10),zn(ef,"nudgeStepLarge",100),zn(ef,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let zD=ef;const J_=new Map,Pp=[],SA=(t,e,r)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){const n=J_.get(t);if(n===void 0)J_.set(t,{backend:e,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${r}`)}if(r>=0){const a=Pp.indexOf(t);a!==-1&&Pp.splice(a,1);for(let h=0;h<Pp.length;h++)if(J_.get(Pp[h]).priority<=r){Pp.splice(h,0,t);return}Pp.push(t)}return}throw new TypeError("not a valid backend")},CA=async t=>{const e=J_.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{const r=!!e.initPromise;try{return r||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(n){return r||(e.error=`${n}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},EA=async t=>{const e=t.executionProviders||[],r=e.map(s=>typeof s=="string"?s:s.name),n=r.length===0?Pp:r;let a;const h=[],x=new Set;for(const s of n){const d=await CA(s);typeof d=="string"?h.push({name:s,err:d}):(a||(a=d),a===d&&x.add(s))}if(!a)throw new Error(`no available backend found. ERR: ${h.map(s=>`[${s.name}] ${s.err}`).join(", ")}`);for(const{name:s,err:d}of h)r.includes(s)&&console.warn(`removing requested execution provider "${s}" from session options because it is not available: ${d}`);const f=e.filter(s=>x.has(typeof s=="string"?s:s.name));return[a,new Proxy(t,{get:(s,d)=>d==="executionProviders"?f:Reflect.get(s,d)})]},PA="1.21.0";let pb="warning";const Ka={wasm:{},webgl:{},webgpu:{},versions:{common:PA},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);pb=t}},get logLevel(){return pb}};Object.defineProperty(Ka,"logLevel",{enumerable:!0});const OA=Ka,kA=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];const n=r.getContext("2d");if(n!=null){let a,h;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(a=t.dims[2],h=t.dims[3]):(a=t.dims[3],h=t.dims[2]);const x=(e==null?void 0:e.format)!==void 0?e.format:"RGB",f=e==null?void 0:e.norm;let s,d;f===void 0||f.mean===void 0?s=[255,255,255,255]:typeof f.mean=="number"?s=[f.mean,f.mean,f.mean,f.mean]:(s=[f.mean[0],f.mean[1],f.mean[2],0],f.mean[3]!==void 0&&(s[3]=f.mean[3])),f===void 0||f.bias===void 0?d=[0,0,0,0]:typeof f.bias=="number"?d=[f.bias,f.bias,f.bias,f.bias]:(d=[f.bias[0],f.bias[1],f.bias[2],0],f.bias[3]!==void 0&&(d[3]=f.bias[3]));const m=h*a;let o=0,l=m,u=m*2,p=-1;x==="RGBA"?(o=0,l=m,u=m*2,p=m*3):x==="RGB"?(o=0,l=m,u=m*2):x==="RBG"&&(o=0,u=m,l=m*2);for(let w=0;w<h;w++)for(let _=0;_<a;_++){const v=(t.data[o++]-d[0])*s[0],y=(t.data[l++]-d[1])*s[1],T=(t.data[u++]-d[2])*s[2],C=p===-1?255:(t.data[p++]-d[3])*s[3];n.fillStyle="rgba("+v+","+y+","+T+","+C+")",n.fillRect(_,w,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},IA=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let a,h,x;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(a=t.dims[2],h=t.dims[1],x=t.dims[3]):(a=t.dims[3],h=t.dims[2],x=t.dims[1]);const f=e!==void 0&&e.format!==void 0?e.format:"RGB",s=e==null?void 0:e.norm;let d,m;s===void 0||s.mean===void 0?d=[255,255,255,255]:typeof s.mean=="number"?d=[s.mean,s.mean,s.mean,s.mean]:(d=[s.mean[0],s.mean[1],s.mean[2],255],s.mean[3]!==void 0&&(d[3]=s.mean[3])),s===void 0||s.bias===void 0?m=[0,0,0,0]:typeof s.bias=="number"?m=[s.bias,s.bias,s.bias,s.bias]:(m=[s.bias[0],s.bias[1],s.bias[2],0],s.bias[3]!==void 0&&(m[3]=s.bias[3]));const o=h*a;if(e!==void 0&&(e.format!==void 0&&x===4&&e.format!=="RGBA"||x===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const l=4;let u=0,p=1,w=2,_=3,v=0,y=o,T=o*2,C=-1;f==="RGBA"?(v=0,y=o,T=o*2,C=o*3):f==="RGB"?(v=0,y=o,T=o*2):f==="RBG"&&(v=0,T=o,y=o*2),n=r.createImageData(a,h);for(let P=0;P<h*a;u+=l,p+=l,w+=l,_+=l,P++)n.data[u]=(t.data[v++]-m[0])*d[0],n.data[p]=(t.data[y++]-m[1])*d[1],n.data[w]=(t.data[T++]-m[2])*d[2],n.data[_]=C===-1?255:(t.data[C++]-m[3])*d[3]}else throw new Error("Can not access image data");return n},o0=(t,e)=>{var P,O,D;if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=e,a=(P=e.norm)!=null?P:{mean:255,bias:0};let h,x;typeof a.mean=="number"?h=[a.mean,a.mean,a.mean,a.mean]:h=[a.mean[0],a.mean[1],a.mean[2],(O=a.mean[3])!=null?O:255],typeof a.bias=="number"?x=[a.bias,a.bias,a.bias,a.bias]:x=[a.bias[0],a.bias[1],a.bias[2],(D=a.bias[3])!=null?D:0];const f=e.format!==void 0?e.format:"RGBA",s=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",d=r*n,m=s==="RGBA"?new Float32Array(d*4):new Float32Array(d*3);let o=4,l=0,u=1,p=2,w=3,_=0,v=d,y=d*2,T=-1;f==="RGB"&&(o=3,l=0,u=1,p=2,w=-1),s==="RGBA"?T=d*3:s==="RBG"?(_=0,y=d,v=d*2):s==="BGR"&&(y=0,v=d,_=d*2);for(let L=0;L<d;L++,l+=o,p+=o,u+=o,w+=o)m[_++]=(t[l]+x[0])/h[0],m[v++]=(t[u]+x[1])/h[1],m[y++]=(t[p]+x[2])/h[2],T!==-1&&w!==-1&&(m[T++]=(t[w]+x[3])/h[3]);return s==="RGBA"?new ta("float32",m,[1,4,r,n]):new ta("float32",m,[1,3,r,n])},AA=async(t,e)=>{const r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,a=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,h=typeof t=="string";let x,f=e!=null?e:{};const s=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},d=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(r){const m=s();m.width=t.width,m.height=t.height;const o=d(m);if(o!=null){let l=t.height,u=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(l=e.resizedHeight,u=e.resizedWidth),e!==void 0){if(f=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");f.tensorFormat="RGBA",f.height=l,f.width=u}else f.tensorFormat="RGBA",f.height=l,f.width=u;o.drawImage(t,0,0),x=o.getImageData(0,0,u,l).data}else throw new Error("Can not access image data")}else if(n){let m,o;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(m=e.resizedHeight,o=e.resizedWidth):(m=t.height,o=t.width),e!==void 0&&(f=e),f.format="RGBA",f.height=m,f.width=o,e!==void 0){const l=s();l.width=o,l.height=m;const u=d(l);if(u!=null)u.putImageData(t,0,0),x=u.getImageData(0,0,o,m).data;else throw new Error("Can not access image data")}else x=t.data}else if(a){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");const m=s();m.width=t.width,m.height=t.height;const o=d(m);if(o!=null){const l=t.height,u=t.width;return o.drawImage(t,0,0,u,l),x=o.getImageData(0,0,u,l).data,f.height=l,f.width=u,o0(x,f)}else throw new Error("Can not access image data")}else{if(h)return new Promise((m,o)=>{const l=s(),u=d(l);if(!t||!u)return o();const p=new Image;p.crossOrigin="Anonymous",p.src=t,p.onload=()=>{l.width=p.width,l.height=p.height,u.drawImage(p,0,0,l.width,l.height);const w=u.getImageData(0,0,l.width,l.height);f.height=l.height,f.width=l.width,m(o0(w.data,f))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(x!==void 0)return o0(x,f);throw new Error("Input data provided is not supported - aborted tensor creation")},DA=(t,e)=>{const{width:r,height:n,download:a,dispose:h}=e,x=[1,n,r,4];return new ta({location:"texture",type:"float32",texture:t,dims:x,download:a,dispose:h})},FA=(t,e)=>{const{dataType:r,dims:n,download:a,dispose:h}=e;return new ta({location:"gpu-buffer",type:r!=null?r:"float32",gpuBuffer:t,dims:n,download:a,dispose:h})},LA=(t,e)=>{const{dataType:r,dims:n,download:a,dispose:h}=e;return new ta({location:"ml-tensor",type:r!=null?r:"float32",mlTensor:t,dims:n,download:a,dispose:h})},$A=(t,e,r)=>new ta({location:"cpu-pinned",type:t,data:e,dims:r!=null?r:[e.length]}),Ym=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Z_=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let mb=!1;const RA=()=>{if(!mb){mb=!0;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;t&&(Ym.set("int64",BigInt64Array),Z_.set(BigInt64Array,"int64")),e&&(Ym.set("uint64",BigUint64Array),Z_.set(BigUint64Array,"uint64")),n?(Ym.set("float16",r),Z_.set(r,"float16")):Ym.set("float16",Uint16Array)}},BA=t=>{let e=1;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n}return e},zA=(t,e)=>{switch(t.location){case"cpu":return new ta(t.type,t.data,e);case"cpu-pinned":return new ta({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new ta({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new ta({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new ta({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};class ta{constructor(e,r,n){RA();let a,h;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,a=e.type,h=e.dims,e.location){case"cpu-pinned":{const f=Ym.get(a);if(!f)throw new TypeError(`unsupported type "${a}" to create tensor from pinned buffer`);if(!(e.data instanceof f))throw new TypeError(`buffer should be of type ${f.name}`);this.cpuData=e.data;break}case"texture":{if(a!=="float32")throw new TypeError(`unsupported type "${a}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint64"&&a!=="int8"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let f,s;if(typeof e=="string")if(a=e,s=n,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");f=r}else{const d=Ym.get(e);if(d===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&d===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${d.name} as data.`);e==="uint64"||e==="int64"?f=d.from(r,BigInt):f=d.from(r)}else if(r instanceof d)f=r;else if(r instanceof Uint8ClampedArray)if(e==="uint8")f=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&r instanceof Uint16Array&&d!==Uint16Array)f=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${a} tensor's data must be type of ${d}`)}else if(s=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const d=typeof e[0];if(d==="string")a="string",f=e;else if(d==="boolean")a="bool",f=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${d}.`)}else if(e instanceof Uint8ClampedArray)a="uint8",f=Uint8Array.from(e);else{const d=Z_.get(e.constructor);if(d===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);a=d,f=e}if(s===void 0)s=[f.length];else if(!Array.isArray(s))throw new TypeError("A tensor's dims must be a number array");h=s,this.cpuData=f,this.dataLocation="cpu"}const x=BA(h);if(this.cpuData&&x!==this.cpuData.length&&!((a==="uint4"||a==="int4")&&Math.ceil(x/2)===this.cpuData.length))throw new Error(`Tensor's size(${x}) does not match data length(${this.cpuData.length}).`);this.type=a,this.dims=h,this.size=x}static async fromImage(e,r){return AA(e,r)}static fromTexture(e,r){return DA(e,r)}static fromGpuBuffer(e,r){return FA(e,r)}static fromMLTensor(e,r){return LA(e,r)}static fromPinnedBuffer(e,r,n){return $A(e,r,n)}toDataURL(e){return kA(this,e)}toImageData(e){return IA(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return zA(this,e)}}const $m=ta,US=(t,e)=>{(typeof Ka.trace>"u"?!Ka.wasm.trace:!Ka.trace)||console.timeStamp(`${t}::ORT::${e}`)},VS=(t,e)=>{var a;const r=((a=new Error().stack)==null?void 0:a.split(/\r\n|\r|\n/g))||[];let n=!1;for(let h=0;h<r.length;h++){if(n&&!r[h].includes("TRACE_FUNC")){let x=`FUNC_${t}::${r[h].trim().split(" ")[1]}`;e&&(x+=`::${e}`),US("CPU",x);return}r[h].includes("TRACE_FUNC")&&(n=!0)}},dw=t=>{(typeof Ka.trace>"u"?!Ka.wasm.trace:!Ka.trace)||VS("BEGIN",t)},fw=t=>{(typeof Ka.trace>"u"?!Ka.wasm.trace:!Ka.trace)||VS("END",t)};class _1{constructor(e){this.handler=e}async run(e,r,n){dw();const a={};let h={};if(typeof e!="object"||e===null||e instanceof $m||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let x=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof $m)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");x=!1;for(const d of r){if(typeof d!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(d)===-1)throw new RangeError(`'fetches' contains invalid output name: ${d}.`);a[d]=null}if(typeof n=="object"&&n!==null)h=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let d=!1;const m=Object.getOwnPropertyNames(r);for(const o of this.outputNames)if(m.indexOf(o)!==-1){const l=r[o];(l===null||l instanceof $m)&&(d=!0,x=!1,a[o]=l)}if(d){if(typeof n=="object"&&n!==null)h=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else h=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const d of this.inputNames)if(typeof e[d]>"u")throw new Error(`input '${d}' is missing in 'feeds'.`);if(x)for(const d of this.outputNames)a[d]=null;const f=await this.handler.run(e,a,h),s={};for(const d in f)if(Object.hasOwnProperty.call(f,d)){const m=f[d];m instanceof $m?s[d]=m:s[d]=new $m(m.type,m.data,m.dims)}return fw(),s}async release(){return this.handler.dispose()}static async create(e,r,n,a){dw();let h,x={};if(typeof e=="string"){if(h=e,typeof r=="object"&&r!==null)x=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(h=e,typeof r=="object"&&r!==null)x=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){const m=e;let o=0,l=e.byteLength;if(typeof r=="object"&&r!==null)x=r;else if(typeof r=="number"){if(o=r,!Number.isSafeInteger(o))throw new RangeError("'byteOffset' must be an integer.");if(o<0||o>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(l=e.byteLength-o,typeof n=="number"){if(l=n,!Number.isSafeInteger(l))throw new RangeError("'byteLength' must be an integer.");if(l<=0||o+l>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-o}].`);if(typeof a=="object"&&a!==null)x=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");h=new Uint8Array(m,o,l)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[f,s]=await EA(x),d=await f.createInferenceSessionHandler(h,s);return fw(),new _1(d)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}const jA=_1,NA=Object.freeze(Object.defineProperty({__proto__:null,registerBackend:SA,env:OA,InferenceSession:jA,Tensor:$m,TRACE:US,TRACE_FUNC_BEGIN:dw,TRACE_FUNC_END:fw},Symbol.toStringTag,{value:"Module"})),UA="modulepreload",VA=function(t){return"/apps/paintboard/"+t},gb={},WA=function(e,r,n){if(!r||r.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(r.map(h=>{if(h=VA(h),h in gb)return;gb[h]=!0;const x=h.endsWith(".css"),f=x?'[rel="stylesheet"]':"";if(!!n)for(let m=a.length-1;m>=0;m--){const o=a[m];if(o.href===h&&(!x||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${f}`))return;const d=document.createElement("link");if(d.rel=x?"stylesheet":UA,x||(d.as="script",d.crossOrigin=""),d.href=h,document.head.appendChild(d),x)return new Promise((m,o)=>{d.addEventListener("load",m),d.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${h}`)))})})).then(()=>e())};function Dm(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var v1={exports:{}};(function(t,e){var r=(()=>{var n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,x=Object.prototype.hasOwnProperty,f=(i=>typeof Dm<"u"?Dm:typeof Proxy<"u"?new Proxy(i,{get:(c,b)=>(typeof Dm<"u"?Dm:c)[b]}):i)(function(i){if(typeof Dm<"u")return Dm.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')}),s=(i,c)=>()=>(i&&(c=i(i=0)),c),d=(i,c)=>{for(var b in c)n(i,b,{get:c[b],enumerable:!0})},m=(i,c,b,S)=>{if(c&&typeof c=="object"||typeof c=="function")for(let E of h(c))!x.call(i,E)&&E!==b&&n(i,E,{get:()=>c[E],enumerable:!(S=a(c,E))||S.enumerable});return i},o=i=>m(n({},"__esModule",{value:!0}),i),l,u,p,w,_,v=s(()=>{l=new Map,u=[],p=(i,c,b)=>{if(c&&typeof c.init=="function"&&typeof c.createInferenceSessionHandler=="function"){let S=l.get(i);if(S===void 0)l.set(i,{backend:c,priority:b});else{if(S.priority>b)return;if(S.priority===b&&S.backend!==c)throw new Error(`cannot register backend "${i}" using priority ${b}`)}if(b>=0){let E=u.indexOf(i);E!==-1&&u.splice(E,1);for(let I=0;I<u.length;I++)if(l.get(u[I]).priority<=b){u.splice(I,0,i);return}u.push(i)}return}throw new TypeError("not a valid backend")},w=async i=>{let c=l.get(i);if(!c)return"backend not found.";if(c.initialized)return c.backend;if(c.aborted)return c.error;{let b=!!c.initPromise;try{return b||(c.initPromise=c.backend.init(i)),await c.initPromise,c.initialized=!0,c.backend}catch(S){return b||(c.error=`${S}`,c.aborted=!0),c.error}finally{delete c.initPromise}}},_=async i=>{let c=i.executionProviders||[],b=c.map(B=>typeof B=="string"?B:B.name),S=b.length===0?u:b,E,I=[],k=new Set;for(let B of S){let z=await w(B);typeof z=="string"?I.push({name:B,err:z}):(E||(E=z),E===z&&k.add(B))}if(!E)throw new Error(`no available backend found. ERR: ${I.map(B=>`[${B.name}] ${B.err}`).join(", ")}`);for(let{name:B,err:z}of I)b.includes(B)&&console.warn(`removing requested execution provider "${B}" from session options because it is not available: ${z}`);let $=c.filter(B=>k.has(typeof B=="string"?B:B.name));return[E,new Proxy(i,{get:(B,z)=>z==="executionProviders"?$:Reflect.get(B,z)})]}}),y=s(()=>{v()}),T,C=s(()=>{T="1.22.0-dev.20250409-89f8206ba4"}),P,O,D=s(()=>{C(),P="warning",O={wasm:{},webgl:{},webgpu:{},versions:{common:T},set logLevel(i){if(i!==void 0){if(typeof i!="string"||["verbose","info","warning","error","fatal"].indexOf(i)===-1)throw new Error(`Unsupported logging level: ${i}`);P=i}},get logLevel(){return P}},Object.defineProperty(O,"logLevel",{enumerable:!0})}),L,W=s(()=>{D(),L=O}),U,te,pe=s(()=>{U=(i,c)=>{let b=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);b.width=i.dims[3],b.height=i.dims[2];let S=b.getContext("2d");if(S!=null){let E,I;(c==null?void 0:c.tensorLayout)!==void 0&&c.tensorLayout==="NHWC"?(E=i.dims[2],I=i.dims[3]):(E=i.dims[3],I=i.dims[2]);let k=(c==null?void 0:c.format)!==void 0?c.format:"RGB",$=c==null?void 0:c.norm,B,z;$===void 0||$.mean===void 0?B=[255,255,255,255]:typeof $.mean=="number"?B=[$.mean,$.mean,$.mean,$.mean]:(B=[$.mean[0],$.mean[1],$.mean[2],0],$.mean[3]!==void 0&&(B[3]=$.mean[3])),$===void 0||$.bias===void 0?z=[0,0,0,0]:typeof $.bias=="number"?z=[$.bias,$.bias,$.bias,$.bias]:(z=[$.bias[0],$.bias[1],$.bias[2],0],$.bias[3]!==void 0&&(z[3]=$.bias[3]));let G=I*E,q=0,Z=G,se=G*2,le=-1;k==="RGBA"?(q=0,Z=G,se=G*2,le=G*3):k==="RGB"?(q=0,Z=G,se=G*2):k==="RBG"&&(q=0,se=G,Z=G*2);for(let me=0;me<I;me++)for(let Te=0;Te<E;Te++){let de=(i.data[q++]-z[0])*B[0],_e=(i.data[Z++]-z[1])*B[1],Ae=(i.data[se++]-z[2])*B[2],Oe=le===-1?255:(i.data[le++]-z[3])*B[3];S.fillStyle="rgba("+de+","+_e+","+Ae+","+Oe+")",S.fillRect(Te,me,1,1)}if("toDataURL"in b)return b.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},te=(i,c)=>{let b=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),S;if(b!=null){let E,I,k;(c==null?void 0:c.tensorLayout)!==void 0&&c.tensorLayout==="NHWC"?(E=i.dims[2],I=i.dims[1],k=i.dims[3]):(E=i.dims[3],I=i.dims[2],k=i.dims[1]);let $=c!==void 0&&c.format!==void 0?c.format:"RGB",B=c==null?void 0:c.norm,z,G;B===void 0||B.mean===void 0?z=[255,255,255,255]:typeof B.mean=="number"?z=[B.mean,B.mean,B.mean,B.mean]:(z=[B.mean[0],B.mean[1],B.mean[2],255],B.mean[3]!==void 0&&(z[3]=B.mean[3])),B===void 0||B.bias===void 0?G=[0,0,0,0]:typeof B.bias=="number"?G=[B.bias,B.bias,B.bias,B.bias]:(G=[B.bias[0],B.bias[1],B.bias[2],0],B.bias[3]!==void 0&&(G[3]=B.bias[3]));let q=I*E;if(c!==void 0&&(c.format!==void 0&&k===4&&c.format!=="RGBA"||k===3&&c.format!=="RGB"&&c.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let Z=4,se=0,le=1,me=2,Te=3,de=0,_e=q,Ae=q*2,Oe=-1;$==="RGBA"?(de=0,_e=q,Ae=q*2,Oe=q*3):$==="RGB"?(de=0,_e=q,Ae=q*2):$==="RBG"&&(de=0,Ae=q,_e=q*2),S=b.createImageData(E,I);for(let He=0;He<I*E;se+=Z,le+=Z,me+=Z,Te+=Z,He++)S.data[se]=(i.data[de++]-G[0])*z[0],S.data[le]=(i.data[_e++]-G[1])*z[1],S.data[me]=(i.data[Ae++]-G[2])*z[2],S.data[Te]=Oe===-1?255:(i.data[Oe++]-G[3])*z[3]}else throw new Error("Can not access image data");return S}}),ne,ye,ce,Me,ke,ve,K=s(()=>{Ve(),ne=(i,c)=>{var Oe,He,lt;if(i===void 0)throw new Error("Image buffer must be defined");if(c.height===void 0||c.width===void 0)throw new Error("Image height and width must be defined");if(c.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:b,width:S}=c,E=(Oe=c.norm)!=null?Oe:{mean:255,bias:0},I,k;typeof E.mean=="number"?I=[E.mean,E.mean,E.mean,E.mean]:I=[E.mean[0],E.mean[1],E.mean[2],(He=E.mean[3])!=null?He:255],typeof E.bias=="number"?k=[E.bias,E.bias,E.bias,E.bias]:k=[E.bias[0],E.bias[1],E.bias[2],(lt=E.bias[3])!=null?lt:0];let $=c.format!==void 0?c.format:"RGBA",B=c.tensorFormat!==void 0&&c.tensorFormat!==void 0?c.tensorFormat:"RGB",z=b*S,G=B==="RGBA"?new Float32Array(z*4):new Float32Array(z*3),q=4,Z=0,se=1,le=2,me=3,Te=0,de=z,_e=z*2,Ae=-1;$==="RGB"&&(q=3,Z=0,se=1,le=2,me=-1),B==="RGBA"?Ae=z*3:B==="RBG"?(Te=0,_e=z,de=z*2):B==="BGR"&&(_e=0,de=z,Te=z*2);for(let it=0;it<z;it++,Z+=q,le+=q,se+=q,me+=q)G[Te++]=(i[Z]+k[0])/I[0],G[de++]=(i[se]+k[1])/I[1],G[_e++]=(i[le]+k[2])/I[2],Ae!==-1&&me!==-1&&(G[Ae++]=(i[me]+k[3])/I[3]);return B==="RGBA"?new Ue("float32",G,[1,4,b,S]):new Ue("float32",G,[1,3,b,S])},ye=async(i,c)=>{let b=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,S=typeof ImageData<"u"&&i instanceof ImageData,E=typeof ImageBitmap<"u"&&i instanceof ImageBitmap,I=typeof i=="string",k,$=c!=null?c:{},B=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},z=G=>typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||G instanceof OffscreenCanvas?G.getContext("2d"):null;if(b){let G=B();G.width=i.width,G.height=i.height;let q=z(G);if(q!=null){let Z=i.height,se=i.width;if(c!==void 0&&c.resizedHeight!==void 0&&c.resizedWidth!==void 0&&(Z=c.resizedHeight,se=c.resizedWidth),c!==void 0){if($=c,c.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");$.tensorFormat="RGBA",$.height=Z,$.width=se}else $.tensorFormat="RGBA",$.height=Z,$.width=se;q.drawImage(i,0,0),k=q.getImageData(0,0,se,Z).data}else throw new Error("Can not access image data")}else if(S){let G,q;if(c!==void 0&&c.resizedWidth!==void 0&&c.resizedHeight!==void 0?(G=c.resizedHeight,q=c.resizedWidth):(G=i.height,q=i.width),c!==void 0&&($=c),$.format="RGBA",$.height=G,$.width=q,c!==void 0){let Z=B();Z.width=q,Z.height=G;let se=z(Z);if(se!=null)se.putImageData(i,0,0),k=se.getImageData(0,0,q,G).data;else throw new Error("Can not access image data")}else k=i.data}else if(E){if(c===void 0)throw new Error("Please provide image config with format for Imagebitmap");let G=B();G.width=i.width,G.height=i.height;let q=z(G);if(q!=null){let Z=i.height,se=i.width;return q.drawImage(i,0,0,se,Z),k=q.getImageData(0,0,se,Z).data,$.height=Z,$.width=se,ne(k,$)}else throw new Error("Can not access image data")}else{if(I)return new Promise((G,q)=>{let Z=B(),se=z(Z);if(!i||!se)return q();let le=new Image;le.crossOrigin="Anonymous",le.src=i,le.onload=()=>{Z.width=le.width,Z.height=le.height,se.drawImage(le,0,0,Z.width,Z.height);let me=se.getImageData(0,0,Z.width,Z.height);$.height=Z.height,$.width=Z.width,G(ne(me.data,$))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(k!==void 0)return ne(k,$);throw new Error("Input data provided is not supported - aborted tensor creation")},ce=(i,c)=>{let{width:b,height:S,download:E,dispose:I}=c,k=[1,S,b,4];return new Ue({location:"texture",type:"float32",texture:i,dims:k,download:E,dispose:I})},Me=(i,c)=>{let{dataType:b,dims:S,download:E,dispose:I}=c;return new Ue({location:"gpu-buffer",type:b!=null?b:"float32",gpuBuffer:i,dims:S,download:E,dispose:I})},ke=(i,c)=>{let{dataType:b,dims:S,download:E,dispose:I}=c;return new Ue({location:"ml-tensor",type:b!=null?b:"float32",mlTensor:i,dims:S,download:E,dispose:I})},ve=(i,c,b)=>new Ue({location:"cpu-pinned",type:i,data:c,dims:b!=null?b:[c.length]})}),re,X,N,ae,J=s(()=>{re=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),X=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),N=!1,ae=()=>{if(!N){N=!0;let i=typeof BigInt64Array<"u"&&BigInt64Array.from,c=typeof BigUint64Array<"u"&&BigUint64Array.from,b=globalThis.Float16Array,S=typeof b<"u"&&b.from;i&&(re.set("int64",BigInt64Array),X.set(BigInt64Array,"int64")),c&&(re.set("uint64",BigUint64Array),X.set(BigUint64Array,"uint64")),S?(re.set("float16",b),X.set(b,"float16")):re.set("float16",Uint16Array)}}}),Y,be,Ce=s(()=>{Ve(),Y=i=>{let c=1;for(let b=0;b<i.length;b++){let S=i[b];if(typeof S!="number"||!Number.isSafeInteger(S))throw new TypeError(`dims[${b}] must be an integer, got: ${S}`);if(S<0)throw new RangeError(`dims[${b}] must be a non-negative integer, got: ${S}`);c*=S}return c},be=(i,c)=>{switch(i.location){case"cpu":return new Ue(i.type,i.data,c);case"cpu-pinned":return new Ue({location:"cpu-pinned",data:i.data,type:i.type,dims:c});case"texture":return new Ue({location:"texture",texture:i.texture,type:i.type,dims:c});case"gpu-buffer":return new Ue({location:"gpu-buffer",gpuBuffer:i.gpuBuffer,type:i.type,dims:c});case"ml-tensor":return new Ue({location:"ml-tensor",mlTensor:i.mlTensor,type:i.type,dims:c});default:throw new Error(`tensorReshape: tensor location ${i.location} is not supported`)}}}),Ue,Ve=s(()=>{pe(),K(),J(),Ce(),Ue=class{constructor(i,c,b){ae();let S,E;if(typeof i=="object"&&"location"in i)switch(this.dataLocation=i.location,S=i.type,E=i.dims,i.location){case"cpu-pinned":{let k=re.get(S);if(!k)throw new TypeError(`unsupported type "${S}" to create tensor from pinned buffer`);if(!(i.data instanceof k))throw new TypeError(`buffer should be of type ${k.name}`);this.cpuData=i.data;break}case"texture":{if(S!=="float32")throw new TypeError(`unsupported type "${S}" to create tensor from texture`);this.gpuTextureData=i.texture,this.downloader=i.download,this.disposer=i.dispose;break}case"gpu-buffer":{if(S!=="float32"&&S!=="float16"&&S!=="int32"&&S!=="int64"&&S!=="uint32"&&S!=="uint8"&&S!=="bool"&&S!=="uint4"&&S!=="int4")throw new TypeError(`unsupported type "${S}" to create tensor from gpu buffer`);this.gpuBufferData=i.gpuBuffer,this.downloader=i.download,this.disposer=i.dispose;break}case"ml-tensor":{if(S!=="float32"&&S!=="float16"&&S!=="int32"&&S!=="int64"&&S!=="uint32"&&S!=="uint64"&&S!=="int8"&&S!=="uint8"&&S!=="bool"&&S!=="uint4"&&S!=="int4")throw new TypeError(`unsupported type "${S}" to create tensor from MLTensor`);this.mlTensorData=i.mlTensor,this.downloader=i.download,this.disposer=i.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let k,$;if(typeof i=="string")if(S=i,$=b,i==="string"){if(!Array.isArray(c))throw new TypeError("A string tensor's data must be a string array.");k=c}else{let B=re.get(i);if(B===void 0)throw new TypeError(`Unsupported tensor type: ${i}.`);if(Array.isArray(c)){if(i==="float16"&&B===Uint16Array||i==="uint4"||i==="int4")throw new TypeError(`Creating a ${i} tensor from number array is not supported. Please use ${B.name} as data.`);i==="uint64"||i==="int64"?k=B.from(c,BigInt):k=B.from(c)}else if(c instanceof B)k=c;else if(c instanceof Uint8ClampedArray)if(i==="uint8")k=Uint8Array.from(c);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(i==="float16"&&c instanceof Uint16Array&&B!==Uint16Array)k=new globalThis.Float16Array(c.buffer,c.byteOffset,c.length);else throw new TypeError(`A ${S} tensor's data must be type of ${B}`)}else if($=c,Array.isArray(i)){if(i.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let B=typeof i[0];if(B==="string")S="string",k=i;else if(B==="boolean")S="bool",k=Uint8Array.from(i);else throw new TypeError(`Invalid element type of data array: ${B}.`)}else if(i instanceof Uint8ClampedArray)S="uint8",k=Uint8Array.from(i);else{let B=X.get(i.constructor);if(B===void 0)throw new TypeError(`Unsupported type for tensor data: ${i.constructor}.`);S=B,k=i}if($===void 0)$=[k.length];else if(!Array.isArray($))throw new TypeError("A tensor's dims must be a number array");E=$,this.cpuData=k,this.dataLocation="cpu"}let I=Y(E);if(this.cpuData&&I!==this.cpuData.length&&!((S==="uint4"||S==="int4")&&Math.ceil(I/2)===this.cpuData.length))throw new Error(`Tensor's size(${I}) does not match data length(${this.cpuData.length}).`);this.type=S,this.dims=E,this.size=I}static async fromImage(i,c){return ye(i,c)}static fromTexture(i,c){return ce(i,c)}static fromGpuBuffer(i,c){return Me(i,c)}static fromMLTensor(i,c){return ke(i,c)}static fromPinnedBuffer(i,c,b){return ve(i,c,b)}toDataURL(i){return U(this,i)}toImageData(i){return te(this,i)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(i){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let c=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=c,i&&this.disposer&&(this.disposer(),this.disposer=void 0),c}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(i){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return be(this,i)}}}),Ie,he=s(()=>{Ve(),Ie=Ue}),Fe,ee,we,Re,Be=s(()=>{D(),Fe=(i,c)=>{(typeof O.trace>"u"?!O.wasm.trace:!O.trace)||console.timeStamp(`${i}::ORT::${c}`)},ee=(i,c)=>{var E;let b=((E=new Error().stack)==null?void 0:E.split(/\r\n|\r|\n/g))||[],S=!1;for(let I=0;I<b.length;I++){if(S&&!b[I].includes("TRACE_FUNC")){let k=`FUNC_${i}::${b[I].trim().split(" ")[1]}`;c&&(k+=`::${c}`),Fe("CPU",k);return}b[I].includes("TRACE_FUNC")&&(S=!0)}},we=i=>{(typeof O.trace>"u"?!O.wasm.trace:!O.trace)||ee("BEGIN",i)},Re=i=>{(typeof O.trace>"u"?!O.wasm.trace:!O.trace)||ee("END",i)}}),Se,Ne=s(()=>{v(),he(),Be(),Se=class WS{constructor(c){this.handler=c}async run(c,b,S){we();let E={},I={};if(typeof c!="object"||c===null||c instanceof Ie||Array.isArray(c))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let k=!0;if(typeof b=="object"){if(b===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(b instanceof Ie)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(b)){if(b.length===0)throw new TypeError("'fetches' cannot be an empty array.");k=!1;for(let z of b){if(typeof z!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(z)===-1)throw new RangeError(`'fetches' contains invalid output name: ${z}.`);E[z]=null}if(typeof S=="object"&&S!==null)I=S;else if(typeof S<"u")throw new TypeError("'options' must be an object.")}else{let z=!1,G=Object.getOwnPropertyNames(b);for(let q of this.outputNames)if(G.indexOf(q)!==-1){let Z=b[q];(Z===null||Z instanceof Ie)&&(z=!0,k=!1,E[q]=Z)}if(z){if(typeof S=="object"&&S!==null)I=S;else if(typeof S<"u")throw new TypeError("'options' must be an object.")}else I=b}}else if(typeof b<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let z of this.inputNames)if(typeof c[z]>"u")throw new Error(`input '${z}' is missing in 'feeds'.`);if(k)for(let z of this.outputNames)E[z]=null;let $=await this.handler.run(c,E,I),B={};for(let z in $)if(Object.hasOwnProperty.call($,z)){let G=$[z];G instanceof Ie?B[z]=G:B[z]=new Ie(G.type,G.data,G.dims)}return Re(),B}async release(){return this.handler.dispose()}static async create(c,b,S,E){we();let I,k={};if(typeof c=="string"){if(I=c,typeof b=="object"&&b!==null)k=b;else if(typeof b<"u")throw new TypeError("'options' must be an object.")}else if(c instanceof Uint8Array){if(I=c,typeof b=="object"&&b!==null)k=b;else if(typeof b<"u")throw new TypeError("'options' must be an object.")}else if(c instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&c instanceof SharedArrayBuffer){let G=c,q=0,Z=c.byteLength;if(typeof b=="object"&&b!==null)k=b;else if(typeof b=="number"){if(q=b,!Number.isSafeInteger(q))throw new RangeError("'byteOffset' must be an integer.");if(q<0||q>=G.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${G.byteLength}).`);if(Z=c.byteLength-q,typeof S=="number"){if(Z=S,!Number.isSafeInteger(Z))throw new RangeError("'byteLength' must be an integer.");if(Z<=0||q+Z>G.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${G.byteLength-q}].`);if(typeof E=="object"&&E!==null)k=E;else if(typeof E<"u")throw new TypeError("'options' must be an object.")}else if(typeof S<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof b<"u")throw new TypeError("'options' must be an object.");I=new Uint8Array(G,q,Z)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[$,B]=await _(k),z=await $.createInferenceSessionHandler(I,B);return Re(),new WS(z)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),ze,rt=s(()=>{Ne(),ze=Se}),nt=s(()=>{}),Ge=s(()=>{}),qe=s(()=>{}),gt=s(()=>{}),ct={};d(ct,{InferenceSession:()=>ze,TRACE:()=>Fe,TRACE_FUNC_BEGIN:()=>we,TRACE_FUNC_END:()=>Re,Tensor:()=>Ie,env:()=>L,registerBackend:()=>p});var wt=s(()=>{y(),W(),rt(),he(),nt(),Ge(),Be(),qe(),gt()}),bt=s(()=>{}),Ct={};d(Ct,{default:()=>Fr});var It,jt,Fr,lr=s(()=>{var i;xp(),nr(),so(),It="ort-wasm-proxy-worker",jt=((i=globalThis.self)==null?void 0:i.name)===It,jt&&(self.onmessage=c=>{let{type:b,in:S}=c.data;try{switch(b){case"init-wasm":ft(S.wasm).then(()=>{Wd(S).then(()=>{postMessage({type:b})},E=>{postMessage({type:b,err:E})})},E=>{postMessage({type:b,err:E})});break;case"init-ep":{let{epName:E,env:I}=S;Da(I,E).then(()=>{postMessage({type:b})},k=>{postMessage({type:b,err:k})});break}case"copy-from":{let{buffer:E}=S,I=Bu(E);postMessage({type:b,out:I});break}case"create":{let{model:E,options:I}=S;Hd(E,I).then(k=>{postMessage({type:b,out:k})},k=>{postMessage({type:b,err:k})});break}case"release":Kd(S),postMessage({type:b});break;case"run":{let{sessionId:E,inputIndices:I,inputs:k,outputIndices:$,options:B}=S;Yd(E,I,k,$,new Array($.length).fill(null),B).then(z=>{z.some(G=>G[3]!=="cpu")?postMessage({type:b,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:b,out:z},Qd([...k,...z]))},z=>{postMessage({type:b,err:z})});break}case"end-profiling":qd(S),postMessage({type:b});break;default:}}catch(E){postMessage({type:b,err:E})}}),Fr=jt?null:c=>new Worker(c!=null?c:Jr,{type:"classic",name:It})}),cr,gn,Jr,Zn,ai,vn,Nn,Ji,Zi,io,oa,dr,ko,so=s(()=>{bt(),cr=typeof location>"u"?void 0:location.origin,gn=()=>{var i,c;return typeof document<"u"?(i=document.currentScript)==null?void 0:i.src:typeof self<"u"?(c=self.location)==null?void 0:c.href:void 0},Jr=gn(),Zn=()=>{if(Jr&&!Jr.startsWith("blob:"))return Jr.substring(0,Jr.lastIndexOf("/")+1)},ai=(i,c)=>{try{let b=c!=null?c:Jr;return(b?new URL(i,b):new URL(i)).origin===cr}catch{return!1}},vn=(i,c)=>{let b=c!=null?c:Jr;try{return(b?new URL(i,b):new URL(i)).href}catch{return}},Nn=(i,c)=>`${c!=null?c:"./"}${i}`,Ji=async i=>{let c=await(await fetch(i,{credentials:"same-origin"})).blob();return URL.createObjectURL(c)},Zi=async i=>(await WA(()=>import(i),[])).default,io=(lr(),o(Ct)).default,oa=async()=>{if(!Jr)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(ai(Jr))return[void 0,io()];let i=await Ji(Jr);return[i,io(i)]},dr=void 0,ko=async(i,c,b)=>{if(!i&&!c&&dr&&Jr&&ai(Jr))return[void 0,dr];{let S="ort-wasm-simd-threaded.jsep.mjs",E=i!=null?i:vn(S,c),I=b&&E&&!ai(E,c),k=I?await Ji(E):E!=null?E:Nn(S,c);return[I?k:void 0,await Zi(k)]}}}),yr,As,H,Pe,fe,Le,Xe,ft,pt,nr=s(()=>{so(),As=!1,H=!1,Pe=!1,fe=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Le=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Xe=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},ft=async i=>{var me,Te;if(As)return Promise.resolve();if(H)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Pe)throw new Error("previous call to 'initializeWebAssembly()' failed.");H=!0;let c=i.initTimeout,b=i.numThreads;if(i.simd!==!1){if(i.simd==="relaxed"){if(!Xe())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Le())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let S=fe();b>1&&!S&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+b+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),i.numThreads=b=1);let E=i.wasmPaths,I=typeof E=="string"?E:void 0,k=E==null?void 0:E.mjs,$=(me=k==null?void 0:k.href)!=null?me:k,B=E==null?void 0:E.wasm,z=(Te=B==null?void 0:B.href)!=null?Te:B,G=i.wasmBinary,[q,Z]=await ko($,I,b>1),se=!1,le=[];if(c>0&&le.push(new Promise(de=>{setTimeout(()=>{se=!0,de()},c)})),le.push(new Promise((de,_e)=>{let Ae={numThreads:b};if(G)Ae.wasmBinary=G;else if(z||I)Ae.locateFile=Oe=>z!=null?z:I+Oe;else if($&&$.indexOf("blob:")!==0)Ae.locateFile=Oe=>new URL(Oe,$).href;else if(q){let Oe=Zn();Oe&&(Ae.locateFile=He=>Oe+He)}Z(Ae).then(Oe=>{H=!1,As=!0,yr=Oe,de(),q&&URL.revokeObjectURL(q)},Oe=>{H=!1,Pe=!0,_e(Oe)})})),await Promise.race(le),se)throw new Error(`WebAssembly backend initializing failed due to timeout: ${c}ms`)},pt=()=>{if(As&&yr)return yr;throw new Error("WebAssembly is not initialized yet.")}}),vr,or,Nt,qt=s(()=>{nr(),vr=(i,c)=>{let b=pt(),S=b.lengthBytesUTF8(i)+1,E=b._malloc(S);return b.stringToUTF8(i,E,S),c.push(E),E},or=(i,c,b,S)=>{if(typeof i=="object"&&i!==null){if(b.has(i))throw new Error("Circular reference in options");b.add(i)}Object.entries(i).forEach(([E,I])=>{let k=c?c+E:E;if(typeof I=="object")or(I,k+".",b,S);else if(typeof I=="string"||typeof I=="number")S(k,I.toString());else if(typeof I=="boolean")S(k,I?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof I}`)})},Nt=i=>{let c=pt(),b=c.stackSave();try{let S=c.PTR_SIZE,E=c.stackAlloc(2*S);c._OrtGetLastError(E,E+S);let I=Number(c.getValue(E,S===4?"i32":"i64")),k=c.getValue(E+S,"*"),$=k?c.UTF8ToString(k):"";throw new Error(`${i} ERROR_CODE: ${I}, ERROR_MESSAGE: ${$}`)}finally{c.stackRestore(b)}}}),jr,Sn=s(()=>{nr(),qt(),jr=i=>{let c=pt(),b=0,S=[],E=i||{};try{if((i==null?void 0:i.logSeverityLevel)===void 0)E.logSeverityLevel=2;else if(typeof i.logSeverityLevel!="number"||!Number.isInteger(i.logSeverityLevel)||i.logSeverityLevel<0||i.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${i.logSeverityLevel}`);if((i==null?void 0:i.logVerbosityLevel)===void 0)E.logVerbosityLevel=0;else if(typeof i.logVerbosityLevel!="number"||!Number.isInteger(i.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${i.logVerbosityLevel}`);(i==null?void 0:i.terminate)===void 0&&(E.terminate=!1);let I=0;return(i==null?void 0:i.tag)!==void 0&&(I=vr(i.tag,S)),b=c._OrtCreateRunOptions(E.logSeverityLevel,E.logVerbosityLevel,!!E.terminate,I),b===0&&Nt("Can't create run options."),(i==null?void 0:i.extra)!==void 0&&or(i.extra,"",new WeakSet,(k,$)=>{let B=vr(k,S),z=vr($,S);c._OrtAddRunConfigEntry(b,B,z)!==0&&Nt(`Can't set a run config entry: ${k} - ${$}.`)}),[b,S]}catch(I){throw b!==0&&c._OrtReleaseRunOptions(b),S.forEach(k=>c._free(k)),I}}}),bi,hi,bn,wr,ir,Ar,Gr=s(()=>{nr(),qt(),bi=i=>{switch(i){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${i}`)}},hi=i=>{switch(i){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${i}`)}},bn=i=>{i.extra||(i.extra={}),i.extra.session||(i.extra.session={});let c=i.extra.session;c.use_ort_model_bytes_directly||(c.use_ort_model_bytes_directly="1"),i.executionProviders&&i.executionProviders.some(b=>(typeof b=="string"?b:b.name)==="webgpu")&&(i.enableMemPattern=!1)},wr=(i,c,b,S)=>{let E=vr(c,S),I=vr(b,S);pt()._OrtAddSessionConfigEntry(i,E,I)!==0&&Nt(`Can't set a session config entry: ${c} - ${b}.`)},ir=async(i,c,b)=>{for(let S of c){let E=typeof S=="string"?S:S.name,I=[];switch(E){case"webnn":if(E="WEBNN",typeof S!="string"){let G=S==null?void 0:S.deviceType;G&&wr(i,"deviceType",G,b)}break;case"webgpu":if(E="JS",typeof S!="string"){let G=S;if(G!=null&&G.preferredLayout){if(G.preferredLayout!=="NCHW"&&G.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${G.preferredLayout}`);wr(i,"preferredLayout",G.preferredLayout,b)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${E}`)}let k=vr(E,b),$=I.length,B=0,z=0;if($>0){B=pt()._malloc($*pt().PTR_SIZE),b.push(B),z=pt()._malloc($*pt().PTR_SIZE),b.push(z);for(let G=0;G<$;G++)pt().setValue(B+G*pt().PTR_SIZE,I[G][0],"*"),pt().setValue(z+G*pt().PTR_SIZE,I[G][1],"*")}await pt()._OrtAppendExecutionProvider(i,k,B,z,$)!==0&&Nt(`Can't append execution provider: ${E}.`)}},Ar=async i=>{var I,k,$,B;let c=pt(),b=0,S=[],E=i||{};bn(E);try{let z=bi((I=E.graphOptimizationLevel)!=null?I:"all"),G=hi((k=E.executionMode)!=null?k:"sequential"),q=typeof E.logId=="string"?vr(E.logId,S):0,Z=($=E.logSeverityLevel)!=null?$:2;if(!Number.isInteger(Z)||Z<0||Z>4)throw new Error(`log serverity level is not valid: ${Z}`);let se=(B=E.logVerbosityLevel)!=null?B:0;if(!Number.isInteger(se)||se<0||se>4)throw new Error(`log verbosity level is not valid: ${se}`);let le=typeof E.optimizedModelFilePath=="string"?vr(E.optimizedModelFilePath,S):0;if(b=c._OrtCreateSessionOptions(z,!!E.enableCpuMemArena,!!E.enableMemPattern,G,!!E.enableProfiling,0,q,Z,se,le),b===0&&Nt("Can't create session options."),E.executionProviders&&await ir(b,E.executionProviders,S),E.enableGraphCapture!==void 0){if(typeof E.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${E.enableGraphCapture}`);wr(b,"enableGraphCapture",E.enableGraphCapture.toString(),S)}if(E.freeDimensionOverrides)for(let[me,Te]of Object.entries(E.freeDimensionOverrides)){if(typeof me!="string")throw new Error(`free dimension override name must be a string: ${me}`);if(typeof Te!="number"||!Number.isInteger(Te)||Te<0)throw new Error(`free dimension override value must be a non-negative integer: ${Te}`);let de=vr(me,S);c._OrtAddFreeDimensionOverride(b,de,Te)!==0&&Nt(`Can't set a free dimension override: ${me} - ${Te}.`)}return E.extra!==void 0&&or(E.extra,"",new WeakSet,(me,Te)=>{wr(b,me,Te,S)}),[b,S]}catch(z){throw b!==0&&c._OrtReleaseSessionOptions(b)!==0&&Nt("Can't release session options."),S.forEach(G=>c._free(G)),z}}}),nn,Nr,yn,pi,sn,ei,ti,Mi,rr=s(()=>{nn=i=>{switch(i){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${i}`)}},Nr=i=>{switch(i){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${i}`)}},yn=(i,c)=>{let b=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][i],S=typeof c=="number"?c:c.reduce((E,I)=>E*I,1);return b>0?Math.ceil(S*b):void 0},pi=i=>{switch(i){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${i}`)}},sn=i=>{switch(i){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${i}`)}},ei=i=>i==="float32"||i==="float16"||i==="int32"||i==="int64"||i==="uint32"||i==="uint8"||i==="bool"||i==="uint4"||i==="int4",ti=i=>i==="float32"||i==="float16"||i==="int32"||i==="int64"||i==="uint32"||i==="uint64"||i==="int8"||i==="uint8"||i==="bool"||i==="uint4"||i==="int4",Mi=i=>{switch(i){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${i}`)}}}),Ds,oo=s(()=>{bt(),Ds=async i=>{if(typeof i=="string"){let c=await fetch(i);if(!c.ok)throw new Error(`failed to load external data file: ${i}`);let b=c.headers.get("Content-Length"),S=b?parseInt(b,10):0;if(S<1073741824)return new Uint8Array(await c.arrayBuffer());{if(!c.body)throw new Error(`failed to load external data file: ${i}, no response body.`);let E=c.body.getReader(),I;try{I=new ArrayBuffer(S)}catch($){if($ instanceof RangeError){let B=Math.ceil(S/65536);I=new WebAssembly.Memory({initial:B,maximum:B}).buffer}else throw $}let k=0;for(;;){let{done:$,value:B}=await E.read();if($)break;let z=B.byteLength;new Uint8Array(I,k,z).set(B),k+=z}return new Uint8Array(I,0,S)}}else return i instanceof Blob?new Uint8Array(await i.arrayBuffer()):i instanceof Uint8Array?i:new Uint8Array(i)}}),Io,Un,Tt,Ot,Ut,pn,xr,Vn=s(()=>{rr(),Io=["V","I","W","E","F"],Un=(i,c)=>{console.log(`[${Io[i]},${new Date().toISOString()}]${c}`)},Ut=(i,c)=>{Tt=i,Ot=c},pn=(i,c)=>{let b=sn(i),S=sn(Tt);b>=S&&Un(b,typeof c=="function"?c():c)},xr=(...i)=>{Ot&&pn(...i)}}),ao,Fs,st,lo,cs,Je,Q,ue=s(()=>{ao=class{static calcMatMulShape(i,c){return i[1]!==c[0]?void 0:[i[0],c[1]]}},Fs=class{static calcShape(i,c,b=!1){let S=i.length,E=c.length;if(S===0)return c;if(E===0)return i;let I=Math.max(i.length,c.length),k=new Array(I);if(b){if(S<2||E<2)return;let $=ao.calcMatMulShape([i[S-2],i[S-1]],[c[E-2],c[E-1]]);if($===void 0)return;[k[I-2],k[I-1]]=$}for(let $=b?3:1;$<=I;$++){let B=S-$<0?1:i[S-$],z=E-$<0?1:c[E-$];if(B!==z&&B>1&&z>1)return;let G=Math.max(B,z);if(B&&z)k[I-$]=Math.max(B,z);else{if(G>1)return;k[I-$]=0}}return k}static isValidBroadcast(i,c){let b=i.length,S=c.length;if(b>S)return!1;for(let E=1;E<=b;E++)if(i[b-E]!==1&&i[b-E]!==c[S-E])return!1;return!0}},st=class ev{static size(c){return ev.getSizeFromDimensionRange(c,0,c.length)}static convertShape(c,b=4){let S=c.length;if(S===0)return[];let E=new Array(S),I=S-1;for(;I>=0;){if(c[I]%b===0){E[I]=c[I]/b;break}if(b%c[I]!==0)throw new Error("cannot convert shape");E[I]=1,b/=c[I],I--}for(I--;I>=0;I--)E[I]=c[I];return E}static sizeFromDimension(c,b){if(b<0||b>c.length)throw new Error(`invalid dimension of ${b} for sizeFromDimension as Tensor has ${c.length} dimensions.`);return ev.getSizeFromDimensionRange(c,b,c.length)}static sizeToDimension(c,b){if(b<0||b>c.length)throw new Error(`invalid dimension of ${b} for sizeToDimension as Tensor has ${c.length} dimensions.`);return ev.getSizeFromDimensionRange(c,0,b)}static getSizeFromDimensionRange(c,b,S){let E=1;for(let I=b;I<S;I++){if(c[I]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");E*=Number(c[I])}return E}static computeStrides(c){let b=c.length;if(b===0)return[];if(b===1)return[1];let S=new Array(b);S[b-1]=1,S[b-2]=c[b-1];for(let E=b-3;E>=0;--E)S[E]=S[E+1]*c[E+1];return S}static normalizeAxis(c,b){if(c<-b&&c>=b)throw new Error("unsupported axis for this operation.");return c<0?c+b:c}static normalizeAxes(c,b){return c.map(S=>this.normalizeAxis(S,b!=null?b:c.length))}static sortBasedOnPerm(c,b){return b?b.map(S=>c[S]):c.slice().reverse()}static padShape(c,b){let S=c.length;return c.map((E,I)=>E+b[I]+b[I+S])}static areEqual(c,b){return c.length!==b.length?!1:c.every((S,E)=>S===b[E])}},lo=class Ag{static adjustPoolAttributes(c,b,S,E,I,k){if(!c&&S.length!==b.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(c)for(let $=0;$<b.length-2;$++)$>=S.length?S.push(b[$+2]):S[$]=b[$+2];for(let $=0;$<S.length;$++)if($<E.length){if(E[$]<0)throw new Error("strides should be greater than or equal to 1")}else E.push(1);for(let $=0;$<S.length;$++)if($<I.length){if(I[$]<0)throw new Error("dilations should be greater than or equal to 1")}else I.push(1);for(let $=0;$<S.length*2;$++)if($<k.length){if(k[$]<0)throw new Error("pad should be greater than or equal to 1")}else k.push(0);for(let $=0;$<S.length;$++){if(S[$]<=0)throw new Error("kernel shapes need to be greater than 0");if(k[$]>=S[$]||k[$+S.length]>=S[$])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(c,b,S,E,I,k,$){if($){if(I.length!==2*(c.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(b.length!==c.length-2)throw new Error("length of strides should be the length of data dimensions");if(E.length!==c.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let B=0;B<c.length-2;B++)Ag.adjustPadAndReturnShape(c[B+(k?1:2)],b[B],S[B],E[B],I,B,B+c.length-2,$)}}static computePoolOutputShape(c,b,S,E,I,k,$){if(b.length<=0)throw new Error("input shape must be of size greater than 0");let B=[b[0],b[1]];return Ag.computeShapeHelper(c,b,B,S,E,I,k,$),B}static computeConvOutputShape(c,b,S,E,I,k,$){if(c.length<=0||b.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let B=[c[0],b[0]];return Ag.computeShapeHelper(!1,c,B,S,E,I,k,$),B}static computeShapeHelper(c,b,S,E,I,k,$,B){if(c)for(let z=0;z<b.length-2;z++)S.push(1);else for(let z=0;z<b.length-2;z++)S.push(Ag.adjustPadAndReturnShape(b[z+2],E[z],I[z],k[z],$,z,z+b.length-2,B))}static adjustPadAndReturnShape(c,b,S,E,I,k,$,B){let z=S*(E-1)+1;if(B&&B!=="NOTSET")switch(B){case"VALID":return I[k]=0,I[$]=0,Math.floor((c-z)/b+1);case"SAME_LOWER":case"SAME_UPPER":if(S!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let G=((c+b-1)/b-1)*b+E-c;return I[k]=Math.floor(B==="SAME_LOWER"?(G+1)/2:G/2),I[$]=G-I[k],Math.floor((c+G-E)/b+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((c+I[k]+I[$]-z)/b+1)}},cs=class{static getShapeOfGemmResult(i,c,b,S,E){if(i.length!==2||b.length!==2)throw new Error("shape need to be of size 2");let I,k,$;c?(I=i[1],k=i[0]):(I=i[0],k=i[1]);let B=-1;if(S?($=b[0],B=1):($=b[1],B=0),b[B]!==k)throw new Error("dimension mismatch");if(I<=0||$<=0||k<=0)throw new Error("invalid shape specified");if(E&&!Fs.isValidBroadcast(E,[I,$]))throw new Error("gemm: invalid bias shape for broadcast");return[I,$,k]}},Je=-34028234663852886e22,Q=34028234663852886e22}),De,We=s(()=>{rr(),De=(i,c)=>new(pi(c))(i)}),Ye,at,_t,Dt,Et,zt,pr,Hr,ri,rn,Ur=s(()=>{Vn(),Ye=(i,c=!0)=>{if(i.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let b=i.byteLength/8,S=new BigInt64Array(i.buffer,i.byteOffset,b),E=new Int32Array(b);for(let I=0;I<b;I++){let k=S[I];if(k>2147483647n||k<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${I}: ${k}`);E[I]=Number(k)}return c?new Uint8Array(E.buffer):E},at=(i,c=!0)=>{if(i.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let b=i.byteLength/4,S=new Int32Array(i.buffer,i.byteOffset,b),E=BigInt64Array.from(S,BigInt);return c?new Uint8Array(E.buffer):E},_t=1,Dt=()=>_t++,Et=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),zt=(i,c)=>{let b=Et.get(i);if(!b)throw new Error("Unsupported data type.");return c.length>0?Math.ceil(c.reduce((S,E)=>S*E)*b/8):0},pr=class{constructor(i){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:c,context:b,tensor:S,dataType:E,shape:I,shouldConvertInt64toInt32:k=!1}=i;this.sessionId=c,this.mlContext=b,this.mlTensor=S,this.dataType=E,this.tensorShape=I,this.shouldConvertInt64toInt32=k}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return zt(this.dataType,this.tensorShape)}destroy(){xr("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(i){this.mlContext.writeTensor(this.mlTensor,i)}async read(i,c){if(i){let b=await this.mlContext.readTensor(this.mlTensor),S=at(new Uint8Array(b));if(c){(c instanceof ArrayBuffer?new Uint8Array(c):new Uint8Array(c.buffer,c.byteOffset,c.byteLength)).set(S);return}else return S.buffer}else return c?this.mlContext.readTensor(this.mlTensor,c):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(i,c,b){return this.mlContext===i&&this.dataType===c&&this.tensorShape.length===b.length&&this.tensorShape.every((S,E)=>S===b[E])}setIsInt64ToInt32Converted(i){this.isInt64ToInt32Converted=i}},Hr=class{constructor(i,c){this.tensorManager=i,this.wrapper=c}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(i,c,b,S){let E=c,I=this.tensorManager.getMLContext(i),k=E==="int64"&&!I.opSupportLimits().input.dataTypes.includes("int64");if(k&&(E="int32",xr("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(I,E,b))return this.wrapper.tensor;if(S){if(this.wrapper.byteLength!==zt(E,b))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let $=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(i,E,b,$,!0,!0,k),S&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(i){let c=i;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(c=Ye(i,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),c.byteLength===this.wrapper.byteLength){this.wrapper.write(c);return}else xr("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(c):this.activeUpload=new Uint8Array(c)}async download(i){var c,b,S;if(this.activeUpload){let E=(c=this.wrapper)!=null&&c.isInt64ToInt32Converted?at(this.activeUpload):this.activeUpload;if(i){i instanceof ArrayBuffer?new Uint8Array(i).set(E):new Uint8Array(i.buffer,i.byteOffset,i.byteLength).set(E);return}else return E.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return i?this.wrapper.read((b=this.wrapper)==null?void 0:b.shouldConvertInt64toInt32,i):this.wrapper.read((S=this.wrapper)==null?void 0:S.shouldConvertInt64toInt32)}},ri=class{constructor(i){this.backend=i,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(i){let c=this.backend.getMLContext(i);if(!c)throw new Error("MLContext not found for session.");return c}reserveTensorId(){let i=Dt();return this.tensorTrackersById.set(i,new Hr(this)),i}releaseTensorId(i){let c=this.tensorTrackersById.get(i);c&&(this.tensorTrackersById.delete(i),c.tensorWrapper&&this.releaseTensor(c.tensorWrapper))}async ensureTensor(i,c,b,S,E){xr("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${c}, dataType: ${b}, shape: ${S}, copyOld: ${E}}`);let I=this.tensorTrackersById.get(c);if(!I)throw new Error("Tensor not found.");return I.ensureTensor(i,b,S,E)}upload(i,c){let b=this.tensorTrackersById.get(i);if(!b)throw new Error("Tensor not found.");b.upload(c)}async download(i,c){xr("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${i}, dstBuffer: ${c==null?void 0:c.byteLength}}`);let b=this.tensorTrackersById.get(i);if(!b)throw new Error("Tensor not found.");return b.download(c)}releaseTensorsForSession(i){for(let c of this.freeTensors)c.sessionId===i&&c.destroy();this.freeTensors=this.freeTensors.filter(c=>c.sessionId!==i)}registerTensor(i,c,b,S){let E=this.getMLContext(i),I=Dt(),k=new pr({sessionId:i,context:E,tensor:c,dataType:b,shape:S});return this.tensorTrackersById.set(I,new Hr(this,k)),this.externalTensors.add(k),I}async getCachedTensor(i,c,b,S,E,I,k=!1){let $=this.getMLContext(i);for(let[z,G]of this.freeTensors.entries())if(G.canReuseTensor($,c,b)){xr("verbose",()=>`[WebNN] Reusing tensor {dataType: ${c}, shape: ${b}}`);let q=this.freeTensors.splice(z,1)[0];return q.sessionId=i,q}xr("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${c}, shape: ${b}}`);let B=await $.createTensor({dataType:c,shape:b,dimensions:b,usage:S,writable:E,readable:I});return new pr({sessionId:i,context:$,tensor:B,dataType:c,shape:b,shouldConvertInt64toInt32:k})}releaseTensor(i){this.externalTensors.has(i)&&this.externalTensors.delete(i),this.freeTensors.push(i)}},rn=(...i)=>new ri(...i)}),Mn,Wn,li,Ls=s(()=>{rr(),nr(),We(),Ur(),Vn(),Mn=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Wn=(i,c)=>{if(i===c)return!0;if(i===void 0||c===void 0)return!1;let b=Object.keys(i).sort(),S=Object.keys(c).sort();return b.length===S.length&&b.every((E,I)=>E===S[I]&&i[E]===c[E])},li=class{constructor(i){this.tensorManager=rn(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,Ut(i.logLevel,!!i.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(i){xr("verbose",()=>`[WebNN] onRunStart {sessionId: ${i}}`),this.activeSessionId=i}onRunEnd(i){xr("verbose",()=>`[WebNN] onRunEnd {sessionId: ${i}}`);let c=this.temporarySessionTensorIds.get(i);if(c){for(let b of c)xr("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${b}}`),this.tensorManager.releaseTensorId(b);this.temporarySessionTensorIds.delete(i),this.activeSessionId=void 0}}async createMLContext(i){if(i instanceof GPUDevice){let b=this.mlContextCache.findIndex(S=>S.gpuDevice===i);if(b!==-1)return this.mlContextCache[b].mlContext;{let S=await navigator.ml.createContext(i);return this.mlContextCache.push({gpuDevice:i,mlContext:S}),S}}else if(i===void 0){let b=this.mlContextCache.findIndex(S=>S.options===void 0&&S.gpuDevice===void 0);if(b!==-1)return this.mlContextCache[b].mlContext;{let S=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:S}),S}}let c=this.mlContextCache.findIndex(b=>Wn(b.options,i));if(c!==-1)return this.mlContextCache[c].mlContext;{let b=await navigator.ml.createContext(i);return this.mlContextCache.push({options:i,mlContext:b}),b}}registerMLContext(i,c){this.mlContextBySessionId.set(i,c);let b=this.sessionIdsByMLContext.get(c);b||(b=new Set,this.sessionIdsByMLContext.set(c,b)),b.add(i),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(i,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(i){this.sessionGraphInputs.delete(i);let c=this.mlContextBySessionId.get(i);if(!c)return;this.tensorManager.releaseTensorsForSession(i),this.mlContextBySessionId.delete(i);let b=this.sessionIdsByMLContext.get(c);if(b.delete(i),b.size===0){this.sessionIdsByMLContext.delete(c);let S=this.mlContextCache.findIndex(E=>E.mlContext===c);S!==-1&&this.mlContextCache.splice(S,1)}}getMLContext(i){return this.mlContextBySessionId.get(i)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(i){xr("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${i}}`),this.tensorManager.releaseTensorId(i)}async ensureTensor(i,c,b,S,E){let I=Mn.get(b);if(!I)throw new Error(`Unsupported ONNX data type: ${b}`);return this.tensorManager.ensureTensor(i!=null?i:this.currentSessionId,c,I,S,E)}async createTemporaryTensor(i,c,b){xr("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${c}, shape: ${b}}`);let S=Mn.get(c);if(!S)throw new Error(`Unsupported ONNX data type: ${c}`);let E=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(i,E,S,b,!1);let I=this.temporarySessionTensorIds.get(i);return I?I.push(E):this.temporarySessionTensorIds.set(i,[E]),E}uploadTensor(i,c){if(!pt().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");xr("verbose",()=>`[WebNN] uploadTensor {tensorId: ${i}, data: ${c.byteLength}}`),this.tensorManager.upload(i,c)}async downloadTensor(i,c){return this.tensorManager.download(i,c)}createMLTensorDownloader(i,c){return async()=>{let b=await this.tensorManager.download(i);return De(b,c)}}registerMLTensor(i,c,b,S){let E=Mn.get(b);if(!E)throw new Error(`Unsupported ONNX data type: ${b}`);let I=this.tensorManager.registerTensor(i,c,E,S);return xr("verbose",()=>`[WebNN] registerMLTensor {tensor: ${c}, dataType: ${E}, dimensions: ${S}} -> {tensorId: ${I}}`),I}registerMLConstant(i,c,b,S,E,I,k=!1){if(!I)throw new Error("External mounted files are not available.");let $=i;i.startsWith("./")&&($=i.substring(2));let B=I.get($);if(!B)throw new Error(`File with name ${$} not found in preloaded files.`);if(c+b>B.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let z=B.slice(c,c+b).buffer,G;switch(E.dataType){case"float32":G=new Float32Array(z);break;case"float16":G=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(z):new Uint16Array(z);break;case"int32":G=new Int32Array(z);break;case"uint32":G=new Uint32Array(z);break;case"int64":k?(G=Ye(new Uint8Array(z),!1),E.dataType="int32"):G=new BigInt64Array(z);break;case"uint64":G=new BigUint64Array(z);break;case"int8":G=new Int8Array(z);break;case"int4":case"uint4":case"uint8":G=new Uint8Array(z);break;default:throw new Error(`Unsupported data type: ${E.dataType} in creating WebNN Constant from external data.`)}return xr("verbose",()=>`[WebNN] registerMLConstant {dataType: ${E.dataType}, shape: ${E.shape}}} ${k?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),S.constant(E,G)}registerGraphInput(i){this.temporaryGraphInputs.push(i)}isGraphInput(i,c){let b=this.sessionGraphInputs.get(i);return b?b.includes(c):!1}isInt64Supported(i){var c;return!!((c=this.mlContextBySessionId.get(i))!=null&&c.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),Gn=s(()=>{}),$s,un,In,Ti,ds,qr,Lr,fs,Hn,En=s(()=>{Vn(),Gn(),$s=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),un=[],In=i=>Math.ceil(Number(i)/16)*16,Ti=i=>{for(let c=0;c<un.length;c++){let b=un[c];if(i<=b)return b}return Math.ceil(i/16)*16},ds=1,qr=()=>ds++,Lr=async(i,c,b,S)=>{let E=In(b),I=i.device.createBuffer({size:E,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let k=i.getCommandEncoder();i.endComputePass(),k.copyBufferToBuffer(c,0,I,0,E),i.flush(),await I.mapAsync(GPUMapMode.READ);let $=I.getMappedRange();if(S){let B=S();return B.set(new Uint8Array($,0,b)),B}else return new Uint8Array($.slice(0,b))}finally{I.destroy()}},fs=class{constructor(i){this.backend=i,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[c]of $s)un.push(c),this.freeBuffers.set(c,[]),this.freeUniformBuffers.set(c,[]);this.sessionCount=0}upload(i,c){let b=c.buffer,S=c.byteOffset,E=c.byteLength,I=In(E),k=this.storageCache.get(i);if(!k)throw new Error("gpu data for uploading does not exist");if(Number(k.originalSize)!==E)throw new Error(`inconsistent data size. gpu data size=${k.originalSize}, data size=${E}`);let $=this.backend.device.createBuffer({mappedAtCreation:!0,size:I,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),B=$.getMappedRange();new Uint8Array(B).set(new Uint8Array(b,S,E)),$.unmap();let z=this.backend.device.createCommandEncoder();z.copyBufferToBuffer($,0,k.gpuData.buffer,0,I),this.backend.device.queue.submit([z.finish()]),$.destroy(),xr("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${i})`)}memcpy(i,c){let b=this.storageCache.get(i);if(!b)throw new Error("source gpu data for memcpy does not exist");let S=this.storageCache.get(c);if(!S)throw new Error("destination gpu data for memcpy does not exist");if(b.originalSize!==S.originalSize)throw new Error("inconsistent source and destination gpu data size");let E=In(b.originalSize),I=this.backend.getCommandEncoder();this.backend.endComputePass(),I.copyBufferToBuffer(b.gpuData.buffer,0,S.gpuData.buffer,0,E)}registerExternalBuffer(i,c,b){let S;if(b){if(S=b[0],i===b[1])return xr("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${c}) => id=${S}, buffer is the same, skip.`),S;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else S=qr();return this.storageCache.set(S,{gpuData:{id:S,type:0,buffer:i},originalSize:c}),xr("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${c}) => id=${S}, registered.`),S}unregisterExternalBuffer(i){i!==void 0&&(this.storageCache.delete(i),xr("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${i}`))}create(i,c=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let b=Ti(i),S,E=(c&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,I=(c&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(E||I){let $=(E?this.freeBuffers:this.freeUniformBuffers).get(b);$?$.length>0?S=$.pop():S=this.backend.device.createBuffer({size:b,usage:c}):S=this.backend.device.createBuffer({size:b,usage:c})}else S=this.backend.device.createBuffer({size:b,usage:c});let k={id:qr(),type:0,buffer:S};return this.storageCache.set(k.id,{gpuData:k,originalSize:Number(i)}),xr("verbose",()=>`[WebGPU] GpuDataManager.create(size=${i}) => id=${k.id}`),k}get(i){var c;return(c=this.storageCache.get(i))==null?void 0:c.gpuData}release(i){let c=typeof i=="bigint"?Number(i):i,b=this.storageCache.get(c);if(!b){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return xr("verbose",()=>`[WebGPU] GpuDataManager.release(id=${c}), gpuDataId=${b.gpuData.id}`),this.storageCache.delete(c),this.buffersPending.push(b.gpuData.buffer),b.originalSize}async download(i,c){let b=this.storageCache.get(Number(i));if(!b)throw new Error("data does not exist");await Lr(this.backend,b.gpuData.buffer,b.originalSize,c)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let i of this.buffersPending){let c=$s.get(i.size);if((i.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let b=this.freeBuffers.get(i.size)||[];c===void 0||b.length>=c?i.destroy():b.push(i)}else if((i.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let b=this.freeUniformBuffers.get(i.size)||[];c===void 0||b.length>=c?i.destroy():b.push(i)}else i.destroy()}this.buffersPending=[]}else{let i=this.capturedPendingBuffers.get(this.backend.currentSessionId);i||(i=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,i));for(let c of this.buffersPending)i.push(c);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(i=>{i.forEach(c=>{c.destroy()})}),this.freeUniformBuffers.forEach(i=>{i.forEach(c=>{c.destroy()})}),this.storageCache.forEach(i=>{i.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(i=>{i.forEach(c=>{c.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(i){let c=this.capturedPendingBuffers.get(i);c&&(c.forEach(b=>{b.destroy()}),this.capturedPendingBuffers.delete(i)),this.sessionCount-=1,this.sessionCount===0&&(xr("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(b=>{b.gpuData.buffer.destroy()}),this.storageCache=new Map)}},Hn=(...i)=>new fs(...i)}),An,_r,Br=s(()=>{An=class{constructor(i){Object.assign(this,i)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(i=>`${this[i]}`).join(";")),this.key}},_r=i=>new An(i)}),es,aa,Kr,Kn,Gt,cn,Qa,ni,Rs,Yt,la,dt,Xt,ec,mi,Tf,ki,br=s(()=>{rr(),ue(),es=64,aa=(i,c)=>{if(c===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(i)){case 10:return c>1?`vec${c}<f16>`:"f16";case 1:return c>1?`vec${c}<f32>`:"f32";case 6:return c>1?`vec${c}<i32>`:"i32";case 12:return c>1?`vec${c}<u32>`:"u32";case 7:if(c>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(c>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(c!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${i}`)}},Kr=(i,c=1)=>{let b=aa(i,c);return typeof b=="string"?b:b[0]},Kn=(i,c=1)=>{let b=aa(i,c);return typeof b=="string"?b:b[1]},Gt=(...i)=>{let c=[];return i.forEach(b=>{b.length!==0&&c.push({type:12,data:b},{type:12,data:st.computeStrides(b)})}),c},cn=i=>i%4===0?4:i%2===0?2:1,Qa=(i="f32",c,b="0")=>!c||c===1?`${i}(${b})`:`vec${c}<${i}>(${b})`,ni=(i,c,b)=>i==="f32"?b:c===1?`f32(${b})`:`vec${c}<f32>(${b})`,Rs=(i,c)=>c===4?`(${i}.x + ${i}.y + ${i}.z + ${i}.w)`:c===2?`(${i}.x + ${i}.y)`:c===3?`(${i}.x + ${i}.y + ${i}.z)`:i,Yt=(i,c,b,S)=>i.startsWith("uniforms.")&&b>4?typeof c=="string"?S==="f16"?`${i}[(${c}) / 8][(${c}) % 8 / 4][(${c}) % 8 % 4]`:`${i}[(${c}) / 4][(${c}) % 4]`:S==="f16"?`${i}[${Math.floor(c/8)}][${Math.floor(c%8/4)}][${c%8%4}]`:`${i}[${Math.floor(c/4)}][${c%4}]`:b>1?`${i}[${c}]`:i,la=(i,c,b,S,E)=>{let I=typeof b=="number",k=I?b:b.length,$=[...new Array(k).keys()],B=k<2?"u32":k<=4?`vec${k}<u32>`:`array<u32, ${k}>`,z=aa(c,E),G=typeof z=="string"?z:z[1],q=typeof z=="string"?z:z[0],Z={indices:B,value:G,storage:q,tensor:c},se=St=>typeof St=="string"?St:`${St}u`,le={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},me=I?"uniforms.":"",Te=`${me}${i}_shape`,de=`${me}${i}_strides`,_e="";for(let St=0;St<k-1;St++)_e+=`
    let dim${St} = current / ${Yt(de,St,k)};
    let rest${St} = current % ${Yt(de,St,k)};
    indices[${St}] = dim${St};
    current = rest${St};
    `;_e+=`indices[${k-1}] = current;`;let Ae=k<2?"":`
  fn o2i_${i}(offset: u32) -> ${Z.indices} {
    var indices: ${Z.indices};
    var current = offset;
    ${_e}
    return indices;
  }`,Oe=St=>(le.offsetToIndices=!0,k<2?St:`o2i_${i}(${St})`),He=[];if(k>=2)for(let St=k-1;St>=0;St--)He.push(`${Yt(de,St,k)} * (indices[${St}])`);let lt=k<2?"":`
  fn i2o_${i}(indices: ${Z.indices}) -> u32 {
    return ${He.join("+")};
  }`,it=St=>(le.indicesToOffset=!0,k<2?St:`i2o_${i}(${St})`),mt=(...St)=>k===0?"0u":`${Z.indices}(${St.map(se).join(",")})`,Mt=(St,Rt)=>k<2?`${St}`:`${Yt(St,Rt,k)}`,At=(St,Rt,gr)=>k<2?`${St}=${gr};`:`${Yt(St,Rt,k)}=${gr};`,$t={},Vt=(St,Rt)=>{le.broadcastedIndicesToOffset=!0;let gr=`${Rt.name}broadcastedIndicesTo${i}Offset`;if(gr in $t)return`${gr}(${St})`;let an=[];for(let Ki=k-1;Ki>=0;Ki--){let qs=Rt.indicesGet("outputIndices",Ki+Rt.rank-k);an.push(`${Mt(de,Ki)} * (${qs} % ${Mt(Te,Ki)})`)}return $t[gr]=`fn ${gr}(outputIndices: ${Rt.type.indices}) -> u32 {
             return ${an.length>0?an.join("+"):"0u"};
           }`,`${gr}(${St})`},Kt=(St,Rt)=>(()=>{if(Z.storage===Z.value)return`${i}[${St}]=${Rt};`;if(Z.storage==="vec2<u32>"&&Z.value==="i32")return`${i}[${St}]=vec2<u32>(u32(${Rt}), select(0u, 0xFFFFFFFFu, ${Rt} < 0));`;if(Z.storage==="vec2<u32>"&&Z.value==="u32")return`${i}[${St}]=vec2<u32>(u32(${Rt}), 0u);`;if(Z.storage==="u32"&&Z.value==="vec4<bool>")return`${i}[${St}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${Rt}));`;throw new Error(`not supported combination of storage type ${Z.storage} and value type ${Z.value} yet`)})(),Mr=St=>(()=>{if(Z.storage===Z.value)return`${i}[${St}]`;if(Z.storage==="vec2<u32>"&&Z.value==="i32")return`i32(${i}[${St}].x)`;if(Z.storage==="vec2<u32>"&&Z.value==="u32")return`u32(${i}[${St}].x)`;if(Z.storage==="u32"&&Z.value==="vec4<bool>")return`vec4<bool>(bool(${i}[${St}] & 0xFFu), bool(${i}[${St}] & 0xFF00u), bool(${i}[${St}] & 0xFF0000u), bool(${i}[${St}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${Z.storage} and value type ${Z.value} yet`)})(),tr=k<2?"":`
  fn get_${i}ByIndices(indices: ${Z.indices}) -> ${G} {
    return ${Mr(`i2o_${i}(indices)`)};
  }`,Jt=k<2?"":(()=>{let St=$.map(gr=>`d${gr}: u32`).join(", "),Rt=$.map(gr=>`d${gr}`).join(", ");return`
  fn get_${i}(${St}) -> ${G} {
    return get_${i}ByIndices(${mt(Rt)});
  }`})(),Lt=(...St)=>{if(St.length!==k)throw new Error(`indices length must be ${k}`);let Rt=St.map(se).join(",");return k===0?Mr("0u"):k===1?Mr(Rt[0]):(le.get=!0,le.getByIndices=!0,le.indicesToOffset=!0,`get_${i}(${Rt})`)},$r=St=>k<2?Mr(St):(le.getByIndices=!0,le.indicesToOffset=!0,`get_${i}ByIndices(${St})`),ar=k<2?"":`
  fn set_${i}ByIndices(indices: ${Z.indices}, value: ${G}) {
    ${Kt(`i2o_${i}(indices)`,"value")}
  }`,Cr=k<2?"":(()=>{let St=$.map(gr=>`d${gr}: u32`).join(", "),Rt=$.map(gr=>`d${gr}`).join(", ");return`
  fn set_${i}(${St}, value: ${G}) {
    set_${i}ByIndices(${mt(Rt)}, value);
  }`})();return{impl:()=>{let St=[],Rt=!1;return le.offsetToIndices&&(St.push(Ae),Rt=!0),le.indicesToOffset&&(St.push(lt),Rt=!0),le.broadcastedIndicesToOffset&&(Object.values($t).forEach(gr=>St.push(gr)),Rt=!0),le.set&&(St.push(Cr),Rt=!0),le.setByIndices&&(St.push(ar),Rt=!0),le.get&&(St.push(Jt),Rt=!0),le.getByIndices&&(St.push(tr),Rt=!0),!I&&Rt&&St.unshift(`const ${Te} = ${Z.indices}(${b.join(",")});`,`const ${de} = ${Z.indices}(${st.computeStrides(b).join(",")});`),St.join(`
`)},type:Z,offsetToIndices:Oe,indicesToOffset:it,broadcastedIndicesToOffset:Vt,indices:mt,indicesGet:Mt,indicesSet:At,set:(...St)=>{if(St.length!==k+1)throw new Error(`indices length must be ${k}`);let Rt=St[k];if(typeof Rt!="string")throw new Error("value must be string");let gr=St.slice(0,k).map(se).join(",");return k===0?Kt("0u",Rt):k===1?Kt(gr[0],Rt):(le.set=!0,le.setByIndices=!0,le.indicesToOffset=!0,`set_${i}(${gr}, ${Rt})`)},setByOffset:Kt,setByIndices:(St,Rt)=>k<2?Kt(St,Rt):(le.setByIndices=!0,le.indicesToOffset=!0,`set_${i}ByIndices(${St}, ${Rt});`),get:Lt,getByOffset:Mr,getByIndices:$r,usage:S,name:i,strides:de,shape:Te,rank:k}},dt=(i,c,b,S=1)=>la(i,c,b,"input",S),Xt=(i,c,b,S=1)=>la(i,c,b,"output",S),ec=(i,c,b)=>la(i,c,b,"atomicOutput",1),mi=(i,c,b,S=1)=>la(i,c,b,"internal",S),Tf=class{constructor(i,c){this.normalizedDispatchGroup=i,this.limits=c,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(i){return`if (global_idx >= ${typeof i=="number"?`${i}u`:i}) { return; }`}mainStart(i=es){let c=typeof i=="number"?i:i[0],b=typeof i=="number"?1:i[1],S=typeof i=="number"?1:i[2];if(c>this.limits.maxComputeWorkgroupSizeX||b>this.limits.maxComputeWorkgroupSizeY||S>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${c}, ${b}, ${S}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(c*b*S>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${c}, ${b}, ${S}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let E=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,I=E?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,k=E?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${c*b*S}u + local_idx;`;return`@compute @workgroup_size(${c}, ${b}, ${S})
  fn main(${I}) {
    ${k}
  `}appendVariableUniforms(i){i.rank!==0&&(i.shape.startsWith("uniforms.")&&this.uniforms.push({name:i.shape.replace("uniforms.",""),type:"u32",length:i.rank}),i.strides.startsWith("uniforms.")&&this.uniforms.push({name:i.strides.replace("uniforms.",""),type:"u32",length:i.rank}))}declareVariable(i,c){if(i.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(i),this.appendVariableUniforms(i);let b=i.usage==="input"?"read":"read_write",S=i.usage==="atomicOutput"?"atomic<i32>":i.type.storage;return`@group(0) @binding(${c}) var<storage, ${b}> ${i.name}: array<${S}>;`}declareVariables(...i){return i.map(c=>this.declareVariable(c,this.variableIndex++)).join(`
`)}registerInternalVariable(i){if(i.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(i),this.appendVariableUniforms(i)}registerInternalVariables(...i){return i.forEach(c=>this.registerInternalVariable(c)),this}registerUniform(i,c,b=1){return this.uniforms.push({name:i,type:c,length:b}),this}registerUniforms(i){return this.uniforms=this.uniforms.concat(i),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let i=[];for(let{name:c,type:b,length:S}of this.uniforms)if(S&&S>4)b==="f16"?i.push(`@align(16) ${c}:array<mat2x4<${b}>, ${Math.ceil(S/8)}>`):i.push(`${c}:array<vec4<${b}>, ${Math.ceil(S/4)}>`);else{let E=S==null||S===1?b:`vec${S}<${b}>`;i.push(`${c}:${E}`)}return`
      struct Uniforms { ${i.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(i=>i.impl()).join(`
`)+this.internalVariables.map(i=>i.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let i=c=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(c)];return this.uniforms.map(c=>{var b;return[i(c.type),(b=c.length)!=null?b:1]})}},ki=(i,c)=>new Tf(i,c)}),tc,hs,ua,Ul,_n,Bs,ui,Kp,Vl,zs=s(()=>{rr(),ue(),Br(),br(),tc=(i,c)=>{if(!i||i.length!==1)throw new Error("Transpose requires 1 input.");if(c.length!==0&&c.length!==i[0].dims.length)throw new Error(`perm size ${c.length} does not match input rank ${i[0].dims.length}`)},hs=(i,c)=>c.length!==0?c:[...new Array(i).keys()].reverse(),ua=(i,c)=>st.sortBasedOnPerm(i,hs(i.length,c)),Ul=(i,c,b,S)=>{let E=`fn perm(i: ${S.type.indices}) -> ${b.type.indices} {
    var a: ${b.type.indices};`;for(let I=0;I<c;++I)E+=`a[${i[I]}]=i[${I}];`;return E+="return a;}"},_n=(i,c)=>{let b=[],S=[];for(let E=0;E<i.length;++E)i[E]!==1&&b.push(i[E]),i[c[E]]!==1&&S.push(c[E]);return{newShape:b,newPerm:S}},Bs=(i,c)=>{let b=0;for(let S=0;S<i.length;++S)if(c[i[S]]!==1){if(i[S]<b)return!1;b=i[S]}return!0},ui=(i,c)=>{let b=i.dataType,S=i.dims.length,E=hs(S,c),I=ua(i.dims,E),k=i.dims,$=I,B=S<2||Bs(E,i.dims),z;if(B)return z=le=>{let me=dt("input",b,k,4),Te=Xt("output",b,$,4);return`
  ${le.registerUniform("output_size","u32").declareVariables(me,Te)}
  ${le.mainStart()}
    ${le.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let le=st.size(I);return{outputs:[{dims:I,dataType:i.dataType}],dispatchGroup:{x:Math.ceil(le/64/4)},programUniforms:[{type:12,data:Math.ceil(le/4)}]}},getShaderSource:z};let{newShape:G,newPerm:q}=_n(i.dims,E),Z=st.areEqual(q,[2,3,1]),se=st.areEqual(q,[3,1,2]);if(G.length===2||Z||se){k=Z?[G[0],G[1]*G[2]]:se?[G[0]*G[1],G[2]]:G,$=[k[1],k[0]];let le=16;return z=me=>{let Te=dt("a",b,k.length),de=Xt("output",b,$.length);return`
  ${me.registerUniform("output_size","u32").declareVariables(Te,de)}
  var<workgroup> tile : array<array<${de.type.value}, ${le+1}>, ${le}>;
  ${me.mainStart([le,le,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${le} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${le}u + local_id.x;
    let input_row = workgroup_id_x * ${le}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${Te.getByIndices(`${Te.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${le}u + local_id.x;
    let output_row = workgroup_id_y * ${le}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${de.setByIndices(`${de.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let me=st.size(I);return{outputs:[{dims:I,dataType:i.dataType}],dispatchGroup:{x:Math.ceil($[1]/le),y:Math.ceil($[0]/le)},programUniforms:[{type:12,data:me},...Gt(k,$)]}},getShaderSource:z}}return z=le=>{let me=dt("a",b,k.length),Te=Xt("output",b,$.length);return`
  ${le.registerUniform("output_size","u32").declareVariables(me,Te)}

  ${Ul(E,S,me,Te)}

  ${le.mainStart()}
    ${le.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${Te.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${Te.setByOffset("global_idx",me.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${c}`,inputDependencies:["rank"]},getRunData:()=>{let le=st.size(I);return{outputs:[{dims:I,dataType:i.dataType}],dispatchGroup:{x:Math.ceil(le/64)},programUniforms:[{type:12,data:le},...Gt(k,$)]}},getShaderSource:z}},Kp=(i,c)=>{tc(i.inputs,c.perm),i.compute(ui(i.inputs[0],c.perm))},Vl=i=>_r({perm:i.perm})}),rc,Wl,nc,Ja,Ao,Sf,ic,sc,Gl,Hl,Ii,Cf,ca,Za,Ef,Kl,Rn,Xl,el,oc,Pf,Xp=s(()=>{rr(),ue(),br(),Ht(),zs(),rc={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Wl={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},nc={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Ja={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Ao=(i,c)=>{let b=[];for(let S=c-i;S<c;++S)b.push(S);return b},Sf=(i,c)=>{let b=[],S=i.length;for(let I=0;I<S;I++)c.indexOf(I)===-1&&b.push(i[I]);let E=c.map(I=>i[I]);return[b,E]},ic=(i,c)=>{let b=i.length+c.length,S=[],E=0;for(let I=0;I<b;I++)c.indexOf(I)===-1?S.push(i[E++]):S.push(1);return S},sc=(i,c)=>{for(let b=0;b<i.length;++b)if(i[i.length-b-1]!==c-1-b)return!1;return!0},Gl=(i,c)=>{let b=[];if(!sc(i,c)){for(let S=0;S<c;++S)i.indexOf(S)===-1&&b.push(S);i.forEach(S=>b.push(S))}return b},Hl=(i,c,b,S,E,I,k)=>{let $=b[0].dims,B=st.size(I),z=st.size(k),G=dt("_A",b[0].dataType,$),q=Xt("output",E,I),Z=64;B===1&&(Z=256);let se=`
          var<workgroup> aBestValues : array<f32, ${Z}>;
       `,le=me=>`
        ${me.registerUniform("reduceSize","u32").declareVariables(G,q)}
        ${se}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${me.mainStart(Z)}

          let outputIndex = global_idx / ${Z};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${nc[S]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${Z}) {
           let candidate = f32(${G.getByOffset("offset + k")});
           bestValue = ${rc[S]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${Z}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Wl[S]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${q.setByOffset("outputIndex",`${S==="mean"?`${q.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${q.type.storage}(${Ja[S]})`}`)};
         }
        }`;return{name:i,shaderCache:{hint:`${c};${Z}`,inputDependencies:["type"]},getShaderSource:le,getRunData:()=>({outputs:[{dims:I,dataType:E}],dispatchGroup:{x:B},programUniforms:[{type:12,data:z}]})}},Ii=(i,c,b,S)=>{let E=i.inputs.length===1?b:ac(i.inputs,b),I=E.axes;I.length===0&&!E.noopWithEmptyAxes&&(I=i.inputs[0].dims.map((se,le)=>le));let k=st.normalizeAxes(I,i.inputs[0].dims.length),$=k,B=i.inputs[0],z=Gl($,i.inputs[0].dims.length);z.length>0&&(B=i.compute(ui(i.inputs[0],z),{inputs:[0],outputs:[-1]})[0],$=Ao($.length,B.dims.length));let[G,q]=Sf(B.dims,$),Z=G;E.keepDims&&(Z=ic(G,k)),i.compute(Hl(c,E.cacheKey,[B],S,i.inputs[0].dataType,Z,q),{inputs:[B]})},Cf=(i,c)=>{Ii(i,"ReduceMeanShared",c,"mean")},ca=(i,c)=>{Ii(i,"ReduceL1Shared",c,"l1")},Za=(i,c)=>{Ii(i,"ReduceL2Shared",c,"l2")},Ef=(i,c)=>{Ii(i,"ReduceLogSumExpShared",c,"logSumExp")},Kl=(i,c)=>{Ii(i,"ReduceMaxShared",c,"max")},Rn=(i,c)=>{Ii(i,"ReduceMinShared",c,"min")},Xl=(i,c)=>{Ii(i,"ReduceProdShared",c,"prod")},el=(i,c)=>{Ii(i,"ReduceSumShared",c,"sum")},oc=(i,c)=>{Ii(i,"ReduceSumSquareShared",c,"sumSquare")},Pf=(i,c)=>{Ii(i,"ReduceLogSumShared",c,"logSum")}}),ji,Of,Yl,ac,ci,kf,ql,Ql,lc,js,da,If,Af,uc,Do,Pn,Jl,Df,Ff,cc,Lf,$f,uo,Qe,ht,ot,Ht=s(()=>{rr(),ue(),Br(),br(),Xp(),ji=i=>{if(!i||i.length===0||i.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(i.length===2&&i[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Of=i=>["","",`var value = ${i.getByIndices("input_indices")};`,""],Yl=(i,c,b,S,E,I,k=!1,$=!1)=>{let B=[],z=b[0].dims,G=z.length,q=st.normalizeAxes(E,G),Z=!$&&q.length===0;z.forEach((me,Te)=>{Z||q.indexOf(Te)>=0?k&&B.push(1):B.push(me)});let se=B.length,le=st.size(B);return{name:i,shaderCache:c,getShaderSource:me=>{let Te=[],de=dt("_A",b[0].dataType,G),_e=Xt("output",I,se),Ae=S(de,_e,q),Oe=Ae[2];for(let He=0,lt=0;He<G;He++)Z||q.indexOf(He)>=0?(k&&lt++,Oe=`for(var j${He}: u32 = 0; j${He} < ${z[He]}; j${He}++) {
                  ${Ae[2].includes("last_index")?`let last_index = j${He};`:""}
                  ${de.indicesSet("input_indices",He,`j${He}`)}
                  ${Oe}
                }`):(Te.push(`${de.indicesSet("input_indices",He,_e.indicesGet("output_indices",lt))};`),lt++);return`

        ${me.registerUniform("output_size","u32").declareVariables(de,_e)}

        ${me.mainStart()}
          ${me.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${de.type.indices};
          let output_indices = ${_e.offsetToIndices("global_idx")};

          ${Te.join(`
`)}
          ${Ae[0]}       // init ops for reduce max/min
          ${Ae[1]}
          ${Oe}
          ${Ae[3]}
          ${Ae.length===4?_e.setByOffset("global_idx","value"):Ae.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:B,dataType:I}],dispatchGroup:{x:Math.ceil(le/64)},programUniforms:[{type:12,data:le},...Gt(z,B)]})}},ac=(i,c)=>{let b=[];return i[1].dims[0]>0&&i[1].getBigInt64Array().forEach(S=>b.push(Number(S))),_r({axes:b,keepDims:c.keepDims,noopWithEmptyAxes:c.noopWithEmptyAxes})},ci=(i,c,b,S)=>{let E=i.inputs,I=E.length===1?b:ac(E,b);i.compute(Yl(c,{hint:I.cacheKey,inputDependencies:["rank"]},[E[0]],I.noopWithEmptyAxes&&I.axes.length===0?Of:S,I.axes,E[0].dataType,I.keepDims,I.noopWithEmptyAxes),{inputs:[0]})},kf=(i,c)=>{ji(i.inputs),ci(i,"ReduceLogSum",c,(b,S)=>[`var value = ${S.type.storage}(0);`,"",`value += ${b.getByIndices("input_indices")};`,"value = log(value);"])},ql=(i,c)=>{ji(i.inputs),ci(i,"ReduceL1",c,(b,S)=>[`var value = ${S.type.storage}(0);`,"",`value += abs(${b.getByIndices("input_indices")});`,""])},Ql=(i,c)=>{ji(i.inputs),ci(i,"ReduceL2",c,(b,S)=>[`var t = ${S.type.value}(0); var value = ${S.type.value}(0);`,"",`t = ${b.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},lc=(i,c)=>{ji(i.inputs),ci(i,"ReduceLogSumExp",c,(b,S)=>[`var value = ${S.type.storage}(0);`,"",`value += exp(${b.getByIndices("input_indices")});`,"value = log(value);"])},js=(i,c)=>{ji(i.inputs),ci(i,"ReduceMax",c,(b,S,E)=>{let I=[];for(let k=0;k<b.rank;k++)(E.indexOf(k)>=0||E.length===0)&&I.push(b.indicesSet("input_indices",k,0));return[`${I.join(`
`)}`,`var value = ${b.getByIndices("input_indices")};`,`value = max(value, ${b.getByIndices("input_indices")});`,""]})},da=(i,c)=>{ji(i.inputs),ci(i,"ReduceMean",c,(b,S,E)=>{let I=1;for(let k=0;k<b.rank;k++)(E.indexOf(k)>=0||E.length===0)&&(I*=i.inputs[0].dims[k]);return["var sum = f32(0);","",`sum += f32(${b.getByIndices("input_indices")});`,`let value = ${S.type.value}(sum / ${I});`]})},If=(i,c)=>{ji(i.inputs),ci(i,"ReduceMin",c,(b,S,E)=>{let I=[];for(let k=0;k<b.rank;k++)(E.indexOf(k)>=0||E.length===0)&&I.push(`input_indices[${k}] = 0;`);return[`${I.join(`
`)}`,`var value = ${b.getByIndices("input_indices")};`,`value = min(value, ${b.getByIndices("input_indices")});`,""]})},Af=(i,c)=>{ji(i.inputs),ci(i,"ReduceProd",c,(b,S)=>[`var value = ${S.type.storage}(1);`,"",`value *= ${b.getByIndices("input_indices")};`,""])},uc=(i,c)=>{ji(i.inputs),ci(i,"ReduceSum",c,(b,S)=>[`var value = ${S.type.storage}(0);`,"",`value += ${b.getByIndices("input_indices")};`,""])},Do=(i,c)=>{ji(i.inputs),ci(i,"ReduceSumSquare",c,(b,S)=>[`var t = ${S.type.value}(0); var value = ${S.type.value}(0);`,"",`t = ${b.getByIndices("input_indices")}; value += t * t;`,""])},Pn=(i,c,b)=>{if(c.length===0)return b;let S=1,E=1;for(let I=0;I<c.length;I++)c.indexOf(I)===-1?S*=i[I]:E*=i[I];return E<32&&S>1024},Jl=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?da(i,c):Cf(i,c)},Df=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?ql(i,c):ca(i,c)},Ff=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?Ql(i,c):Za(i,c)},cc=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?lc(i,c):Ef(i,c)},Lf=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?js(i,c):Kl(i,c)},$f=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?If(i,c):Rn(i,c)},uo=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?Af(i,c):Xl(i,c)},Qe=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?uc(i,c):el(i,c)},ht=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?Do(i,c):oc(i,c)},ot=(i,c)=>{Pn(i.inputs[0].dims,c.axes,c.noopWithEmptyAxes)?kf(i,c):Pf(i,c)}}),Tr,Zr,Dn,dn,Zl=s(()=>{rr(),Br(),Ht(),Tr=i=>{if(!i||i.length===0||i.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(i[0].dataType!==1)throw new Error("Invalid input type.")},Zr=(i,c)=>{Tr(i.inputs);let b=(S,E,I)=>{let k=[];for(let $=0;$<S.rank;$++)(I.indexOf($)>=0||I.length===0)&&k.push(`input_indices[${$}] = 0;`);return[`${k.join(`
`)}`,`var value = ${S.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${S.getByIndices("input_indices")} ${c.selectLastIndex>0?"<=":"<"} value) {
         value = ${S.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",E.setByOffset("global_idx","best_index")]};i.compute(Yl("ArgMin",{hint:c.cacheKey,inputDependencies:["rank"]},[i.inputs[0]],b,[c.axis],7,c.keepDims),{inputs:[0]})},Dn=(i,c)=>{Tr(i.inputs);let b=(S,E,I)=>{let k=[];for(let $=0;$<S.rank;$++)(I.indexOf($)>=0||I.length===0)&&k.push(`input_indices[${$}] = 0;`);return[`${k.join(`
`)}`,`var value = ${S.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${S.getByIndices("input_indices")} ${c.selectLastIndex>0?">=":">"} value) {
         value = ${S.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",E.setByOffset("global_idx","best_index")]};i.compute(Yl("argMax",{hint:c.cacheKey,inputDependencies:["rank"]},[i.inputs[0]],b,[c.axis],7,c.keepDims),{inputs:[0]})},dn=i=>_r(i)}),Rf,gi,fa,Bf,Fo,Ns,tl,on,eu=s(()=>{rr(),ue(),Gn(),br(),Rf=(i,c)=>{let b=i[0],S=i[1],E=i[2],I=i[3],k=i[4],$=i[5];if(k&&$)throw new Error("Attention cannot have both past and attention_bias");if(b.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let B=b.dims[0],z=b.dims[1],G=b.dims[2];if(E.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(S.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(S.dims[0]!==G)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(E.dims[0]!==S.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let q=E.dims[0]/3,Z=q,se=Z;if(c.qkvHiddenSizes.length>0){if(c.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let Ae of c.qkvHiddenSizes)if(Ae%c.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");q=c.qkvHiddenSizes[0],Z=c.qkvHiddenSizes[1],se=c.qkvHiddenSizes[2]}let le=z;if(q!==Z)throw new Error("qkv_hidden_sizes first element should be same as the second");if(E.dims[0]!==q+Z+se)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let me=0;if(k){if(Z!==se)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(k.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(k.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(k.dims[1]!==B)throw new Error('Input "past" second dimension must be batch_size');if(k.dims[2]!==c.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(k.dims[4]!==Z/c.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');c.pastPresentShareBuffer||(me=k.dims[3])}let Te=le+me,de=-1,_e=0;if(I)throw new Error("Mask not supported");if(k)throw new Error("past is not supported");if($){if($.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if($.dims[0]!==B||$.dims[1]!==c.numHeads||$.dims[2]!==z||$.dims[3]!==Te)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:B,sequenceLength:z,pastSequenceLength:me,kvSequenceLength:le,totalSequenceLength:Te,maxSequenceLength:de,inputHiddenSize:G,hiddenSize:q,vHiddenSize:se,headSize:Math.floor(q/c.numHeads),vHeadSize:Math.floor(se/c.numHeads),numHeads:c.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:c.maskFilterValue,maskType:_e,scale:c.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},gi=(i,c,b)=>c&&i?`
      let total_sequence_length_input = u32(${c.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${i==null?void 0:i.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${b?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,fa=(i,c,b,S,E,I,k,$)=>{let B=cn(k?1:I),z=64,G=I/B;G<z&&(z=32);let q=Math.ceil(I/B/z),Z=[{type:12,data:c},{type:12,data:b},{type:12,data:S},{type:12,data:E},{type:12,data:G},{type:12,data:q}],se=Kr(i.dataType,B),le=Kn(1,B),me=["type"];k&&me.push("type"),$&&me.push("type");let Te=de=>{let _e=Xt("x",i.dataType,i.dims,B),Ae=[_e],Oe=k?dt("seq_lens",k.dataType,k.dims):void 0;Oe&&Ae.push(Oe);let He=$?dt("total_sequence_length_input",$.dataType,$.dims):void 0;He&&Ae.push(He);let lt=Kn(i.dataType),it=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${z}>;
  var<workgroup> thread_sum: array<f32, ${z}>;
  ${de.registerUniforms(it).declareVariables(...Ae)}
  ${de.mainStart([z,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${gi(Oe,He,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${z}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${k?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${le}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${le}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(B){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${B}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${z}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${le}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${le}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(B){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${B}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${z}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${_e.type.value}(${lt}(1.0) / ${lt}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${le}(x[offset + i]);
        x[offset + i] = ${_e.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${k?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${_e.type.value}(${lt}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${z};${se};${B}`,inputDependencies:me},getShaderSource:Te,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:E,z:c*b},programUniforms:Z})}},Bf=(i,c,b,S,E,I,k,$,B)=>{let z=k+I.kvSequenceLength,G=[I.batchSize,I.numHeads,I.sequenceLength,z],q=i>1&&S,Z=I.kvNumHeads?I.kvNumHeads:I.numHeads,se=q?[I.batchSize,Z,z,I.headSize]:void 0,le=I.nReps?I.nReps:1,me=I.scale===0?1/Math.sqrt(I.headSize):I.scale,Te=cn(I.headSize),de=I.headSize/Te,_e=12,Ae={x:Math.ceil(z/_e),y:Math.ceil(I.sequenceLength/_e),z:I.batchSize*I.numHeads},Oe=[{type:12,data:I.sequenceLength},{type:12,data:de},{type:12,data:z},{type:12,data:I.numHeads},{type:12,data:I.headSize},{type:1,data:me},{type:12,data:k},{type:12,data:I.kvSequenceLength},{type:12,data:le}],He=q&&S&&st.size(S.dims)>0,lt=["type","type"];He&&lt.push("type"),E&&lt.push("type"),$&&lt.push("type"),B&&lt.push("type");let it=[{dims:G,dataType:c.dataType,gpuDataType:0}];q&&it.push({dims:se,dataType:c.dataType,gpuDataType:0});let mt=Mt=>{let At=dt("q",c.dataType,c.dims,Te),$t=dt("key",b.dataType,b.dims,Te),Vt=[At,$t];if(He){let ar=dt("past_key",S.dataType,S.dims,Te);Vt.push(ar)}E&&Vt.push(dt("attention_bias",E.dataType,E.dims));let Kt=$?dt("seq_lens",$.dataType,$.dims):void 0;Kt&&Vt.push(Kt);let Mr=B?dt("total_sequence_length_input",B.dataType,B.dims):void 0;Mr&&Vt.push(Mr);let tr=Xt("output",c.dataType,G),Jt=[tr];q&&Jt.push(Xt("present_key",c.dataType,se,Te));let Lt=Kn(1,Te),$r=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_e}u;

  var<workgroup> tileQ: array<${At.type.storage}, ${_e*_e}>;
  var<workgroup> tileK: array<${At.type.storage}, ${_e*_e}>;
  ${Mt.registerUniforms($r).declareVariables(...Vt,...Jt)}
  ${Mt.mainStart([_e,_e,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${le===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${le===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${gi(Kt,Mr,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${He&&q?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${q?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${Lt}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${He&&q?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${q?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${Lt}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(Te){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${Te}`)}})()};
        output[outputIdx] = ${tr.type.value} (sum * uniforms.alpha) + ${E?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${Te};${E!==void 0};${S!==void 0};${i}`,inputDependencies:lt},getRunData:()=>({outputs:it,dispatchGroup:Ae,programUniforms:Oe}),getShaderSource:mt}},Fo=(i,c,b,S,E,I,k=void 0,$=void 0)=>{let B=I+E.kvSequenceLength,z=E.nReps?E.nReps:1,G=E.vHiddenSize*z,q=i>1&&S,Z=E.kvNumHeads?E.kvNumHeads:E.numHeads,se=q?[E.batchSize,Z,B,E.headSize]:void 0,le=[E.batchSize,E.sequenceLength,G],me=12,Te={x:Math.ceil(E.vHeadSize/me),y:Math.ceil(E.sequenceLength/me),z:E.batchSize*E.numHeads},de=[{type:12,data:E.sequenceLength},{type:12,data:B},{type:12,data:E.vHeadSize},{type:12,data:E.numHeads},{type:12,data:E.headSize},{type:12,data:G},{type:12,data:I},{type:12,data:E.kvSequenceLength},{type:12,data:z}],_e=q&&S&&st.size(S.dims)>0,Ae=["type","type"];_e&&Ae.push("type"),k&&Ae.push("type"),$&&Ae.push("type");let Oe=[{dims:le,dataType:c.dataType,gpuDataType:0}];q&&Oe.push({dims:se,dataType:c.dataType,gpuDataType:0});let He=lt=>{let it=dt("probs",c.dataType,c.dims),mt=dt("v",b.dataType,b.dims),Mt=[it,mt];_e&&Mt.push(dt("past_value",S.dataType,S.dims));let At=k?dt("seq_lens",k.dataType,k.dims):void 0;k&&Mt.push(At);let $t=$?dt("total_sequence_length_input",$.dataType,$.dims):void 0;$&&Mt.push($t);let Vt=[Xt("output",c.dataType,le)];q&&Vt.push(Xt("present_value",c.dataType,se));let Kt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${me}u;
  var<workgroup> tileQ: array<${it.type.value}, ${me*me}>;
  var<workgroup> tileV: array<${it.type.value}, ${me*me}>;
  ${lt.registerUniforms(Kt).declareVariables(...Mt,...Vt)}
  ${lt.mainStart([me,me,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${z===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${z===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${gi(At,$t,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${_e&&q?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${q?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${it.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${_e&&q?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${q?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${S!==void 0};${i}`,inputDependencies:Ae},getRunData:()=>({outputs:Oe,dispatchGroup:Te,programUniforms:de}),getShaderSource:He}},Ns=(i,c,b,S,E,I,k,$,B,z,G=void 0,q=void 0)=>{let Z=Math.min(i.outputCount,1+(k?1:0)+($?1:0)),se=Z>1?z.pastSequenceLength:0,le=se+z.kvSequenceLength,me=B&&st.size(B.dims)>0?B:void 0,Te=[c,b];Z>1&&k&&st.size(k.dims)>0&&Te.push(k),me&&Te.push(me),G&&Te.push(G),q&&Te.push(q);let de=i.compute(Bf(Z,c,b,k,me,z,se,G,q),{inputs:Te,outputs:Z>1?[-1,1]:[-1]})[0];i.compute(fa(de,z.batchSize,z.numHeads,se,z.sequenceLength,le,G,q),{inputs:G&&q?[de,G,q]:[de],outputs:[]});let _e=[de,S];Z>1&&$&&st.size($.dims)>0&&_e.push($),G&&_e.push(G),q&&_e.push(q),i.compute(Fo(Z,de,S,$,z,se,G,q),{inputs:_e,outputs:Z>1?[0,2]:[0]})},tl=(i,c)=>{let b=[c.batchSize,c.numHeads,c.sequenceLength,c.headSize],S=c.sequenceLength,E=c.inputHiddenSize,I=c.headSize,k=12,$={x:Math.ceil(c.headSize/k),y:Math.ceil(c.sequenceLength/k),z:c.batchSize*c.numHeads},B=[i.inputs[0],i.inputs[1],i.inputs[2]],z=[{type:12,data:S},{type:12,data:E},{type:12,data:I},{type:12,data:c.numHeads},{type:12,data:c.headSize},{type:12,data:c.hiddenSize},{type:12,data:c.hiddenSize+c.hiddenSize+c.vHiddenSize}],G=q=>{let Z=Xt("output_q",B[0].dataType,b),se=Xt("output_k",B[0].dataType,b),le=Xt("output_v",B[0].dataType,b),me=dt("input",B[0].dataType,B[0].dims),Te=dt("weight",B[1].dataType,B[1].dims),de=dt("bias",B[2].dataType,B[2].dims),_e=me.type.storage,Ae=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${k}u;
  var<workgroup> tileInput: array<${_e}, ${k*k}>;
  var<workgroup> tileWeightQ: array<${_e}, ${k*k}>;
  var<workgroup> tileWeightK: array<${_e}, ${k*k}>;
  var<workgroup> tileWeightV: array<${_e}, ${k*k}>;
  ${q.registerUniforms(Ae).declareVariables(me,Te,de,Z,se,le)}
  ${q.mainStart([k,k,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${_e}(0);
    var valueK = ${_e}(0);
    var valueV = ${_e}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return i.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:b,dataType:i.inputs[0].dataType,gpuDataType:0},{dims:b,dataType:i.inputs[0].dataType,gpuDataType:0},{dims:b,dataType:i.inputs[0].dataType,gpuDataType:0}],dispatchGroup:$,programUniforms:z}),getShaderSource:G},{inputs:B,outputs:[-1,-1,-1]})},on=(i,c)=>{let b=Rf(i.inputs,c),[S,E,I]=tl(i,b);return Ns(i,S,E,I,i.inputs[4],void 0,void 0,void 0,i.inputs[5],b)}}),dc,rl,fc,zf,Yp=s(()=>{wt(),rr(),ue(),Br(),br(),dc=(i,c)=>{if(!i||i.length!==5)throw new Error("BatchNormalization requires 5 inputs");let b=(S,E,I)=>{let k=E.length;if(k!==S.length)throw new Error(`${I}: num dimensions != ${k}`);E.forEach(($,B)=>{if($!==S[B])throw new Error(`${I}: dim[${B}] do not match`)})};if(i[0].dims.length>1){let S=c.format==="NHWC"?c.spatial?i[0].dims.slice(-1):i[0].dims.slice(-1).concat(i[0].dims.slice(1,i[0].dims.length-1)):i[0].dims.slice(1,c.spatial?2:void 0);b(i[1].dims,S,"Invalid input scale"),b(i[2].dims,S,"Invalid input B"),b(i[3].dims,S,"Invalid input mean"),b(i[4].dims,S,"Invalid input var")}else b(i[1].dims,[1],"Invalid input scale"),b(i[2].dims,[1],"Invalid input B"),b(i[3].dims,[1],"Invalid input mean"),b(i[4].dims,[1],"Invalid input var")},rl=(i,c)=>{let{epsilon:b,spatial:S,format:E}=c,I=i[0].dims,k=S?cn(I[I.length-1]):1,$=E==="NHWC"&&I.length>1?k:1,B=st.size(I)/k,z=S,G=z?I.length:I,q=dt("x",i[0].dataType,i[0].dims,k),Z=dt("scale",i[1].dataType,i[1].dims,$),se=dt("bias",i[2].dataType,i[2].dims,$),le=dt("inputMean",i[3].dataType,i[3].dims,$),me=dt("inputVar",i[4].dataType,i[4].dims,$),Te=Xt("y",i[0].dataType,G,k),de=()=>{let Ae="";if(S)Ae=`let cOffset = ${I.length===1?"0u":E==="NHWC"?`outputIndices[${I.length-1}] / ${k}`:"outputIndices[1]"};`;else if(E==="NCHW")Ae=`
            ${Te.indicesSet("outputIndices","0","0")}
            let cOffset = ${Te.indicesToOffset("outputIndices")};`;else{Ae=`var cIndices = ${Z.type.indices}(0);
                       cIndices[0] = outputIndices[${I.length-1}];`;for(let Oe=1;Oe<Z.rank;Oe++)Ae+=`cIndices[${Oe}] = outputIndices[${Oe}];`;Ae+=`let cOffset = ${Z.indicesToOffset("cIndices")};`}return Ae},_e=Ae=>`
  const epsilon = ${b};
  ${Ae.registerUniform("outputSize","u32").declareVariables(q,Z,se,le,me,Te)}
  ${Ae.mainStart()}
  ${Ae.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${Te.offsetToIndices(`global_idx * ${k}`)};
    ${de()}
    let scale = ${Z.getByOffset("cOffset")};
    let bias = ${se.getByOffset("cOffset")};
    let inputMean = ${le.getByOffset("cOffset")};
    let inputVar = ${me.getByOffset("cOffset")};
    let x = ${q.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${Te.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${c.epsilon}_${c.format}_${S}_${k}`,inputDependencies:z?["rank","type","type","type","type"]:void 0},getShaderSource:_e,getRunData:()=>({outputs:[{dims:i[0].dims,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(B/64)},programUniforms:z?[{type:12,data:B},...Gt(I)]:[{type:12,data:B}]})}},fc=i=>_r(i),zf=(i,c)=>{let{inputs:b,outputCount:S}=i,E=fc({...c,outputCount:S});if(L.webgpu.validateInputContent&&dc(b,E),c.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");i.compute(rl(b,E))}}),ha,Us,nl,hc=s(()=>{ue(),br(),ha=i=>{if(i[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(i[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(i[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(i[0].dims[2]!==i[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Us=i=>{let c=i[0].dims,b=i[0].dims[2],S=st.size(c)/4,E=i[0].dataType,I=dt("input",E,c,4),k=dt("bias",E,[b],4),$=dt("residual",E,c,4),B=Xt("output",E,c,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:c,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(S/64)}}),getShaderSource:z=>`
  const channels = ${b}u / 4;
  ${z.declareVariables(I,k,$,B)}

  ${z.mainStart()}
    ${z.guardAgainstOutOfBoundsWorkgroupSizes(S)}
    let value = ${I.getByOffset("global_idx")}
      + ${k.getByOffset("global_idx % channels")} + ${$.getByOffset("global_idx")};
    ${B.setByOffset("global_idx","value")}
  }`}},nl=i=>{ha(i.inputs),i.compute(Us(i.inputs))}}),il,Xr,tu,sl,pc,Lo,co,ol,mc,jf,Nf,pa,al,ru,gc,_c,ll,vc,Cn,ii,yc,Uf,wc,xc,nu,ma,ul,$o,ga,Ro,cl,Bo,Vf,Wf,bc,Mc,Gf,zo,jo,Tc,ge,No,dl,Si,Vr,Sc=s(()=>{rr(),ue(),Br(),br(),il=(i,c,b,S,E,I,k)=>{let $=Math.ceil(c/4),B="";typeof E=="string"?B=`${E}(a)`:B=E("a");let z=dt("inputData",b,[$],4),G=Xt("outputData",S,[$],4),q=[{name:"vec_size",type:"u32"}];return k&&q.push(...k),`
      ${i.registerUniforms(q).declareVariables(z,G)}

  ${I!=null?I:""}

  ${i.mainStart()}
    ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${z.getByOffset("global_idx")};
    ${G.setByOffset("global_idx",B)}
  }`},Xr=(i,c,b,S,E,I=i.dataType,k,$)=>{let B=[{type:12,data:Math.ceil(st.size(i.dims)/4)}];return k&&B.push(...k),{name:c,shaderCache:{hint:E,inputDependencies:["type"]},getShaderSource:z=>il(z,st.size(i.dims),i.dataType,I,b,S,$),getRunData:z=>({outputs:[{dims:i.dims,dataType:I}],dispatchGroup:{x:Math.ceil(st.size(z[0].dims)/64/4)},programUniforms:B})}},tu=i=>{i.compute(Xr(i.inputs[0],"Abs","abs"))},sl=i=>{i.compute(Xr(i.inputs[0],"Acos","acos"))},pc=i=>{i.compute(Xr(i.inputs[0],"Acosh","acosh"))},Lo=i=>{i.compute(Xr(i.inputs[0],"Asin","asin"))},co=i=>{i.compute(Xr(i.inputs[0],"Asinh","asinh"))},ol=i=>{i.compute(Xr(i.inputs[0],"Atan","atan"))},mc=i=>{i.compute(Xr(i.inputs[0],"Atanh","atanh"))},jf=i=>_r(i),Nf=(i,c)=>{let b;switch(c.to){case 10:b="vec4<f16>";break;case 1:b="vec4<f32>";break;case 12:b="vec4<u32>";break;case 6:b="vec4<i32>";break;case 9:b="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${c.to}`)}i.compute(Xr(i.inputs[0],"Cast",b,void 0,c.cacheKey,c.to))},pa=i=>{let c,b,S=i.length>=2&&i[1].data!==0,E=i.length>=3&&i[2].data!==0;switch(i[0].dataType){case 1:c=S?i[1].getFloat32Array()[0]:-34028234663852886e22,b=E?i[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:c=S?i[1].getUint16Array()[0]:64511,b=E?i[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return _r({min:c,max:b})},al=(i,c)=>{let b=c||pa(i.inputs),S=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"Clip",E=>`clamp(${E}, vec4<${S}>(uniforms.min), vec4<${S}>(uniforms.max))`,void 0,b.cacheKey,void 0,[{type:i.inputs[0].dataType,data:b.min},{type:i.inputs[0].dataType,data:b.max}],[{name:"min",type:S},{name:"max",type:S}]),{inputs:[0]})},ru=i=>{i.compute(Xr(i.inputs[0],"Ceil","ceil"))},gc=i=>{i.compute(Xr(i.inputs[0],"Cos","cos"))},_c=i=>{i.compute(Xr(i.inputs[0],"Cosh","cosh"))},ll=i=>_r(i),vc=(i,c)=>{let b=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"Elu",S=>`elu_vf32(${S})`,`
  const elu_alpha_ = ${b}(${c.alpha});

  fn elu_f32(a: ${b}) -> ${b} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${b}>) -> vec4<${b}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,c.cacheKey))},Cn=(i="f32")=>`
const r0: ${i} = 0.3275911;
const r1: ${i} = 0.254829592;
const r2: ${i} = -0.284496736;
const r3: ${i} = 1.421413741;
const r4: ${i} = -1.453152027;
const r5: ${i} = 1.061405429;

fn erf_vf32(v: vec4<${i}>) -> vec4<${i}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,ii=i=>{let c=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"Erf",b=>`erf_vf32(${b})`,Cn(c)))},yc=i=>{i.compute(Xr(i.inputs[0],"Exp","exp"))},Uf=i=>{i.compute(Xr(i.inputs[0],"Floor","floor"))},wc=i=>{let c=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"Gelu",b=>`0.5 * ${b} * (1.0 + erf_vf32(${b} * 0.7071067811865475))`,Cn(c)))},xc=(i,c)=>{let b=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"LeakyRelu",S=>`select(leaky_relu_alpha_ * ${S}, ${S}, ${S} >= vec4<${b}>(0.0))`,`const leaky_relu_alpha_ = ${b}(${c.alpha});`,c.cacheKey))},nu=i=>{i.compute(Xr(i.inputs[0],"Not",c=>`!${c}`))},ma=i=>{i.compute(Xr(i.inputs[0],"Neg",c=>`-${c}`))},ul=i=>{i.compute(Xr(i.inputs[0],"Reciprocal",c=>`1.0/${c}`))},$o=i=>{let c=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"Relu",b=>`select(vec4<${c}>(0.0), ${b}, ${b} > vec4<${c}>(0.0))`))},ga=i=>{i.compute(Xr(i.inputs[0],"Sigmoid",c=>`(1.0 / (1.0 + exp(-${c})))`))},Ro=i=>_r(i),cl=(i,c)=>{let b=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"HardSigmoid",S=>`max(vec4<${b}>(0.0), min(vec4<${b}>(1.0), ${c.alpha} * ${S} + vec4<${b}>(${c.beta})))`,void 0,c.cacheKey))},Bo=i=>{i.compute(Xr(i.inputs[0],"Sin","sin"))},Vf=i=>{i.compute(Xr(i.inputs[0],"Sinh","sinh"))},Wf=i=>{i.compute(Xr(i.inputs[0],"Sqrt","sqrt"))},bc=i=>{i.compute(Xr(i.inputs[0],"Tan","tan"))},Mc=i=>`sign(${i}) * (1 - exp(-2 * abs(${i}))) / (1 + exp(-2 * abs(${i})))`,Gf=i=>{i.compute(Xr(i.inputs[0],"Tanh",Mc))},zo=(i="f32")=>`
const fast_gelu_a: ${i} = 0.5;
const fast_gelu_b: ${i} = 0.7978845608028654;
const fast_gelu_c: ${i} = 0.035677408136300125;

fn tanh_v(v: vec4<${i}>) -> vec4<${i}> {
  return ${Mc("v")};
}
`,jo=i=>`(fast_gelu_a + fast_gelu_a * tanh_v(${i} * (fast_gelu_c * ${i} * ${i} + fast_gelu_b))) * ${i}`,Tc=i=>{let c=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"FastGelu",jo,zo(c),void 0,i.inputs[0].dataType))},ge=(i,c)=>{let b=Kn(i.inputs[0].dataType);return i.compute(Xr(i.inputs[0],"ThresholdedRelu",S=>`select(vec4<${b}>(0.0), ${S}, ${S} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${b}>(${c.alpha});`,c.cacheKey)),0},No=i=>{i.compute(Xr(i.inputs[0],"Log","log"))},dl=(i,c)=>`
const alpha = vec4<${i}>(${c});
const one = ${i}(1.0);
const zero = ${i}(0.0);

fn quick_gelu_impl(x: vec4<${i}>) -> vec4<${i}> {
  let v = x *alpha;
  var x1 : vec4<${i}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Si=i=>`quick_gelu_impl(${i})`,Vr=(i,c)=>{let b=Kn(i.inputs[0].dataType);i.compute(Xr(i.inputs[0],"QuickGelu",Si,dl(b,c.alpha),c.cacheKey,i.inputs[0].dataType))}}),Cc,Hf,fo,Kf=s(()=>{ue(),br(),Sc(),Cc=i=>{if(i[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(i[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(i[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(i[0].dims[2]!==i[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Hf=i=>{let c=i[0].dims.slice();c[2]=c[2]/2;let b=dt("input",i[0].dataType,i[0].dims,4),S=dt("bias",i[0].dataType,[i[0].dims[2]],4),E=Xt("output",i[0].dataType,c,4),I=st.size(c)/4,k=Kr(i[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:c,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)}}),getShaderSource:$=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${i[0].dims[2]/4/2}u;

  ${$.declareVariables(b,S,E)}

  ${Cn(k)}

  ${$.mainStart()}
    ${$.guardAgainstOutOfBoundsWorkgroupSizes(I)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${E.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},fo=i=>{Cc(i.inputs),i.compute(Hf(i.inputs))}}),Xf,Yf,Ni,qf,ps,Qf,Jf,Ec,Zf,eh,ms,th,Pc,qp=s(()=>{rr(),ue(),br(),Xf=(i,c,b,S,E,I,k,$,B,z,G,q)=>{let Z,se;typeof $=="string"?Z=se=(_e,Ae)=>`${$}((${_e}),(${Ae}))`:typeof $=="function"?Z=se=$:(Z=$.scalar,se=$.vector);let le=Xt("outputData",G,S.length,4),me=dt("aData",B,c.length,4),Te=dt("bData",z,b.length,4),de;if(E)if(I){let _e=st.size(c)===1,Ae=st.size(b)===1,Oe=c.length>0&&c[c.length-1]%4===0,He=b.length>0&&b[b.length-1]%4===0;_e||Ae?de=le.setByOffset("global_idx",se(_e?`${me.type.value}(${me.getByOffset("0")}.x)`:me.getByOffset("global_idx"),Ae?`${Te.type.value}(${Te.getByOffset("0")}.x)`:Te.getByOffset("global_idx"))):de=`
            let outputIndices = ${le.offsetToIndices("global_idx * 4u")};
            let offsetA = ${me.broadcastedIndicesToOffset("outputIndices",le)};
            let offsetB = ${Te.broadcastedIndicesToOffset("outputIndices",le)};
            ${le.setByOffset("global_idx",se(k||Oe?me.getByOffset("offsetA / 4u"):`${me.type.value}(${me.getByOffset("offsetA / 4u")}[offsetA % 4u])`,k||He?Te.getByOffset("offsetB / 4u"):`${Te.type.value}(${Te.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else de=le.setByOffset("global_idx",se(me.getByOffset("global_idx"),Te.getByOffset("global_idx")));else{if(!I)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let _e=(Ae,Oe,He="")=>{let lt=`aData[indexA${Oe}][componentA${Oe}]`,it=`bData[indexB${Oe}][componentB${Oe}]`;return`
            let outputIndices${Oe} = ${le.offsetToIndices(`global_idx * 4u + ${Oe}u`)};
            let offsetA${Oe} = ${me.broadcastedIndicesToOffset(`outputIndices${Oe}`,le)};
            let offsetB${Oe} = ${Te.broadcastedIndicesToOffset(`outputIndices${Oe}`,le)};
            let indexA${Oe} = offsetA${Oe} / 4u;
            let indexB${Oe} = offsetB${Oe} / 4u;
            let componentA${Oe} = offsetA${Oe} % 4u;
            let componentB${Oe} = offsetB${Oe} % 4u;
            ${Ae}[${Oe}] = ${He}(${Z(lt,it)});
          `};G===9?de=`
            var data = vec4<u32>(0);
            ${_e("data",0,"u32")}
            ${_e("data",1,"u32")}
            ${_e("data",2,"u32")}
            ${_e("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:de=`
            ${_e("outputData[global_idx]",0)}
            ${_e("outputData[global_idx]",1)}
            ${_e("outputData[global_idx]",2)}
            ${_e("outputData[global_idx]",3)}
          `}return`
        ${i.registerUniform("vec_size","u32").declareVariables(me,Te,le)}

        ${q!=null?q:""}

        ${i.mainStart()}
        ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${de}
      }`},Yf=(i,c,b,S,E,I,k=b.dataType)=>{let $=b.dims.map(me=>{var Te;return(Te=Number(me))!=null?Te:1}),B=S.dims.map(me=>{var Te;return(Te=Number(me))!=null?Te:1}),z=!st.areEqual($,B),G=$,q=st.size($),Z=!1,se=!1,le=[z];if(z){let me=Fs.calcShape($,B,!1);if(!me)throw new Error("Can't perform binary op on the given tensors");G=me.slice(),q=st.size(G);let Te=st.size($)===1,de=st.size(B)===1,_e=$.length>0&&$[$.length-1]%4===0,Ae=B.length>0&&B[B.length-1]%4===0;le.push(Te),le.push(de),le.push(_e),le.push(Ae);let Oe=1;for(let He=1;He<G.length;He++){let lt=$[$.length-He],it=B[B.length-He];if(lt===it)Oe*=lt;else break}Oe%4===0?(se=!0,Z=!0):(Te||de||_e||Ae)&&(Z=!0)}else Z=!0;return le.push(Z),{name:i,shaderCache:{hint:c+le.map(me=>me.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:me=>Xf(me,$,B,G,Z,z,se,E,b.dataType,S.dataType,k,I),getRunData:()=>({outputs:[{dims:G,dataType:k}],dispatchGroup:{x:Math.ceil(q/64/4)},programUniforms:[{type:12,data:Math.ceil(st.size(G)/4)},...Gt($,B,G)]})}},Ni=(i,c,b,S,E,I)=>{i.compute(Yf(c,E!=null?E:"",i.inputs[0],i.inputs[1],b,S,I))},qf=i=>{Ni(i,"Add",(c,b)=>`${c}+${b}`)},ps=i=>{Ni(i,"Div",(c,b)=>`${c}/${b}`)},Qf=i=>{Ni(i,"Equal",{scalar:(c,b)=>`u32(${c}==${b})`,vector:(c,b)=>`vec4<u32>(${c}==${b})`},void 0,void 0,9)},Jf=i=>{Ni(i,"Mul",(c,b)=>`${c}*${b}`)},Ec=i=>{let c=dt("input",i.inputs[0].dataType,i.inputs[0].dims).type.value;Ni(i,"Pow",{scalar:(b,S)=>`pow_custom(${b},${S})`,vector:(b,S)=>`pow_vector_custom(${b},${S})`},`
    fn pow_custom(a : ${c}, b : ${c}) -> ${c} {
      if (b == ${c}(0.0)) {
        return ${c}(1.0);
      } else if (a < ${c}(0.0) && f32(b) != floor(f32(b))) {
        return ${c}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${c}(1.0), round(f32(abs(b) % ${c}(2.0))) != 1.0) * ${c}(${c==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${c}>, b : vec4<${c}>) -> vec4<${c}> {
      // TODO: implement vectorized pow
      return vec4<${c}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Zf=i=>{Ni(i,"Sub",(c,b)=>`${c}-${b}`)},eh=i=>{Ni(i,"Greater",{scalar:(c,b)=>`u32(${c}>${b})`,vector:(c,b)=>`vec4<u32>(${c}>${b})`},void 0,void 0,9)},ms=i=>{Ni(i,"Less",{scalar:(c,b)=>`u32(${c}<${b})`,vector:(c,b)=>`vec4<u32>(${c}<${b})`},void 0,void 0,9)},th=i=>{Ni(i,"GreaterOrEqual",{scalar:(c,b)=>`u32(${c}>=${b})`,vector:(c,b)=>`vec4<u32>(${c}>=${b})`},void 0,void 0,9)},Pc=i=>{Ni(i,"LessOrEqual",{scalar:(c,b)=>`u32(${c}<=${b})`,vector:(c,b)=>`vec4<u32>(${c}<=${b})`},void 0,void 0,9)}}),rh,nh,ho,Oc,ih,Ui,Qp=s(()=>{rr(),ue(),Br(),br(),rh=(i,c)=>{if(!i||i.length<1)throw new Error("too few inputs");let b=0,S=i[b],E=S.dataType,I=S.dims.length;i.forEach((k,$)=>{if($!==b){if(k.dataType!==E)throw new Error("input tensors should be one type");if(k.dims.length!==I)throw new Error("input tensors should have the same shape");k.dims.forEach((B,z)=>{if(z!==c&&B!==S.dims[z])throw new Error("non concat dimensions must match")})}})},nh=(i,c)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${i}u>(${c});
    for (var i: u32 = 0u; i < ${i}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${i}u;
  }`,ho=(i,c)=>{let b=i.length,S=[];for(let E=0;E<b;++E){let I=c.setByOffset("global_idx",i[E].getByIndices("indices"));b===1?S.push(I):E===0?S.push(`if (inputIndex == ${E}u) { ${I} }`):E===b-1?S.push(`else { ${I} }`):S.push(`else if (inputIndex == ${E}) { ${I} }`)}return S.join(`
`)},Oc=(i,c,b,S)=>{let E=st.size(b),I=new Array(i.length),k=new Array(i.length),$=0,B=[],z=[],G=[{type:12,data:E}];for(let me=0;me<i.length;++me)$+=i[me].dims[c],I[me]=$,z.push(i[me].dims.length),k[me]=dt(`input${me}`,S,z[me]),B.push("rank"),G.push({type:12,data:I[me]});for(let me=0;me<i.length;++me)G.push(...Gt(i[me].dims));G.push(...Gt(b));let q=Xt("output",S,b.length),Z=q.indicesGet("indices",c),se=Array.from(Array(I.length).keys()).map(me=>`uniforms.sizeInConcatAxis${me}`).join(","),le=me=>`

  ${(()=>{me.registerUniform("outputSize","u32");for(let Te=0;Te<i.length;Te++)me.registerUniform(`sizeInConcatAxis${Te}`,"u32");return me.declareVariables(...k,q)})()}

  ${nh(I.length,se)}

  ${me.mainStart()}
    ${me.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${q.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${Z});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${I.length}u>(${se});
      ${Z} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${ho(k,q)}
  }`;return{name:"Concat",shaderCache:{hint:`${c}`,inputDependencies:B},getRunData:()=>({outputs:[{dims:b,dataType:S}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:G}),getShaderSource:le}},ih=(i,c)=>{let b=i.inputs,S=b[0].dims,E=st.normalizeAxis(c.axis,S.length);rh(b,E);let I=S.slice();I[E]=b.reduce(($,B)=>$+(B.dims.length>E?B.dims[E]:0),0);let k=b.filter($=>st.size($.dims)>0);i.compute(Oc(k,E,I,b[0].dataType),{inputs:k})},Ui=i=>_r({axis:i.axis})}),Uo,po,Vo,kc,Vs=s(()=>{rr(),ue(),Uo=(i,c,b="f32")=>{switch(i.activation){case"Relu":return`value = max(value, ${c}(0.0));`;case"Sigmoid":return`value = (${c}(1.0) / (${c}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${c}(${b}(uniforms.clip_min)), ${c}(${b}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${c}(0.0), min(${c}(1.0), ${b}(uniforms.alpha) * value + ${b}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${b}(uniforms.alpha) * value, value, value >= ${c}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${i.activation}`)}},po=(i,c)=>{i.activation==="Clip"?c.push({type:1,data:i.clipMax},{type:1,data:i.clipMin}):i.activation==="HardSigmoid"?c.push({type:1,data:i.alpha},{type:1,data:i.beta}):i.activation==="LeakyRelu"&&c.push({type:1,data:i.alpha})},Vo=(i,c)=>{i.activation==="Clip"?c.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):i.activation==="HardSigmoid"?c.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):i.activation==="LeakyRelu"&&c.push({name:"alpha",type:"f32"})},kc=i=>{let c=(i==null?void 0:i.activation)||"";if(c==="HardSigmoid"){let[b,S]=(i==null?void 0:i.activation_params)||[.2,.5];return{activation:c,alpha:b,beta:S}}else if(c==="Clip"){let[b,S]=(i==null?void 0:i.activation_params)||[Je,Q];return{activation:c,clipMax:S,clipMin:b}}else if(c==="LeakyRelu"){let[b]=(i==null?void 0:i.activation_params)||[.01];return{activation:c,alpha:b}}return{activation:c}}}),Bn,sh,iu=s(()=>{Bn=(i,c)=>{switch(i){case 1:return c;case 2:return`vec2<${c}>`;case 3:return`vec3<${c}>`;case 4:return`vec4<${c}>`;default:throw new Error(`${i}-component is not supported.`)}},sh=i=>`
      ${i?"value = value + getBiasByOutputCoords(coords);":""}
      `}),su,fl=s(()=>{su=i=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${i}.x), i32(${i}.y), i32(${i}.z), 1));
}
`}),Ws,Ic,ou=s(()=>{rr(),ue(),br(),Vs(),Ws=(i,c,b,S,E)=>{let I=S-b;return`
      ${Array.from({length:b}).map((k,$)=>`
      if (${Yt(c.shape,$,c.rank)} != 1) {
        ${c.indicesSet(i,$,Yt(E,$+I,S))}
      } else {
        ${c.indicesSet(i,$,0)}
      }`).join("")}
`},Ic=(i,c,b,S,E=!1,I)=>{let k=i[0].dims,$=i[1].dims,B=k[k.length-2],z=$[$.length-1],G=k[k.length-1],q=cn(z),Z=cn(G),se=cn(B),le=st.size(b)/q/se,me=i.length>2,Te=S?S.slice(0,-2):b.slice(0,-2),de=[st.size(Te),B,z],_e=[{type:12,data:le},{type:12,data:B},{type:12,data:z},{type:12,data:G}];po(c,_e),_e.push(...Gt(Te,k,$)),me&&_e.push(...Gt(i[2].dims)),_e.push(...Gt(de));let Ae=Oe=>{let He=mi("batch_dims",i[0].dataType,Te.length),lt=dt("a",i[0].dataType,k.length,Z),it=dt("b",i[1].dataType,$.length,q),mt=Xt("output",i[0].dataType,de.length,q),Mt=Kr(mt.type.tensor),At=Uo(c,mt.type.value,Mt),$t=[lt,it],Vt="";if(me){let tr=E?q:1;$t.push(dt("bias",i[2].dataType,i[2].dims.length,tr)),Vt=`${E?`value += bias[col / ${tr}];`:`value += ${mt.type.value}(bias[row + i]);`}`}let Kt=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Vo(c,Kt);let Mr=()=>{let tr=`var a_data: ${lt.type.value};`;for(let Jt=0;Jt<Z;Jt++)tr+=`
              let b_data${Jt} = b[(b_offset + (k + ${Jt}) * uniforms.N + col) / ${q}];`;for(let Jt=0;Jt<se;Jt++){tr+=`a_data = a[(a_offset + (row + ${Jt}) * uniforms.K + k) / ${Z}];`;for(let Lt=0;Lt<Z;Lt++)tr+=`
            values[${Jt}] = fma(${it.type.value}(a_data${Z===1?"":`[${Lt}]`}), b_data${Lt}, values[${Jt}]);
`}return tr};return`
  ${Oe.registerUniforms(Kt).registerInternalVariables(He).declareVariables(...$t,mt)}
  ${Oe.mainStart()}
    ${Oe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${q})) * ${q};
    var index1 = global_idx / (uniforms.N / ${q});
    let stride1 = uniforms.M / ${se};
    let row = (index1 % stride1) * ${se};
    let batch = index1 / stride1;

    ${b.length===2?"":`let batch_indices = ${He.offsetToIndices("batch")};`}

    var a_indices: ${lt.type.indices};
    ${Ws("a_indices",lt,lt.rank-2,He.rank,"batch_indices")}
    ${lt.indicesSet("a_indices",lt.rank-2,0)}
    ${lt.indicesSet("a_indices",lt.rank-1,0)}
    let a_offset = ${lt.indicesToOffset("a_indices")};

    var b_indices: ${it.type.indices};
    ${Ws("b_indices",it,it.rank-2,He.rank,"batch_indices")}
    ${it.indicesSet("b_indices",it.rank-2,0)}
    ${it.indicesSet("b_indices",it.rank-1,0)}
    let b_offset = ${it.indicesToOffset("b_indices")};
    var values: array<${mt.type.value}, ${se}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${Z}) {
      ${Mr()}
    }
    for (var i = 0u; i < ${se}u; i++) {
      var value = values[i];
      ${Vt}
      ${At}
      let cur_indices = ${mt.type.indices}(batch, row + i, col);
      let offset = ${mt.indicesToOffset("cur_indices")};
      ${mt.setByOffset(`offset / ${q}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${c.activation};${q};${Z};${se};${E}`,inputDependencies:me?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:I?I(b):b,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(le/64)},programUniforms:_e}),getShaderSource:Ae}}}),Ac,gs,hl,ts,Ai,Dc,au,_a,Wo=s(()=>{rr(),ue(),br(),Vs(),ou(),iu(),Ac=(i,c)=>i?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${c?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${c?", batchIndices":""});
        `,gs=(i,c)=>i?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${c===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${c===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${c===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,hl=(i,c,b="f32",S,E=!1,I=32,k=!1,$=32)=>{let B=c[1]*i[1],z=c[0]*i[0],G=E?B:I,q=E?I:B,Z=G/c[0],se=I/c[1];if(!((E&&Z===4&&i[1]===4||!E&&(Z===3||Z===4))&&G%c[0]===0&&I%c[1]===0&&i[0]===4))throw new Error(`If transposeA ${E} is true, innerElementSize ${Z} and workPerThread[1] ${i[1]} must be 4.
      Otherwise, innerElementSize ${Z} must be 3 or 4.
  tileAWidth ${G} must be divisible by workgroupSize[0]${c[0]}. tileInner ${I} must be divisible by workgroupSize[1] ${c[1]}. colPerThread ${i[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${Z}<${b}>, ${G/Z}>, ${q}>;
var<workgroup> mm_Bsub: array<array<vec4<${b}>, ${z/i[0]}>, ${I}>;

const rowPerThread = ${i[1]};
const colPerThread = ${i[0]};
const innerElementSize = ${Z};
const tileInner = ${I};

@compute @workgroup_size(${c[0]}, ${c[1]}, ${c[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${k?"0":"i32(globalId.z)"};
  ${S?`let batchIndices = ${S.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${B};

  let num_tiles = ${k?`${Math.ceil($/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${k?`i32(globalId.z) * ${$}`:"0"};

  var acc: array<vec4<${b}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${se};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${Ac(E,S)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${se}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${S?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${Z===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${gs(E,Z)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},ts=(i,c)=>i?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${c?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${c?", batchIndices":""});
            `,Ai=i=>i?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Dc=(i,c,b="f32",S,E=!1,I=32,k=!1,$=32,B=!1)=>{let z=i[1]*c[1],G=i[0]*c[0],q=E?z:I,Z=E?I:z;if(!(Z%c[1]===0&&q%c[0]===0&&I%c[1]===0))throw new Error(`tileAHight ${Z} must be divisible by workgroupSize[1]${c[1]}, tileAWidth ${q} must be divisible by workgroupSize[0]${c[0]}, tileInner ${I} must be divisible by workgroupSize[1]${c[1]}`);let se=Z/c[1],le=q/c[0],me=I/c[1],Te=B?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${z};
    let globalColStart = i32(workgroupId.x) * ${G};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${Z}; inputRow = inputRow + ${c[1]}) {
        for (var inputCol = localCol; inputCol < ${q}; inputCol = inputCol + ${c[0]}) {
          ${ts(E,S)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${I}; inputRow = inputRow + ${c[1]}) {
            for (var inputCol = localCol; inputCol < ${G}; inputCol = inputCol + ${c[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${S?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${b}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${c[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${E?`mm_Asub[k][localRow + innerRow * ${c[1]}];`:`mm_Asub[localRow + innerRow * ${c[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${c[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${c[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${z};

let tileRowA = i32(localId.y) * ${se};
let tileColA = i32(localId.x) * ${le};
let tileRowB = i32(localId.y) * ${me};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${se}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${le}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${ts(E,S)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${me}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${S?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${b}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${Ai(E)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${b}, ${q}>, ${Z}>;
  var<workgroup> mm_Bsub : array<array<${b}, ${G}>, ${I}>;
  const rowPerThread = ${i[1]};
  const colPerThread = ${i[0]};
  const tileInner = ${I};

@compute @workgroup_size(${c[0]}, ${c[1]}, ${c[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${k?"0":"i32(globalId.z)"};
    ${S?`let batchIndices = ${S.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${k?`${Math.ceil($/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${k?`i32(globalId.z) * ${$}`:"0"};

    var acc : array<array<${b}, colPerThread>, rowPerThread>;
    ${Te}
  }
`},au=(i,c,b,S,E=!1)=>{let[I,k,$,B]=S,z=Kr(S[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Bn(i,z)} {
      var value = ${Bn(i,z)}(0.0);
      let col = colIn * ${i};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${k.type.indices};
        ${Ws("aIndices",k,k.rank-2,I.rank,"batchIndices")}
        ${k.indicesSet("aIndices",k.rank-2,"u32(row)")}
        ${k.indicesSet("aIndices",k.rank-1,"u32(colIn)")}
        value = ${k.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Bn(i,z)} {
      var value = ${Bn(i,z)}(0.0);
      let col = colIn * ${i};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${$.type.indices};
        ${Ws("bIndices",$,$.rank-2,I.rank,"batchIndices")}
        ${$.indicesSet("bIndices",$.rank-2,"u32(row)")}
        ${$.indicesSet("bIndices",$.rank-1,"u32(colIn)")}
        value = ${$.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Bn(i,z)}) {
      let col = colIn * ${i};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${c?`value = value + ${E?"bias[colIn]":`${Bn(i,z)}(bias[row])`};`:""}
        ${b}
        ${B.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},_a=(i,c,b,S,E=!1,I)=>{let k=i[0].dims,$=i[1].dims,B=k.slice(0,-2),z=$.slice(0,-2),G=S?S.slice(0,-2):b.slice(0,-2),q=st.size(G),Z=k[k.length-2],se=k[k.length-1],le=$[$.length-1],me=se%4===0&&le%4===0,Te=Z<=8?[4,1,1]:[4,4,1],de=[8,8,1],_e=[Math.ceil(le/de[0]/Te[0]),Math.ceil(Z/de[1]/Te[1]),Math.ceil(q/de[2]/Te[2])],Ae=me?4:1,Oe=[...B,Z,se/Ae],He=Oe.length,lt=[...z,se,le/Ae],it=lt.length,mt=[q,Z,le/Ae],Mt=[{type:6,data:Z},{type:6,data:le},{type:6,data:se}];po(c,Mt),Mt.push(...Gt(G,Oe,lt));let At=["rank","rank"],$t=i.length>2;$t&&(Mt.push(...Gt(i[2].dims)),At.push("rank")),Mt.push(...Gt(mt));let Vt=Kt=>{let Mr=G.length,tr=mi("batchDims",i[0].dataType,Mr,1),Jt=Kr(i[0].dataType),Lt=dt("a",i[0].dataType,He,Ae),$r=dt("b",i[1].dataType,it,Ae),ar=Xt("result",i[0].dataType,mt.length,Ae),Cr=[Lt,$r];if($t){let Ki=E?Ae:1;Cr.push(dt("bias",i[2].dataType,i[2].dims.length,Ki))}let St=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Vo(c,St);let Rt=Kr(ar.type.tensor),gr=Uo(c,ar.type.value,Rt),an=au(Ae,$t,gr,[tr,Lt,$r,ar],E);return`
  ${Kt.registerUniforms(St).registerInternalVariables(tr).declareVariables(...Cr,ar)}
  ${an}
  ${me?hl(Te,de,Jt,tr):Dc(Te,de,Jt,tr)}
                   `};return{name:"MatMul",shaderCache:{hint:`${Te};${c.activation};${me};${E}`,inputDependencies:At},getRunData:()=>({outputs:[{dims:I?I(b):b,dataType:i[0].dataType}],dispatchGroup:{x:_e[0],y:_e[1],z:_e[2]},programUniforms:Mt}),getShaderSource:Vt}}}),_s,Fc,Jp=s(()=>{rr(),Vn(),br(),Vs(),iu(),fl(),Wo(),_s=(i,c,b,S,E=!1,I,k=4,$=4,B=4,z="f32")=>{let G=Mt=>{switch(Mt){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${z}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${Mt} is not supported.`)}},q=Mt=>{switch(Mt){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${Mt} is not supported.`)}},Z=i?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,se=i?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,le=i?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",me=i?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",Te=i?"row":"col",de=i?"col":"row",_e=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${i?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${Te} / outWidth;
    let outCol = ${Te} % outWidth;

    let WRow = ${de} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${de} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${de} % inChannels;
    var resData = ${Bn(k,z)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${le} && xCol >= 0 && xCol < ${me}) {
      ${Z}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${G(k)}
    }
    return resData;`,Ae=i?c&&S?`
    let col = colIn * ${k};
    ${_e}`:`
    let col = colIn * ${k};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${_e}
    }
    return ${Bn(k,z)}(0.0);`:S&&b?`
    let col = colIn * ${k};
    ${_e}`:`
    let col = colIn * ${k};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_e}
    }
    return ${Bn(k,z)}(0.0);`,Oe=i?S&&b?q($):`
    let col = colIn * ${$};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${q($)}
    }
    return ${Bn($,z)}(0.0);`:`
    let col = colIn * ${$};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${q($)}
    }
    return ${Bn($,z)}(0.0);`,He=Bn(B,z),lt=Bn(i?k:$,z),it=Bn(i?$:k,z),mt=Uo(I,He,z);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${lt} {
      ${i?Ae:Oe}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${it} {
      ${i?Oe:Ae}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${He}) {
      let col = colIn * ${B};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${i?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${se}
      ${sh(E)}
      ${mt}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Fc=(i,c,b,S,E,I,k,$,B)=>{let z=c.format==="NHWC",G=z?i[0].dims[3]:i[0].dims[1],q=b[0],Z=z?b[2]:b[3],se=z?b[1]:b[2],le=z?b[3]:b[1],me=z&&(G%4===0||G%3===0)&&le%4===0,Te=z?le:Z*se,de=z?Z*se:le,_e=[8,8,1],Ae=S<=8?[4,1,1]:[4,4,1],Oe=[Math.ceil(Te/_e[0]/Ae[0]),Math.ceil(de/_e[1]/Ae[1]),Math.ceil(q/_e[2]/Ae[2])];xr("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${Oe}`);let He=me?z&&G%4!==0?3:4:1,lt=_e[1]*Ae[1],it=_e[0]*Ae[0],mt=Math.max(_e[0]*He,_e[1]),Mt=S%lt===0,At=E%it===0,$t=I%mt===0,Vt=me?[He,4,4]:[1,1,1],Kt=[{type:6,data:S},{type:6,data:E},{type:6,data:I},{type:6,data:[c.pads[0],c.pads[1]]},{type:6,data:c.strides},{type:6,data:c.dilations}];po(c,Kt),Kt.push(...Gt(i[0].dims,i[1].dims));let Mr=["rank","rank"];k&&(Kt.push(...Gt(i[2].dims)),Mr.push("rank")),Kt.push(...Gt(b));let tr=Jt=>{let Lt=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Vo(c,Lt);let $r=me?4:1,ar=Kr(i[0].dataType),Cr=`
      fn setOutputAtIndex(flatIndex : i32, value : ${me?`vec4<${ar}>`:ar}) {
        result[flatIndex] = ${me?`vec4<${ar}>`:ar}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${me?`vec4<${ar}>`:ar}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${me?"/ 4":""}, value);
      }`,St=dt("x",i[0].dataType,i[0].dims.length,He===3?1:He),Rt=dt("w",i[1].dataType,i[1].dims.length,$r),gr=[St,Rt],an=Xt("result",i[0].dataType,b.length,$r);if(k){let Ki=dt("bias",i[2].dataType,i[2].dims.length,$r);gr.push(Ki),Cr+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${me?`vec4<${ar}>`:ar} {
          return bias[coords.${z?"w":"y"}${me?"/ 4":""}];
        }`}return`
        ${su("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Jt.registerUniforms(Lt).declareVariables(...gr,an)}
        ${Cr}
        ${_s(z,Mt,At,$t,k,c,Vt[0],Vt[1],Vt[2],ar)}
        ${me?hl(Ae,_e,ar,void 0,!z,mt):Dc(Ae,_e,ar,void 0,!z,mt,!1,void 0,$)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${c.cacheKey};${He};${me};${Mt};${At};${$t};${lt};${it};${mt}`,inputDependencies:Mr},getRunData:()=>({outputs:[{dims:B?B(b):b,dataType:i[0].dataType}],dispatchGroup:{x:Oe[0],y:Oe[1],z:Oe[2]},programUniforms:Kt}),getShaderSource:tr}}}),mo,lu,va,Xn,pl,uu,rs,cu,du=s(()=>{rr(),Vn(),ue(),br(),Vs(),iu(),mo=i=>{let c=1;for(let b=0;b<i.length;b++)c*=i[b];return c},lu=i=>typeof i=="number"?[i,i,i]:i,va=(i,c)=>c<=1?i:i+(i-1)*(c-1),Xn=(i,c,b,S=1)=>{let E=va(c,S);return Math.floor((i[0]*(b-1)-b+E)/2)},pl=(i,c,b,S,E)=>{E==null&&(E=Xn(i,c[0],S[0]));let I=[0,0,0,b];for(let k=0;k<3;k++)i[k]+2*E>=c[k]&&(I[k]=Math.trunc((i[k]-c[k]+2*E)/S[k]+1));return I},uu=(i,c,b,S,E,I,k,$,B,z)=>{let G,q,Z,se;if(i==="VALID"&&(i=0),typeof i=="number"){G={top:i,bottom:i,left:i,right:i,front:i,back:i};let le=pl([c,b,S,1],[$,B,z],1,[E,I,k],i);q=le[0],Z=le[1],se=le[2]}else if(Array.isArray(i)){if(!i.every((me,Te,de)=>me===de[0]))throw Error(`Unsupported padding parameter: ${i}`);G={top:i[0],bottom:i[1],left:i[2],right:i[3],front:i[4],back:i[5]};let le=pl([c,b,S,1],[$,B,z],1,[E,I,k],i[0]);q=le[0],Z=le[1],se=le[2]}else if(i==="SAME_UPPER"){q=Math.ceil(c/E),Z=Math.ceil(b/I),se=Math.ceil(S/k);let le=(q-1)*E+$-c,me=(Z-1)*I+B-b,Te=(se-1)*k+z-S,de=Math.floor(le/2),_e=le-de,Ae=Math.floor(me/2),Oe=me-Ae,He=Math.floor(Te/2),lt=Te-He;G={top:Ae,bottom:Oe,left:He,right:lt,front:de,back:_e}}else throw Error(`Unknown padding parameter: ${i}`);return{padInfo:G,outDepth:q,outHeight:Z,outWidth:se}},rs=(i,c,b,S,E,I=!1,k="channelsLast")=>{let $,B,z,G,q;if(k==="channelsLast")[$,B,z,G,q]=i;else if(k==="channelsFirst")[$,q,B,z,G]=i;else throw new Error(`Unknown dataFormat ${k}`);let[Z,,se,le,me]=c,[Te,de,_e]=lu(b),[Ae,Oe,He]=lu(S),lt=va(se,Ae),it=va(le,Oe),mt=va(me,He),{padInfo:Mt,outDepth:At,outHeight:$t,outWidth:Vt}=uu(E,B,z,G,Te,de,_e,lt,it,mt),Kt=I?Z*q:Z,Mr=[0,0,0,0,0];return k==="channelsFirst"?Mr=[$,Kt,At,$t,Vt]:k==="channelsLast"&&(Mr=[$,At,$t,Vt,Kt]),{batchSize:$,dataFormat:k,inDepth:B,inHeight:z,inWidth:G,inChannels:q,outDepth:At,outHeight:$t,outWidth:Vt,outChannels:Kt,padInfo:Mt,strideDepth:Te,strideHeight:de,strideWidth:_e,filterDepth:se,filterHeight:le,filterWidth:me,effectiveFilterDepth:lt,effectiveFilterHeight:it,effectiveFilterWidth:mt,dilationDepth:Ae,dilationHeight:Oe,dilationWidth:He,inShape:i,outShape:Mr,filterShape:c}},cu=(i,c,b,S,E,I)=>{let k=I==="channelsLast";k?i[0].dims[3]:i[0].dims[1];let $=[64,1,1],B={x:b.map((Te,de)=>de)},z=[Math.ceil(mo(B.x.map(Te=>b[Te]))/$[0]),1,1];xr("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${z}`);let G=1,q=st.size(b),Z=[{type:12,data:q},{type:12,data:S},{type:12,data:E},{type:12,data:c.strides},{type:12,data:c.dilations}];po(c,Z),Z.push(...Gt(i[0].dims,i[1].dims));let se=["rank","rank"],le=i.length===3;le&&(Z.push(...Gt(i[2].dims)),se.push("rank")),Z.push(...Gt(b));let me=Te=>{let de=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:S.length},{name:"pads",type:"u32",length:E.length},{name:"strides",type:"u32",length:c.strides.length},{name:"dilations",type:"u32",length:c.dilations.length}];Vo(c,de);let _e=1,Ae=Kr(i[0].dataType),Oe=dt("x",i[0].dataType,i[0].dims.length,G),He=dt("W",i[1].dataType,i[1].dims.length,_e),lt=[Oe,He],it=Xt("result",i[0].dataType,b.length,_e),mt="";if(le){let $t=dt("bias",i[2].dataType,i[2].dims.length,_e);lt.push($t),mt+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${Ae} {
          return bias[${k?Yt("coords",4,5):Yt("coords",1,5)}];
        }`}let Mt=Bn(G,Ae),At=Uo(c,Mt,Ae);return`
            ${mt}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${Oe.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${He.getByIndices("aIndices")};
            }
          ${Te.registerUniforms(de).declareVariables(...lt,it)}
          ${Te.mainStart()}
          ${Te.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${it.offsetToIndices("global_idx")};
              let batch = ${Yt("coords",0,Oe.rank)};
              let d2 = ${k?Yt("coords",Oe.rank-1,Oe.rank):Yt("coords",1,Oe.rank)};
              let xFRCCorner = vec3<u32>(${k?Yt("coords",1,Oe.rank):Yt("coords",2,Oe.rank)},
              ${k?Yt("coords",2,Oe.rank):Yt("coords",3,Oe.rank)},
              ${k?Yt("coords",3,Oe.rank):Yt("coords",4,Oe.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${k?Yt("uniforms.x_shape",1,Oe.rank):Yt("uniforms.x_shape",2,Oe.rank)};
              let xShapeZ = ${k?Yt("uniforms.x_shape",2,Oe.rank):Yt("uniforms.x_shape",3,Oe.rank)};
              let xShapeW = ${k?Yt("uniforms.x_shape",3,Oe.rank):Yt("uniforms.x_shape",4,Oe.rank)};
              let xShapeU = ${k?Yt("uniforms.x_shape",4,Oe.rank):Yt("uniforms.x_shape",1,Oe.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${k?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${k?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${k?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${k?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${le?"value = value + getBiasByOutputCoords(coords)":""};
              ${At}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${c.cacheKey};${k};${G};${le}`,inputDependencies:se},getRunData:()=>({outputs:[{dims:b,dataType:i[0].dataType}],dispatchGroup:{x:z[0],y:z[1],z:z[2]},programUniforms:Z}),getShaderSource:me}}}),Gs,Lc,_i=s(()=>{rr(),ue(),br(),Vs(),Gs=(i,c,b,S)=>{let E=i.length>2,I=E?"value += b[output_channel];":"",k=i[0].dims,$=i[1].dims,B=c.format==="NHWC",z=B?b[3]:b[1],G=z/c.group,q=B&&G>=4?cn(z):1,Z=st.size(b)/q,se=[{type:12,data:Z},{type:12,data:c.dilations},{type:12,data:[c.strides[0],c.strides[1]]},{type:12,data:[c.pads[0],c.pads[1]]},{type:12,data:G}];po(c,se),se.push(...Gt(k,[$[0],$[1],$[2],$[3]/q]));let le=E?["rank","rank","rank"]:["rank","rank"];se.push(...Gt([b[0],b[1],b[2],b[3]/q]));let me=Te=>{let de=Xt("output",i[0].dataType,b.length,q),_e=Kr(de.type.tensor),Ae=Uo(c,de.type.value,_e),Oe=dt("x",i[0].dataType,k.length),He=dt("w",i[1].dataType,$.length,q),lt=[Oe,He];E&&lt.push(dt("b",i[2].dataType,i[2].dims,q));let it=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:c.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Vo(c,it);let mt=B?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${Oe.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${He.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${Oe.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${He.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${Te.registerUniforms(it).declareVariables(...lt,de)}

  ${Te.mainStart()}
    ${Te.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${de.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${B?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${B?1:2}], outputIndices[${B?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${q} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${B?2:1}];

    var value: ${de.type.value} = ${de.type.value}(0);
    ${mt}
    ${I}
    ${Ae}
    ${de.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${c.cacheKey}_${q}`,inputDependencies:le},getRunData:()=>({outputs:[{dims:S?S(b):b,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:se}),getShaderSource:me}},Lc=(i,c,b,S)=>{let E=i.length>2,I=cn(b[3]),k=cn(b[2]),$=st.size(b)/I/k,B=[i[0].dims[0],i[0].dims[1],i[0].dims[2],i[0].dims[3]/I],z=[i[1].dims[0],i[1].dims[1],i[1].dims[2],i[1].dims[3]/I],G=[b[0],b[1],b[2],b[3]/I],q=[{type:12,data:$},{type:6,data:[c.strides[0],c.strides[1]]},{type:6,data:[c.pads[0],c.pads[1]]}];po(c,q),q.push(...Gt(B,z,G));let Z=(k-1)*c.strides[1]+z[1],se=le=>{let me=Xt("output",i[0].dataType,G.length,I),Te=Kr(me.type.tensor),de=Uo(c,me.type.value,Te),_e=dt("x",i[0].dataType,B.length,I),Ae=dt("w",i[1].dataType,z.length,I),Oe=[_e,Ae];E&&Oe.push(dt("b",i[2].dataType,i[2].dims,I));let He=E?"value += b[output_channel];":"",lt=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Vo(c,lt),`
  ${le.registerUniforms(lt).declareVariables(...Oe,me)}
  ${le.mainStart()}
    ${le.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${k}u;
    let col = (index1 % width1) * ${k}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${_e.type.value}, ${Z}>;
    var values: array<${me.type.value}, ${k}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${z[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${Z}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${_e.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${_e.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${z[1]}; w_width++) {
          let w_val = ${Ae.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${k}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${k}u; i++) {
      var value = values[i];
      ${He}
      ${de}
      ${me.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${c.cacheKey};${I};${k};${Z};${z[0]};${z[1]}`,inputDependencies:E?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:S?S(b):b,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:q}),getShaderSource:se}}}),ml,fu,oh,hu,ya,$c,wa,pu,Rc,Zp=s(()=>{ue(),Jp(),du(),Wo(),_i(),Vs(),ou(),zs(),ml=(i,c,b,S,E,I)=>{let k=i[0],$=i.slice(I?1:2,I?3:4),B=$.length,z=c[0],G=c.slice(2).map((Z,se)=>Z+(Z-1)*(b[se]-1)),q=$.map((Z,se)=>Z+S[se]+S[se+B]).map((Z,se)=>Math.floor((Z-G[se]+E[se])/E[se]));return q.splice(0,0,k),q.splice(I?3:1,0,z),q},fu=[2,3,1,0],oh=(i,c)=>{if(!i||i.length!==2&&i.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(i[0].dims.length>5)throw new Error("greater than 5D is not supported");if(i[0].dims.length!==i[1].dims.length)throw new Error("filter does not have same dimension as input");let b=i[0].dims[c.format==="NHWC"?i[0].dims.length-1:1],S=i[1].dims[1]*c.group;if(b!==S)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(i.length===3&&(i[2].dims.length!==1||i[1].dims[0]!==i[2].dims[0]))throw new Error("invalid bias");let E=i[0].dims.length-2;if(c.dilations.length!==E)throw new Error(`dilations should be ${E}D`);if(c.strides.length!==E)throw new Error(`strides should be ${E}D`);if(c.pads.length!==E*2)throw new Error(`pads should be ${E*2}D`);if(c.kernelShape.length!==0&&c.kernelShape.length!==i[1].dims.length-2)throw new Error("invalid kernel shape")},hu=(i,c)=>{let b=i.kernelShape.slice();b.length<c[1].dims.length-2&&b.push(...Array(c[1].dims.length-2-b.length).fill(0));for(let I=2;I<c[1].dims.length;++I)b[I-2]===0&&(b[I-2]=c[1].dims[I]);let S=i.pads.slice();lo.adjustPadsBasedOnAutoPad(c[0].dims,i.strides,i.dilations,b,S,i.format==="NHWC",i.autoPad);let E=Object.assign({},i);return Object.assign(E,{kernelShape:b,pads:S}),E},ya=i=>{let c=kc(i),b=i.format,S=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][i.auto_pad],E=i.dilations,I=i.group,k=i.kernel_shape,$=i.pads,B=i.strides,z=i.w_is_const();return{autoPad:S,format:b,dilations:E,group:I,kernelShape:k,pads:$,strides:B,wIsConst:z,...c,cacheKey:`${i.format};${c.activation};`}},$c=(i,c,b,S)=>{var lt,it,mt;let E=b.format==="NHWC",I=ml(c[0].dims,c[1].dims,b.dilations,b.pads,b.strides,E);if(b.group!==1){let Mt=[c[0]];if(E){let At=(lt=i.kernelCustomData.wT)!=null?lt:i.compute(ui(c[1],fu),{inputs:[1],outputs:[b.wIsConst?-2:-1]})[0];b.wIsConst&&!i.kernelCustomData.wT&&(i.kernelCustomData.wT=At),Mt.push(At)}else Mt.push(c[1]);c.length===3&&Mt.push(c[2]),!i.adapterInfo.isArchitecture("ampere")&&E&&c[1].dims[0]===b.group&&c[1].dims[1]===1&&b.dilations[0]===1&&b.dilations[1]===1?i.compute(Lc(Mt,b,I,S),{inputs:Mt}):i.compute(Gs(Mt,b,I,S),{inputs:Mt});return}let k=c.length===3,$=c[0].dims[E?1:2],B=c[0].dims[E?2:3],z=c[0].dims[E?3:1],G=c[1].dims[2],q=c[1].dims[3],Z=I[E?1:2],se=I[E?2:3],le=I[E?3:1],me=E&&G===$&&q===B&&b.pads[0]===0&&b.pads[1]===0;if(me||G===1&&q===1&&b.dilations[0]===1&&b.dilations[1]===1&&b.strides[0]===1&&b.strides[1]===1&&b.pads[0]===0&&b.pads[1]===0){let Mt=I[0],At,$t,Vt,Kt=[];if(E){let Jt=(it=i.kernelCustomData.wT)!=null?it:i.compute(ui(c[1],fu),{inputs:[1],outputs:[b.wIsConst?-2:-1]})[0];if(b.wIsConst&&!i.kernelCustomData.wT&&(i.kernelCustomData.wT=Jt),me){let Lt=$*B*z;At=c[0].reshape([1,Mt,Lt]),$t=Jt.reshape([1,Lt,le]),Vt=[1,Mt,le]}else At=c[0].reshape([Mt,$*B,z]),$t=Jt.reshape([1,z,le]),Vt=[Mt,Z*se,le];Kt.push(At),Kt.push($t)}else At=c[0].reshape([Mt,z,$*B]),$t=c[1].reshape([1,le,z]),Vt=[Mt,le,Z*se],Kt.push($t),Kt.push(At);k&&Kt.push(c[2]);let Mr=Vt[2],tr=Kt[0].dims[Kt[0].dims.length-1];Mr<8&&tr<8?i.compute(Ic(Kt,b,I,Vt,E,S),{inputs:Kt}):i.compute(_a(Kt,b,I,Vt,E,S),{inputs:Kt});return}let Te=!0,de=(mt=i.kernelCustomData.wT)!=null?mt:i.compute(ui(c[1],fu),{inputs:[1],outputs:[b.wIsConst?-2:-1]})[0];b.wIsConst&&!i.kernelCustomData.wT&&(i.kernelCustomData.wT=de);let _e=[c[0],de];k&&_e.push(c[2]);let Ae=E?Z*se:le,Oe=E?le:Z*se,He=G*q*z;i.compute(Fc(_e,b,I,Ae,Oe,He,k,Te,S),{inputs:_e})},wa=(i,c)=>{let b=c.format==="NHWC",S=[i.inputs[0].reshape(b?[i.inputs[0].dims[0],1,i.inputs[0].dims[1],i.inputs[0].dims[2]]:[i.inputs[0].dims[0],i.inputs[0].dims[1],1,i.inputs[0].dims[2]]),i.inputs[1].reshape([i.inputs[1].dims[0],i.inputs[1].dims[1],1,i.inputs[1].dims[2]])];i.inputs.length===3&&S.push(i.inputs[2]);let E=[0,c.pads[0],0,c.pads[1]],I=[1].concat(c.strides),k=[1].concat(c.dilations),$=[1].concat(c.kernelShape),B=hu({...c,pads:E,strides:I,dilations:k,kernelShape:$},S);$c(i,S,B,z=>b?[z[0],z[2],z[3]]:[z[0],z[1],z[3]])},pu=(i,c,b)=>{let S=b.format==="NHWC"?"channelsLast":"channelsFirst",E=hu(b,c),I=b.autoPad==="NOTSET"?b.pads:b.autoPad,k=rs(c[0].dims,c[1].dims,b.strides,b.dilations,I,!1,S);i.compute(cu(c,E,k.outShape,[k.filterDepth,k.filterHeight,k.filterWidth],[k.padInfo.front,k.padInfo.top,k.padInfo.left],S))},Rc=(i,c)=>{if(oh(i.inputs,c),i.inputs[0].dims.length===3)wa(i,c);else if(i.inputs[0].dims.length===5)pu(i,i.inputs,c);else{let b=hu(c,i.inputs);$c(i,i.inputs,b)}}}),Go,em=s(()=>{rr(),Vn(),ue(),br(),Go=(i,c,b)=>{let S=i.length>2,E=c.outputShape,I=c.format==="NHWC",k=c.group,$=i[1].dims,B=$[2]/k,z=$[3],G=I?cn(B):1,q=I&&z===1&&B>=4,Z=q?Math.floor(B/4)*4:Math.floor(B/G)*G,se=B-Z,le=I?cn(z):1,me=I?z===1?G:le:1,Te=st.size(E)/le,de=[Math.ceil(Te/64),1,1];xr("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${de}`);let _e=["rank","rank"],Ae=[c.strides[0],c.strides[1]],Oe=[c.kernelShape[I?1:2],c.kernelShape[I?2:3]],He=[c.dilations[0],c.dilations[1]],lt=[Oe[0]+(c.dilations[0]<=1?0:(c.kernelShape[I?1:2]-1)*(c.dilations[0]-1)),Oe[1]+(c.dilations[1]<=1?0:(c.kernelShape[I?2:3]-1)*(c.dilations[1]-1))],it=[lt[0]-1-Math.floor((c.pads[0]+c.pads[2])/2),lt[1]-1-Math.floor((c.pads[1]+c.pads[3])/2)],mt=[{type:12,data:Te},{type:12,data:Ae},{type:12,data:Oe},{type:12,data:He},{type:12,data:lt},{type:6,data:it},{type:12,data:Z},{type:12,data:B},{type:12,data:z},...Gt(i[0].dims,i[1].dims)];S&&(mt.push(...Gt(i[2].dims)),_e.push("rank")),mt.push(...Gt(E));let Mt=At=>{let $t=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:Ae.length},{name:"filter_dims",type:"u32",length:Oe.length},{name:"dilations",type:"u32",length:Oe.length},{name:"effective_filter_dims",type:"u32",length:lt.length},{name:"pads",type:"i32",length:it.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],Vt=Kr(i[0].dataType),Kt=I?1:2,Mr=I?2:3,tr=I?3:1,Jt=dt("W",i[1].dataType,i[1].dims.length,me),Lt=dt("Dy",i[0].dataType,i[0].dims.length,G),$r=[Lt,Jt];S&&$r.push(dt("bias",i[2].dataType,[E[tr]].length,le));let ar=Xt("result",i[0].dataType,E.length,le),Cr=()=>{let gr="";if(q)G===4?gr+=`
        let xValue = ${Lt.getByOffset("x_offset")};
        let wValue = ${Jt.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:G===2?gr+=`
          dotProd = dotProd + dot(vec4<${Vt}>(${Lt.getByOffset("x_offset")}, ${Lt.getByOffset("x_offset + 1u")}), vec4<${Vt}>(${Jt.getByOffset("w_offset")}, ${Jt.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:G===1&&(gr+=`
          dotProd = dotProd + dot(vec4<${Vt}>(${Lt.getByOffset("x_offset")}, ${Lt.getByOffset("x_offset + 1u")}, ${Lt.getByOffset("x_offset + 2u")}, ${Lt.getByOffset("x_offset + 3u")}), vec4<${Vt}>(${Jt.getByOffset("w_offset")}, ${Jt.getByOffset("w_offset + 1u")}, ${Jt.getByOffset("w_offset + 2u")}, ${Jt.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(gr+=`
                  let xValue = ${I?Lt.getByOffset(`${Lt.indicesToOffset(`${Lt.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${G}`):Lt.get("batch","inputChannel","idyR","idyC")};
        `,G===1)gr+=`
          let w_offset = ${Jt.indicesToOffset(`${Jt.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Jt.getByOffset(`w_offset / ${me}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let an=0;an<G;an++)gr+=`
            let wValue${an} = ${Jt.getByOffset(`${Jt.indicesToOffset(`${Jt.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${an}, wOutChannel)`)} / ${me}`)};
            dotProd = dotProd + xValue[${an}] * wValue${an};`;return gr},St=()=>{if(se===0)return"";if(!q)throw new Error(`packInputAs4 ${q} is not true.`);let gr="";if(G===1){gr+="dotProd = dotProd";for(let an=0;an<se;an++)gr+=`
            + ${Lt.getByOffset(`x_offset + ${an}`)} * ${Jt.getByOffset(`w_offset + ${an}`)}`;gr+=";"}else if(G===2){if(se!==2)throw new Error(`Invalid inputChannelsRemainder ${se}.`);gr+=`
          let xValue = ${Lt.getByOffset("x_offset")};
          let wValue = ${Jt.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return gr},Rt=`
            let outputIndices = ${ar.offsetToIndices(`global_idx * ${le}`)};
            let batch = ${ar.indicesGet("outputIndices",0)};
            let d1 = ${ar.indicesGet("outputIndices",tr)};
            let r = ${ar.indicesGet("outputIndices",Kt)};
            let c = ${ar.indicesGet("outputIndices",Mr)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ar.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${Vt}(dyRCorner) + ${Vt}(wR)) / ${Vt}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${Vt}(uniforms.Dy_shape[${Kt}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${Vt}(dyCCorner) + ${Vt}(wC)) / ${Vt}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${Vt}(uniforms.Dy_shape[${Mr}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${q?`
                var x_offset = ${Lt.indicesToOffset(`${Lt.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${G};
                var w_offset = ${Jt.indicesToOffset(`${Jt.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${me};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${q?4:G}) {
                  ${Cr()}
                  inputChannel = inputChannel + ${q?4:G};
                }
                ${St()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${S?` + bias[d1 / ${le}]`:""};
            ${ar.setByOffset("global_idx","value")};
          `;return`
    ${At.registerUniforms($t).declareVariables(...$r,ar)}
      ${At.mainStart()}
      ${At.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${Rt}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${c.cacheKey};${G}${me}${le}${q}${se}`,inputDependencies:_e},getRunData:()=>({dispatchGroup:{x:de[0],y:de[1],z:de[2]},outputs:[{dims:b?b(E):E,dataType:i[0].dataType}],programUniforms:mt}),getShaderSource:Mt}}}),ah,xa,Bc,zc,lh,jc,mu,gu,Nc,Uc=s(()=>{em(),Vs(),zs(),ah=(i,c,b,S,E,I)=>(i-1)*c+b+(S-1)*E+1-I,xa=(i,c,b,S,E)=>{let I=Math.floor(i/2);c==="SAME_UPPER"?(b[S]=I,b[E]=i-I):c==="SAME_LOWER"&&(b[S]=i-I,b[E]=I)},Bc=(i,c,b,S,E,I,k,$,B,z)=>{let G=i.length-2,q=z.length===0;B.length<G&&B.push(...Array(G-B.length).fill(0));let Z=i[0],se=c[$?3:1]*E;for(let le=0,me=i.length-G-($?1:0);le<G;++le,++me){let Te=i[me],de=q?Te*k[le]:z[le],_e=ah(Te,k[le],I[le],c[me],b[le],de);xa(_e,S,I,le,le+G),q&&z.push(k[le]*(Te-1)+B[le]+(c[me]-1)*b[le]+1-I[le]-I[le+G])}z.splice(0,0,Z),z.splice($?3:1,0,se)},zc=(i,c)=>{let b=i.kernelShape.slice();if(i.kernelShape.length===0||i.kernelShape.reduce((q,Z)=>q*Z,1)===0){b.length=0;for(let q=2;q<c[1].dims.length;++q)b.push(c[1].dims[q])}let S=i.format==="NHWC";b.splice(0,0,c[1].dims[0]),b.splice(S?3:1,0,c[1].dims[1]);let E=i.pads.slice(),I=i.outputShape.slice(),k=i.outputPadding.slice(),$=c[0].dims,B=i.dilations.slice();if(B.reduce((q,Z)=>q+Z,0)===0){let q=c[0].dims.length-2;B=new Array(q).fill(1)}let z=i.strides.slice();if(z.reduce((q,Z)=>q+Z,0)===0){let q=c[0].dims.length-2;z=new Array(q).fill(1)}Bc($,b,B,i.autoPad,i.group,E,z,S,k,I);let G=Object.assign({},i);return Object.assign(G,{kernelShape:b,pads:E,outputPadding:k,outputShape:I,dilations:B,strides:z}),G},lh=i=>{let c=kc(i),b=i.format,S=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof i.autoPad>"u"?0:i.autoPad],E=i.dilations,I=i.group,k=i.kernelShape,$=i.pads,B=i.strides,z=i.wIsConst(),G=i.outputPadding,q=i.outputShape;return{autoPad:S,format:b,dilations:E,group:I,kernelShape:k,outputPadding:G,outputShape:q,pads:$,strides:B,wIsConst:z,...c,cacheKey:`${i.format};${c.activation};`}},jc=(i,c)=>{if(!i||i.length!==2&&i.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(i[0].dims.length!==4&&i[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(i[0].dims.length!==i[1].dims.length)throw new Error("filter does not have same dimension as input");let b=i[0].dims[c.format==="NHWC"?i[0].dims.length-1:1],S=i[1].dims[0];if(b!==S)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let E=i[1].dims[1]*c.group;if(i.length===3&&(i[2].dims.length!==1||i[2].dims[0]!==E))throw new Error("invalid bias");let I=i[0].dims.length-2;if(c.dilations.reduce((k,$)=>k+$,0)>0&&c.dilations.length!==I)throw new Error(`dilations should be ${I}D`);if(c.strides.reduce((k,$)=>k+$,0)>0&&c.strides.length!==I)throw new Error(`strides should be ${I}D`);if(c.pads.reduce((k,$)=>k+$,0)>0&&c.pads.length!==I*2)throw new Error(`pads should be ${I*2}D`);if(c.outputPadding.length!==I&&c.outputPadding.length!==0)throw new Error(`output_padding should be ${I}D`);if(c.kernelShape.reduce((k,$)=>k+$,0)>0&&c.kernelShape.length!==0&&c.kernelShape.length!==i[1].dims.length-2)throw new Error("invalid kernel shape");if(c.outputShape.length!==0&&c.outputShape.length!==i[0].dims.length-2)throw new Error("invalid output shape")},mu=(i,c,b,S)=>{var k;let E=(k=i.kernelCustomData.wT)!=null?k:i.compute(ui(c[1],[2,3,0,1]),{inputs:[1],outputs:[b.wIsConst?-2:-1]})[0];b.wIsConst&&!i.kernelCustomData.wT&&(i.kernelCustomData.wT=E);let I=[c[0],E];c.length===3&&I.push(c[2]),i.compute(Go(I,b,S),{inputs:I})},gu=(i,c)=>{let b=c.format==="NHWC",S=[i.inputs[0].reshape(b?[i.inputs[0].dims[0],1,i.inputs[0].dims[1],i.inputs[0].dims[2]]:[i.inputs[0].dims[0],i.inputs[0].dims[1],1,i.inputs[0].dims[2]]),i.inputs[1].reshape([i.inputs[1].dims[0],i.inputs[1].dims[1],1,i.inputs[1].dims[2]])];i.inputs.length===3&&S.push(i.inputs[2]);let E=c.kernelShape;(E.length===0||E[0]===0)&&(E=[i.inputs[1].dims[2]]);let I=c.dilations;(I.length===0||I[0]===0)&&(I=[1]);let k=c.strides;(k.length===0||k[0]===0)&&(k=[1]);let $=c.pads;$.length===0&&($=[0,0]),$=[0,$[0],0,$[1]],k=[1].concat(k),I=[1].concat(I),E=[1].concat(E);let B=c.outputPadding;B=[0].concat(B);let z=zc({...c,pads:$,strides:k,dilations:I,kernelShape:E,outputPadding:B},S);mu(i,S,z,G=>b?[G[0],G[2],G[3]]:[G[0],G[1],G[3]])},Nc=(i,c)=>{if(jc(i.inputs,c),i.inputs[0].dims.length===3)gu(i,c);else{let b=zc(c,i.inputs);mu(i,i.inputs,b)}}}),Vc,Wc,Gc,ba=s(()=>{rr(),ue(),Br(),br(),Vc=(i,c,b,S)=>{let E=st.size(c),I=c.length,k=dt("input",i,I),$=Xt("output",i,I),B=b.dataType===6?b.getInt32Array()[0]:Number(b.getBigInt64Array()[0]),z=st.normalizeAxis(B,I),G=q=>{let Z=` i32(${k.indicesGet("inputIndices","uniforms.axis")}) `,se=Yt("uniforms.input_shape","uniforms.axis",I),le=S.reverse?Z+(S.exclusive?" + 1":""):"0",me=S.reverse?se:Z+(S.exclusive?"":" + 1");return`
                ${q.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(k,$)}
                ${q.mainStart()}
                  ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${$.offsetToIndices("global_idx")};
                  var sum = ${$.type.value}(0);
                  let first : i32 = ${le};
                  let last : i32 = ${me};
                  for (var i : i32 = first; i < last; i++) {
                    ${k.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${k.getByIndices("inputIndices")};
                  }
                  ${$.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:S.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:c,dataType:i}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},{type:12,data:z},...Gt(c,c)]}),getShaderSource:G}},Wc=(i,c)=>{let b=i.inputs[0].dims,S=i.inputs[0].dataType,E=i.inputs[1];i.compute(Vc(S,b,E,c),{inputs:[0]})},Gc=i=>{let c=i.exclusive===1,b=i.reverse===1;return _r({exclusive:c,reverse:b})}}),uh,Hc,Kc,ch,Xc,tm=s(()=>{rr(),ue(),Br(),br(),uh=i=>{if(!i||i.length!==1)throw new Error("DepthToSpace requires 1 input.");if(i[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Hc=(i,c,b,S)=>{let E=[];E.push(`fn perm(i: ${S.type.indices}) -> ${b.type.indices} {
    var a: ${b.type.indices};`);for(let I=0;I<c;++I)E.push(b.indicesSet("a",i[I],`i[${I}]`));return E.push("return a;}"),E.join(`
`)},Kc=(i,c)=>{let b,S,E,I,k,$,B=c.format==="NHWC",z=c.blocksize,G=c.mode==="DCR";B?([b,S,E,I]=i.dims,k=G?[b,S,E,z,z,I/z**2]:[b,S,E,I/z**2,z,z],$=G?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([b,S,E,I]=[i.dims[0],i.dims[2],i.dims[3],i.dims[1]],k=G?[b,z,z,I/z**2,S,E]:[b,I/z**2,z,z,S,E],$=G?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let q=i.reshape(k),Z=q.dims.length,se=i.dataType,le=dt("a",se,Z),me=Xt("output",se,Z),Te=de=>`
  ${de.registerUniform("output_size","u32").declareVariables(le,me)}

  ${Hc($,Z,le,me)}

  ${de.mainStart()}
    ${de.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${me.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${me.setByOffset("global_idx",le.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${i.dims};${c.blocksize};${c.mode}`,inputDependencies:["rank"]},getRunData:de=>{let _e=B?[b,S*z,E*z,I/z**2]:[b,I/z**2,S*z,E*z],Ae=st.size(_e),Oe=q.dims,He=st.sortBasedOnPerm(Oe,$);return{outputs:[{dims:_e,dataType:de[0].dataType}],dispatchGroup:{x:Math.ceil(Ae/64)},programUniforms:[{type:12,data:Ae},...Gt(Oe,He)]}},getShaderSource:Te}},ch=(i,c)=>{uh(i.inputs),i.compute(Kc(i.inputs[0],c))},Xc=i=>_r({blocksize:i.blocksize,mode:i.mode,format:i.format})}),Ma,Ta,gl,Yc,_u,Rr,qc,Qc,Sa,Jc,dh,fh=s(()=>{rr(),ue(),Br(),br(),Ma="[a-zA-Z]|\\.\\.\\.",Ta="("+Ma+")+",gl="^"+Ta+"$",Yc="("+Ta+",)*"+Ta,_u="^"+Yc+"$",Rr=class{constructor(i=-1){this.symbolToIndices=new Map,this.inputIndex=i}addSymbol(i,c){let b=this.symbolToIndices.get(i);b===void 0?b=[c]:b.push(c),this.symbolToIndices.set(i,b)}},qc=class{constructor(i,c){var E;this.equation=c,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[b,S]=c.includes("->")?c.split("->",2):[c,""];if(!b.match(RegExp(_u)))throw new Error("Invalid LHS term");if(b.split(",").forEach((I,k)=>{let $=i[k].dims.slice();if(!I.match(RegExp(gl)))throw new Error("Invalid LHS term");let B=this.processTerm(I,!0,$,k);this.lhs.push(B)}),S==="")S+=[...this.symbolToInfo.entries()].filter(([I,k])=>k.count===1||I==="...").map(([I])=>I).join("");else if(!S.match(RegExp(Ta)))throw new Error("Invalid RHS");(E=S.match(RegExp(Ma,"g")))==null||E.forEach(I=>{if(I==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let k=this.symbolToInfo.get(I);if(k===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(k.dimValue)}}),this.rhs=this.processTerm(S,!1,this.outputDims)}addSymbol(i,c,b){let S=this.symbolToInfo.get(i);if(S!==void 0){if(S.dimValue!==c&&S.count!==1)throw new Error("Dimension mismatch");S.count++,S.inputIndices.push(b)}else S={count:1,dimValue:c,inputIndices:[b]};this.symbolToInfo.set(i,S)}processTerm(i,c,b,S=-1){let E=b.length,I=!1,k=[],$=0;if(!i.match(RegExp(gl))&&!c&&i!=="")throw new Error("Invalid LHS term");let B=i.match(RegExp(Ma,"g")),z=new Rr(S);return B==null||B.forEach((G,q)=>{if(G==="..."){if(I)throw new Error("Only one ellipsis is allowed per input term");I=!0;let Z=E-B.length+1;if(Z<0)throw new Error("Ellipsis out of bounds");if(k=b.slice($,$+Z),this.hasEllipsis){if(this.ellipsisDims.length!==k.length||this.ellipsisDims.toString()!==k.toString())throw new Error("Ellipsis dimensions mismatch")}else if(c)this.hasEllipsis=!0,this.ellipsisDims=k;else throw new Error("Ellipsis must be specified in the LHS");for(let se=0;se<k.length;se++){let le=String.fromCharCode(48+se);z.addSymbol(le,q+se),this.addSymbol(le,b[$++],S)}}else z.addSymbol(G,q+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(G,b[$++],S)}),z}},Qc=i=>i+"_max",Sa=(i,c,b,S)=>{let E=i.map(z=>z.length).map((z,G)=>dt(`input${G}`,c,z)),I=st.size(S),k=Xt("output",c,S.length),$=[...b.symbolToInfo.keys()].filter(z=>!b.rhs.symbolToIndices.has(z)),B=z=>{let G=[],q="var prod = 1.0;",Z="var sum = 0.0;",se="sum += prod;",le=[],me=[],Te=[],de=[],_e=b.symbolToInfo.size===b.rhs.symbolToIndices.size;b.symbolToInfo.forEach((Oe,He)=>{var lt;if(b.rhs.symbolToIndices.has(He)){let it=(lt=b.rhs.symbolToIndices.get(He))==null?void 0:lt[0];it!==void 0&&b.lhs.forEach((mt,Mt)=>{if(Oe.inputIndices.includes(Mt)){let At=mt.symbolToIndices.get(He);if(At===void 0)throw new Error("Invalid symbol error");At.forEach($t=>{G.push(`${E[Mt].indicesSet(`input${Mt}Indices`,$t,k.indicesGet("outputIndices",it))}`)})}})}else b.lhs.forEach((it,mt)=>{if(Oe.inputIndices.includes(mt)){let Mt=it.symbolToIndices.get(He);if(Mt===void 0)throw new Error("Invalid symbol error");Mt.forEach(At=>{le.push(`${E[mt].indicesSet(`input${mt}Indices`,At,`${He}`)}`)}),de.push(`prod *= ${E[mt].getByIndices(`input${mt}Indices`)};`)}}),me.push(`for(var ${He}: u32 = 0; ${He} < uniforms.${Qc(He)}; ${He}++) {`),Te.push("}")});let Ae=_e?[...G,`let sum = ${E.map((Oe,He)=>Oe.getByIndices(`input${He}Indices`)).join(" * ")};`]:[...G,Z,...me,...le,q,...de,se,...Te];return`
            ${z.registerUniforms($.map(Oe=>({name:`${Qc(Oe)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...E,k)}

            ${z.mainStart()}
            ${z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${k.offsetToIndices("global_idx")};
            ${E.map((Oe,He)=>`var input${He}Indices: ${E[He].type.indices};`).join(`
`)}
            ${Ae.join(`
`)};
            ${k.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:b.equation,inputDependencies:i.map(()=>"rank")},getRunData:()=>{let z=$.filter(q=>b.symbolToInfo.has(q)).map(q=>{var Z;return{type:12,data:((Z=b.symbolToInfo.get(q))==null?void 0:Z.dimValue)||0}});z.push({type:12,data:I});let G=i.map((q,Z)=>[...Gt(q)]).reduce((q,Z)=>q.concat(Z),z);return G.push(...Gt(S)),{outputs:[{dims:S,dataType:c}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:G}},getShaderSource:B}},Jc=(i,c)=>{let b=new qc(i.inputs,c.equation),S=b.outputDims,E=i.inputs.map((I,k)=>I.dims);i.compute(Sa(E,i.inputs[0].dataType,b,S))},dh=i=>{let c=i.equation.replace(/\s+/g,"");return _r({equation:c})}}),Di,Zc,Ca,vu,ed,td=s(()=>{rr(),ue(),br(),Di=i=>{if(!i||i.length!==2)throw new Error("Expand requires 2 input.");let c=i[0].dims,b=Array.from(i[1].getBigInt64Array(),Number),S=b.length<c.length?0:b.length-c.length,E=c.length<b.length?0:c.length-b.length;for(;S<b.length&&E<c.length;++S,++E)if(b[S]!==c[E]&&b[S]!==1&&c[E]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Zc=(i,c)=>{let b=i.length-c.length,S=[];for(let E=0;E<b;++E)S.push(i[E]);for(let E=0;E<c.length;++E)S.push(c[E]===1?i[E+b]:c[E]);return S},Ca=(i,c)=>i.length>c.length?Zc(i,c):Zc(c,i),vu=i=>{let c=i[0].dims,b=Array.from(i[1].getBigInt64Array(),Number),S=Ca(c,b),E=i[0].dataType,I=E===9||st.size(c)===1,k=E===9||c.length>0&&c[c.length-1]%4===0?4:1,$=I||S.length>0&&S[S.length-1]%4===0?4:1,B=Math.ceil(st.size(S)/$),z=q=>{let Z=dt("input",E,c.length,k),se=Xt("output",E,S.length,$),le;if(E===9){let me=(Te,de,_e="")=>`
          let outputIndices${de} = ${se.offsetToIndices(`outputOffset + ${de}u`)};
          let offset${de} = ${Z.broadcastedIndicesToOffset(`outputIndices${de}`,se)};
          let index${de} = offset${de} / 4u;
          let component${de} = offset${de} % 4u;
          ${Te}[${de}] = ${_e}(${Z.getByOffset(`index${de}`)}[component${de}]);
        `;le=`
        let outputOffset = global_idx * ${$};
        var data = vec4<u32>(0);
        ${me("data",0,"u32")}
        ${me("data",1,"u32")}
        ${me("data",2,"u32")}
        ${me("data",3,"u32")}
        ${se.setByOffset("global_idx","data")}
      }`}else le=`
        let outputIndices = ${se.offsetToIndices(`global_idx * ${$}`)};
        let inputOffset = ${Z.broadcastedIndicesToOffset("outputIndices",se)};
        let data = ${se.type.value}(${Z.getByOffset(`inputOffset / ${k}`)});
        ${se.setByOffset("global_idx","data")}
      }`;return`
    ${q.registerUniform("vec_size","u32").declareVariables(Z,se)}
    ${q.mainStart()}
    ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${le}`},G=[{type:12,data:B},...Gt(c,S)];return{name:"Expand",shaderCache:{hint:`${S.length};${k}${$}`,inputDependencies:["rank"]},getShaderSource:z,getRunData:()=>({outputs:[{dims:S,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(B/64)},programUniforms:G})}},ed=i=>{Di(i.inputs),i.compute(vu(i.inputs),{inputs:[0]})}}),Ci,Hs,yu=s(()=>{rr(),ue(),br(),Sc(),Ci=i=>{let c=i[0].dataType,b=st.size(i[0].dims),S=st.size(i[1].dims),E=S%4===0,I=k=>{let $=dt("x",c,[1],4),B=dt("bias",c,[1],4),z=Xt("y",c,[1],4),G=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],q=se=>`
      let bias${se}_offset: u32 = (global_idx * 4 + ${se}) % uniforms.bias_size;
      let bias${se} = ${B.getByOffset(`bias${se}_offset / 4`)}[bias${se}_offset % 4];`,Z=E?`
      let bias = ${B.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${q(0)}${q(1)}${q(2)}${q(3)}
      let bias = ${$.type.value}(bias0, bias1, bias2, bias3);`;return`${k.registerUniforms(G).declareVariables($,B,z)}

    ${zo(Kn(c))}

    ${k.mainStart(es)}
      ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${$.getByOffset("global_idx")};
      ${Z}
      let x_in = x + bias;
      ${z.setByOffset("global_idx",jo("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${E}`,inputDependencies:["type","type"]},getShaderSource:I,getRunData:k=>({outputs:[{dims:k[0].dims,dataType:k[0].dataType}],programUniforms:[{type:12,data:Math.ceil(b/4)},{type:12,data:S}],dispatchGroup:{x:Math.ceil(b/es/4)}})}},Hs=i=>{i.inputs.length<2||st.size(i.inputs[1].dims)===0?Tc(i):i.compute(Ci(i.inputs))}}),rd,_l,nd,wu,id=s(()=>{rr(),ue(),Br(),br(),rd=i=>{if(!i||i.length!==2)throw new Error("Gather requires 2 inputs.")},_l=(i,c)=>{let b=i[0].dims,S=i[1].dims,E=b.length,I=st.normalizeAxis(c.axis,E),k=b.slice(0);k.splice(I,1,...S);let $=b[I],B=i[0].dataType===9?4:1,z=Math.ceil(st.size(k)/B),G=[{type:12,data:z},{type:6,data:$},{type:12,data:I},...Gt(i[0].dims,i[1].dims,k)],q=Z=>{let se=dt("data",i[0].dataType,i[0].dims.length,B),le=dt("inputIndices",i[1].dataType,i[1].dims.length),me=Xt("output",i[0].dataType,k.length,B),Te=_e=>{let Ae=S.length,Oe=`var indicesIndices${_e}  = ${le.type.indices}(0);`;for(let He=0;He<Ae;He++)Oe+=`${Ae>1?`indicesIndices${_e}[${He}]`:`indicesIndices${_e}`} = ${k.length>1?`outputIndices${_e}[uniforms.axis + ${He}]`:`outputIndices${_e}`};`;Oe+=`
          var idx${_e} = ${le.getByIndices(`indicesIndices${_e}`)};
          if (idx${_e} < 0) {
            idx${_e} = idx${_e} + uniforms.axisDimLimit;
          }
          var dataIndices${_e} : ${se.type.indices};
        `;for(let He=0,lt=0;He<E;He++)He===I?(Oe+=`${E>1?`dataIndices${_e}[${He}]`:`dataIndices${_e}`} = u32(idx${_e});`,lt+=Ae):(Oe+=`${E>1?`dataIndices${_e}[${He}]`:`dataIndices${_e}`} = ${k.length>1?`outputIndices${_e}[${lt}]`:`outputIndices${_e}`};`,lt++);return Oe},de;if(i[0].dataType===9){let _e=(Ae,Oe,He="")=>`
          let outputIndices${Oe} = ${me.offsetToIndices(`outputOffset + ${Oe}u`)};
          ${Te(Oe)};
          let offset${Oe} = ${se.indicesToOffset(`dataIndices${Oe}`)};
          let index${Oe} = offset${Oe} / 4u;
          let component${Oe} = offset${Oe} % 4u;
          ${Ae}[${Oe}] = ${He}(${se.getByOffset(`index${Oe}`)}[component${Oe}]);
        `;de=`
        let outputOffset = global_idx * ${B};
        var value = vec4<u32>(0);
        ${_e("value",0,"u32")}
        ${_e("value",1,"u32")}
        ${_e("value",2,"u32")}
        ${_e("value",3,"u32")}
        ${me.setByOffset("global_idx","value")}
      `}else de=`
      let outputIndices = ${me.offsetToIndices("global_idx")};
      ${Te("")};
      let value = ${se.getByIndices("dataIndices")};
      ${me.setByOffset("global_idx","value")};
      `;return`
      ${Z.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(se,le,me)}
      ${Z.mainStart()}
        ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${de}
      }`};return{name:"Gather",shaderCache:{hint:c.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:k,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(z/64)},programUniforms:G}),getShaderSource:q}},nd=i=>_r({axis:i.axis}),wu=(i,c)=>{let b=i.inputs;rd(b),i.compute(_l(i.inputs,c))}}),xu,bu,Ks,rm=s(()=>{rr(),ue(),br(),xu=(i,c,b,S,E,I,k,$,B)=>{let z=[{type:12,data:I},{type:12,data:S},{type:12,data:E},{type:12,data:b},{type:12,data:k},{type:12,data:$},{type:12,data:B}],G=[I];z.push(...Gt(c.dims,G));let q=Z=>{let se=dt("indices_data",c.dataType,c.dims.length),le=Xt("input_slice_offsets_data",12,1,1),me=[se,le],Te=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:E.length},{name:"sizes_from_slice_dims_data",type:"u32",length:b.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${Z.registerUniforms(Te).declareVariables(...me)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${E.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${b.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return i.compute({name:"computeSliceOffsets",shaderCache:{hint:`${E.length}_${b.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:G,dataType:i.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:z}),getShaderSource:q},{inputs:[c],outputs:[-1]})[0]},bu=(i,c)=>{let b=i.inputs,S=b[0].dims,E=b[0].dataType,I=b[1].dims,k=I[I.length-1],$=st.sizeToDimension(I,I.length-1),B=st.sizeFromDimension(S,c.batchDims+k),z=st.sizeToDimension(S,c.batchDims),G=st.sizeFromDimension(S,c.batchDims),q=$/z,Z=new Array(k),se=B;for(let Oe=0;Oe<k;++Oe)Z[k-1-Oe]=se,se*=S[c.batchDims+k-1-Oe];let le=xu(i,b[1],Z,c.batchDims,S,$,q,G,k),me=c.batchDims+k;if(me>S.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let Te=I.slice(0,-1).concat(S.slice(me)),de=st.size(Te),_e=[{type:12,data:de},{type:12,data:B},...Gt(b[0].dims,le.dims,Te)],Ae=Oe=>{let He=dt("data",b[0].dataType,b[0].dims.length),lt=dt("slice_offsets",12,le.dims.length),it=Xt("output",b[0].dataType,Te.length);return`
          ${Oe.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(He,lt,it)}
            ${Oe.mainStart()}
            ${Oe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};i.compute({name:"GatherND",shaderCache:{hint:c.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:Te,dataType:E}],dispatchGroup:{x:Math.ceil(de/64)},programUniforms:_e}),getShaderSource:Ae},{inputs:[b[0],le]})},Ks=i=>({batchDims:i.batch_dims,cacheKey:""})}),Xs,sd,Mu,Tu,nm=s(()=>{rr(),ue(),Br(),br(),Xs=(i,c)=>{if(i.length<3||i.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let b=st.normalizeAxis(c.quantizeAxis,i[0].dims.length),S=c.blockSize,E=i[0],I=i[2],k=i.length===4?i[3]:void 0;if(I.dims.length!==E.dims.length||!E.dims.map(($,B)=>B===b?Math.ceil($/S)===I.dims[B]:$===I.dims[B]).reduce(($,B)=>$&&B,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(k){if(k.dataType!==E.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(k.dims.length!==I.dims.length||!k.dims.map(($,B)=>$===I.dims[B]).reduce(($,B)=>$&&B,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},sd=(i,c)=>{let b=i[0].dims,S=i[1].dims,E=b.length,I=st.normalizeAxis(c.gatherAxis,E),k=st.normalizeAxis(c.quantizeAxis,E),$=b.slice(0);$.splice(I,1,...S);let B=st.size($),z=i[2].dataType,G=i[0].dataType===22,q=[{type:12,data:B},{type:12,data:k},{type:12,data:I},{type:12,data:c.blockSize},...Gt(...i.map((se,le)=>se.dims),$)],Z=se=>{let le=dt("data",i[0].dataType,i[0].dims.length),me=dt("inputIndices",i[1].dataType,i[1].dims.length),Te=dt("scales",i[2].dataType,i[2].dims.length),de=i.length>3?dt("zeroPoint",i[3].dataType,i[3].dims.length):void 0,_e=Xt("output",z,$.length),Ae=[le,me,Te];de&&Ae.push(de);let Oe=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${se.registerUniforms(Oe).declareVariables(...Ae,_e)}
        ${se.mainStart()}
        let output_indices = ${_e.offsetToIndices("global_idx")};
        var indices_indices = ${me.type.indices}(0);
        ${S.length>1?`
          for (var i: u32 = 0; i < ${S.length}; i++) {
            let index = ${_e.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${me.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${_e.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${le.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${_e.indicesGet("output_indices","i")};
          ${le.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${me.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${b[I]};
        }
        ${le.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${$.length}; i++) {
          let index = ${_e.indicesGet("output_indices",`i + ${S.length} - 1`)};
          ${le.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${le.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${le.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${G?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${Te.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${Te.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${Te.getByIndices("scale_indices")};
        ${de?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${de.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${de.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${G?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Kn(z)}(quantized_data - zero_point) * scale;
        ${_e.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${c.cacheKey};${i.filter((se,le)=>le!==1).map(se=>se.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:i.length},(se,le)=>"rank")},getRunData:()=>({outputs:[{dims:$,dataType:z}],dispatchGroup:{x:Math.ceil(B/64)},programUniforms:q}),getShaderSource:Z}},Mu=(i,c)=>{let b=i.inputs;Xs(b,c),i.compute(sd(i.inputs,c))},Tu=i=>_r({blockSize:i.blockSize,gatherAxis:i.gatherAxis,quantizeAxis:i.quantizeAxis})}),od,hh,ad,Ys,im=s(()=>{rr(),ue(),Br(),br(),od=i=>{if(!i||i.length!==2)throw new Error("GatherElements requires 2 inputs.");if(i[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(i[0].dims.length!==i[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},hh=(i,c)=>{let b=i[0].dims,S=i[0].dataType,E=b.length,I=i[1].dims,k=i[1].dataType,$=st.normalizeAxis(c.axis,E),B=b[$],z=I.slice(0),G=st.size(z),q=dt("input",S,E),Z=dt("indicesInput",k,I.length),se=Xt("output",S,z.length),le=[{type:12,data:G},{type:6,data:B},{type:12,data:$}];return le.push(...Gt(b,I,z)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:z,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:le}),getShaderSource:me=>`
      ${me.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(q,Z,se)}
      ${me.mainStart()}
      ${me.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${se.offsetToIndices("global_idx")};

      var idx = ${Z.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${q.type.indices}(outputIndices);
      ${q.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${q.getByIndices("inputIndices")};

      ${se.setByOffset("global_idx","value")};
  }`}},ad=i=>_r({axis:i.axis}),Ys=(i,c)=>{let b=i.inputs;od(b),i.compute(hh(i.inputs,c))}}),ld,ud,vi,Vi,sm=s(()=>{rr(),ue(),br(),ld=i=>{if(!i)throw new Error("Input is missing");if(i.length<2||i.length>3)throw new Error("Invaid input number.");if(i.length===3&&i[2].dims.length>2)throw new Error("Invalid input shape of C");if(i[0].dataType!==i[1].dataType||i.length===3&&i[0].dataType!==i[2].dataType)throw new Error("Input types are mismatched")},ud=(i,c)=>{let b=i[0].dims.slice(),S=i[1].dims.slice(),[E,I,k]=cs.getShapeOfGemmResult(b,c.transA,S,c.transB,i.length===3?i[2].dims:void 0),$=[E,I];if(!$)throw new Error("Can't use gemm on the given tensors");let B=16,z=Math.ceil(I/B),G=Math.ceil(E/B),q=!0,Z=st.size($),se=[{type:12,data:q?z:Z},{type:12,data:E},{type:12,data:I},{type:12,data:k},{type:1,data:c.alpha},{type:1,data:c.beta}],le=["type","type"];i.length===3&&(se.push(...Gt(i[2].dims)),le.push("rank")),se.push(...Gt($));let me=de=>{let _e="";c.transA&&c.transB?_e="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":c.transA&&!c.transB?_e="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!c.transA&&c.transB?_e="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!c.transA&&!c.transB&&(_e="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let Ae=c.alpha===1?"":"value *= uniforms.alpha;",Oe=dt("a",i[0].dataType,i[0].dims),He=dt("b",i[1].dataType,i[1].dims),lt=Oe.type.value,it=null,mt=[Oe,He];i.length===3&&(it=dt("c",i[2].dataType,i[2].dims.length),mt.push(it));let Mt=Xt("output",i[0].dataType,$.length);mt.push(Mt);let At=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${de.registerUniforms(At).declareVariables(...mt)}

  ${de.mainStart()}
    ${de.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${lt}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${_e}
    }

    ${Ae}
    ${it!=null?`let cOffset = ${it.broadcastedIndicesToOffset("vec2(m, n)",Mt)}; value += ${lt}(uniforms.beta) * ${it.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},Te=de=>{let _e=dt("a",i[0].dataType,i[0].dims),Ae=dt("b",i[1].dataType,i[1].dims),Oe=null,He=[_e,Ae];i.length===3&&(Oe=dt("c",i[2].dataType,i[2].dims.length),He.push(Oe));let lt=Xt("output",i[0].dataType,$.length);He.push(lt);let it=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],mt="",Mt="";c.transA&&c.transB?(Mt=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_e.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${Ae.type.value}(0);
      }
      `,mt="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):c.transA&&!c.transB?(Mt=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_e.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${Ae.type.value}(0);
      }
      `,mt="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!c.transA&&c.transB?(Mt=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_e.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${Ae.type.value}(0);
      }
      `,mt="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!c.transA&&!c.transB&&(Mt=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_e.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${Ae.type.value}(0);
      }
      `,mt="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let At=c.alpha===1?"":"value *= uniforms.alpha;";return`
  ${de.registerUniforms(it).declareVariables(...He)}
  var<workgroup> tile_a: array<array<${_e.type.storage}, ${B}>, ${B}>;
  var<workgroup> tile_b: array<array<${Ae.type.storage}, ${B}>, ${B}>;
  ${de.mainStart([B,B,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${B};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${B};
    let num_tiles = (uniforms.K - 1) / ${B} + 1;
    var k_start = 0u;
    var value = ${lt.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${Mt}
      k_start = k_start + ${B};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${B}; k++) {
        ${mt}
      }
      workgroupBarrier();
    }

    ${At}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${Oe!=null?`let cOffset = ${Oe.broadcastedIndicesToOffset("vec2(m, n)",lt)}; value += ${lt.type.value}(uniforms.beta) * ${Oe.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return q?{name:"GemmShared",shaderCache:{hint:`${c.cacheKey}`,inputDependencies:le},getRunData:()=>({outputs:[{dims:$,dataType:i[0].dataType}],dispatchGroup:{x:z*G},programUniforms:se}),getShaderSource:Te}:{name:"Gemm",shaderCache:{hint:`${c.cacheKey}`,inputDependencies:le},getRunData:()=>({outputs:[{dims:$,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:se}),getShaderSource:me}},vi=i=>{let c=i.transA,b=i.transB,S=i.alpha,E=i.beta;return{transA:c,transB:b,alpha:S,beta:E,cacheKey:`${i.transA};${i.transB};${i.alpha===1}`}},Vi=(i,c)=>{ld(i.inputs),i.compute(ud(i.inputs,c))}}),vs,Wi,Gi,ys,cd,ph,dd,ws,Ea,mh,fd,hd,Ho,pd,Su=s(()=>{rr(),ue(),Br(),br(),[vs,Wi,Gi,ys]=[0,1,2,3],cd=i=>{if(i[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(i[0].dims.length!==i[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(i[0].dims.length-2!==i[1].dims[i[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${i[0].dims.length-2}`);if(i[0].dims[0]!==i[1].dims[0])throw new Error("grid batch size must match input batch size")},ph=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,dd=i=>`
  fn gs_bicubic_interpolate(p: mat4x4<${i}>, x: f32, y: f32) -> ${i} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${i}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,ws=i=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${i.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,Ea=i=>`
  ${i.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,mh=(i,c,b)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${c} {
     var pixel = ${c}(0);
     var indices = vec4<u32>(0);
     indices[${vs}] = batch;
     indices[${Wi}] = channel;`+(()=>{switch(b.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Gi}] = u32(r);
            indices[${ys}] = u32(c);
          } else {
            return ${c}(0);
          }
        `;case"border":return`
          indices[${Gi}] = u32(clamp(r, 0, H - 1));
          indices[${ys}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Gi}] = gs_reflect(r, border[1], border[3]);
          indices[${ys}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${b.paddingMode} is not supported`)}})()+`
    return ${i.getByIndices("indices")};
  }
`,fd=(i,c,b)=>(()=>{switch(b.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${vs}], indices[${Wi}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${vs}], indices[${Wi}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${vs}], indices[${Wi}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${vs}], indices[${Wi}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${vs}], indices[${Wi}], border);

          let dx2 = ${c}(f32(x2) - x);
          let dx1 = ${c}(x - f32(x1));
          let dy2 = ${c}(f32(y2) - y);
          let dy1 = ${c}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${c}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${vs}], indices[${Wi}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${b.mode} is not supported`)}})()+`${i.setByOffset("global_idx","result")}`,hd=(i,c)=>{let b=dt("x",i[0].dataType,i[0].dims.length),S=[i[1].dims[0],i[1].dims[1],i[1].dims[2]],E=dt("grid",i[1].dataType,S.length,2),I=[i[0].dims[0],i[0].dims[1],i[1].dims[1],i[1].dims[2]];c.format==="NHWC"&&(I=[i[0].dims[0],i[1].dims[1],i[1].dims[2],i[0].dims[3]],[vs,Wi,Gi,ys]=[0,3,1,2]);let k=Xt("output",i[0].dataType,I.length),$=b.type.value,B=st.size(I),z=[{type:12,data:B},...Gt(i[0].dims,S,I)],G=q=>`
  ${q.registerUniform("output_size","u32").declareVariables(b,E,k)}
  ${ph}
  ${dd($)}
  ${ws(c)}
  ${Ea(c)}
  ${mh(b,$,c)}

  ${q.mainStart()}
    ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Gi}]);
      let W_in = i32(uniforms.x_shape[${ys}]);

      ${c.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${k.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${vs}], indices[${Gi}], indices[${ys}]);
      let nxy = ${E.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${fd(k,$,c)}
  }`;return{name:"GridSample",shaderCache:{hint:`${c.cacheKey}`,inputDependencies:["type","type"]},getRunData:q=>{let Z=st.size(I);return{outputs:[{dims:I,dataType:q[0].dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:z}},getShaderSource:G}},Ho=(i,c)=>{cd(i.inputs),i.compute(hd(i.inputs,c))},pd=i=>_r({alignCorners:i.align_corners,mode:i.mode,paddingMode:i.padding_mode,format:i.format})}),si,Cu,gh,Eu,vl,xs,Pu,_h=s(()=>{rr(),ue(),Br(),Gn(),eu(),br(),zs(),si=(i,c)=>i.length>c&&i[c].dims.length>0?i[c]:void 0,Cu=(i,c)=>{let b=i[0],S=si(i,1),E=si(i,2),I=si(i,3),k=si(i,4),$=si(i,5),B=si(i,6),z=si(i,7);if(b.dims.length!==3&&b.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let G=b.dims[0],q=b.dims[1],Z=b.dims.length===3?b.dims[2]:c.numHeads*b.dims[4],se=q,le=0,me=0,Te=Math.floor(Z/c.numHeads);if(B&&z&&st.size(B.dims)&&st.size(z.dims)){if(B.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(B.dims[0]!==G||B.dims[1]!==c.numHeads||B.dims[3]!==Te)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(z.dims[0]!==G||z.dims[1]!==c.numHeads||z.dims[3]!==Te)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(B.dims[2]!==z.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(z.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');le=B.dims[2],me=B.dims[2]}else if(B&&st.size(B.dims)||z&&st.size(z.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let de;if(S&&st.size(S.dims)>0){if(b.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(S.dims.length<3||S.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(b.dims[0]!==S.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(S.dims.length===3){if(S.dims[2]!==b.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');de=2,se=S.dims[1]}else if(S.dims.length===5){if(S.dims[2]!==c.numHeads||S.dims[3]!==2||S.dims[4]!==Te)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(E)throw new Error('Expect "value" be none when "key" has packed kv format.');de=5,se=S.dims[1]}else{if(S.dims[1]!==c.numHeads||S.dims[3]!==Te)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');de=0,se=S.dims[2]}}else{if(b.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(b.dims[2]!==c.numHeads||b.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');de=3}if(I&&st.size(I.dims)>0){if(I.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(S&&S.dims.length===5&&S.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let _e=le+se,Ae=0;if(k&&st.size(k.dims)>0){Ae=8;let it=k.dims;throw it.length===1?it[0]===G?Ae=1:it[0]===3*G+2&&(Ae=3):it.length===2&&it[0]===G&&it[1]===_e&&(Ae=5),Ae===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let Oe=!1,He=Z;if(E&&st.size(E.dims)>0){if(E.dims.length!==3&&E.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(b.dims[0]!==E.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(E.dims.length===3){if(se!==E.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');He=E.dims[2]}else{if(se!==E.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');He=E.dims[1]*E.dims[3],Oe=!0}}let lt=!1;if(k&&st.size(k.dims)>0)throw new Error("Key padding mask is not supported");if($&&st.size($.dims)>0){if($.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if($.dims[0]!==G||$.dims[1]!==c.numHeads||$.dims[2]!==q||$.dims[3]!==_e)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:G,sequenceLength:q,pastSequenceLength:le,kvSequenceLength:se,totalSequenceLength:_e,maxSequenceLength:me,inputHiddenSize:0,hiddenSize:Z,vHiddenSize:He,headSize:Te,vHeadSize:Math.floor(He/c.numHeads),numHeads:c.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:c.maskFilterValue,maskType:Ae,scale:c.scale,broadcastResPosBias:lt,passPastInKv:Oe,qkvFormat:de}},gh=i=>_r({...i}),Eu=_r({perm:[0,2,1,3]}),vl=(i,c,b,S,E,I,k)=>{let $=[S,E,I],B=st.size($),z=[{type:12,data:B},{type:12,data:k},{type:12,data:I}],G=q=>{let Z=Xt("qkv_with_bias",c.dataType,$),se=dt("qkv",c.dataType,$),le=dt("bias",b.dataType,$),me=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${q.registerUniforms(me).declareVariables(se,le,Z)}
  ${q.mainStart()}
    ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return i.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:$,dataType:c.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(B/64)},programUniforms:z}),getShaderSource:G},{inputs:[c,b],outputs:[-1]})[0]},xs=(i,c,b,S,E,I,k,$)=>{let B=I;if(k&&st.size(k.dims)>0){if(S===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return B=vl(i,I,k,c,S,b*E,$),B=B.reshape([c,S,b,E]),b===1||S===1?B:i.compute(ui(B,Eu.perm),{inputs:[B],outputs:[-1]})[0]}else return I.dims.length===3&&(B=I.reshape([c,S,b,E])),b===1||S===1?B:i.compute(ui(B,Eu.perm),{inputs:[B],outputs:[-1]})[0]},Pu=(i,c)=>{let b=Cu(i.inputs,c),S=i.inputs[0],E=si(i.inputs,1),I=si(i.inputs,2),k=si(i.inputs,3),$=si(i.inputs,4),B=si(i.inputs,5),z=si(i.inputs,6),G=si(i.inputs,7);if(S.dims.length===5)throw new Error("Packed QKV is not implemented");if((E==null?void 0:E.dims.length)===5)throw new Error("Packed KV is not implemented");let q=E&&I&&E.dims.length===4&&I.dims.length===4,Z=xs(i,b.batchSize,b.numHeads,b.sequenceLength,b.headSize,S,k,0);if(q)return Ns(i,Z,E,I,$,void 0,z,G,B,b);if(!E||!I)throw new Error("key and value must be provided");let se=xs(i,b.batchSize,b.numHeads,b.kvSequenceLength,b.headSize,E,k,b.hiddenSize),le=xs(i,b.batchSize,b.numHeads,b.kvSequenceLength,b.vHeadSize,I,k,2*b.hiddenSize);Ns(i,Z,se,le,$,void 0,z,G,B,b)}}),md,bs,gd,_d,vd,yl,om,vh=s(()=>{rr(),ue(),Br(),br(),md=i=>{if(!i||i.length<1)throw new Error("too few inputs")},bs=(i,c)=>{let b=[],S=c.numOutputs;return i[1].dims[0]>0&&(i[1].getBigInt64Array().forEach(E=>b.push(Number(E))),S=b.length),_r({numOutputs:S,axis:c.axis,splitSizes:b})},gd=i=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${i}u; i += 1u ) {
    if (index < ${Yt("uniforms.size_in_split_axis","i",i)}) {
        return i;
    }
    }
    return ${i}u;
}`,_d=i=>{let c=i.length,b=[];for(let S=0;S<c;++S){let E=i[S].setByIndices("indices","input[global_idx]");c===1?b.push(E):S===0?b.push(`if (output_number == ${S}u) { ${E} }`):S===c-1?b.push(`else { ${E} }`):b.push(`else if (output_number == ${S}) { ${E} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${i[0].type.indices}, global_idx: u32) {
        ${b.join(`
`)}
      }`},vd=(i,c)=>{let b=i[0].dims,S=st.size(b),E=i[0].dataType,I=st.normalizeAxis(c.axis,b.length),k=new Array(c.numOutputs),$=dt("input",E,b.length),B=new Array(c.numOutputs),z=[],G=[],q=0,Z=[{type:12,data:S}];for(let le=0;le<c.numOutputs;le++){q+=c.splitSizes[le],B[le]=q;let me=b.slice();me[I]=c.splitSizes[le],G.push(me),k[le]=Xt(`output${le}`,E,me.length),z.push({dims:G[le],dataType:i[0].dataType})}Z.push({type:12,data:B},...Gt(b,...G));let se=le=>`
  ${le.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",B.length).declareVariables($,...k)}
  ${gd(B.length)}
  ${_d(k)}

  ${le.mainStart()}
    ${le.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${$.offsetToIndices("global_idx")};
    var index = ${$.indicesGet("indices",I)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Yt("uniforms.size_in_split_axis","output_number - 1u",B.length)};
      ${$.indicesSet("indices",I,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:c.cacheKey,inputDependencies:["rank"]},getShaderSource:se,getRunData:()=>({outputs:z,dispatchGroup:{x:Math.ceil(S/64)},programUniforms:Z})}},yl=(i,c)=>{md(i.inputs);let b=i.inputs.length===1?c:bs(i.inputs,c);i.compute(vd(i.inputs,b),{inputs:[0]})},om=i=>{let c=i.axis,b=i.splitSizes,S=i.numOutputs<0?b.length:i.numOutputs;if(S!==b.length)throw new Error("numOutputs and splitSizes lengh must be equal");return _r({axis:c,numOutputs:S,splitSizes:b})}}),Ms,Pa,Ou,ku=s(()=>{rr(),ue(),Br(),br(),Ms=(i,c)=>{let[b,S,E,I]=i,{numHeads:k,rotaryEmbeddingDim:$}=c;if(b.dims.length!==3&&b.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${b.dims.length}`);if(!st.areEqual(S.dims,[])&&!st.areEqual(S.dims,[1])&&S.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${S.dims.length}`);if(E.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${E.dims.length}`);if(I.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${I.dims.length}`);if(!st.areEqual(E.dims,I.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if($>0&&k===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let B=b.dims[0],z=b.dims[b.dims.length-2],G=E.dims[0],q=st.sizeFromDimension(b.dims,1)/z,Z=$===0?E.dims[1]*2:q/k;if($>Z)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(S.dims.length===2){if(B!==S.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${S.dims[0]}`);if(z!==S.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${S.dims[1]}`)}if(Z/2!==E.dims[1]&&$/2!==E.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${E.dims[1]}`);if(z>G)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Pa=(i,c)=>{let{interleaved:b,numHeads:S,rotaryEmbeddingDim:E,scale:I}=c,k=i[0].dims[0],$=st.sizeFromDimension(i[0].dims,1),B=i[0].dims[i[0].dims.length-2],z=$/B,G=i[2].dims[1],q=E===0?G*2:z/S,Z=new Array(k,B,z/q,q-G),se=st.computeStrides(Z),le=[{type:1,data:I},{type:12,data:Z},{type:12,data:se},...i[0].dims.length===3?new Array({type:12,data:[$,z,q,1]}):[],...i[0].dims.length===4?new Array({type:12,data:[$,q,B*q,1]}):[],...Gt(i[0].dims,i[1].dims,i[2].dims,i[3].dims,i[0].dims)],me=Te=>{let de=dt("input",i[0].dataType,i[0].dims.length),_e=dt("position_ids",i[1].dataType,i[1].dims.length),Ae=dt("cos_cache",i[2].dataType,i[2].dims.length),Oe=dt("sin_cache",i[3].dataType,i[3].dims.length),He=Xt("output",i[0].dataType,i[0].dims.length);return Te.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:Z.length},{name:"global_strides",type:"u32",length:se.length},{name:"input_output_strides",type:"u32",length:se.length}]),`
        ${Te.declareVariables(de,_e,Ae,Oe,He)}

        ${Te.mainStart(es)}
          let half_rotary_emb_dim = uniforms.${Ae.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${Te.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${_e.broadcastedIndicesToOffset("bsnh.xy",Xt("",_e.type.tensor,2))};
            let position_id =
                u32(${_e.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${b});
            let j = i + select(half_rotary_emb_dim, 1, ${b});
            let re = ${de.getByOffset("i")} * ${Ae.get("position_id","bsnh[3]")} -
                ${de.getByOffset("j")} * ${Oe.get("position_id","bsnh[3]")};
            ${He.setByOffset("i","re")}
            let im = ${de.getByOffset("i")} * ${Oe.get("position_id","bsnh[3]")} +
                ${de.getByOffset("j")} * ${Ae.get("position_id","bsnh[3]")};
            ${He.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${He.setByOffset("k",de.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:_r({interleaved:b}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:me,getRunData:()=>({outputs:[{dims:i[0].dims,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(st.size(Z)/es)},programUniforms:le})}},Ou=(i,c)=>{Ms(i.inputs,c),i.compute(Pa(i.inputs,c))}}),Oa,Ko,fr,ka,Iu,Xo=s(()=>{Br(),rr(),eu(),_h(),vh(),zs(),ku(),br(),Oa=(i,c)=>{if(c.doRotary&&i.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let b=i[0],S=i[1],E=i[2],I=i[3],k=i[4];if(c.doRotary!==0&&i.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(c.localWindowSize!==-1)throw new Error("Local attention is not supported");if(c.softcap!==0)throw new Error("Softcap is not supported");if(c.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(c.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(b.dims.length!==3&&b.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let $=!1,B=b.dims[0],z=b.dims[1],G=b.dims.length===3?$?b.dims[2]/3:b.dims[2]:c.numHeads*b.dims[4],q=z,Z=0,se=!S||S.dims.length===0,le=Math.floor(se?G/(c.numHeads+2*c.kvNumHeads):G/c.numHeads);se&&(G=le*c.numHeads);let me=I&&I.dims.length!==0,Te=k&&k.dims.length!==0;if(me&&I.dims.length===4&&I.dims[0]===B&&I.dims[1]!==c.kvNumHeads&&I.dims[2]===c.kvNumHeads&&I.dims[3]===le)throw new Error("BSNH pastKey/pastValue is not supported");if(me&&Te){if(I.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(k.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');Z=I.dims[2]}else if(me||Te)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let de=1;if(S&&S.dims.length>0){if(b.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(S.dims.length<3||S.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(b.dims[0]!==S.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(S.dims.length===3){if(b.dims[2]%S.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');q=S.dims[1]}else if(S.dims.length===5){if(S.dims[2]!==c.numHeads||S.dims[3]!==2||S.dims[4]!==le)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(E)throw new Error('Expect "value" be none when "key" has packed kv format.');q=S.dims[1]}else{if(S.dims[1]!==c.numHeads||S.dims[3]!==le)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');q=S.dims[2]}}else{if(b.dims.length!==3&&b.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(b.dims.length===5&&(b.dims[2]!==c.numHeads||b.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');de=3}let _e=0,Ae=!1,Oe=c.kvNumHeads?le*c.kvNumHeads:G;if(E&&E.dims.length>0){if(E.dims.length!==3&&E.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(b.dims[0]!==E.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(E.dims.length===3){if(q!==E.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');Oe=E.dims[2]}else{if(q!==E.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');Oe=E.dims[1]*E.dims[3],Ae=!0}}let He=i.length>4?i[5]:void 0;if(He&&He.dims.length!==1&&He.dims[0]!==B)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:B,sequenceLength:z,pastSequenceLength:Z,kvSequenceLength:q,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:G,vHiddenSize:Oe,headSize:le,vHeadSize:Math.floor(Oe/c.kvNumHeads),numHeads:c.numHeads,kvNumHeads:c.kvNumHeads,nReps:c.numHeads/c.kvNumHeads,pastPresentShareBuffer:!1,maskType:_e,scale:c.scale,broadcastResPosBias:!1,passPastInKv:Ae,qkvFormat:de}},Ko=_r({perm:[0,2,1,3]}),fr=(i,c,b)=>{let S=c,E=b.kvNumHeads;return c.dims.length===3&&b.kvSequenceLength!==0&&(S=c.reshape([b.batchSize,b.kvSequenceLength,E,b.headSize]),S=i.compute(ui(S,Ko.perm),{inputs:[S],outputs:[-1]})[0]),S},ka=(i,c,b,S)=>{let E=7,I=["type","type"],k=[i*c],$=i*c,B=[{type:12,data:$},{type:12,data:c},{type:12,data:i}],z=G=>{let q=dt("seq_lens",b.dataType,b.dims),Z=dt("total_seq_lens",S.dataType,S.dims),se=Xt("pos_ids",E,k),le=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${G.registerUniforms(le).declareVariables(q,Z,se)}
  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${Z.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${q.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${se.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${se.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${se.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${i};${c}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:k,dataType:E}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:B}),getShaderSource:z}},Iu=(i,c)=>{var Oe;let b=Oa(i.inputs,c);if(i.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((Oe=i.inputs[1])==null?void 0:Oe.dims.length)===5)throw new Error("Packed KV is not implemented");let S=i.inputs[0],E=i.inputs[1]&&i.inputs[1].dims.length>0?i.inputs[1]:void 0,I=i.inputs[2]&&i.inputs[2].dims.length>0?i.inputs[2]:void 0,k=i.inputs[3]&&i.inputs[3].dims.length!==0?i.inputs[3]:void 0,$=i.inputs[4]&&i.inputs[4].dims.length!==0?i.inputs[4]:void 0,B=i.inputs.length>4?i.inputs[5]:void 0,z=i.inputs.length>5?i.inputs[6]:void 0,G=b.kvNumHeads?b.kvNumHeads:b.numHeads,q=_r({axis:2,numOutputs:3,splitSizes:[b.numHeads*b.headSize,G*b.headSize,G*b.headSize]}),[Z,se,le]=!E&&!I?i.compute(vd([S],q),{inputs:[S],outputs:[-1,-1,-1]}):[S,E,I],me,Te;if(c.doRotary){let He=i.compute(ka(b.batchSize,b.sequenceLength,B,z),{inputs:[B,z],outputs:[-1]})[0],lt=i.inputs[7],it=i.inputs[8],mt=_r({interleaved:c.rotaryInterleaved!==0,numHeads:b.numHeads,rotaryEmbeddingDim:0,scale:c.scale}),Mt=[Z,He,lt,it],At=[-1];me=i.compute(Pa(Mt,mt),{inputs:Mt,outputs:At})[0],Mt.splice(0,1,se);let $t=_r({interleaved:c.rotaryInterleaved!==0,numHeads:b.kvNumHeads,rotaryEmbeddingDim:0,scale:c.scale});Te=i.compute(Pa(Mt,$t),{inputs:Mt,outputs:At})[0]}let de=xs(i,b.batchSize,b.numHeads,b.sequenceLength,b.headSize,c.doRotary?me:Z,void 0,0),_e=fr(i,c.doRotary?Te:se,b),Ae=fr(i,le,b);Ns(i,de,_e,Ae,void 0,void 0,k,$,void 0,b,B,z)}}),Au,Du,yd,Yn,am=s(()=>{rr(),ue(),zs(),br(),Au=(i,c,b,S,E,I,k,$)=>{let B=cn(I),z=B===1?"f32":`vec${B}f`,G=B===1?"vec2f":`mat2x${B}f`,q=E*k,Z=64;q===1&&(Z=256);let se=[E,k,I/B],le=[E,k,2],me=["rank","type","type"],Te=[];Te.push(...Gt(se,le));let de=_e=>{let Ae=dt("x",c.dataType,3,B),Oe=dt("scale",b.dataType,b.dims),He=dt("bias",S.dataType,S.dims),lt=Xt("output",1,3,2),it=[Ae,Oe,He,lt];return`
  var<workgroup> workgroup_shared : array<${G}, ${Z}>;
  const workgroup_size = ${Z}u;
  ${_e.declareVariables(...it)}
  ${_e.mainStart(Z)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${z}(0);
    var squared_sum = ${z}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${z}(${Ae.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${G}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Rs("workgroup_shared[0][0]",B)} / f32(hight * ${B});
      let squared_sum_final = ${Rs("workgroup_shared[0][1]",B)} / f32(hight * ${B});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${$}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return i.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${B};${$};${Z}`,inputDependencies:me},getRunData:()=>({outputs:[{dims:le,dataType:1}],dispatchGroup:{x:q},programUniforms:Te}),getShaderSource:de},{inputs:[c,b,S],outputs:[-1]})[0]},Du=(i,c,b)=>{let S=c[0].dims,E=S,I=2,k=S[0],$=S[1],B=st.sizeFromDimension(S,I),z=cn(B),G=st.size(E)/z,q=Au(i,c[0],c[1],c[2],k,B,$,b.epsilon),Z=[k,$,B/z],se=[k,$],le=["type","none"],me=Te=>{let de=dt("x",c[0].dataType,Z.length,z),_e=dt("scale_shift",1,se.length,2),Ae=Xt("output",c[0].dataType,Z.length,z),Oe=[de,_e,Ae];return`
  ${Te.registerUniform("output_size","u32").declareVariables(...Oe)}
  ${Te.mainStart()}
  ${Te.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${Ae.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${_e.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${de.getByOffset("global_idx")} * ${Ae.type.value}(scale_shift.x) + ${Ae.type.value}(scale_shift.y);
      ${Ae.setByOffset("global_idx","value")};
  }`};i.compute({name:"InstanceNormalization",shaderCache:{hint:`${z}`,inputDependencies:le},getRunData:()=>({outputs:[{dims:E,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:[{type:12,data:G},...Gt(Z,se,Z)]}),getShaderSource:me},{inputs:[c[0],q]})},yd=(i,c,b)=>{let S=c[0].dims,E=S,I=S[0],k=S[S.length-1],$=st.sizeFromDimension(S,1)/k,B=cn(k),z=st.size(E)/B,G=[{type:12,data:$},{type:12,data:Math.floor(k/B)}],q=["type","type"],Z=!1,se=[0,S.length-1];for(let de=0;de<S.length-2;de++)Z=Z||S[de+1]!==1,se.push(de+1);Z=Z&&S[S.length-1]!==1;let le=Z?i.compute(ui(i.inputs[0],se),{inputs:[i.inputs[0]],outputs:[-1]})[0]:i.inputs[0].reshape(Array.from({length:S.length},(de,_e)=>S[se[_e]])),me=Au(i,le,c[1],c[2],I,$,k,b.epsilon),Te=de=>{let _e=Kr(c[0].dataType),Ae=B===1?"vec2f":`mat${B}x2f`,Oe=it=>{let mt=it===0?"x":"y",Mt=B===1?"f32":`vec${B}f`;switch(B){case 1:return`${_e}(${Mt}(scale.${mt}))`;case 2:return`vec2<${_e}>(${Mt}(scale[0].${mt}, scale[1].${mt}))`;case 4:return`vec4<${_e}>(${Mt}(scale[0].${mt}, scale[1].${mt}, scale[2].${mt}, scale[3].${mt}))`;default:throw new Error(`Not supported compoents ${B}`)}},He=dt("input",c[0].dataType,c[0].dims,B),lt=Xt("output",c[0].dataType,E,B);return`
  @group(0) @binding(0) var<storage, read> input : array<${He.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${Ae}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${lt.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${de.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${Oe(0)}, ${Oe(1)});
  }`};i.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${B}`,inputDependencies:q},getRunData:()=>({outputs:[{dims:E,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(z/64)},programUniforms:G}),getShaderSource:Te},{inputs:[c[0],me]})},Yn=(i,c)=>{c.format==="NHWC"?yd(i,i.inputs,c):Du(i,i.inputs,c)}}),yh,wl,wh,xh=s(()=>{rr(),ue(),br(),yh=i=>{if(!i||i.length<2)throw new Error("layerNorm requires at least 2 inputs.")},wl=(i,c,b)=>{let S=c.simplified,E=i[0].dims,I=i[1],k=!S&&i[2],$=E,B=st.normalizeAxis(c.axis,E.length),z=st.sizeToDimension(E,B),G=st.sizeFromDimension(E,B),q=st.size(I.dims),Z=k?st.size(k.dims):0;if(q!==G||k&&Z!==G)throw new Error(`Size of X.shape()[axis:] == ${G}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${q} and bias size of ${Z}`);let se=[];for(let He=0;He<E.length;++He)He<B?se.push(E[He]):se.push(1);let le=cn(G),me=["type","type"],Te=[{type:12,data:z},{type:1,data:G},{type:12,data:Math.floor(G/le)},{type:1,data:c.epsilon}];k&&me.push("type");let de=b>1,_e=b>2,Ae=He=>{let lt=Kr(i[0].dataType),it=[dt("x",i[0].dataType,i[0].dims,le),dt("scale",I.dataType,I.dims,le)];k&&it.push(dt("bias",k.dataType,k.dims,le)),it.push(Xt("output",i[0].dataType,$,le)),de&&it.push(Xt("mean_data_output",1,se)),_e&&it.push(Xt("inv_std_output",1,se));let mt=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${He.registerUniforms(mt).declareVariables(...it)}
  ${He.mainStart()}
    ${He.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Qa("f32",le)};
    var mean_square_vector = ${Qa("f32",le)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${ni(lt,le,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Rs("mean_vector",le)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Rs("mean_square_vector",le)} / uniforms.norm_size ${S?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${ni(lt,le,"x[j + offset]")};
      let f32scale = ${ni(lt,le,"scale[j]")};
      output[j + offset] = ${it[0].type.value}((f32input ${S?"":"- mean"}) * inv_std_dev * f32scale
        ${k?`+ ${ni(lt,le,"bias[j]")}`:""}
      );
    }

    ${de?"mean_data_output[global_idx] = mean":""};
    ${_e?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},Oe=[{dims:$,dataType:i[0].dataType}];return de&&Oe.push({dims:se,dataType:1}),_e&&Oe.push({dims:se,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${le};${b};${S}`,inputDependencies:me},getRunData:()=>({outputs:Oe,dispatchGroup:{x:Math.ceil(z/64)},programUniforms:Te}),getShaderSource:Ae}},wh=(i,c)=>{yh(i.inputs),i.compute(wl(i.inputs,c,i.outputCount))}}),bh,Mh,Th=s(()=>{ue(),ou(),Wo(),bh=i=>{if(!i||i.length!==2)throw new Error("MatMul requires 2 inputs.");if(i[0].dims[i[0].dims.length-1]!==i[1].dims[i[1].dims.length-2])throw new Error("shared dimension does not match.")},Mh=i=>{bh(i.inputs);let c=Fs.calcShape(i.inputs[0].dims,i.inputs[1].dims,!0);if(!c)throw new Error("Can't use matmul on the given tensors");let b=c[c.length-1],S=i.inputs[0].dims[i.inputs[0].dims.length-1];if(b<8&&S<8)i.compute(Ic(i.inputs,{activation:""},c));else{let E=c[c.length-2],I=st.size(i.inputs[0].dims.slice(0,-2)),k=st.size(i.inputs[1].dims.slice(0,-2));if(I!==1&&E===1&&k===1){let $=i.inputs[0].reshape([1,I,S]),B=i.inputs[1].reshape([1,S,b]),z=[1,I,b],G=[$,B];i.compute(_a(G,{activation:""},c,z),{inputs:G})}else i.compute(_a(i.inputs,{activation:""},c))}}}),Hi,yi,Fu,Sh,xl,lm=s(()=>{rr(),ue(),Br(),br(),Hi=(i,c)=>{if(i.length<3||i.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let b=i[0],S=b.dims.length;if(b.dims[S-1]!==c.k)throw new Error("The last dim of input shape does not match the k value");let E=Math.floor((c.k+c.blockSize-1)/c.blockSize),I=c.blockSize/8*c.bits,k=i[1];if(!st.areEqual(k.dims,[c.n,E,I]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let $=i[2].dims;if(st.size($)!==c.n*E)throw new Error("scales input size error.");if(i.length===4){let B=i[3].dims,z=c.bits>4?c.n*E:c.n*Math.floor((E+1)/2);if(st.size(B)!==z)throw new Error("zeroPoints input size error.")}},yi=(i,c)=>{let b=i[0].dims,S=b.length,E=b[S-2],I=c.k,k=c.n,$=b.slice(0,S-2),B=st.size($),z=i[1].dims[2]/4,G=i[0].dataType,q=cn(c.k),Z=cn(z),se=cn(k),le=$.concat([E,k]),me=E>1&&k/se%2===0?2:1,Te=st.size(le)/se/me,de=64,_e=[],Ae=[B,E,I/q],Oe=st.convertShape(i[1].dims).slice();Oe.splice(-1,1,z/Z),_e.push(...Gt(Ae)),_e.push(...Gt(Oe)),_e.push(...Gt(i[2].dims)),i.length===4&&_e.push(...Gt(st.convertShape(i[3].dims)));let He=[B,E,k/se];_e.push(...Gt(He));let lt=it=>{let mt=Ae.length,Mt=dt("a",i[0].dataType,mt,q),At=dt("b",12,Oe.length,Z),$t=dt("scales",i[2].dataType,i[2].dims.length),Vt=[Mt,At,$t],Kt=i.length===4?dt("zero_points",12,i[3].dims.length):void 0;Kt&&Vt.push(Kt);let Mr=He.length,tr=Xt("output",i[0].dataType,Mr,se),Jt=Kr(i[0].dataType),Lt=(()=>{switch(q){case 1:return`array<${Jt}, 8>`;case 2:return`mat4x2<${Jt}>`;case 4:return`mat2x4<${Jt}>`;default:throw new Error(`${q}-component is not supported.`)}})(),$r=()=>{let St=`
          // reuse a data
            var input_offset = ${Mt.indicesToOffset(`${Mt.type.indices}(batch, row, word_offset)`)};
            var a_data: ${Lt};
            for (var j: u32 = 0; j < ${8/q}; j++) {
              a_data[j] = ${Mt.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let Rt=0;Rt<se*me;Rt++)St+=`
            b_value = ${Z===1?`b${Rt}_data`:`b${Rt}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${Lt}(${Array.from({length:4},(gr,an)=>`${Jt}(b_value_lower[${an}]), ${Jt}(b_value_upper[${an}])`).join(", ")});
            b_dequantized_values = ${q===1?`${Lt}(${Array.from({length:8},(gr,an)=>`(b_quantized_values[${an}] - ${Kt?`zero_point${Rt}`:"zero_point"}) * scale${Rt}`).join(", ")});`:`(b_quantized_values - ${Lt}(${Array(8).fill(`${Kt?`zero_point${Rt}`:"zero_point"}`).join(",")})) * scale${Rt};`};
            workgroup_shared[local_id.x * ${me} + ${Math.floor(Rt/se)}]${se>1?`[${Rt%se}]`:""} += ${Array.from({length:8/q},(gr,an)=>`${q===1?`a_data[${an}] * b_dequantized_values[${an}]`:`dot(a_data[${an}], b_dequantized_values[${an}])`}`).join(" + ")};
          `;return St},ar=()=>{let St=`
            var col_index = col * ${se};
            ${Kt?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Jt}(8);`}
            `;for(let Rt=0;Rt<se*me;Rt++)St+=`
            let scale${Rt} = ${$t.getByOffset("col_index * nBlocksPerCol + block")};
            ${Kt?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${Kt.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${Rt} = ${Jt}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return St},Cr=()=>{let St=`col_index = col * ${se};`;for(let Rt=0;Rt<se*me;Rt++)St+=`
            let b${Rt}_data = ${At.getByIndices(`${At.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return St+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${Lt};
            var b_dequantized_values: ${Lt};`,St};return`
        var<workgroup> workgroup_shared: array<${tr.type.value}, ${me*de}>;
        ${it.declareVariables(...Vt,tr)}
        ${it.mainStart([de,1,1])}
          let output_indices = ${tr.offsetToIndices(`(global_idx / ${de}) * ${me}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${de}) {
            //process one block
            var word_offset: u32 = block * ${c.blockSize/q};
            ${ar()}
            for (var word: u32 = 0; word < ${z}; word += ${Z}) {
              ${Cr()}
              for (var i: u32 = 0; i < ${Z}; i++) {
                ${$r()}
                word_offset += ${8/q};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${me}) {
            var output_value: ${tr.type.value} = ${tr.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${de}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${me};
            }
            ${tr.setByIndices(`${tr.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${c.blockSize};${c.bits};${q};${Z};${se};${me};${de}`,inputDependencies:Array(i.length).fill("rank")},getRunData:()=>({outputs:[{dims:le,dataType:G}],dispatchGroup:{x:Te},programUniforms:_e}),getShaderSource:lt}},Fu=(i,c)=>{let b=i[0].dims,S=b.length,E=b[S-2],I=c.k,k=c.n,$=b.slice(0,S-2),B=st.size($),z=i[1].dims[2]/4,G=i[0].dataType,q=cn(c.k),Z=cn(z),se=$.concat([E,k]),le=128,me=k%8===0?8:k%4===0?4:1,Te=le/me,de=Te*Z*8,_e=de/q,Ae=de/c.blockSize,Oe=st.size(se)/me,He=[],lt=[B,E,I/q],it=st.convertShape(i[1].dims).slice();it.splice(-1,1,z/Z),He.push(...Gt(lt)),He.push(...Gt(it)),He.push(...Gt(i[2].dims)),i.length===4&&He.push(...Gt(st.convertShape(i[3].dims)));let mt=[B,E,k];He.push(...Gt(mt));let Mt=At=>{let $t=lt.length,Vt=dt("a",i[0].dataType,$t,q),Kt=dt("b",12,it.length,Z),Mr=dt("scales",i[2].dataType,i[2].dims.length),tr=[Vt,Kt,Mr],Jt=i.length===4?dt("zero_points",12,i[3].dims.length):void 0;Jt&&tr.push(Jt);let Lt=mt.length,$r=Xt("output",i[0].dataType,Lt),ar=Kr(i[0].dataType),Cr=()=>{switch(q){case 1:return`
          let a_data0 = vec4<${ar}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ar}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ar}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ar}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${q}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${Vt.type.value}, ${_e}>;
        var<workgroup> inter_results: array<array<${$r.type.value}, ${Te}>, ${me}>;
        ${At.declareVariables(...tr,$r)}
        ${At.mainStart([Te,me,1])}
          let output_indices = ${$r.offsetToIndices(`workgroup_index * ${me}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${Ae} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${_e};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${_e}; a_offset += ${le})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${Vt.getByIndices(`${Vt.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${Vt.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${Ae} + local_id.x;
            ${Jt?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Jt.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ar}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ar}(8);`}
            let scale = ${Mr.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${Kt.getByIndices(`${Kt.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${c.blockSize/q};
            for (var i: u32 = 0; i < ${Z}; i++) {
              ${Cr()}
              let b_value = ${Z===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ar}>(${Array.from({length:4},(St,Rt)=>`${ar}(b_value_lower[${Rt}]), ${ar}(b_value_upper[${Rt}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ar}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(St,Rt)=>`${`dot(a_data${Rt}, b_dequantized_values[${Rt}])`}`).join(" + ")};
              word_offset += ${8/q};
            }
            workgroupBarrier();
          }

          if (local_idx < ${me}) {
            var output_value: ${$r.type.value} = ${$r.type.value}(0);
            for (var b = 0u; b < ${Te}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${$r.setByIndices(`${$r.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${c.blockSize};${q};${Z};${Te};${me}`,inputDependencies:Array(i.length).fill("rank")},getRunData:()=>({outputs:[{dims:se,dataType:G}],dispatchGroup:{x:Oe},programUniforms:He}),getShaderSource:Mt}},Sh=(i,c)=>{Hi(i.inputs,c),c.blockSize===32&&i.adapterInfo.isVendor("intel")&&i.adapterInfo.isArchitecture("gen-12lp")?i.compute(Fu(i.inputs,c)):i.compute(yi(i.inputs,c))},xl=i=>_r(i)}),Ch,Yo,wd,xd,bd,um,cm,Md,bl,Eh=s(()=>{rr(),ue(),br(),Ch=i=>{if(!i||i.length<1)throw new Error("Too few inputs");if(i[0].dataType!==1&&i[0].dataType!==10)throw new Error("Input type must be float or float16.");if(i.length>=2){let c=i[0].dims.length*2===i[1].dims[0];if(i.length===4&&(c=i[3].dims[0]*2===i[1].dims[0]),!c)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Yo=(i,c,b)=>{let S="";for(let E=c-1;E>=0;--E)S+=`
            k = i32(${i.indicesGet("indices",E)}) - ${Yt("uniforms.pads",E,b)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Yt("uniforms.x_shape",E,c)})) {
              break;
            }
            offset += k * i32(${Yt("uniforms.x_strides",E,c)});
        `;return`
          value = ${i.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${S}
            value = x[offset];
          }
      `},wd=(i,c,b)=>{let S="";for(let E=c-1;E>=0;--E)S+=`
                k = i32(${i.indicesGet("indices",E)}) - ${Yt("uniforms.pads",E,b)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Yt("uniforms.x_shape",E,c)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Yt("uniforms.x_shape",E,c)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Yt("uniforms.x_strides",E,c)});
            `;return`
              var offset = 0;
              var k = 0;
              ${S}
              value = x[offset];
          `},xd=(i,c,b)=>{let S="";for(let E=c-1;E>=0;--E)S+=`
                k = i32(${i.indicesGet("indices",E)}) - ${Yt("uniforms.pads",E,b)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Yt("uniforms.x_shape",E,c)})) {
                  k = i32(${Yt("uniforms.x_shape",E,c)}) - 1;
                }
                offset += k * i32(${Yt("uniforms.x_strides",E,c)});
            `;return`
              var offset = 0;
              var k = 0;
              ${S}
              value = x[offset];
          `},bd=(i,c,b)=>{let S="";for(let E=c-1;E>=0;--E)S+=`
                k = i32(${i.indicesGet("indices",E)}) - ${Yt("uniforms.pads",E,b)};
                if (k < 0)  {
                  k += i32(${Yt("uniforms.x_shape",E,c)}]);
                }
                if (k >= i32(${Yt("uniforms.x_shape",E,c)})) {
                  k -= i32(${Yt("uniforms.x_shape",E,c)});
                }
                offset += k * i32(${Yt("uniforms.x_strides",E,c)});
            `;return`
              var offset = 0;
              var k = 0;
              ${S}
              value = x[offset];
          `},um=(i,c,b)=>{switch(b.mode){case 0:return Yo(i,c,b.pads.length);case 1:return wd(i,c,b.pads.length);case 2:return xd(i,c,b.pads.length);case 3:return bd(i,c,b.pads.length);default:throw new Error("Invalid mode")}},cm=(i,c)=>{let b=st.padShape(i[0].dims.slice(),c.pads),S=i[0].dims,E=st.size(b),I=[{type:12,data:E},{type:6,data:c.pads}],k=i.length>=3&&i[2].data;c.mode===0&&I.push({type:k?i[2].dataType:1,data:c.value}),I.push(...Gt(i[0].dims,b));let $=["rank"],B=z=>{let G=Xt("output",i[0].dataType,b.length),q=dt("x",i[0].dataType,S.length),Z=q.type.value,se=um(G,S.length,c),le=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:c.pads.length}];return c.mode===0&&le.push({name:"constant_value",type:k?Z:"f32"}),`
            ${z.registerUniforms(le).declareVariables(q,G)}
            ${z.mainStart()}
            ${z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${G.offsetToIndices("global_idx")};

            var value = ${Z}(0);
            ${se}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${c.mode}${k}`,inputDependencies:$},getRunData:()=>({outputs:[{dims:b,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(st.size(b)/64)},programUniforms:I}),getShaderSource:B}},Md=(i,c)=>{if(i.length>1){let b=i[1].getBigInt64Array(),S=i.length>=3&&i[2].data?i[2].dataType===10?i[2].getUint16Array()[0]:i[2].getFloat32Array()[0]:0,E=i[0].dims.length,I=new Int32Array(2*E).fill(0);if(i.length>=4){let $=i[3].getBigInt64Array();for(let B=0;B<$.length;B++)I[Number($[B])]=Number(b[B]),I[Number($[B])+E]=Number(b[B+$.length])}else b.forEach(($,B)=>I[Number(B)]=Number($));let k=[];return I.forEach($=>k.push($)),{mode:c.mode,value:S,pads:k}}else return c},bl=(i,c)=>{Ch(i.inputs);let b=Md(i.inputs,c);i.compute(cm(i.inputs,b),{inputs:[0]})}}),Ml,Tl,Ia,qo,Sl,Td,Cl,Aa,Lu,ns,Ts,Sd,Cd,Ph,Ed,Oh,kh,Ih,Ah,dm=s(()=>{wt(),rr(),ue(),br(),Ml=i=>{if(L.webgpu.validateInputContent&&(!i||i.length!==1))throw new Error("Pool ops requires 1 input.")},Tl=(i,c,b)=>{let S=c.format==="NHWC",E=i.dims.slice();S&&E.splice(1,0,E.pop());let I=Object.hasOwnProperty.call(c,"dilations"),k=c.kernelShape.slice(),$=c.strides.slice(),B=I?c.dilations.slice():[],z=c.pads.slice();lo.adjustPoolAttributes(b,E,k,$,B,z);let G=lo.computePoolOutputShape(b,E,$,B,k,z,c.autoPad),q=Object.assign({},c);I?Object.assign(q,{kernelShape:k,strides:$,pads:z,dilations:B,cacheKey:c.cacheKey}):Object.assign(q,{kernelShape:k,strides:$,pads:z,cacheKey:c.cacheKey});let Z=G.slice();return Z.push(Z.splice(1,1)[0]),[q,S?Z:G]},Ia=(i,c)=>{let b=c.format==="NHWC",S=st.size(i),E=st.size(c.kernelShape),I=[{type:12,data:S},{type:12,data:E}],k=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(c.kernelShape.length<=2){let $=c.kernelShape[c.kernelShape.length-1],B=c.strides[c.strides.length-1],z=c.pads[c.pads.length/2-1],G=c.pads[c.pads.length-1],q=!!(z+G);I.push({type:12,data:$},{type:12,data:B},{type:12,data:z},{type:12,data:G}),k.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let Z=!1;if(c.kernelShape.length===2){let se=c.kernelShape[c.kernelShape.length-2],le=c.strides[c.strides.length-2],me=c.pads[c.pads.length/2-2],Te=c.pads[c.pads.length-2];Z=!!(me+Te),I.push({type:12,data:se},{type:12,data:le},{type:12,data:me},{type:12,data:Te}),k.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[I,k,!0,q,Z]}else{if(b)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let $=st.computeStrides(c.kernelShape);I.push({type:12,data:$},{type:12,data:c.pads},{type:12,data:c.strides}),k.push({name:"kernelStrides",type:"u32",length:$.length},{name:"pads",type:"u32",length:c.pads.length},{name:"strides",type:"u32",length:c.strides.length});let B=c.pads.reduce((z,G)=>z+G);return[I,k,!!B,!1,!1]}},qo=(i,c,b,S,E,I,k,$,B,z,G,q)=>{let Z=E.format==="NHWC",se=c.type.value,le=Xt("output",c.type.tensor,S);if(E.kernelShape.length<=2){let me="",Te="",de="",_e=b-(Z?2:1);if(G?me=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_e}] = indices[${_e}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${_e}] < 0 || xIndices[${_e}]
                      >= uniforms.x_shape[${_e}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${c.indicesToOffset("xIndices")}];
                  ${I}
                }`:me=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_e}] = indices[${_e}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${c.indicesToOffset("xIndices")}];
                  ${I}
                }`,E.kernelShape.length===2){let Ae=b-(Z?3:2);q?Te=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${Ae}] = indices[${Ae}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${Ae}] < 0 || xIndices[${Ae}] >= uniforms.x_shape[${Ae}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:Te=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${Ae}] = indices[${Ae}] * uniforms.sh - uniforms.phStart + j;
                `,de=`
              }
            `}return`
            ${i.registerUniforms(B).declareVariables(c,le)}

            ${i.mainStart()}
              ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${le.offsetToIndices("global_idx")};
              var xIndices = ${le.offsetToIndices("global_idx")};

              var value = ${se}(${$});
              var pad = 0;
              ${Te}
              ${me}
              ${de}
              ${k}

              output[global_idx] = value;
            }`}else{if(Z)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let me=E.kernelShape.length,Te=E.pads.length,de="";return z?de=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${c.indicesToOffset("xIndices")}];
                ${I}
              }`:de=`
              }
              let x_val = x[${c.indicesToOffset("xIndices")}];
              ${I}
            `,`
            ${i.registerUniforms(B).declareVariables(c,le)}

            ${i.mainStart()}
              ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${le.offsetToIndices("global_idx")};
              var xIndices = ${le.offsetToIndices("global_idx")};

              var offsets: array<u32, ${me}>;

              var value = ${se}(${$});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${me-1}u; j++) {
                  offsets[j] = offset / ${Yt("uniforms.kernelStrides","j",me)};
                  offset -= offsets[j] * ${Yt("uniforms.kernelStrides","j",me)};
                }
                offsets[${me-1}] = offset;

                isPad = false;
                for (var j = ${b-me}u; j < ${b}u; j++) {
                  xIndices[j] = indices[j] * ${Yt("uniforms.strides",`j - ${b-me}u`,me)}
                    + offsets[j - ${b-me}u] - ${Yt("uniforms.pads","j - 2u",Te)};
                  ${de}
              }
              ${k}

              output[global_idx] = value;
            }`}},Sl=i=>`${i.format};${i.ceilMode};${i.autoPad};${i.kernelShape.length}`,Td=i=>`${Sl(i)};${i.countIncludePad}`,Cl=i=>`${Sl(i)};${i.storageOrder};${i.dilations}`,Aa=i=>({format:i.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][i.auto_pad],ceilMode:i.ceil_mode,kernelShape:i.kernel_shape,strides:i.strides,pads:i.pads}),Lu=(i,c,b,S)=>{let[E,I]=Tl(c,S,b),k=dt("x",c.dataType,c.dims.length),$=k.type.value,B="value += x_val;",z="";E.countIncludePad?z+=`value /= ${$}(uniforms.kernelSize);`:z+=`value /= ${$}(i32(uniforms.kernelSize) - pad);`;let[G,q,Z,se,le]=Ia(I,E);G.push(...Gt(c.dims,I));let me=["rank"];return{name:i,shaderCache:{hint:`${S.cacheKey};${Z};${se};${le}`,inputDependencies:me},getRunData:()=>({outputs:[{dims:I,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(st.size(I)/64)},programUniforms:G}),getShaderSource:Te=>qo(Te,k,c.dims.length,I.length,E,B,z,0,q,Z,se,le)}},ns=i=>{let c=i.count_include_pad!==0,b=Aa(i);if(b.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let S={countIncludePad:c,...b,cacheKey:""};return{...S,cacheKey:Td(S)}},Ts=(i,c)=>{Ml(i.inputs),i.compute(Lu("AveragePool",i.inputs[0],!1,c))},Sd={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},Cd=i=>{let c=i.format;return{format:c,...Sd,cacheKey:c}},Ph=(i,c)=>{Ml(i.inputs),i.compute(Lu("GlobalAveragePool",i.inputs[0],!0,c))},Ed=(i,c,b,S)=>{let[E,I]=Tl(c,S,b),k=`
      value = max(x_val, value);
    `,$="",B=dt("x",c.dataType,c.dims.length),z=["rank"],[G,q,Z,se,le]=Ia(I,E);return G.push(...Gt(c.dims,I)),{name:i,shaderCache:{hint:`${S.cacheKey};${Z};${se};${le}`,inputDependencies:z},getRunData:()=>({outputs:[{dims:I,dataType:c.dataType}],dispatchGroup:{x:Math.ceil(st.size(I)/64)},programUniforms:G}),getShaderSource:me=>qo(me,B,c.dims.length,I.length,E,k,$,c.dataType===10?-65504:-1e5,q,Z,se,le)}},Oh=(i,c)=>{Ml(i.inputs),i.compute(Ed("MaxPool",i.inputs[0],!1,c))},kh=i=>{let c=i.storage_order,b=i.dilations,S=Aa(i);if(c!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(S.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let E={storageOrder:c,dilations:b,...S,cacheKey:""};return{...E,cacheKey:Cl(E)}},Ih=i=>{let c=i.format;return{format:c,...Sd,cacheKey:c}},Ah=(i,c)=>{Ml(i.inputs),i.compute(Ed("GlobalMaxPool",i.inputs[0],!0,c))}}),Dh,Pd,Fh,Lh,Od=s(()=>{rr(),ue(),Br(),br(),Dh=(i,c)=>{if(i.length<2||i.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(i.length===3&&i[1].dims===i[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(i.length===3&&i[0].dataType!==i[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(i[0].dataType===6&&i.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(i[1].dims.length!==0&&i[1].dims.length!==1&&i[1].dims.length!==i[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(i.length>2){if(i[0].dataType!==i[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(i[1].dims.length!==i[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!i[1].dims.map((b,S)=>b===i[2].dims[S]).reduce((b,S)=>b&&S,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(c.blockSize>0){if(i[1].dims.length===0||i[1].dims.length===1&&i[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!i[1].dims.map((E,I)=>I===c.axis||E===i[0].dims[I]).reduce((E,I)=>E&&I,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(i[1].dims.length!==i[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let b=i[0].dims[c.axis],S=i[1].dims[c.axis];if(c.blockSize<Math.ceil(b/S)||c.blockSize>Math.ceil(b/(S-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Pd=(i,c)=>{let b=st.normalizeAxis(c.axis,i[0].dims.length),S=i[0].dataType,E=S===3,I=i[0].dims,k=i[1].dataType,$=st.size(I),B=S===3||S===2,z=B?[Math.ceil(st.size(i[0].dims)/4)]:i[0].dims,G=i[1].dims,q=i.length>2?i[2]:void 0,Z=q?B?[Math.ceil(st.size(q.dims)/4)]:q.dims:void 0,se=G.length===0||G.length===1&&G[0]===1,le=se===!1&&G.length===1,me=cn($),Te=se&&(!B||me===4),de=Te?me:1,_e=Te&&!B?me:1,Ae=dt("input",B?12:S,z.length,_e),Oe=dt("scale",k,G.length),He=q?dt("zero_point",B?12:S,Z.length):void 0,lt=Xt("output",k,I.length,de),it=[Ae,Oe];He&&it.push(He);let mt=[z,G];q&&mt.push(Z);let Mt=[{type:12,data:$/de},{type:12,data:b},{type:12,data:c.blockSize},...Gt(...mt,I)],At=$t=>{let Vt=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${$t.registerUniforms(Vt).declareVariables(...it,lt)}
      ${$t.mainStart()}
          ${$t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${lt.offsetToIndices("global_idx")};

          // Set input x
          ${B?`
            let input = ${Ae.getByOffset("global_idx / 4")};
            let x_vec = ${E?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${de===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${Ae.getByOffset("global_idx")};`};

          // Set scale input
          ${se?`let scale_value= ${Oe.getByOffset("0")}`:le?`
            let scale_index = ${lt.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${Oe.getByOffset("scale_index")};`:`
            var scale_indices: ${Oe.type.indices} = output_indices;
            let index = ${Oe.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${Oe.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${Oe.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${He?se?B?`
                let zero_point_input = ${He.getByOffset("0")};
                let zero_point_vec =  ${E?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${He.getByOffset("0")}`:le?B?`
                let zero_point_index = ${lt.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${He.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${E?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${lt.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${He.getByOffset("zero_point_index")};`:B?`
                let zero_point_offset = ${Oe.indicesToOffset("scale_indices")};
                let zero_point_input = ${He.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${E?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${He.getByIndices("scale_indices")};`:`let zero_point_value = ${B?E?"i32":"u32":Ae.type.value}(0);`};
      // Compute and write output
      ${lt.setByOffset("global_idx",`${lt.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:c.cacheKey,inputDependencies:He?["rank","rank","rank"]:["rank","rank"]},getShaderSource:At,getRunData:()=>({outputs:[{dims:I,dataType:k}],dispatchGroup:{x:Math.ceil($/de/64),y:1,z:1},programUniforms:Mt})}},Fh=(i,c)=>{Dh(i.inputs,c),i.compute(Pd(i.inputs,c))},Lh=i=>_r({axis:i.axis,blockSize:i.blockSize})}),kd,Id,$h,fm=s(()=>{wt(),rr(),br(),kd=(i,c,b)=>{let S=i===c,E=i<c&&b<0,I=i>c&&b>0;if(S||E||I)throw new Error("Range these inputs' contents are invalid.")},Id=(i,c,b,S)=>{let E=Math.abs(Math.ceil((c-i)/b)),I=[E],k=E,$=[{type:12,data:k},{type:S,data:i},{type:S,data:b},...Gt(I)],B=z=>{let G=Xt("output",S,I.length),q=G.type.value,Z=[{name:"outputSize",type:"u32"},{name:"start",type:q},{name:"delta",type:q}];return`
        ${z.registerUniforms(Z).declareVariables(G)}
        ${z.mainStart()}
        ${z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${q}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${S}`},getShaderSource:B,getRunData:()=>({outputs:[{dims:I,dataType:S}],dispatchGroup:{x:Math.ceil(k/64)},programUniforms:$})}},$h=i=>{let c=0,b=0,S=0;i.inputs[0].dataType===6?(c=i.inputs[0].getInt32Array()[0],b=i.inputs[1].getInt32Array()[0],S=i.inputs[2].getInt32Array()[0]):i.inputs[0].dataType===1&&(c=i.inputs[0].getFloat32Array()[0],b=i.inputs[1].getFloat32Array()[0],S=i.inputs[2].getFloat32Array()[0]),L.webgpu.validateInputContent&&kd(c,b,S),i.compute(Id(c,b,S,i.inputs[0].dataType),{inputs:[]})}}),$u,Ru,Ad,Rh,Bh,zh,Dd=s(()=>{rr(),ue(),Br(),br(),$u=(i,c,b,S)=>{if(i!=="none"&&S!=="i32"&&S!=="u32"&&S!=="f32")throw new Error(`Input ${S} is not supported with reduction ${i}.`);let E=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,I=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${c}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(i){case"none":return`${c}=${b};`;case"add":return S==="i32"||S==="u32"?`atomicAdd(&${c}, bitcast<${S}>(${b}));`:`
              ${E}bitcast<${S}>(oldValue) + (${b})${I}`;case"max":return S==="i32"||S==="u32"?`atomicMax(&${c}, bitcast<${S}>(${b}));`:`
                ${E}max(bitcast<f32>(oldValue), (${b}))${I}`;case"min":return S==="i32"||S==="u32"?`atomicMin(&${c}, bitcast<${S}>(${b}));`:`${E}min(bitcast<${S}>(oldValue), (${b}))${I}`;case"mul":return`${E}(bitcast<${S}>(oldValue) * (${b}))${I}`;default:throw new Error(`Reduction ${i} is not supported.`)}},Ru=(i,c)=>`${i===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${c?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${c?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,Ad=(i,c,b)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${b?"global_idx":"idx"} + i];
        ${$u(i.reduction,"output[data_offset + i]","value",c)}
      }`,Rh=(i,c)=>{let b=i[0].dims,S=i[1].dims,E=b,I=1,k=Math.ceil(st.size(S)/I),$=S[S.length-1],B=st.sizeFromDimension(b,$),z=st.sizeFromDimension(S,0)/$,G=[{type:12,data:k},{type:12,data:$},{type:12,data:B},...Gt(i[1].dims,i[2].dims,E)],q=Z=>{let se=dt("indices",i[1].dataType,i[1].dims.length),le=dt("updates",i[2].dataType,i[2].dims.length,I),me=c.reduction!=="none"&&c.reduction!==""?ec("output",i[0].dataType,E.length):Xt("output",i[0].dataType,E.length,I);return`
      ${Z.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(se,le,me)}
      ${Z.mainStart()}
        ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${c.reduction==="none"}) {
    for (var i = 0; i < ${z}; i = i + 1) {
      for (var j = i + 1; j < ${z}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${c.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${z}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${Ru(b.length,!1)}
      }
      ${Ad(c,me.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${Ru(b.length,!0)}
  }
  ${Ad(c,me.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${c.cacheKey}_${c.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:E,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(k/64)},programUniforms:G}),getShaderSource:q}},Bh=i=>_r({reduction:i.reduction}),zh=(i,c)=>{i.compute(Rh(i.inputs,c),{inputs:[i.inputs[1],i.inputs[2]],outputs:[]})}}),jh,Fi,Nh,Fd,Uh,El,Vh,Wh,Gh,Qr,Ld,hm,Hh,pm,$d,Kh,Xh,Yh,qh,Rd,Qh=s(()=>{rr(),ue(),Br(),br(),jh=(i,c)=>{if(i.every(b=>b>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),i.length>0){if(c.mode==="linear"){if(!(i.length===2||i.length===3||i.length===4&&i[0]===1&&i[1]===1||i.length===4&&i[0]===1&&i[3]===1||i.length===5&&i[0]===1&&i[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(c.mode==="cubic"&&!(i.length===2||i.length===4&&i[0]===1&&i[1]===1||i.length===4&&i[0]===1&&i[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Fi=(i,c,b)=>{c.every(E=>E>=0&&E<b||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let S=new Array(b).fill(1);return c.forEach((E,I)=>S[E]=i[I]),S},Nh=(i,c,b,S,E,I)=>{let[k,$,B]=b>10?[1,2,3]:[-1,i.length>1?1:-1,-1],z=i[0].dims.length;if(k>0&&i.length>k&&i[k].dims.length>0)i[k].getFloat32Array().forEach(G=>I.push(G));else if(c.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if($>0&&i.length>$&&i[$].dims.length===1&&i[$].dims[0]>0){if(i[$].getFloat32Array().forEach(G=>S.push(G)),S.length!==0&&S.length!==z&&b>=18&&S.length!==c.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");jh(S,c),c.axes.length>0&&Fi(S,c.axes,z).forEach((G,q)=>S[q]=G)}if(B>0&&i.length>B&&i[B].dims.length===1&&i[B].dims[0]>0&&(i[B].getBigInt64Array().forEach(G=>E.push(Number(G))),E.length!==0&&E.length!==z&&b>=18&&E.length!==c.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(c.axes.length>0){if(S.length!==0&&S.length!==c.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(E.length!==0&&E.length!==c.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof S<"u"&&typeof E<"u"&&S.length>0&&E.length>z)throw new Error("Resize requires only of scales or sizes to be specified")},Fd=(i,c,b,S)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${i}) * (${c});
  let whole = ${S}(big / (${b}));
  let fract = ${S}(big % (${b})) / ${S}(${b});
  return whole + fract;
`,Uh=(i,c)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${c} { `+(()=>{switch(i){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${c}(xResized) / ${c}(xScale);
          } else {
            ${Fd("xResized","lengthOriginal","lengthResized",c)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${c}(xResized) + 0.5) / ${c}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${c}(xResized) + 0.5) / ${c}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Fd("xResized","lengthOriginal - 1","lengthResized - 1",c)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${c}(roiStart) * ${c}(lengthOriginal - 1) +
                        (${c}(xResized) * ${c}(roiEnd - roiStart) * ${c}(lengthOriginal - 1)) /
                        ${c}(lengthResized - 1);
                  } else {
                    return 0.5 * ${c}(roiStart + roiEnd) * ${c}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${c}xScale * ${c}(lengthResized);
                  const adjustment = ${c}(lengthResized) / outputWidth;
                  const center = ${c}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${c}(xResized) + 0.5) / ${c}(xScale)) - 0.5;`;case"half_pixel":return`return ((${c}(xResized) + 0.5) / ${c}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${i} is not supported`)}})()+"}",El=(i,c,b)=>`fn getNearestPixelFromOriginal(xOriginal: ${b}, isDownSample: bool) -> ${b} {`+(()=>{switch(i){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(c<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${i} is not supported`)}})()+"}",Vh=(i,c,b)=>{let S=new Array(b).fill(0).concat(new Array(b).fill(1)),E=i.length===0?S:i.slice();return c.length>0?(c.forEach((I,k)=>{S[I]=E[k],S[k+b]=E[c.length+k]}),S):E},Wh=(i,c,b,S)=>{let E=[];if(b.length>0)if(S.length>0){if(i.forEach(I=>E.push(I)),Math.max(...S)>i.length)throw new Error("axes is out of bound");S.forEach((I,k)=>E[I]=b[k])}else b.forEach(I=>E.push(I));else{if(c.length===0)throw new Error("Resize requires either scales or sizes.");E=i.map((I,k)=>Math.round(I*c[k]))}return E},Gh=(i,c,b)=>{let S=(()=>{switch(b.keepAspectRatioPolicy){case"not_larger":return b.axes.length>0?Math.min(...b.axes.map(I=>c[I]),Number.MAX_VALUE):Math.min(...c,Number.MAX_VALUE);case"not_smaller":return b.axes.length>0?Math.max(...b.axes.map(I=>c[I]),Number.MIN_VALUE):Math.max(...c,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${b.keepAspectRatioPolicy} is not supported`)}})();c.fill(1,0,c.length);let E=i.slice();return b.axes.length>0?(b.axes.forEach(I=>c[I]=S),b.axes.forEach(I=>E[I]=Math.round(i[I]*c[I]))):(c.fill(S,0,c.length),E.forEach((I,k)=>E[k]=Math.round(I*c[k]))),E},Qr=(i,c,b,S,E)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${i.type.indices}) -> array<${i.type.value}, ${b.length}> {
      var original_indices: array<${i.type.value}, ${b.length}>;
      for (var i:u32 = 0; i < ${b.length}; i++) {
        var output_index = ${i.indicesGet("output_indices","i")};
        var scale = ${Yt("uniforms.scales","i",S)};
        var roi_low = ${Yt("uniforms.roi","i",E)};
        var roi_hi = ${Yt("uniforms.roi",`i + ${c.length}`,E)};
        if (scale == 1.0) {
          original_indices[i] = ${i.type.value}(output_index);
        } else {
          var input_shape_i = ${Yt("uniforms.input_shape","i",c.length)};
          var output_shape_i = ${Yt("uniforms.output_shape","i",b.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Ld=(i,c,b,S,E,I,k)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${c.type.indices}) -> ${i.type.indices} {
      var input_indices: ${i.type.indices};
      for (var i:u32 = 0; i < ${S.length}; i++) {
        var output_index = ${c.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Yt("uniforms.scales","i",E)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Yt("uniforms.roi","i",I)};
          var roi_hi = ${Yt("uniforms.roi",`i + ${b.length}`,I)};
          var input_shape_i = ${Yt("uniforms.input_shape","i",b.length)};
          var output_shape_i = ${Yt("uniforms.output_shape","i",S.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${k} || (original_idx >= 0 && original_idx < ${c.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${c.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${i.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,hm=(i,c)=>`
    fn checkInputIndices(input_indices: ${i.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${c.length}; i++) {
        var input_index = ${i.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Yt("uniforms.input_shape","i",c.length)}) {
          return false;
        }
      }
      return true;
    }`,Hh=(i,c,b,S)=>i.rank>S?`
    ${i.indicesSet("input_indices",c,"channel")};
    ${i.indicesSet("input_indices",b,"batch")};
`:"",pm=(i,c,b,S,E)=>{let[I,k,$,B]=b.length===2?[-1,0,1,-1]:[0,2,3,1],z=i.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${z} {
      var input_indices: ${i.type.indices};
      ${i.indicesSet("input_indices",k,`max(0, min(row, ${b[k]} - 1))`)};
      ${i.indicesSet("input_indices",$,`max(0, min(col, ${b[$]} - 1))`)};
      ${Hh(i,B,I,2)}
      return ${i.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${c.type.indices}) -> ${z} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${z} = originalIndices[${k}];
      var col:${z} = originalIndices[${$}];
      ${S?`if (row < 0 || row > (${b[k]} - 1) || col < 0 || col > (${b[$]} - 1)) {
        return ${E};
      }`:""};
      row = max(0, min(row, ${b[k]} - 1));
      col = max(0, min(col, ${b[$]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${b.length>2?`u32(originalIndices[${B}])`:"0"};
      var batch: u32 =  ${b.length>2?`u32(originalIndices[${I}])`:"0"};
      var x11: ${z} = getInputValue(batch, channel, row1, col1);
      var x12: ${z} = getInputValue(batch, channel, row1, col2);
      var x21: ${z} = getInputValue(batch, channel, row2, col1);
      var x22: ${z} = getInputValue(batch, channel, row2, col2);
      var dx1: ${z} = abs(row - ${z}(row1));
      var dx2: ${z} = abs(${z}(row2) - row);
      var dy1: ${z} = abs(col - ${z}(col1));
      var dy2: ${z} = abs(${z}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},$d=(i,c,b,S,E,I,k,$,B,z)=>{let G=b.length===2,[q,Z]=G?[0,1]:[2,3],se=i.type.value,le=me=>{let Te=me===q?"row":"col";return`
      fn ${Te}CubicInterpolation(input_indices: ${i.type.indices}, output_indices: ${c.type.indices}) -> ${se} {
        var output_index = ${c.indicesGet("output_indices",me)};
        var originalIdx: ${se} = getOriginalCoordinateFromResizedCoordinate(output_index, ${E[me]},
        ${S[me]}, ${b[me]}, ${I[me]}, ${I[me]} + ${b.length});
        var fractOriginalIdx: ${se} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${$} && (originalIdx < 0 || originalIdx > (${b[me]} - 1))) {
          return ${B};
        }
        var data: array<${se}, 4> = array<${se}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${Te}: ${se} = originalIdx + ${se}(i);
          if (${Te} < 0 || ${Te} >= ${b[me]}) {
            ${z?`coefs[i + 1] = 0.0;
                        continue;`:$?`return ${B};`:`${Te} = max(0, min(${Te}, ${b[me]} - 1));`};
          }
        var input_indices_copy: ${i.type.indices} = input_indices;
          ${i.indicesSet("input_indices_copy",me,`u32(${Te})`)};
          data[i + 1] = ${me===q?i.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${le(q)};
    ${le(Z)};
  fn getCubicInterpolationCoefs(s: ${se}) -> array<${se}, 4> {
    var absS = abs(s);
    var coeffs: array<${se}, 4> = array<${se}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${se} = 1.0 - absS;
    var twoMinusAbsS: ${se} = 2.0 - absS;
    var onePlusAbsS: ${se} = 1.0 + absS;
    coeffs[0] = ((${k} * onePlusAbsS - 5 * ${k}) * onePlusAbsS + 8 * ${k}) * onePlusAbsS - 4 * ${k};
    coeffs[1] = ((${k} + 2) * absS - (${k} + 3)) * absS * absS + 1;
    coeffs[2] = ((${k} + 2) * oneMinusAbsS - (${k} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${k} * twoMinusAbsS - 5 * ${k}) * twoMinusAbsS + 8 * ${k}) * twoMinusAbsS - 4 * ${k};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${se}, 4>, coefs: array<${se}, 4>) -> ${se} {
    var coefsSum: ${se} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${c.type.indices}) -> ${se} {
    var input_indices: ${i.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},Kh=(i,c,b,S,E)=>{let[I,k,$,B,z]=b.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],G=i.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${G} {
      var input_indices: ${i.type.indices};
      ${i.indicesSet("input_indices",k,`max(0, min(depth, ${b[k]} - 1))`)};
      ${i.indicesSet("input_indices",$,`max(0, min(height, ${b[$]} - 1))`)};
      ${i.indicesSet("input_indices",B,`max(0, min(width, ${b[B]} - 1))`)};
      ${Hh(i,z,I,3)}
      return ${i.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${c.type.indices}) -> ${G} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${G} = originalIndices[${k}];
      var height:${G} = originalIndices[${$}];
      var width:${G} = originalIndices[${B}];
      ${S?`if (depth < 0 || depth > (${b[k]} - 1) || height < 0 || height > (${b[$]} - 1) || width < 0 || (width > ${b[B]} - 1)) {
      return ${E};
        }`:""};

    depth = max(0, min(depth, ${b[k]} - 1));
      height = max(0, min(height, ${b[$]} - 1));
      width = max(0, min(width, ${b[B]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${b.length>3?`u32(originalIndices[${z}])`:"0"};
      var batch: u32 =  ${b.length>3?`u32(originalIndices[${I}])`:"0"};

      var x111: ${G} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${G} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${G} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${G} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${G} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${G} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${G} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${G} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${G} = abs(depth - ${G}(depth1));
      var dx2: ${G} = abs(${G}(depth2) - depth);
      var dy1: ${G} = abs(height - ${G}(height1));
      var dy2: ${G} = abs(${G}(height2) - height);
      var dz1: ${G} = abs(width - ${G}(width1));
      var dz2: ${G} = abs(${G}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},Xh=(i,c,b,S,E,I)=>{let k=i.dims,$=Vh(I,c.axes,k.length),B=Wh(k,S,E,c.axes),z=S.slice();S.length===0&&(z=k.map((_e,Ae)=>_e===0?1:B[Ae]/_e),c.keepAspectRatioPolicy!=="stretch"&&(B=Gh(k,z,c)));let G=Xt("output",i.dataType,B.length),q=dt("input",i.dataType,k.length),Z=st.size(B),se=k.length===B.length&&k.every((_e,Ae)=>_e===B[Ae]),le=c.coordinateTransformMode==="tf_crop_and_resize",me=c.extrapolationValue,Te=q.type.value,de=_e=>`
      ${se?"":`
      ${Uh(c.coordinateTransformMode,Te)};
      ${(()=>{switch(c.mode){case"nearest":return`
              ${hm(q,k)};
              ${El(c.nearestMode,b,Te)};
              ${Ld(q,G,k,B,z.length,$.length,le)};
              `;case"linear":return`
              ${Qr(G,k,B,z.length,$.length)};
              ${(()=>{if(k.length===2||k.length===4)return`${pm(q,G,k,le,me)}`;if(k.length===3||k.length===5)return`${Kh(q,G,k,le,me)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(k.length===2||k.length===4)return`${$d(q,G,k,B,z,$,c.cubicCoeffA,le,c.extrapolationValue,c.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${_e.registerUniform("output_size","u32").registerUniform("scales","f32",z.length).registerUniform("roi","f32",$.length).declareVariables(q,G)}
      ${_e.mainStart()}
        ${_e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${se?"output[global_idx] = input[global_idx];":`
        let output_indices = ${G.offsetToIndices("global_idx")};
        var input_indices: ${q.type.indices};
        ${(()=>{switch(c.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${q.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${c.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${k.length===2||k.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${c.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${c.cacheKey}|${b}|${z.length>0?c.mode==="cubic"?z:z.length:""}|${E.length>0?E:""}|${$.length>0?$:""}|${se}|${c.mode==="nearest"?k.length:k}`,inputDependencies:["rank"]},getShaderSource:de,getRunData:()=>({outputs:[{dims:B,dataType:i.dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:[{type:12,data:Z},{type:1,data:z},{type:1,data:$},...Gt(k,B)]})}},Yh=i=>{let c=i.customDataBuffer;return new Uint32Array(c,c.byteOffset,1)[0]},qh=(i,c)=>{let b=[],S=[],E=[],I=Yh(i);if(c.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Nh(i.inputs,c,I,b,S,E),i.compute(Xh(i.inputs[0],c,I,b,S,E),{inputs:[0]})},Rd=i=>{let c=i.antialias,b=i.axes,S=i.coordinateTransformMode,E=i.cubicCoeffA,I=i.excludeOutside!==0,k=i.extrapolationValue,$=i.keepAspectRatioPolicy,B=i.mode,z=i.nearestMode===""?"simple":i.nearestMode;return _r({antialias:c,axes:b,coordinateTransformMode:S,cubicCoeffA:E,excludeOutside:I,extrapolationValue:k,keepAspectRatioPolicy:$,mode:B,nearestMode:z})}}),mm,Jh,Zh,ep=s(()=>{rr(),ue(),br(),mm=i=>{if(!i||i.length<3)throw new Error("layerNorm requires at least 3 inputs.");let c=i[0],b=i[1],S=i[2];if(c.dataType!==b.dataType||c.dataType!==S.dataType)throw new Error("All inputs must have the same data type");if(c.dims.length!==3&&c.dims.length!==2)throw new Error("Input must be 2D or 3D");if(b.dims.length!==3&&b.dims.length!==2)throw new Error("Skip must be 2D or 3D");let E=c.dims[c.dims.length-1],I=c.dims[c.dims.length-2];if(b.dims[b.dims.length-1]!==E)throw new Error("Skip must have the same hidden size as input");if(b.dims[b.dims.length-2]!==I)throw new Error("Skip must have the same sequence length as input");if(S.dims.length!==1)throw new Error("Gamma must be 1D");if(S.dims[S.dims.length-1]!==E)throw new Error("Gamma must have the same hidden size as input");if(i.length>3){let k=i[3];if(k.dims.length!==1)throw new Error("Beta must be 1D");if(k.dims[k.dims.length-1]!==E)throw new Error("Beta must have the same hidden size as input")}if(i.length>4){let k=i[4];if(k.dims.length!==1)throw new Error("Bias must be 1D");if(k.dims[k.dims.length-1]!==E)throw new Error("Bias must have the same hidden size as input")}},Jh=(i,c,b,S)=>{let E=c.simplified,I=i[0].dims,k=st.size(I),$=I,B=k,z=I.slice(-1)[0],G=S?I.slice(0,-1).concat(1):[],q=!E&&i.length>3,Z=i.length>4,se=S&&b>1,le=S&&b>2,me=b>3,Te=64,de=cn(z),_e=[{type:12,data:B},{type:12,data:de},{type:12,data:z},{type:1,data:c.epsilon}],Ae=He=>{let lt=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],it=[dt("x",i[0].dataType,i[0].dims,de),dt("skip",i[1].dataType,i[1].dims,de),dt("gamma",i[2].dataType,i[2].dims,de)];q&&it.push(dt("beta",i[3].dataType,i[3].dims,de)),Z&&it.push(dt("bias",i[4].dataType,i[4].dims,de)),it.push(Xt("output",i[0].dataType,$,de)),se&&it.push(Xt("mean_output",1,G)),le&&it.push(Xt("inv_std_output",1,G)),me&&it.push(Xt("input_skip_bias_sum",i[0].dataType,$,de));let mt=Kr(i[0].dataType),Mt=Kr(1,de);return`

      ${He.registerUniforms(lt).declareVariables(...it)}
      var<workgroup> sum_shared : array<${Mt}, ${Te}>;
      var<workgroup> sum_squared_shared : array<${Mt}, ${Te}>;

      ${He.mainStart([Te,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${Te};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${Te};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${Te-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${Z?"bias[offset1d + i]":mt+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${me?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${ni(mt,de,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${Te};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Rs("sum",de)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Rs("square_sum",de)} / f32(uniforms.hidden_size) ${E?"":"- mean * mean"} + uniforms.epsilon);
        ${se?"mean_output[global_idx] = mean;":""}
        ${le?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${E?"":`- ${mt}(mean)`}) *
            ${mt}(inv_std_dev) * gamma[offset1d + i]
            ${q?"+ beta[offset1d + i]":""};
        }
      }`},Oe=[{dims:$,dataType:i[0].dataType}];return b>1&&Oe.push({dims:G,dataType:1}),b>2&&Oe.push({dims:G,dataType:1}),b>3&&Oe.push({dims:I,dataType:i[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${de};${se};${le};${me}`,inputDependencies:i.map((He,lt)=>"type")},getShaderSource:Ae,getRunData:()=>({outputs:Oe,dispatchGroup:{x:Math.ceil(B/z)},programUniforms:_e})}},Zh=(i,c)=>{mm(i.inputs);let b=[0];i.outputCount>1&&b.push(-3),i.outputCount>2&&b.push(-3),i.outputCount>3&&b.push(3),i.compute(Jh(i.inputs,c,i.outputCount,!1),{outputs:b})}}),tp,Pl,gm,Bd,rp,np,go,zd,_m=s(()=>{rr(),ue(),Br(),br(),tp=(i,c)=>{if(!i||i.length<1)throw new Error("too few inputs");if(c.axes.length!==0){if(c.axes.length!==c.starts.length||c.axes.length!==c.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(c.starts.length!==c.ends.length)throw new Error("starts and ends must have the same length");i.slice(1).forEach((b,S)=>{if(i[S+1].dataType!==6&&i[S+1].dataType!==7)throw new Error(`Input ${S} must be an array of int32 or int64`)})},Pl=(i,c)=>{let b=[];if(i.length>c)if(i[c].dataType===7)i[c].getBigInt64Array().forEach(S=>b.push(Number(S)));else if(i[c].dataType===6)i[c].getInt32Array().forEach(S=>b.push(Number(S)));else throw new Error(`Input ${c} must be an array of int32 or int64`);return b},gm=(i,c)=>{if(i.length>1){let b=Pl(i,1),S=Pl(i,2),E=Pl(i,3);return E.length===0&&(E=[...Array(i[0].dims.length).keys()]),_r({starts:b,ends:S,axes:E})}else return c},Bd=(i,c,b,S,E)=>{let I=i;return i<0&&(I+=b[S[c]]),E[c]<0?Math.max(0,Math.min(I,b[S[c]]-1)):Math.max(0,Math.min(I,b[S[c]]))},rp=(i,c,b)=>`fn calculateInputIndices(output_indices: ${c.type.indices}) -> ${i.type.indices} {
          var input_indices: ${i.type.indices};
          var carry = 0u;
          for (var i = ${b.length}; i >= 0; i--) {
            let input_shape_i = ${Yt("uniforms.input_shape","i",b.length)};
            let steps_i = ${Yt("uniforms.steps","i",b.length)};
            let signs_i = ${Yt("uniforms.signs","i",b.length)};
            let starts_i = ${Yt("uniforms.starts","i",b.length)};
            var output_index = ${c.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${i.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,np=(i,c)=>{let b=i[0].dims,S=st.size(b),E=c.axes.length>0?st.normalizeAxes(c.axes,b.length):[...Array(b.length).keys()],I=Pl(i,4);I.forEach(de=>de!==0||(()=>{throw new Error("step cannot be 0")})),I.length===0&&(I=Array(E.length).fill(1));let k=c.starts.map((de,_e)=>Bd(de,_e,b,E,I)),$=c.ends.map((de,_e)=>Bd(de,_e,b,E,I));if(E.length!==k.length||E.length!==$.length)throw new Error("start, ends and axes should have the same number of elements");if(E.length!==b.length)for(let de=0;de<b.length;++de)E.includes(de)||(k.splice(de,0,0),$.splice(de,0,b[de]),I.splice(de,0,1));let B=I.map(de=>Math.sign(de));I.forEach((de,_e,Ae)=>{if(de<0){let Oe=($[_e]-k[_e])/de,He=k[_e],lt=He+Oe*I[_e];k[_e]=lt,$[_e]=He,Ae[_e]=-de}});let z=b.slice(0);E.forEach((de,_e)=>{z[de]=Math.ceil(($[de]-k[de])/I[de])});let G={dims:z,dataType:i[0].dataType},q=Xt("output",i[0].dataType,z.length),Z=dt("input",i[0].dataType,i[0].dims.length),se=st.size(z),le=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:k.length},{name:"signs",type:"i32",length:B.length},{name:"steps",type:"u32",length:I.length}],me=[{type:12,data:se},{type:12,data:k},{type:6,data:B},{type:12,data:I},...Gt(i[0].dims,z)],Te=de=>`
      ${de.registerUniforms(le).declareVariables(Z,q)}
        ${rp(Z,q,b)}
        ${de.mainStart()}
          ${de.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${q.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${q.setByOffset("global_idx",Z.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${B.length}_${k.length}_${I.length}`,inputDependencies:["rank"]},getShaderSource:Te,getRunData:()=>({outputs:[G],dispatchGroup:{x:Math.ceil(S/64)},programUniforms:me})}},go=(i,c)=>{tp(i.inputs,c);let b=gm(i.inputs,c);i.compute(np(i.inputs,b),{inputs:[0]})},zd=i=>{let c=i.starts,b=i.ends,S=i.axes;return _r({starts:c,ends:b,axes:S})}}),ip,sp,op,ap,vm=s(()=>{rr(),ue(),Br(),zs(),br(),ip=i=>{if(!i||i.length!==1)throw new Error("Softmax op requires 1 input.")},sp=(i,c)=>{let b=i.inputs[0],S=b.dims,E=st.size(S),I=S.length,k=st.normalizeAxis(c.axis,I),$=k<S.length-1,B,z=[];$?(z=Array.from({length:I},(it,mt)=>mt),z[k]=I-1,z[I-1]=k,B=i.compute(ui(b,z),{inputs:[b],outputs:[-1]})[0]):B=b;let G=B.dims,q=G[I-1],Z=E/q,se=cn(q),le=q/se,me=64;Z===1&&(me=256);let Te=(it,mt)=>mt===4?`max(max(${it}.x, ${it}.y), max(${it}.z, ${it}.w))`:mt===2?`max(${it}.x, ${it}.y)`:mt===3?`max(max(${it}.x, ${it}.y), ${it}.z)`:it,de=dt("x",B.dataType,B.dims,se),_e=Xt("result",B.dataType,B.dims,se),Ae=de.type.value,Oe=Kr(B.dataType)==="f32"?`var threadMax = ${Ae}(-3.402823e+38f);`:`var threadMax = ${Ae}(-65504.0h);`,He=it=>`
      var<workgroup> rowMaxShared : ${Ae};
      var<workgroup> rowSumShared : ${Ae};
      var<workgroup> threadShared : array<${Ae}, ${me}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${Ae} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${Ae}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${it.registerUniform("packedCols","i32").declareVariables(de,_e)}
      ${it.mainStart(me)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${me};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${Oe}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${Ae}(${Te("threadShared[0]",se)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${Ae}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${Ae}(${Rs("threadShared[0]",se)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,lt=i.compute({name:"Softmax",shaderCache:{hint:`${se};${me}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:G,dataType:B.dataType}],dispatchGroup:{x:Z},programUniforms:[{type:6,data:le}]}),getShaderSource:He},{inputs:[B],outputs:[$?-1:0]})[0];$&&i.compute(ui(lt,z),{inputs:[lt]})},op=(i,c)=>{ip(i.inputs),sp(i,c)},ap=i=>_r({axis:i.axis})}),jd,ym,Nd,lp,Ol,wm=s(()=>{rr(),ue(),br(),jd=i=>Array.from(i.getBigInt64Array(),Number),ym=i=>{if(!i||i.length!==2)throw new Error("Tile requires 2 inputs.");if(i[0].dataType!==1&&i[0].dataType!==10&&i[0].dataType!==6&&i[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(i[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(i[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(jd(i[1]).length!==i[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},Nd=(i,c)=>{let b=[];for(let S=0;S<i.length;++S)b.push(i[S]*c[S]);return b},lp=(i,c)=>{let b=i[0].dims,S=c!=null?c:jd(i[1]),E=Nd(b,S),I=st.size(E),k=i[0].dataType,$=dt("input",k,b.length),B=Xt("output",k,E.length),z=G=>`
      const inputShape = ${$.indices(...b)};
      ${G.registerUniform("output_size","u32").declareVariables($,B)}
      ${G.mainStart()}
      ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${B.offsetToIndices("global_idx")};
      var input_indices: ${$.type.indices};
      for (var i = 0; i < ${b.length}; i++) {
        let input_dim_i = ${$.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${B.indicesGet("output_indices","i")}  % input_dim_i;

        ${$.indicesSet("input_indices","i","input_dim_value")}
      }
      ${B.setByOffset("global_idx",$.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${S}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:E,dataType:i[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...Gt(i[0].dims,E)]}),getShaderSource:z}},Ol=i=>{ym(i.inputs),i.compute(lp(i.inputs),{inputs:[0]})}}),up,cp,xm,bm=s(()=>{rr(),ue(),br(),up=(i,c,b,S,E)=>{let I=Xt("output_data",E,b.length,4),k=dt("a_data",c[1].dataType,c[1].dims.length,4),$=dt("b_data",c[2].dataType,c[2].dims.length,4),B=dt("c_data",c[0].dataType,c[0].dims.length,4),z,G=(q,Z,se)=>`select(${Z}, ${q}, ${se})`;if(!S)z=I.setByOffset("global_idx",G(k.getByOffset("global_idx"),$.getByOffset("global_idx"),B.getByOffset("global_idx")));else{let q=(Z,se,le="")=>{let me=`a_data[index_a${se}][component_a${se}]`,Te=`b_data[index_b${se}][component_b${se}]`,de=`bool(c_data[index_c${se}] & (0xffu << (component_c${se} * 8)))`;return`
            let output_indices${se} = ${I.offsetToIndices(`global_idx * 4u + ${se}u`)};
            let offset_a${se} = ${k.broadcastedIndicesToOffset(`output_indices${se}`,I)};
            let offset_b${se} = ${$.broadcastedIndicesToOffset(`output_indices${se}`,I)};
            let offset_c${se} = ${B.broadcastedIndicesToOffset(`output_indices${se}`,I)};
            let index_a${se} = offset_a${se} / 4u;
            let index_b${se} = offset_b${se} / 4u;
            let index_c${se} = offset_c${se} / 4u;
            let component_a${se} = offset_a${se} % 4u;
            let component_b${se} = offset_b${se} % 4u;
            let component_c${se} = offset_c${se} % 4u;
            ${Z}[${se}] = ${le}(${G(me,Te,de)});
          `};E===9?z=`
            var data = vec4<u32>(0);
            ${q("data",0,"u32")}
            ${q("data",1,"u32")}
            ${q("data",2,"u32")}
            ${q("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:z=`
            ${q("output_data[global_idx]",0)}
            ${q("output_data[global_idx]",1)}
            ${q("output_data[global_idx]",2)}
            ${q("output_data[global_idx]",3)}
          `}return`
        ${i.registerUniform("vec_size","u32").declareVariables(B,k,$,I)}
        ${i.mainStart()}
        ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${z}
      }`},cp=i=>{let c=i[1].dims,b=i[2].dims,S=i[0].dims,E=i[1].dataType,I=!(st.areEqual(c,b)&&st.areEqual(b,S)),k=c,$=st.size(c);if(I){let z=Fs.calcShape(Fs.calcShape(c,b,!1),S,!1);if(!z)throw new Error("Can't perform where op on the given tensors");k=z,$=st.size(k)}let B=Math.ceil($/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:z=>up(z,i,k,I,E),getRunData:()=>({outputs:[{dims:k,dataType:E}],dispatchGroup:{x:Math.ceil($/64/4)},programUniforms:[{type:12,data:B},...Gt(S,c,b,k)]})}},xm=i=>{i.compute(cp(i.inputs))}}),Ud,Mm=s(()=>{Zl(),eu(),Yp(),hc(),Kf(),qp(),Qp(),Zp(),Uc(),ba(),tm(),fh(),td(),yu(),id(),rm(),nm(),im(),sm(),Su(),Xo(),am(),xh(),Th(),lm(),_h(),Eh(),dm(),Od(),fm(),Dd(),Ht(),Qh(),ku(),ep(),_m(),vm(),vh(),wm(),zs(),Sc(),bm(),Ud=new Map([["Abs",[tu]],["Acos",[sl]],["Acosh",[pc]],["Add",[qf]],["ArgMax",[Dn,dn]],["ArgMin",[Zr,dn]],["Asin",[Lo]],["Asinh",[co]],["Atan",[ol]],["Atanh",[mc]],["Attention",[on]],["AveragePool",[Ts,ns]],["BatchNormalization",[zf]],["BiasAdd",[nl]],["BiasSplitGelu",[fo]],["Cast",[Nf,jf]],["Ceil",[ru]],["Clip",[al]],["Concat",[ih,Ui]],["Conv",[Rc,ya]],["ConvTranspose",[Nc,lh]],["Cos",[gc]],["Cosh",[_c]],["CumSum",[Wc,Gc]],["DepthToSpace",[ch,Xc]],["DequantizeLinear",[Fh,Lh]],["Div",[ps]],["Einsum",[Jc,dh]],["Elu",[vc,ll]],["Equal",[Qf]],["Erf",[ii]],["Exp",[yc]],["Expand",[ed]],["FastGelu",[Hs]],["Floor",[Uf]],["FusedConv",[Rc,ya]],["Gather",[wu,nd]],["GatherElements",[Ys,ad]],["GatherBlockQuantized",[Mu,Tu]],["GatherND",[bu,Ks]],["Gelu",[wc]],["Gemm",[Vi,vi]],["GlobalAveragePool",[Ph,Cd]],["GlobalMaxPool",[Ah,Ih]],["Greater",[eh]],["GreaterOrEqual",[th]],["GridSample",[Ho,pd]],["GroupQueryAttention",[Iu]],["HardSigmoid",[cl,Ro]],["InstanceNormalization",[Yn]],["LayerNormalization",[wh]],["LeakyRelu",[xc,ll]],["Less",[ms]],["LessOrEqual",[Pc]],["Log",[No]],["MatMul",[Mh]],["MatMulNBits",[Sh,xl]],["MaxPool",[Oh,kh]],["Mul",[Jf]],["MultiHeadAttention",[Pu,gh]],["Neg",[ma]],["Not",[nu]],["Pad",[bl]],["Pow",[Ec]],["QuickGelu",[Vr,ll]],["Range",[$h]],["Reciprocal",[ul]],["ReduceMin",[$f]],["ReduceMean",[Jl]],["ReduceMax",[Lf]],["ReduceSum",[Qe]],["ReduceProd",[uo]],["ReduceL1",[Df]],["ReduceL2",[Ff]],["ReduceLogSum",[ot]],["ReduceLogSumExp",[cc]],["ReduceSumSquare",[ht]],["Relu",[$o]],["Resize",[qh,Rd]],["RotaryEmbedding",[Ou]],["ScatterND",[zh,Bh]],["Sigmoid",[ga]],["Sin",[Bo]],["Sinh",[Vf]],["Slice",[go,zd]],["SkipLayerNormalization",[Zh]],["Split",[yl,om]],["Sqrt",[Wf]],["Softmax",[op,ap]],["Sub",[Zf]],["Tan",[bc]],["Tanh",[Gf]],["ThresholdedRelu",[ge,ll]],["Tile",[Ol]],["Transpose",[Kp,Vl]],["Where",[xm]]])}),dp,Tm=s(()=>{wt(),Vn(),br(),dp=class{constructor(i){this.backend=i,this.repo=new Map,this.attributesBound=!1}getArtifact(i){return this.repo.get(i)}setArtifact(i,c){this.repo.set(i,c)}run(i,c,b,S,E){we(i.programInfo.name);let I=this.backend.device,k=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let $=[];for(let z of c)$.push({binding:$.length,resource:{buffer:z.buffer}});for(let z of b)$.push({binding:$.length,resource:{buffer:z.buffer}});E&&$.push({binding:$.length,resource:E});let B=I.createBindGroup({layout:i.computePipeline.getBindGroupLayout(0),entries:$,label:i.programInfo.name});if(this.backend.sessionStatus==="capturing"){let z={kernelId:this.backend.currentKernelId,computePipeline:i.computePipeline,bindGroup:B,dispatchGroup:S};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(z)}k.setPipeline(i.computePipeline),k.setBindGroup(0,B),k.dispatchWorkgroups(...S),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Re(i.programInfo.name)}dispose(){}build(i,c){we(i.name);let b=this.backend.device,S=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(z=>{b.features.has(z.feature)&&S.push(`enable ${z.extension};`)});let E=ki(c,this.backend.device.limits),I=i.getShaderSource(E),k=`${S.join(`
`)}
${E.additionalImplementations}
${I}`,$=b.createShaderModule({code:k,label:i.name});xr("verbose",()=>`[WebGPU] ${i.name} shader code: ${k}`);let B=b.createComputePipeline({compute:{module:$,entryPoint:"main"},layout:"auto",label:i.name});return Re(i.name),{programInfo:i,computePipeline:B,uniformVariablesInfo:E.variablesInfo}}normalizeDispatchGroupSize(i){let c=typeof i=="number"?i:i.x,b=typeof i=="number"?1:i.y||1,S=typeof i=="number"?1:i.z||1,E=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(c<=E&&b<=E&&S<=E)return[c,b,S];let I=c*b*S,k=Math.ceil(Math.sqrt(I));if(k>E){if(k=Math.ceil(Math.cbrt(I)),k>E)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[k,k,k]}else return[k,k,1]}}}),fp={};d(fp,{WebGpuBackend:()=>gp});var hp,pp,mp,gp,Sm=s(()=>{wt(),rr(),Vn(),We(),En(),Mm(),Tm(),hp=(i,c)=>{if(c.length!==i.length)throw new Error(`inputDependencies length ${c.length} is not equal to inputTensors length ${i.length}.`);let b=[];for(let S=0;S<i.length;++S){let E=i[S].dataType;switch(c[S]){case"none":{b.push("");break}case"type":{b.push(`${E}`);break}case"rank":{let I=i[S].dims.length;b.push(`${E};${I}`);break}case"dims":{let I=i[S].dims.join(",");b.push(`${E};${I}`);break}default:throw new Error(`unsupported input dependency: ${c[S]}`)}}return b.join("|")},pp=(i,c,b)=>{var E,I,k;let S=i.name;return(E=i.shaderCache)!=null&&E.hint&&(S+="["+i.shaderCache.hint+"]"),S+=":"+b+`:${hp(c,(k=(I=i.shaderCache)==null?void 0:I.inputDependencies)!=null?k:new Array(c.length).fill("dims"))}`,S},mp=class{constructor(i){i&&(this.architecture=i.architecture,this.vendor=i.vendor)}isArchitecture(i){return this.architecture===i}isVendor(i){return this.vendor===i}},gp=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let i=this.kernelCustomData.get(this.currentKernelId);return i||(i={},this.kernelCustomData.set(this.currentKernelId,i)),i}async initialize(i,c){this.env=i;let b=[],S={requiredLimits:{maxComputeWorkgroupStorageSize:c.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:c.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:c.limits.maxStorageBufferBindingSize,maxBufferSize:c.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:c.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:c.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:c.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:c.limits.maxComputeWorkgroupSizeZ},requiredFeatures:b},E=I=>c.features.has(I)&&b.push(I)&&!0;E("chromium-experimental-timestamp-query-inside-passes")||E("timestamp-query"),E("shader-f16"),E("subgroups"),this.device=await c.requestDevice(S),this.adapterInfo=new mp(c.info||await c.requestAdapterInfo()),this.gpuDataManager=Hn(this),this.programManager=new dp(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Ut(i.logLevel,!!i.debug),this.device.onuncapturederror=I=>{I.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${I.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:c,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let i=this.getCommandEncoder(),c={};this.queryType==="at-passes"&&(c.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=i.beginComputePass(c)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;we(),this.endComputePass();let i;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),i=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(i,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,i,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&i.mapAsync(GPUMapMode.READ).then(()=>{var S;let c=new BigUint64Array(i.getMappedRange()),b=this.pendingQueries.get(i);for(let E=0;E<c.length/2;E++){let I=b[E],k=I.kernelId,$=this.kernels.get(k),B=$.kernelType,z=$.kernelName,G=I.programName,q=I.inputTensorViews,Z=I.outputTensorViews,se=c[E*2],le=c[E*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=se);let me=Number(se-this.queryTimeBase),Te=Number(le-this.queryTimeBase);if(!Number.isSafeInteger(me)||!Number.isSafeInteger(Te))throw new RangeError("incorrect timestamp range");if((S=this.env.webgpu.profiling)!=null&&S.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:q.map(de=>({dims:de.dims,dataType:Nr(de.dataType)})),outputsMetadata:Z.map(de=>({dims:de.dims,dataType:Nr(de.dataType)})),kernelId:k,kernelType:B,kernelName:z,programName:G,startTime:me,endTime:Te});else{let de="";q.forEach((Ae,Oe)=>{de+=`input[${Oe}]: [${Ae.dims}] | ${Nr(Ae.dataType)}, `});let _e="";Z.forEach((Ae,Oe)=>{_e+=`output[${Oe}]: [${Ae.dims}] | ${Nr(Ae.dataType)}, `}),console.log(`[profiling] kernel "${k}|${B}|${z}|${G}" ${de}${_e}execution time: ${Te-me} ns`)}Fe("GPU",`${G}::${se}::${le}`)}i.unmap(),this.pendingQueries.delete(i)}),Re()}run(i,c,b,S,E,I){we(i.name);let k=[];for(let _e=0;_e<c.length;++_e){let Ae=c[_e].data;if(Ae===0)continue;let Oe=this.gpuDataManager.get(Ae);if(!Oe)throw new Error(`no GPU data for input: ${Ae}`);k.push(Oe)}let{outputs:$,dispatchGroup:B,programUniforms:z}=i.getRunData(c),G=b.length===0?$.map((_e,Ae)=>Ae):b;if(G.length!==$.length)throw new Error(`Output size ${G.length} must be equal to ${$.length}.`);let q=[],Z=[];for(let _e=0;_e<$.length;++_e){if(!Number.isInteger(G[_e])||G[_e]<-3||G[_e]>=I)throw new Error(`Invalid output index: ${G[_e]}`);if(G[_e]===-3)continue;let Ae=G[_e]===-1,Oe=G[_e]===-2,He=Ae||Oe?E($[_e].dataType,$[_e].dims):S(G[_e],$[_e].dataType,$[_e].dims);if(q.push(He),He.data===0)continue;let lt=this.gpuDataManager.get(He.data);if(!lt)throw new Error(`no GPU data for output: ${He.data}`);if(Ae&&this.temporaryData.push(lt),Oe){let it=this.kernelPersistentData.get(this.currentKernelId);it||(it=[],this.kernelPersistentData.set(this.currentKernelId,it)),it.push(lt)}Z.push(lt)}if(k.length!==c.length||Z.length!==q.length){if(Z.length===0)return Re(i.name),q;throw new Error(`Program ${i.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let se;if(z){let _e=0,Ae=[];z.forEach(it=>{let mt=typeof it.data=="number"?[it.data]:it.data;if(mt.length===0)return;let Mt=it.type===10?2:4,At,$t;it.type===10?($t=mt.length>4?16:mt.length>2?8:mt.length*Mt,At=mt.length>4?16:Mt*mt.length):($t=mt.length<=2?mt.length*Mt:16,At=16),_e=Math.ceil(_e/$t)*$t,Ae.push(_e);let Vt=it.type===10?8:4;_e+=mt.length>4?Math.ceil(mt.length/Vt)*At:mt.length*Mt});let Oe=16;_e=Math.ceil(_e/Oe)*Oe;let He=new ArrayBuffer(_e);z.forEach((it,mt)=>{let Mt=Ae[mt],At=typeof it.data=="number"?[it.data]:it.data;if(it.type===6)new Int32Array(He,Mt,At.length).set(At);else if(it.type===12)new Uint32Array(He,Mt,At.length).set(At);else if(it.type===10)new Uint16Array(He,Mt,At.length).set(At);else if(it.type===1)new Float32Array(He,Mt,At.length).set(At);else throw new Error(`Unsupported uniform type: ${Nr(it.type)}`)});let lt=this.gpuDataManager.create(_e,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(lt.buffer,0,He,0,_e),this.gpuDataManager.release(lt.id),se={offset:0,size:_e,buffer:lt.buffer}}let le=this.programManager.normalizeDispatchGroupSize(B),me=le[1]===1&&le[2]===1,Te=pp(i,c,me),de=this.programManager.getArtifact(Te);if(de||(de=this.programManager.build(i,le),this.programManager.setArtifact(Te,de),xr("info",()=>`[artifact] key: ${Te}, programName: ${i.name}`)),z&&de.uniformVariablesInfo){if(z.length!==de.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${de.uniformVariablesInfo.length}, got ${z.length} in program "${de.programInfo.name}".`);for(let _e=0;_e<z.length;_e++){let Ae=z[_e],Oe=Ae.type,He=typeof Ae.data=="number"?1:Ae.data.length,[lt,it]=de.uniformVariablesInfo[_e];if(Oe!==lt||He!==it)throw new Error(`Uniform variable ${_e} mismatch: expect type ${lt} with size ${it}, got type ${Oe} with size ${He} in program "${de.programInfo.name}".`)}}if(xr("info",()=>`[ProgramManager] run "${i.name}" (key=${Te}) with ${le[0]}x${le[1]}x${le[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let _e={kernelId:this.currentKernelId,programName:de.programInfo.name,inputTensorViews:c,outputTensorViews:q};this.pendingKernels.push(_e),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(_e)}return this.programManager.run(de,k,Z,le,se),Re(i.name),q}upload(i,c){this.gpuDataManager.upload(i,c)}memcpy(i,c){this.gpuDataManager.memcpy(i,c)}async download(i,c){await this.gpuDataManager.download(i,c)}alloc(i){return this.gpuDataManager.create(i).id}free(i){return this.gpuDataManager.release(i)}createKernel(i,c,b,S){let E=Ud.get(i);if(!E)throw new Error(`kernel not implemented: ${i}`);let I={kernelType:i,kernelName:S,kernelEntry:E[0],attributes:[E[1],b]};this.kernels.set(c,I)}releaseKernel(i){let c=this.kernelPersistentData.get(i);if(c){for(let b of c)this.gpuDataManager.release(b.id);this.kernelPersistentData.delete(i)}this.kernelCustomData.delete(i),this.kernels.delete(i)}computeKernel(i,c,b){let S=this.kernels.get(i);if(!S)throw new Error(`kernel not created: ${i}`);let E=S.kernelType,I=S.kernelName,k=S.kernelEntry,$=S.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${E}] ${I}" is not allowed to be called recursively`);this.currentKernelId=i,$[0]&&($[1]=$[0]($[1]),$[0]=void 0),xr("info",()=>`[WebGPU] Start to run kernel "[${E}] ${I}"...`);let B=this.env.debug;this.temporaryData=[];try{return B&&this.device.pushErrorScope("validation"),k(c,$[1]),0}catch(z){return b.push(Promise.resolve(`[WebGPU] Kernel "[${E}] ${I}" failed. ${z}`)),1}finally{B&&b.push(this.device.popErrorScope().then(z=>z?`GPU validation error for kernel "[${E}] ${I}": ${z.message}`:null));for(let z of this.temporaryData)this.gpuDataManager.release(z.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(i,c,b,S){let E=this.sessionExternalDataMapping.get(i);E||(E=new Map,this.sessionExternalDataMapping.set(i,E));let I=E.get(c),k=this.gpuDataManager.registerExternalBuffer(b,S,I);return E.set(c,[k,b]),k}unregisterBuffers(i){let c=this.sessionExternalDataMapping.get(i);c&&(c.forEach(b=>this.gpuDataManager.unregisterExternalBuffer(b[0])),this.sessionExternalDataMapping.delete(i))}getBuffer(i){let c=this.gpuDataManager.get(i);if(!c)throw new Error(`no GPU data for buffer: ${i}`);return c.buffer}createDownloader(i,c,b){return async()=>{let S=await Lr(this,i,c);return De(S.buffer,b)}}writeTimestamp(i){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,i)}setQueryType(){var i;this.queryType="none",(((i=this.env.webgpu.profiling)==null?void 0:i.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){xr("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){xr("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){xr("info","replay"),this.sessionStatus="replaying";let i=this.capturedCommandList.get(this.currentSessionId),c=this.capturedPendingKernels.get(this.currentSessionId),b=i.length;this.pendingKernels=[];for(let S=0;S<b;S++){let E=this.getComputePassEncoder(),I=i[S];this.writeTimestamp(this.pendingDispatchNumber*2),E.setPipeline(I.computePipeline),E.setBindGroup(0,I.bindGroup),E.dispatchWorkgroups(...I.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(c[S]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(i){this.unregisterBuffers(i),this.capturedCommandList.has(i)&&this.capturedCommandList.delete(i),this.capturedPendingKernels.has(i)&&this.capturedPendingKernels.delete(i),this.gpuDataManager.onReleaseSession(i)}onRunStart(i){this.currentSessionId=i,this.setQueryType()}}}),_p={};d(_p,{init:()=>vp});var kl,Vd,vp,Cm=s(()=>{rr(),Vn(),ue(),Ls(),kl=class GS{constructor(c,b,S,E){this.module=c,this.dataType=b,this.data=S,this.dims=E}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let c=st.size(this.dims);return c===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,c)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let c=st.size(this.dims);return c===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,c)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let c=st.size(this.dims);return c===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,c)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let c=st.size(this.dims);return c===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,c)}reshape(c){if(st.size(c)!==st.size(this.dims))throw new Error("Invalid new shape");return new GS(this.module,this.dataType,this.data,c)}},Vd=class{constructor(i,c,b){this.module=i,this.backend=c,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=c.adapterInfo;let S=i.PTR_SIZE,E=b/i.PTR_SIZE,I=S===4?"i32":"i64";this.opKernelContext=Number(i.getValue(S*E++,I));let k=Number(i.getValue(S*E++,I));this.outputCount=Number(i.getValue(S*E++,I)),this.customDataOffset=Number(i.getValue(S*E++,"*")),this.customDataSize=Number(i.getValue(S*E++,I));let $=[];for(let B=0;B<k;B++){let z=Number(i.getValue(S*E++,I)),G=Number(i.getValue(S*E++,"*")),q=Number(i.getValue(S*E++,I)),Z=[];for(let se=0;se<q;se++)Z.push(Number(i.getValue(S*E++,I)));$.push(new kl(i,z,G,Z))}this.inputs=$}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(i,c){var k,$,B;let b=($=(k=c==null?void 0:c.inputs)==null?void 0:k.map(z=>typeof z=="number"?this.inputs[z]:z))!=null?$:this.inputs,S=(B=c==null?void 0:c.outputs)!=null?B:[],E=(z,G,q)=>new kl(this.module,G,this.output(z,q),q),I=(z,G)=>{let q=yn(z,G);if(!q)throw new Error(`Unsupported data type: ${z}`);let Z=q>0?this.backend.gpuDataManager.create(q).id:0;return new kl(this.module,z,Z,G)};return this.backend.run(i,b,S,E,I,this.outputCount)}output(i,c){let b=this.module.stackSave();try{let S=this.module.PTR_SIZE,E=S===4?"i32":"i64",I=this.module.stackAlloc((1+c.length)*S);this.module.setValue(I,c.length,E);for(let k=0;k<c.length;k++)this.module.setValue(I+S*(k+1),c[k],E);return this.module._JsepOutput(this.opKernelContext,i,I)}catch(S){throw new Error(`Failed to generate kernel's output[${i}] with dims [${c}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${S}`)}finally{this.module.stackRestore(b)}}},vp=async(i,c,b,S)=>{let E=c.jsepInit;if(!E)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(i==="webgpu"){let I=(Sm(),o(fp)).WebGpuBackend,k=new I;await k.initialize(b,S),E("webgpu",[k,$=>k.alloc(Number($)),$=>k.free($),($,B,z,G=!1)=>{if(G)xr("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number($)}, dst=${Number(B)}, size=${Number(z)}`),k.memcpy(Number($),Number(B));else{xr("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number($)}, gpuDataId=${Number(B)}, size=${Number(z)}`);let q=c.HEAPU8.subarray(Number($>>>0),Number($>>>0)+Number(z));k.upload(Number(B),q)}},async($,B,z)=>{xr("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${$}, dataOffset=${B}, size=${z}`),await k.download(Number($),()=>c.HEAPU8.subarray(Number(B)>>>0,Number(B+z)>>>0))},($,B,z)=>k.createKernel($,Number(B),z,c.UTF8ToString(c._JsepGetNodeName(Number(B)))),$=>k.releaseKernel($),($,B,z,G)=>{xr("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${z}, kernel=${$}, contextDataOffset=${B}`);let q=new Vd(c,k,Number(B));return k.computeKernel(Number($),q,G)},()=>k.captureBegin(),()=>k.captureEnd(),()=>k.replay()])}else{let I=new li(b);E("webnn",[I,()=>I.reserveTensorId(),k=>I.releaseTensorId(k),async(k,$,B,z,G)=>I.ensureTensor(k,$,B,z,G),(k,$)=>{I.uploadTensor(k,$)},async(k,$)=>I.downloadTensor(k,$)])}}}),yp,Wd,Da,_o,wp,Gd,Bu,Hd,Kd,Xd,Yd,qd,Qd,xp=s(()=>{Sn(),Gr(),rr(),nr(),qt(),oo(),yp=(i,c)=>{pt()._OrtInit(i,c)!==0&&Nt("Can't initialize onnxruntime.")},Wd=async i=>{yp(i.wasm.numThreads,sn(i.logLevel))},Da=async(i,c)=>{var b,S;(S=(b=pt()).asyncInit)==null||S.call(b);{let E=(Cm(),o(_p)).init;if(c==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let I=i.webgpu.adapter;if(I){if(typeof I.limits!="object"||typeof I.features!="object"||typeof I.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let k=i.webgpu.powerPreference;if(k!==void 0&&k!=="low-power"&&k!=="high-performance")throw new Error(`Invalid powerPreference setting: "${k}"`);let $=i.webgpu.forceFallbackAdapter;if($!==void 0&&typeof $!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${$}"`);if(I=await navigator.gpu.requestAdapter({powerPreference:k,forceFallbackAdapter:$}),!I)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await E("webgpu",pt(),i,I)}if(c==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await E("webnn",pt(),i)}}},_o=new Map,wp=i=>{let c=pt(),b=c.stackSave();try{let S=c.PTR_SIZE,E=c.stackAlloc(2*S);c._OrtGetInputOutputCount(i,E,E+S)!==0&&Nt("Can't get session input/output count.");let I=S===4?"i32":"i64";return[Number(c.getValue(E,I)),Number(c.getValue(E+S,I))]}finally{c.stackRestore(b)}},Gd=(i,c)=>{let b=pt(),S=b.stackSave(),E=0;try{let I=b.PTR_SIZE,k=b.stackAlloc(2*I);b._OrtGetInputOutputMetadata(i,c,k,k+I)!==0&&Nt("Can't get session input/output metadata.");let $=Number(b.getValue(k,"*"));E=Number(b.getValue(k+I,"*"));let B=b.HEAP32[E/4];if(B===0)return[$,0];let z=b.HEAPU32[E/4+1],G=[];for(let q=0;q<z;q++){let Z=Number(b.getValue(E+8+q*I,"*"));G.push(Z!==0?b.UTF8ToString(Z):Number(b.getValue(E+8+(q+z)*I,"*")))}return[$,B,G]}finally{b.stackRestore(S),E!==0&&b._OrtFree(E)}},Bu=i=>{let c=pt(),b=c._malloc(i.byteLength);if(b===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${i.byteLength}.`);return c.HEAPU8.set(i,b),[b,i.byteLength]},Hd=async(i,c)=>{var q,Z,se,le,me,Te;let b,S,E=pt();Array.isArray(i)?[b,S]=i:i.buffer===E.HEAPU8.buffer?[b,S]=[i.byteOffset,i.byteLength]:[b,S]=Bu(i);let I=0,k=0,$=0,B=[],z=[],G=[];try{if([k,B]=await Ar(c),(c==null?void 0:c.externalData)&&E.mountExternalData){let At=[];for(let $t of c.externalData){let Vt=typeof $t=="string"?$t:$t.path;At.push(Ds(typeof $t=="string"?$t:$t.data).then(Kt=>{E.mountExternalData(Vt,Kt)}))}await Promise.all(At)}for(let At of(q=c==null?void 0:c.executionProviders)!=null?q:[])if((typeof At=="string"?At:At.name)==="webnn"){if(E.shouldTransferToMLTensor=!1,typeof At!="string"){let $t=At,Vt=$t==null?void 0:$t.context,Kt=$t==null?void 0:$t.gpuDevice,Mr=$t==null?void 0:$t.deviceType,tr=$t==null?void 0:$t.powerPreference;Vt?E.currentContext=Vt:Kt?E.currentContext=await E.webnnCreateMLContext(Kt):E.currentContext=await E.webnnCreateMLContext({deviceType:Mr,powerPreference:tr})}else E.currentContext=await E.webnnCreateMLContext();break}I=await E._OrtCreateSession(b,S,k),(Z=E.webgpuOnCreateSession)==null||Z.call(E,I),I===0&&Nt("Can't create a session."),(se=E.jsepOnCreateSession)==null||se.call(E),E.currentContext&&(E.webnnRegisterMLContext(I,E.currentContext),E.currentContext=void 0,E.shouldTransferToMLTensor=!0);let[de,_e]=wp(I),Ae=!!(c!=null&&c.enableGraphCapture),Oe=[],He=[],lt=[],it=[],mt=[];for(let At=0;At<de;At++){let[$t,Vt,Kt]=Gd(I,At);$t===0&&Nt("Can't get an input name."),z.push($t);let Mr=E.UTF8ToString($t);Oe.push(Mr),lt.push(Vt===0?{name:Mr,isTensor:!1}:{name:Mr,isTensor:!0,type:Nr(Vt),shape:Kt})}for(let At=0;At<_e;At++){let[$t,Vt,Kt]=Gd(I,At+de);$t===0&&Nt("Can't get an output name."),G.push($t);let Mr=E.UTF8ToString($t);He.push(Mr),it.push(Vt===0?{name:Mr,isTensor:!1}:{name:Mr,isTensor:!0,type:Nr(Vt),shape:Kt});{if(Ae&&(c==null?void 0:c.preferredOutputLocation)===void 0){mt.push("gpu-buffer");continue}let tr=typeof(c==null?void 0:c.preferredOutputLocation)=="string"?c.preferredOutputLocation:(me=(le=c==null?void 0:c.preferredOutputLocation)==null?void 0:le[Mr])!=null?me:"cpu";if(tr!=="cpu"&&tr!=="cpu-pinned"&&tr!=="gpu-buffer"&&tr!=="ml-tensor")throw new Error(`Not supported preferred output location: ${tr}.`);if(Ae&&tr!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${tr}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);mt.push(tr)}}let Mt=null;return mt.some(At=>At==="gpu-buffer"||At==="ml-tensor")&&($=E._OrtCreateBinding(I),$===0&&Nt("Can't create IO binding."),Mt={handle:$,outputPreferredLocations:mt,outputPreferredLocationsEncoded:mt.map(At=>Mi(At))}),_o.set(I,[I,z,G,Mt,Ae,!1]),[I,Oe,He,lt,it]}catch(de){throw z.forEach(_e=>E._OrtFree(_e)),G.forEach(_e=>E._OrtFree(_e)),$!==0&&E._OrtReleaseBinding($)!==0&&Nt("Can't release IO binding."),I!==0&&E._OrtReleaseSession(I)!==0&&Nt("Can't release session."),de}finally{E._free(b),k!==0&&E._OrtReleaseSessionOptions(k)!==0&&Nt("Can't release session options."),B.forEach(de=>E._free(de)),(Te=E.unmountExternalData)==null||Te.call(E)}},Kd=i=>{var B,z,G;let c=pt(),b=_o.get(i);if(!b)throw new Error(`cannot release session. invalid session id: ${i}`);let[S,E,I,k,$]=b;k&&($&&c._OrtClearBoundOutputs(k.handle)!==0&&Nt("Can't clear bound outputs."),c._OrtReleaseBinding(k.handle)!==0&&Nt("Can't release IO binding.")),(B=c.jsepOnReleaseSession)==null||B.call(c,i),(z=c.webnnOnReleaseSession)==null||z.call(c,i),(G=c.webgpuOnReleaseSession)==null||G.call(c,i),E.forEach(q=>c._OrtFree(q)),I.forEach(q=>c._OrtFree(q)),c._OrtReleaseSession(S)!==0&&Nt("Can't release session."),_o.delete(i)},Xd=async(i,c,b,S,E,I,k=!1)=>{if(!i){c.push(0);return}let $=pt(),B=$.PTR_SIZE,z=i[0],G=i[1],q=i[3],Z=q,se,le;if(z==="string"&&(q==="gpu-buffer"||q==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(k&&q!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${I} when enableGraphCapture is true.`);if(q==="gpu-buffer"){let de=i[2].gpuBuffer;le=yn(nn(z),G);{let _e=$.jsepRegisterBuffer;if(!_e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');se=_e(S,I,de,le)}}else if(q==="ml-tensor"){let de=i[2].mlTensor;le=yn(nn(z),G);let _e=$.webnnRegisterMLTensor;if(!_e)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');se=_e(S,de,nn(z),G)}else{let de=i[2];if(Array.isArray(de)){le=B*de.length,se=$._malloc(le),b.push(se);for(let _e=0;_e<de.length;_e++){if(typeof de[_e]!="string")throw new TypeError(`tensor data at index ${_e} is not a string`);$.setValue(se+_e*B,vr(de[_e],b),"*")}}else{let _e=$.webnnIsGraphInput;if(z!=="string"&&_e){let Ae=$.UTF8ToString(E);if(_e(S,Ae)){let Oe=nn(z);le=yn(Oe,G),Z="ml-tensor";let He=$.webnnCreateTemporaryTensor,lt=$.webnnUploadTensor;if(!He||!lt)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let it=await He(S,Oe,G);lt(it,new Uint8Array(de.buffer,de.byteOffset,de.byteLength)),se=it}else le=de.byteLength,se=$._malloc(le),b.push(se),$.HEAPU8.set(new Uint8Array(de.buffer,de.byteOffset,le),se)}else le=de.byteLength,se=$._malloc(le),b.push(se),$.HEAPU8.set(new Uint8Array(de.buffer,de.byteOffset,le),se)}}let me=$.stackSave(),Te=$.stackAlloc(4*G.length);try{G.forEach((_e,Ae)=>$.setValue(Te+Ae*B,_e,B===4?"i32":"i64"));let de=$._OrtCreateTensor(nn(z),se,le,Te,G.length,Mi(Z));de===0&&Nt(`Can't create tensor for input/output. session=${S}, index=${I}.`),c.push(de)}finally{$.stackRestore(me)}},Yd=async(i,c,b,S,E,I)=>{var $t,Vt,Kt,Mr;let k=pt(),$=k.PTR_SIZE,B=_o.get(i);if(!B)throw new Error(`cannot run inference. invalid session id: ${i}`);let z=B[0],G=B[1],q=B[2],Z=B[3],se=B[4],le=B[5],me=c.length,Te=S.length,de=0,_e=[],Ae=[],Oe=[],He=[],lt=k.stackSave(),it=k.stackAlloc(me*$),mt=k.stackAlloc(me*$),Mt=k.stackAlloc(Te*$),At=k.stackAlloc(Te*$);try{[de,_e]=jr(I);for(let Lt=0;Lt<me;Lt++)await Xd(b[Lt],Ae,He,i,G[c[Lt]],c[Lt],se);for(let Lt=0;Lt<Te;Lt++)await Xd(E[Lt],Oe,He,i,q[S[Lt]],me+S[Lt],se);for(let Lt=0;Lt<me;Lt++)k.setValue(it+Lt*$,Ae[Lt],"*"),k.setValue(mt+Lt*$,G[c[Lt]],"*");for(let Lt=0;Lt<Te;Lt++)k.setValue(Mt+Lt*$,Oe[Lt],"*"),k.setValue(At+Lt*$,q[S[Lt]],"*");if(Z&&!le){let{handle:Lt,outputPreferredLocations:$r,outputPreferredLocationsEncoded:ar}=Z;if(G.length!==me)throw new Error(`input count from feeds (${me}) is expected to be always equal to model's input count (${G.length}).`);for(let Cr=0;Cr<me;Cr++){let St=c[Cr];await k._OrtBindInput(Lt,G[St],Ae[Cr])!==0&&Nt(`Can't bind input[${Cr}] for session=${i}.`)}for(let Cr=0;Cr<Te;Cr++){let St=S[Cr];($t=E[Cr])!=null&&$t[3]?k._OrtBindOutput(Lt,q[St],Oe[Cr],0)!==0&&Nt(`Can't bind pre-allocated output[${Cr}] for session=${i}.`):k._OrtBindOutput(Lt,q[St],0,ar[St])!==0&&Nt(`Can't bind output[${Cr}] to ${$r[Cr]} for session=${i}.`)}_o.set(i,[z,G,q,Z,se,!0])}(Vt=k.jsepOnRunStart)==null||Vt.call(k,z),(Kt=k.webnnOnRunStart)==null||Kt.call(k,z);let tr;Z?tr=await k._OrtRunWithBinding(z,Z.handle,Te,Mt,de):tr=await k._OrtRun(z,mt,it,me,At,Te,Mt,de),tr!==0&&Nt("failed to call OrtRun().");let Jt=[];for(let Lt=0;Lt<Te;Lt++){let $r=Number(k.getValue(Mt+Lt*$,"*"));if($r===Oe[Lt]){Jt.push(E[Lt]);continue}let ar=k.stackSave(),Cr=k.stackAlloc(4*$),St=!1,Rt,gr=0;try{k._OrtGetTensorData($r,Cr,Cr+$,Cr+2*$,Cr+3*$)!==0&&Nt(`Can't access output tensor data on index ${Lt}.`);let an=$===4?"i32":"i64",Ki=Number(k.getValue(Cr,an));gr=k.getValue(Cr+$,"*");let qs=k.getValue(Cr+$*2,"*"),zr=Number(k.getValue(Cr+$*3,an)),Il=[];for(let $i=0;$i<zr;$i++)Il.push(Number(k.getValue(qs+$i*$,an)));k._OrtFree(qs)!==0&&Nt("Can't free memory for tensor dims.");let wi=Il.reduce(($i,Or)=>$i*Or,1);Rt=Nr(Ki);let Tp=Z==null?void 0:Z.outputPreferredLocations[S[Lt]];if(Rt==="string"){if(Tp==="gpu-buffer"||Tp==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let $i=[];for(let Or=0;Or<wi;Or++){let zu=k.getValue(gr+Or*$,"*"),m_=k.getValue(gr+(Or+1)*$,"*"),Em=Or===wi-1?void 0:m_-zu;$i.push(k.UTF8ToString(zu,Em))}Jt.push([Rt,Il,$i,"cpu"])}else if(Tp==="gpu-buffer"&&wi>0){let $i=k.jsepGetBuffer;if(!$i)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Or=$i(gr),zu=yn(Ki,wi);if(zu===void 0||!ei(Rt))throw new Error(`Unsupported data type: ${Rt}`);St=!0,Jt.push([Rt,Il,{gpuBuffer:Or,download:k.jsepCreateDownloader(Or,zu,Rt),dispose:()=>{k._OrtReleaseTensor($r)!==0&&Nt("Can't release tensor.")}},"gpu-buffer"])}else if(Tp==="ml-tensor"&&wi>0){let $i=k.webnnEnsureTensor,Or=k.webnnIsInt64Supported;if(!$i||!Or)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(yn(Ki,wi)===void 0||!ti(Rt))throw new Error(`Unsupported data type: ${Rt}`);if(Rt==="int64"&&!Or(i))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let zu=await $i(i,gr,Ki,Il,!1);St=!0,Jt.push([Rt,Il,{mlTensor:zu,download:k.webnnCreateMLTensorDownloader(gr,Rt),dispose:()=>{k.webnnReleaseTensorId(gr),k._OrtReleaseTensor($r)}},"ml-tensor"])}else{let $i=pi(Rt),Or=new $i(wi);new Uint8Array(Or.buffer,Or.byteOffset,Or.byteLength).set(k.HEAPU8.subarray(gr,gr+Or.byteLength)),Jt.push([Rt,Il,Or,"cpu"])}}finally{k.stackRestore(ar),Rt==="string"&&gr&&k._free(gr),St||k._OrtReleaseTensor($r),(Mr=k.webnnOnRunEnd)==null||Mr.call(k,z)}}return Z&&!se&&(k._OrtClearBoundOutputs(Z.handle)!==0&&Nt("Can't clear bound outputs."),_o.set(i,[z,G,q,Z,se,!1])),Jt}finally{k.stackRestore(lt),Ae.forEach(tr=>k._OrtReleaseTensor(tr)),Oe.forEach(tr=>k._OrtReleaseTensor(tr)),He.forEach(tr=>k._free(tr)),de!==0&&k._OrtReleaseRunOptions(de),_e.forEach(tr=>k._free(tr))}},qd=i=>{let c=pt(),b=_o.get(i);if(!b)throw new Error("invalid session id");let S=b[0],E=c._OrtEndProfiling(S);E===0&&Nt("Can't get an profile file name."),c._OrtFree(E)},Qd=i=>{let c=[];for(let b of i){let S=b[2];!Array.isArray(S)&&"buffer"in S&&c.push(S.buffer)}return c}}),is,Ei,Fa,mr,Qo,Tn,On,Fn,Li,La,bp,Mp,R,V,oe,Ee,tt,Ze,ut=s(()=>{wt(),xp(),nr(),so(),is=()=>!!L.wasm.proxy&&typeof document<"u",Fa=!1,mr=!1,Qo=!1,Fn=new Map,Li=(i,c)=>{let b=Fn.get(i);b?b.push(c):Fn.set(i,[c])},La=()=>{if(Fa||!mr||Qo||!Ei)throw new Error("worker not ready")},bp=i=>{switch(i.data.type){case"init-wasm":Fa=!1,i.data.err?(Qo=!0,On[1](i.data.err)):(mr=!0,On[0]()),Tn&&(URL.revokeObjectURL(Tn),Tn=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let c=Fn.get(i.data.type);i.data.err?c.shift()[1](i.data.err):c.shift()[0](i.data.out);break}}},Mp=async()=>{if(!mr){if(Fa)throw new Error("multiple calls to 'initWasm()' detected.");if(Qo)throw new Error("previous call to 'initWasm()' failed.");if(Fa=!0,is())return new Promise((i,c)=>{Ei==null||Ei.terminate(),oa().then(([b,S])=>{try{Ei=S,Ei.onerror=I=>c(I),Ei.onmessage=bp,On=[i,c];let E={type:"init-wasm",in:L};if(!E.in.wasm.wasmPaths&&b){let I=Zn();I&&(E.in.wasm.wasmPaths=I)}Ei.postMessage(E),Tn=b}catch(E){c(E)}},c)});try{await ft(L.wasm),await Wd(L),mr=!0}catch(i){throw Qo=!0,i}finally{Fa=!1}}},R=async i=>{if(is())return La(),new Promise((c,b)=>{Li("init-ep",[c,b]);let S={type:"init-ep",in:{epName:i,env:L}};Ei.postMessage(S)});await Da(L,i)},V=async i=>is()?(La(),new Promise((c,b)=>{Li("copy-from",[c,b]);let S={type:"copy-from",in:{buffer:i}};Ei.postMessage(S,[i.buffer])})):Bu(i),oe=async(i,c)=>{if(is()){if(c!=null&&c.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return La(),new Promise((b,S)=>{Li("create",[b,S]);let E={type:"create",in:{model:i,options:{...c}}},I=[];i instanceof Uint8Array&&I.push(i.buffer),Ei.postMessage(E,I)})}else return Hd(i,c)},Ee=async i=>{if(is())return La(),new Promise((c,b)=>{Li("release",[c,b]);let S={type:"release",in:i};Ei.postMessage(S)});Kd(i)},tt=async(i,c,b,S,E,I)=>{if(is()){if(b.some(k=>k[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(E.some(k=>k))throw new Error("pre-allocated output tensor is not supported for proxy.");return La(),new Promise((k,$)=>{Li("run",[k,$]);let B=b,z={type:"run",in:{sessionId:i,inputIndices:c,inputs:B,outputIndices:S,options:I}};Ei.postMessage(z,Qd(B))})}else return Yd(i,c,b,S,E,I)},Ze=async i=>{if(is())return La(),new Promise((c,b)=>{Li("end-profiling",[c,b]);let S={type:"end-profiling",in:i};Ei.postMessage(S)});qd(i)}}),xt,Pt,Bt,Zt=s(()=>{wt(),ut(),rr(),bt(),oo(),xt=(i,c)=>{switch(i.location){case"cpu":return[i.type,i.dims,i.data,"cpu"];case"gpu-buffer":return[i.type,i.dims,{gpuBuffer:i.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[i.type,i.dims,{mlTensor:i.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${i.location} for ${c()}`)}},Pt=i=>{switch(i[3]){case"cpu":return new Ie(i[0],i[2],i[1]);case"gpu-buffer":{let c=i[0];if(!ei(c))throw new Error(`not supported data type: ${c} for deserializing GPU tensor`);let{gpuBuffer:b,download:S,dispose:E}=i[2];return Ie.fromGpuBuffer(b,{dataType:c,dims:i[1],download:S,dispose:E})}case"ml-tensor":{let c=i[0];if(!ti(c))throw new Error(`not supported data type: ${c} for deserializing MLTensor tensor`);let{mlTensor:b,download:S,dispose:E}=i[2];return Ie.fromMLTensor(b,{dataType:c,dims:i[1],download:S,dispose:E})}default:throw new Error(`invalid data location: ${i[3]}`)}},Bt=class{async fetchModelAndCopyToWasmMemory(i){return V(await Ds(i))}async loadModel(i,c){we();let b;typeof i=="string"?b=await this.fetchModelAndCopyToWasmMemory(i):b=i,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await oe(b,c),Re()}async dispose(){return Ee(this.sessionId)}async run(i,c,b){var q;we();let S=[],E=[];Object.entries(i).forEach(Z=>{let se=Z[0],le=Z[1],me=this.inputNames.indexOf(se);if(me===-1)throw new Error(`invalid input '${se}'`);S.push(le),E.push(me)});let I=[],k=[];Object.entries(c).forEach(Z=>{let se=Z[0],le=Z[1],me=this.outputNames.indexOf(se);if(me===-1)throw new Error(`invalid output '${se}'`);I.push(le),k.push(me)});let $=S.map((Z,se)=>xt(Z,()=>`input "${this.inputNames[E[se]]}"`)),B=I.map((Z,se)=>Z?xt(Z,()=>`output "${this.outputNames[k[se]]}"`):null),z=await tt(this.sessionId,E,$,k,B,b),G={};for(let Z=0;Z<z.length;Z++)G[this.outputNames[k[Z]]]=(q=I[Z])!=null?q:Pt(z[Z]);return Re(),G}startProfiling(){}endProfiling(){Ze(this.sessionId)}}}),Er={};d(Er,{OnnxruntimeWebAssemblyBackend:()=>Pr,initializeFlags:()=>hr,wasmBackend:()=>sr});var hr,Pr,sr,Sr=s(()=>{wt(),ut(),Zt(),hr=()=>{(typeof L.wasm.initTimeout!="number"||L.wasm.initTimeout<0)&&(L.wasm.initTimeout=0);let i=L.wasm.simd;if(typeof i!="boolean"&&i!==void 0&&i!=="fixed"&&i!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${i}". Reset it to \`false\` and ignore SIMD feature checking.`),L.wasm.simd=!1),typeof L.wasm.proxy!="boolean"&&(L.wasm.proxy=!1),typeof L.wasm.trace!="boolean"&&(L.wasm.trace=!1),typeof L.wasm.numThreads!="number"||!Number.isInteger(L.wasm.numThreads)||L.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)L.wasm.numThreads=1;else{let c=typeof navigator>"u"?f("node:os").cpus().length:navigator.hardwareConcurrency;L.wasm.numThreads=Math.min(4,Math.ceil((c||1)/2))}},Pr=class{async init(i){hr(),await Mp(),await R(i)}async createInferenceSessionHandler(i,c){let b=new Bt;return await b.loadModel(i,c),b}},sr=new Pr}),Qt={};d(Qt,{InferenceSession:()=>ze,TRACE:()=>Fe,TRACE_FUNC_BEGIN:()=>we,TRACE_FUNC_END:()=>Re,Tensor:()=>Ie,default:()=>mn,env:()=>L,registerBackend:()=>p}),wt(),wt(),wt();var Dr="1.22.0-dev.20250409-89f8206ba4",mn=ct;{let i=(Sr(),o(Er)).wasmBackend;p("webgpu",i,5),p("webnn",i,5),p("cpu",i,10),p("wasm",i,10)}return Object.defineProperty(L.versions,"web",{value:Dr,enumerable:!0}),o(Qt)})();/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */t.exports=r})(v1);const GA=pw(v1.exports),HA=NE({__proto__:null,default:GA},[v1.exports]);var KA={"onnxruntime-common":t=>{t.exports=NA},"onnxruntime-web":t=>{t.exports=HA},"?2ce3":()=>{},"?7992":()=>{},"?5af5":()=>{},"?2b25":()=>{},"?db59":()=>{},"?383f":()=>{},"?fa4b":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(t,e,r)=>{r.r(e),r.d(e,{Environment:()=>Ct,Interpreter:()=>jt,Template:()=>As,parse:()=>be,tokenize:()=>m});var n=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),a=class{constructor(H,Pe){this.value=H,this.type=Pe}};function h(H){return/\w/.test(H)}function x(H){return/[0-9]/.test(H)}var f=[["{%",n.OpenStatement],["%}",n.CloseStatement],["{{",n.OpenExpression],["}}",n.CloseExpression],["(",n.OpenParen],[")",n.CloseParen],["{",n.OpenCurlyBracket],["}",n.CloseCurlyBracket],["[",n.OpenSquareBracket],["]",n.CloseSquareBracket],[",",n.Comma],[".",n.Dot],[":",n.Colon],["|",n.Pipe],["<=",n.ComparisonBinaryOperator],[">=",n.ComparisonBinaryOperator],["==",n.ComparisonBinaryOperator],["!=",n.ComparisonBinaryOperator],["<",n.ComparisonBinaryOperator],[">",n.ComparisonBinaryOperator],["+",n.AdditiveBinaryOperator],["-",n.AdditiveBinaryOperator],["~",n.AdditiveBinaryOperator],["*",n.MultiplicativeBinaryOperator],["/",n.MultiplicativeBinaryOperator],["%",n.MultiplicativeBinaryOperator],["=",n.Equals]],s=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function d(H,Pe={}){return H.endsWith(`
`)&&(H=H.slice(0,-1)),Pe.lstrip_blocks&&(H=H.replace(/^[ \t]*({[#%-])/gm,"$1")),Pe.trim_blocks&&(H=H.replace(/([#%-]})\n/g,"$1")),H.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function m(H,Pe={}){var nr,vr;const fe=[],Le=d(H,Pe);let Xe=0,ft=0;const pt=or=>{let Nt="";for(;or(Le[Xe]);){if(Le[Xe]==="\\"){if(++Xe,Xe>=Le.length)throw new SyntaxError("Unexpected end of input");const qt=Le[Xe++],jr=s.get(qt);if(jr===void 0)throw new SyntaxError(`Unexpected escaped character: ${qt}`);Nt+=jr;continue}if(Nt+=Le[Xe++],Xe>=Le.length)throw new SyntaxError("Unexpected end of input")}return Nt};e:for(;Xe<Le.length;){const or=(nr=fe.at(-1))==null?void 0:nr.type;if(or===void 0||or===n.CloseStatement||or===n.CloseExpression||or===n.Comment){let qt="";for(;Xe<Le.length&&!(Le[Xe]==="{"&&(Le[Xe+1]==="%"||Le[Xe+1]==="{"||Le[Xe+1]==="#"));)qt+=Le[Xe++];if(qt.length>0){fe.push(new a(qt,n.Text));continue}}if(Le[Xe]==="{"&&Le[Xe+1]==="#"){Xe+=2;let qt="";for(;Le[Xe]!=="#"||Le[Xe+1]!=="}";){if(Xe+2>=Le.length)throw new SyntaxError("Missing end of comment tag");qt+=Le[Xe++]}fe.push(new a(qt,n.Comment)),Xe+=2;continue}pt(qt=>/\s/.test(qt));const Nt=Le[Xe];if(Nt==="-"||Nt==="+"){const qt=(vr=fe.at(-1))==null?void 0:vr.type;if(qt===n.Text||qt===void 0)throw new SyntaxError(`Unexpected character: ${Nt}`);switch(qt){case n.Identifier:case n.NumericLiteral:case n.StringLiteral:case n.CloseParen:case n.CloseSquareBracket:break;default:{++Xe;const jr=pt(x);fe.push(new a(`${Nt}${jr}`,jr.length>0?n.NumericLiteral:n.UnaryOperator));continue}}}for(const[qt,jr]of f){if(qt==="}}"&&ft>0)continue;if(Le.slice(Xe,Xe+qt.length)===qt){fe.push(new a(qt,jr)),jr===n.OpenExpression?ft=0:jr===n.OpenCurlyBracket?++ft:jr===n.CloseCurlyBracket&&--ft,Xe+=qt.length;continue e}}if(Nt==="'"||Nt==='"'){++Xe;const qt=pt(jr=>jr!==Nt);fe.push(new a(qt,n.StringLiteral)),++Xe;continue}if(x(Nt)){let qt=pt(x);if(Le[Xe]==="."&&x(Le[Xe+1])){++Xe;const jr=pt(x);qt=`${qt}.${jr}`}fe.push(new a(qt,n.NumericLiteral));continue}if(h(Nt)){const qt=pt(h);fe.push(new a(qt,n.Identifier));continue}throw new SyntaxError(`Unexpected character: ${Nt}`)}return fe}var o=class{constructor(){$e(this,"type","Statement")}},l=class extends o{constructor(Pe){super();$e(this,"type","Program");this.body=Pe}},u=class extends o{constructor(Pe,fe,Le){super();$e(this,"type","If");this.test=Pe,this.body=fe,this.alternate=Le}},p=class extends o{constructor(Pe,fe,Le,Xe){super();$e(this,"type","For");this.loopvar=Pe,this.iterable=fe,this.body=Le,this.defaultBlock=Xe}},w=class extends o{constructor(){super(...arguments);$e(this,"type","Break")}},_=class extends o{constructor(){super(...arguments);$e(this,"type","Continue")}},v=class extends o{constructor(Pe,fe,Le){super();$e(this,"type","Set");this.assignee=Pe,this.value=fe,this.body=Le}},y=class extends o{constructor(Pe,fe,Le){super();$e(this,"type","Macro");this.name=Pe,this.args=fe,this.body=Le}},T=class extends o{constructor(Pe){super();$e(this,"type","Comment");this.value=Pe}},C=class extends o{constructor(){super(...arguments);$e(this,"type","Expression")}},P=class extends C{constructor(Pe,fe,Le){super();$e(this,"type","MemberExpression");this.object=Pe,this.property=fe,this.computed=Le}},O=class extends C{constructor(Pe,fe){super();$e(this,"type","CallExpression");this.callee=Pe,this.args=fe}},D=class extends C{constructor(Pe){super();$e(this,"type","Identifier");this.value=Pe}},L=class extends C{constructor(Pe){super();$e(this,"type","Literal");this.value=Pe}},W=class extends L{constructor(){super(...arguments);$e(this,"type","IntegerLiteral")}},U=class extends L{constructor(){super(...arguments);$e(this,"type","FloatLiteral")}},te=class extends L{constructor(){super(...arguments);$e(this,"type","StringLiteral")}},pe=class extends L{constructor(){super(...arguments);$e(this,"type","ArrayLiteral")}},ne=class extends L{constructor(){super(...arguments);$e(this,"type","TupleLiteral")}},ye=class extends L{constructor(){super(...arguments);$e(this,"type","ObjectLiteral")}},ce=class extends C{constructor(Pe,fe,Le){super();$e(this,"type","BinaryExpression");this.operator=Pe,this.left=fe,this.right=Le}},Me=class extends C{constructor(Pe,fe){super();$e(this,"type","FilterExpression");this.operand=Pe,this.filter=fe}},ke=class extends o{constructor(Pe,fe){super();$e(this,"type","FilterStatement");this.filter=Pe,this.body=fe}},ve=class extends C{constructor(Pe,fe){super();$e(this,"type","SelectExpression");this.lhs=Pe,this.test=fe}},K=class extends C{constructor(Pe,fe,Le){super();$e(this,"type","TestExpression");this.operand=Pe,this.negate=fe,this.test=Le}},re=class extends C{constructor(Pe,fe){super();$e(this,"type","UnaryExpression");this.operator=Pe,this.argument=fe}},X=class extends C{constructor(Pe=void 0,fe=void 0,Le=void 0){super();$e(this,"type","SliceExpression");this.start=Pe,this.stop=fe,this.step=Le}},N=class extends C{constructor(Pe,fe){super();$e(this,"type","KeywordArgumentExpression");this.key=Pe,this.value=fe}},ae=class extends C{constructor(Pe){super();$e(this,"type","SpreadExpression");this.argument=Pe}},J=class extends o{constructor(Pe,fe,Le){super();$e(this,"type","CallStatement");this.call=Pe,this.callerArgs=fe,this.body=Le}},Y=class extends C{constructor(Pe,fe,Le){super();$e(this,"type","Ternary");this.condition=Pe,this.trueExpr=fe,this.falseExpr=Le}};function be(H){const Pe=new l([]);let fe=0;function Le(Tt,Ot){const Ut=H[fe++];if(!Ut||Ut.type!==Tt)throw new Error(`Parser Error: ${Ot}. ${Ut.type} !== ${Tt}.`);return Ut}function Xe(Tt){if(!vr(Tt))throw new SyntaxError(`Expected ${Tt}`);++fe}function ft(){switch(H[fe].type){case n.Comment:return new T(H[fe++].value);case n.Text:return or();case n.OpenStatement:return Nt();case n.OpenExpression:return qt();default:throw new SyntaxError(`Unexpected token type: ${H[fe].type}`)}}function pt(...Tt){return fe+Tt.length<=H.length&&Tt.every((Ot,Ut)=>Ot===H[fe+Ut].type)}function nr(...Tt){var Ot,Ut,pn;return((Ot=H[fe])==null?void 0:Ot.type)===n.OpenStatement&&((Ut=H[fe+1])==null?void 0:Ut.type)===n.Identifier&&Tt.includes((pn=H[fe+1])==null?void 0:pn.value)}function vr(...Tt){return fe+Tt.length<=H.length&&Tt.every((Ot,Ut)=>H[fe+Ut].type==="Identifier"&&Ot===H[fe+Ut].value)}function or(){return new te(Le(n.Text,"Expected text token").value)}function Nt(){if(Le(n.OpenStatement,"Expected opening statement token"),H[fe].type!==n.Identifier)throw new SyntaxError(`Unknown statement, got ${H[fe].type}`);const Tt=H[fe].value;let Ot;switch(Tt){case"set":++fe,Ot=jr();break;case"if":++fe,Ot=Sn(),Le(n.OpenStatement,"Expected {% token"),Xe("endif"),Le(n.CloseStatement,"Expected %} token");break;case"macro":++fe,Ot=bi(),Le(n.OpenStatement,"Expected {% token"),Xe("endmacro"),Le(n.CloseStatement,"Expected %} token");break;case"for":++fe,Ot=bn(),Le(n.OpenStatement,"Expected {% token"),Xe("endfor"),Le(n.CloseStatement,"Expected %} token");break;case"call":{++fe;let Ut=null;pt(n.OpenParen)&&(Ut=ei());const pn=Un();if(pn.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const xr=ei();Le(n.CloseStatement,"Expected closing statement token");const Vn=[];for(;!nr("endcall");)Vn.push(ft());Le(n.OpenStatement,"Expected '{%'"),Xe("endcall"),Le(n.CloseStatement,"Expected closing statement token");const ao=new O(pn,xr);Ot=new J(ao,Ut,Vn);break}case"break":++fe,Le(n.CloseStatement,"Expected closing statement token"),Ot=new w;break;case"continue":++fe,Le(n.CloseStatement,"Expected closing statement token"),Ot=new _;break;case"filter":{++fe;let Ut=Un();Ut instanceof D&&pt(n.OpenParen)&&(Ut=sn(Ut)),Le(n.CloseStatement,"Expected closing statement token");const pn=[];for(;!nr("endfilter");)pn.push(ft());Le(n.OpenStatement,"Expected '{%'"),Xe("endfilter"),Le(n.CloseStatement,"Expected '%}'"),Ot=new ke(Ut,pn);break}default:throw new SyntaxError(`Unknown statement type: ${Tt}`)}return Ot}function qt(){Le(n.OpenExpression,"Expected opening expression token");const Tt=wr();return Le(n.CloseExpression,"Expected closing expression token"),Tt}function jr(){const Tt=hi();let Ot=null;const Ut=[];if(pt(n.Equals))++fe,Ot=hi();else{for(Le(n.CloseStatement,"Expected %} token");!nr("endset");)Ut.push(ft());Le(n.OpenStatement,"Expected {% token"),Xe("endset")}return Le(n.CloseStatement,"Expected closing statement token"),new v(Tt,Ot,Ut)}function Sn(){const Tt=wr();Le(n.CloseStatement,"Expected closing statement token");const Ot=[],Ut=[];for(;!nr("elif","else","endif");)Ot.push(ft());if(nr("elif")){++fe,++fe;const pn=Sn();Ut.push(pn)}else if(nr("else"))for(++fe,++fe,Le(n.CloseStatement,"Expected closing statement token");!nr("endif");)Ut.push(ft());return new u(Tt,Ot,Ut)}function bi(){const Tt=Un();if(Tt.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const Ot=ei();Le(n.CloseStatement,"Expected closing statement token");const Ut=[];for(;!nr("endmacro");)Ut.push(ft());return new y(Tt,Ot,Ut)}function hi(Tt=!1){const Ot=Tt?Un:wr,Ut=[Ot()],pn=pt(n.Comma);for(;pn&&(++fe,Ut.push(Ot()),!!pt(n.Comma)););return pn?new ne(Ut):Ut[0]}function bn(){const Tt=hi(!0);if(!(Tt instanceof D||Tt instanceof ne))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Tt.type} instead`);if(!vr("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++fe;const Ot=wr();Le(n.CloseStatement,"Expected closing statement token");const Ut=[];for(;!nr("endfor","else");)Ut.push(ft());const pn=[];if(nr("else"))for(++fe,++fe,Le(n.CloseStatement,"Expected closing statement token");!nr("endfor");)pn.push(ft());return new p(Tt,Ot,Ut,pn)}function wr(){return ir()}function ir(){const Tt=Ar();if(vr("if")){++fe;const Ot=Ar();if(vr("else")){++fe;const Ut=ir();return new Y(Ot,Tt,Ut)}else return new ve(Tt,Ot)}return Tt}function Ar(){let Tt=Gr();for(;vr("or");){const Ot=H[fe];++fe;const Ut=Gr();Tt=new ce(Ot,Tt,Ut)}return Tt}function Gr(){let Tt=nn();for(;vr("and");){const Ot=H[fe];++fe;const Ut=nn();Tt=new ce(Ot,Tt,Ut)}return Tt}function nn(){let Tt;for(;vr("not");){const Ot=H[fe];++fe;const Ut=nn();Tt=new re(Ot,Ut)}return Tt!=null?Tt:Nr()}function Nr(){let Tt=yn();for(;;){let Ot;if(vr("not","in"))Ot=new a("not in",n.Identifier),fe+=2;else if(vr("in"))Ot=H[fe++];else if(pt(n.ComparisonBinaryOperator))Ot=H[fe++];else break;const Ut=yn();Tt=new ce(Ot,Tt,Ut)}return Tt}function yn(){let Tt=Ds();for(;pt(n.AdditiveBinaryOperator);){const Ot=H[fe];++fe;const Ut=Ds();Tt=new ce(Ot,Tt,Ut)}return Tt}function pi(){const Tt=rr(Un());return pt(n.OpenParen)?sn(Tt):Tt}function sn(Tt){let Ot=new O(Tt,ei());return Ot=rr(Ot),pt(n.OpenParen)&&(Ot=sn(Ot)),Ot}function ei(){Le(n.OpenParen,"Expected opening parenthesis for arguments list");const Tt=ti();return Le(n.CloseParen,"Expected closing parenthesis for arguments list"),Tt}function ti(){const Tt=[];for(;!pt(n.CloseParen);){let Ot;if(H[fe].type===n.MultiplicativeBinaryOperator&&H[fe].value==="*"){++fe;const Ut=wr();Ot=new ae(Ut)}else if(Ot=wr(),pt(n.Equals)){if(++fe,!(Ot instanceof D))throw new SyntaxError("Expected identifier for keyword argument");const Ut=wr();Ot=new N(Ot,Ut)}Tt.push(Ot),pt(n.Comma)&&++fe}return Tt}function Mi(){const Tt=[];let Ot=!1;for(;!pt(n.CloseSquareBracket);)pt(n.Colon)?(Tt.push(void 0),++fe,Ot=!0):(Tt.push(wr()),pt(n.Colon)&&(++fe,Ot=!0));if(Tt.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(Ot){if(Tt.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new X(...Tt)}return Tt[0]}function rr(Tt){for(;pt(n.Dot)||pt(n.OpenSquareBracket);){const Ot=H[fe];++fe;let Ut;const pn=Ot.type===n.OpenSquareBracket;if(pn)Ut=Mi(),Le(n.CloseSquareBracket,"Expected closing square bracket");else if(Ut=Un(),Ut.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Tt=new P(Tt,Ut,pn)}return Tt}function Ds(){let Tt=oo();for(;pt(n.MultiplicativeBinaryOperator);){const Ot=H[fe++],Ut=oo();Tt=new ce(Ot,Tt,Ut)}return Tt}function oo(){let Tt=Io();for(;vr("is");){++fe;const Ot=vr("not");Ot&&++fe;const Ut=Un();if(!(Ut instanceof D))throw new SyntaxError("Expected identifier for the test");Tt=new K(Tt,Ot,Ut)}return Tt}function Io(){let Tt=pi();for(;pt(n.Pipe);){++fe;let Ot=Un();if(!(Ot instanceof D))throw new SyntaxError("Expected identifier for the filter");pt(n.OpenParen)&&(Ot=sn(Ot)),Tt=new Me(Tt,Ot)}return Tt}function Un(){const Tt=H[fe++];switch(Tt.type){case n.NumericLiteral:{const Ot=Tt.value;return Ot.includes(".")?new U(Number(Ot)):new W(Number(Ot))}case n.StringLiteral:{let Ot=Tt.value;for(;pt(n.StringLiteral);)Ot+=H[fe++].value;return new te(Ot)}case n.Identifier:return new D(Tt.value);case n.OpenParen:{const Ot=hi();return Le(n.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),Ot}case n.OpenSquareBracket:{const Ot=[];for(;!pt(n.CloseSquareBracket);)Ot.push(wr()),pt(n.Comma)&&++fe;return++fe,new pe(Ot)}case n.OpenCurlyBracket:{const Ot=new Map;for(;!pt(n.CloseCurlyBracket);){const Ut=wr();Le(n.Colon,"Expected colon between key and value in object literal");const pn=wr();Ot.set(Ut,pn),pt(n.Comma)&&++fe}return++fe,new ye(Ot)}default:throw new SyntaxError(`Unexpected token: ${Tt.type}`)}}for(;fe<H.length;)Pe.body.push(ft());return Pe}function Ce(H,Pe,fe=1){Pe===void 0&&(Pe=H,H=0);const Le=[];for(let Xe=H;Xe<Pe;Xe+=fe)Le.push(Xe);return Le}function Ue(H,Pe,fe,Le=1){const Xe=Math.sign(Le);Xe>=0?(Pe=(Pe!=null?Pe:Pe=0)<0?Math.max(H.length+Pe,0):Math.min(Pe,H.length),fe=(fe!=null?fe:fe=H.length)<0?Math.max(H.length+fe,0):Math.min(fe,H.length)):(Pe=(Pe!=null?Pe:Pe=H.length-1)<0?Math.max(H.length+Pe,-1):Math.min(Pe,H.length-1),fe=(fe!=null?fe:fe=-1)<-1?Math.max(H.length+fe,-1):Math.min(fe,H.length-1));const ft=[];for(let pt=Pe;Xe*pt<Xe*fe;pt+=Le)ft.push(H[pt]);return ft}function Ve(H){return H.replace(/\b\w/g,Pe=>Pe.toUpperCase())}function Ie(H){return he(new Date,H)}function he(H,Pe){const fe=new Intl.DateTimeFormat(void 0,{month:"long"}),Le=new Intl.DateTimeFormat(void 0,{month:"short"}),Xe=ft=>ft<10?"0"+ft:ft.toString();return Pe.replace(/%[YmdbBHM%]/g,ft=>{switch(ft){case"%Y":return H.getFullYear().toString();case"%m":return Xe(H.getMonth()+1);case"%d":return Xe(H.getDate());case"%b":return Le.format(H);case"%B":return fe.format(H);case"%H":return Xe(H.getHours());case"%M":return Xe(H.getMinutes());case"%%":return"%";default:return ft}})}function Fe(H){return H.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ee(H,Pe,fe,Le){if(Le===0)return H;let Xe=Le==null||Le<0?1/0:Le;const ft=Pe.length===0?new RegExp("(?=)","gu"):new RegExp(Fe(Pe),"gu");return H.replaceAll(ft,pt=>Xe>0?(--Xe,fe):pt)}var we=class extends Error{},Re=class extends Error{},Be=class{constructor(H=void 0){$e(this,"type","RuntimeValue");$e(this,"value");$e(this,"builtins",new Map);this.value=H}__bool__(){return new rt(!!this.value)}toString(){return String(this.value)}},Se=class extends Be{constructor(){super(...arguments);$e(this,"type","IntegerValue")}},Ne=class extends Be{constructor(){super(...arguments);$e(this,"type","FloatValue")}toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},ze=class extends Be{constructor(){super(...arguments);$e(this,"type","StringValue");$e(this,"builtins",new Map([["upper",new ct(()=>new ze(this.value.toUpperCase()))],["lower",new ct(()=>new ze(this.value.toLowerCase()))],["strip",new ct(()=>new ze(this.value.trim()))],["title",new ct(()=>new ze(Ve(this.value)))],["capitalize",new ct(()=>new ze(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new Se(this.value.length)],["rstrip",new ct(()=>new ze(this.value.trimEnd()))],["lstrip",new ct(()=>new ze(this.value.trimStart()))],["startswith",new ct(Pe=>{if(Pe.length===0)throw new Error("startswith() requires at least one argument");const fe=Pe[0];if(fe instanceof ze)return new rt(this.value.startsWith(fe.value));if(fe instanceof qe){for(const Le of fe.value){if(!(Le instanceof ze))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(Le.value))return new rt(!0)}return new rt(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new ct(Pe=>{if(Pe.length===0)throw new Error("endswith() requires at least one argument");const fe=Pe[0];if(fe instanceof ze)return new rt(this.value.endsWith(fe.value));if(fe instanceof qe){for(const Le of fe.value){if(!(Le instanceof ze))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(Le.value))return new rt(!0)}return new rt(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new ct(Pe=>{var ft,pt;const fe=(ft=Pe[0])!=null?ft:new wt;if(!(fe instanceof ze||fe instanceof wt))throw new Error("sep argument must be a string or null");const Le=(pt=Pe[1])!=null?pt:new Se(-1);if(!(Le instanceof Se))throw new Error("maxsplit argument must be a number");let Xe=[];if(fe instanceof wt){const nr=this.value.trimStart();for(const{0:vr,index:or}of nr.matchAll(/\S+/g)){if(Le.value!==-1&&Xe.length>=Le.value&&or!==void 0){Xe.push(vr+nr.slice(or+vr.length));break}Xe.push(vr)}}else{if(fe.value==="")throw new Error("empty separator");Xe=this.value.split(fe.value),Le.value!==-1&&Xe.length>Le.value&&Xe.push(Xe.splice(Le.value).join(fe.value))}return new qe(Xe.map(nr=>new ze(nr)))})],["replace",new ct(Pe=>{var ft;if(Pe.length<2)throw new Error("replace() requires at least two arguments");const fe=Pe[0],Le=Pe[1];if(!(fe instanceof ze&&Le instanceof ze))throw new Error("replace() arguments must be strings");let Xe;if(Pe.length>2?Pe[2].type==="KeywordArgumentsValue"?Xe=(ft=Pe[2].value.get("count"))!=null?ft:new wt:Xe=Pe[2]:Xe=new wt,!(Xe instanceof Se||Xe instanceof wt))throw new Error("replace() count argument must be a number or null");return new ze(ee(this.value,fe.value,Le.value,Xe.value))})]]))}},rt=class extends Be{constructor(){super(...arguments);$e(this,"type","BooleanValue")}},nt=class extends Be{constructor(){super(...arguments);$e(this,"type","ObjectValue");$e(this,"builtins",new Map([["get",new ct(([Pe,fe])=>{var Le,Xe;if(!(Pe instanceof ze))throw new Error(`Object key must be a string: got ${Pe.type}`);return(Xe=(Le=this.value.get(Pe.value))!=null?Le:fe)!=null?Xe:new wt})],["items",new ct(()=>this.items())],["keys",new ct(()=>this.keys())],["values",new ct(()=>this.values())]]))}__bool__(){return new rt(this.value.size>0)}items(){return new qe(Array.from(this.value.entries()).map(([Pe,fe])=>new qe([new ze(Pe),fe])))}keys(){return new qe(Array.from(this.value.keys()).map(Pe=>new ze(Pe)))}values(){return new qe(Array.from(this.value.values()))}},Ge=class extends nt{constructor(){super(...arguments);$e(this,"type","KeywordArgumentsValue")}},qe=class extends Be{constructor(){super(...arguments);$e(this,"type","ArrayValue");$e(this,"builtins",new Map([["length",new Se(this.value.length)]]))}__bool__(){return new rt(this.value.length>0)}},gt=class extends qe{constructor(){super(...arguments);$e(this,"type","TupleValue")}},ct=class extends Be{constructor(){super(...arguments);$e(this,"type","FunctionValue")}},wt=class extends Be{constructor(){super(...arguments);$e(this,"type","NullValue")}},bt=class extends Be{constructor(){super(...arguments);$e(this,"type","UndefinedValue")}},Ct=class{constructor(H){$e(this,"variables",new Map([["namespace",new ct(H=>{if(H.length===0)return new nt(new Map);if(H.length!==1||!(H[0]instanceof nt))throw new Error("`namespace` expects either zero arguments or a single object argument");return H[0]})]]));$e(this,"tests",new Map([["boolean",H=>H.type==="BooleanValue"],["callable",H=>H instanceof ct],["odd",H=>{if(!(H instanceof Se))throw new Error(`cannot odd on ${H.type}`);return H.value%2!==0}],["even",H=>{if(!(H instanceof Se))throw new Error(`cannot even on ${H.type}`);return H.value%2===0}],["false",H=>H.type==="BooleanValue"&&!H.value],["true",H=>H.type==="BooleanValue"&&H.value],["none",H=>H.type==="NullValue"],["string",H=>H.type==="StringValue"],["number",H=>H instanceof Se||H instanceof Ne],["integer",H=>H instanceof Se],["iterable",H=>H.type==="ArrayValue"||H.type==="StringValue"],["mapping",H=>H.type==="ObjectValue"],["lower",H=>{const Pe=H.value;return H.type==="StringValue"&&Pe===Pe.toLowerCase()}],["upper",H=>{const Pe=H.value;return H.type==="StringValue"&&Pe===Pe.toUpperCase()}],["none",H=>H.type==="NullValue"],["defined",H=>H.type!=="UndefinedValue"],["undefined",H=>H.type==="UndefinedValue"],["equalto",(H,Pe)=>H.value===Pe.value],["eq",(H,Pe)=>H.value===Pe.value]]));this.parent=H}set(H,Pe){return this.declareVariable(H,Fr(Pe))}declareVariable(H,Pe){if(this.variables.has(H))throw new SyntaxError(`Variable already declared: ${H}`);return this.variables.set(H,Pe),Pe}setVariable(H,Pe){return this.variables.set(H,Pe),Pe}resolve(H){if(this.variables.has(H))return this;if(this.parent)return this.parent.resolve(H);throw new Error(`Unknown variable: ${H}`)}lookupVariable(H){var Pe;try{return(Pe=this.resolve(H).variables.get(H))!=null?Pe:new bt}catch{return new bt}}};function It(H){H.set("false",!1),H.set("true",!0),H.set("none",null),H.set("raise_exception",Pe=>{throw new Error(Pe)}),H.set("range",Ce),H.set("strftime_now",Ie),H.set("True",!0),H.set("False",!1),H.set("None",null)}var jt=class{constructor(H){$e(this,"global");this.global=H!=null?H:new Ct}run(H){return this.evaluate(H,this.global)}evaluateBinaryExpression(H,Pe){const fe=this.evaluate(H.left,Pe);switch(H.operator.value){case"and":return fe.__bool__().value?this.evaluate(H.right,Pe):fe;case"or":return fe.__bool__().value?fe:this.evaluate(H.right,Pe)}const Le=this.evaluate(H.right,Pe);switch(H.operator.value){case"==":return new rt(fe.value==Le.value);case"!=":return new rt(fe.value!=Le.value)}if(fe instanceof bt||Le instanceof bt){if(Le instanceof bt&&["in","not in"].includes(H.operator.value))return new rt(H.operator.value==="not in");throw new Error(`Cannot perform operation ${H.operator.value} on undefined values`)}else{if(fe instanceof wt||Le instanceof wt)throw new Error("Cannot perform operation on null values");if(H.operator.value==="~")return new ze(fe.value.toString()+Le.value.toString());if((fe instanceof Se||fe instanceof Ne)&&(Le instanceof Se||Le instanceof Ne)){const Xe=fe.value,ft=Le.value;switch(H.operator.value){case"+":case"-":case"*":{const pt=H.operator.value==="+"?Xe+ft:H.operator.value==="-"?Xe-ft:Xe*ft;return fe instanceof Ne||Le instanceof Ne?new Ne(pt):new Se(pt)}case"/":return new Ne(Xe/ft);case"%":{const pt=Xe%ft;return fe instanceof Ne||Le instanceof Ne?new Ne(pt):new Se(pt)}case"<":return new rt(Xe<ft);case">":return new rt(Xe>ft);case">=":return new rt(Xe>=ft);case"<=":return new rt(Xe<=ft)}}else if(fe instanceof qe&&Le instanceof qe)switch(H.operator.value){case"+":return new qe(fe.value.concat(Le.value))}else if(Le instanceof qe){const Xe=Le.value.find(ft=>ft.value===fe.value)!==void 0;switch(H.operator.value){case"in":return new rt(Xe);case"not in":return new rt(!Xe)}}}if(fe instanceof ze||Le instanceof ze)switch(H.operator.value){case"+":return new ze(fe.value.toString()+Le.value.toString())}if(fe instanceof ze&&Le instanceof ze)switch(H.operator.value){case"in":return new rt(Le.value.includes(fe.value));case"not in":return new rt(!Le.value.includes(fe.value))}if(fe instanceof ze&&Le instanceof nt)switch(H.operator.value){case"in":return new rt(Le.value.has(fe.value));case"not in":return new rt(!Le.value.has(fe.value))}throw new SyntaxError(`Unknown operator "${H.operator.value}" between ${fe.type} and ${Le.type}`)}evaluateArguments(H,Pe){const fe=[],Le=new Map;for(const Xe of H)if(Xe.type==="SpreadExpression"){const ft=Xe,pt=this.evaluate(ft.argument,Pe);if(!(pt instanceof qe))throw new Error(`Cannot unpack non-iterable type: ${pt.type}`);for(const nr of pt.value)fe.push(nr)}else if(Xe.type==="KeywordArgumentExpression"){const ft=Xe;Le.set(ft.key.value,this.evaluate(ft.value,Pe))}else{if(Le.size>0)throw new Error("Positional arguments must come before keyword arguments");fe.push(this.evaluate(Xe,Pe))}return[fe,Le]}applyFilter(H,Pe,fe){var Le,Xe,ft,pt,nr,vr,or,Nt,qt,jr,Sn,bi,hi,bn;if(Pe.type==="Identifier"){const wr=Pe;if(wr.value==="tojson")return new ze(lr(H));if(H instanceof qe)switch(wr.value){case"list":return H;case"first":return H.value[0];case"last":return H.value[H.value.length-1];case"length":return new Se(H.value.length);case"reverse":return new qe(H.value.reverse());case"sort":return new qe(H.value.sort((ir,Ar)=>{if(ir.type!==Ar.type)throw new Error(`Cannot compare different types: ${ir.type} and ${Ar.type}`);switch(ir.type){case"IntegerValue":case"FloatValue":return ir.value-Ar.value;case"StringValue":return ir.value.localeCompare(Ar.value);default:throw new Error(`Cannot compare type: ${ir.type}`)}}));case"join":return new ze(H.value.map(ir=>ir.value).join(""));case"string":return new ze(lr(H));case"unique":{const ir=new Set,Ar=[];for(const Gr of H.value)ir.has(Gr.value)||(ir.add(Gr.value),Ar.push(Gr));return new qe(Ar)}default:throw new Error(`Unknown ArrayValue filter: ${wr.value}`)}else if(H instanceof ze)switch(wr.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const ir=H.builtins.get(wr.value);if(ir instanceof ct)return ir.value([],fe);if(ir instanceof Se)return ir;throw new Error(`Unknown StringValue filter: ${wr.value}`)}case"trim":return new ze(H.value.trim());case"indent":return new ze(H.value.split(`
`).map((ir,Ar)=>Ar===0||ir.length===0?ir:"    "+ir).join(`
`));case"join":case"string":return H;case"int":{const ir=parseInt(H.value,10);return new Se(isNaN(ir)?0:ir)}case"float":{const ir=parseFloat(H.value);return new Ne(isNaN(ir)?0:ir)}default:throw new Error(`Unknown StringValue filter: ${wr.value}`)}else if(H instanceof Se||H instanceof Ne)switch(wr.value){case"abs":return H instanceof Se?new Se(Math.abs(H.value)):new Ne(Math.abs(H.value));case"int":return new Se(Math.floor(H.value));case"float":return new Ne(H.value);default:throw new Error(`Unknown NumericValue filter: ${wr.value}`)}else if(H instanceof nt)switch(wr.value){case"items":return new qe(Array.from(H.value.entries()).map(([ir,Ar])=>new qe([new ze(ir),Ar])));case"length":return new Se(H.value.size);default:throw new Error(`Unknown ObjectValue filter: ${wr.value}`)}else if(H instanceof rt)switch(wr.value){case"bool":return new rt(H.value);case"int":return new Se(H.value?1:0);case"float":return new Ne(H.value?1:0);case"string":return new ze(H.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${wr.value}`)}throw new Error(`Cannot apply filter "${wr.value}" to type: ${H.type}`)}else if(Pe.type==="CallExpression"){const wr=Pe;if(wr.callee.type!=="Identifier")throw new Error(`Unknown filter: ${wr.callee.type}`);const ir=wr.callee.value;if(ir==="tojson"){const[,Ar]=this.evaluateArguments(wr.args,fe),Gr=(Le=Ar.get("indent"))!=null?Le:new wt;if(!(Gr instanceof Se||Gr instanceof wt))throw new Error("If set, indent must be a number");return new ze(lr(H,Gr.value))}else if(ir==="join"){let Ar;if(H instanceof ze)Ar=Array.from(H.value);else if(H instanceof qe)Ar=H.value.map(yn=>yn.value);else throw new Error(`Cannot apply filter "${ir}" to type: ${H.type}`);const[Gr,nn]=this.evaluateArguments(wr.args,fe),Nr=(ft=(Xe=Gr.at(0))!=null?Xe:nn.get("separator"))!=null?ft:new ze("");if(!(Nr instanceof ze))throw new Error("separator must be a string");return new ze(Ar.join(Nr.value))}else if(ir==="int"||ir==="float"){const[Ar,Gr]=this.evaluateArguments(wr.args,fe),nn=(nr=(pt=Ar.at(0))!=null?pt:Gr.get("default"))!=null?nr:ir==="int"?new Se(0):new Ne(0);if(H instanceof ze){const Nr=ir==="int"?parseInt(H.value,10):parseFloat(H.value);return isNaN(Nr)?nn:ir==="int"?new Se(Nr):new Ne(Nr)}else{if(H instanceof Se||H instanceof Ne)return H;if(H instanceof rt)return ir==="int"?new Se(H.value?1:0):new Ne(H.value?1:0);throw new Error(`Cannot apply filter "${ir}" to type: ${H.type}`)}}else if(ir==="default"){const[Ar,Gr]=this.evaluateArguments(wr.args,fe),nn=(vr=Ar[0])!=null?vr:new ze(""),Nr=(Nt=(or=Ar[1])!=null?or:Gr.get("boolean"))!=null?Nt:new rt(!1);if(!(Nr instanceof rt))throw new Error("`default` filter flag must be a boolean");return H instanceof bt||Nr.value&&!H.__bool__().value?nn:H}if(H instanceof qe){switch(ir){case"selectattr":case"rejectattr":{const Ar=ir==="selectattr";if(H.value.some(sn=>!(sn instanceof nt)))throw new Error(`\`${ir}\` can only be applied to array of objects`);if(wr.args.some(sn=>sn.type!=="StringLiteral"))throw new Error(`arguments of \`${ir}\` must be strings`);const[Gr,nn,Nr]=wr.args.map(sn=>this.evaluate(sn,fe));let yn;if(nn){const sn=fe.tests.get(nn.value);if(!sn)throw new Error(`Unknown test: ${nn.value}`);yn=sn}else yn=(...sn)=>sn[0].__bool__().value;const pi=H.value.filter(sn=>{const ei=sn.value.get(Gr.value),ti=ei?yn(ei,Nr):!1;return Ar?ti:!ti});return new qe(pi)}case"map":{const[,Ar]=this.evaluateArguments(wr.args,fe);if(Ar.has("attribute")){const Gr=Ar.get("attribute");if(!(Gr instanceof ze))throw new Error("attribute must be a string");const nn=Ar.get("default"),Nr=H.value.map(yn=>{var pi,sn;if(!(yn instanceof nt))throw new Error("items in map must be an object");return(sn=(pi=yn.value.get(Gr.value))!=null?pi:nn)!=null?sn:new bt});return new qe(Nr)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${ir}`)}else if(H instanceof ze){switch(ir){case"indent":{const[Ar,Gr]=this.evaluateArguments(wr.args,fe),nn=(jr=(qt=Ar.at(0))!=null?qt:Gr.get("width"))!=null?jr:new Se(4);if(!(nn instanceof Se))throw new Error("width must be a number");const Nr=(bi=(Sn=Ar.at(1))!=null?Sn:Gr.get("first"))!=null?bi:new rt(!1),yn=(bn=(hi=Ar.at(2))!=null?hi:Gr.get("blank"))!=null?bn:new rt(!1),pi=H.value.split(`
`),sn=" ".repeat(nn.value),ei=pi.map((ti,Mi)=>!Nr.value&&Mi===0||!yn.value&&ti.length===0?ti:sn+ti);return new ze(ei.join(`
`))}case"replace":{const Ar=H.builtins.get("replace");if(!(Ar instanceof ct))throw new Error("replace filter not available");const[Gr,nn]=this.evaluateArguments(wr.args,fe);return Ar.value([...Gr,new Ge(nn)],fe)}}throw new Error(`Unknown StringValue filter: ${ir}`)}else throw new Error(`Cannot apply filter "${ir}" to type: ${H.type}`)}throw new Error(`Unknown filter: ${Pe.type}`)}evaluateFilterExpression(H,Pe){const fe=this.evaluate(H.operand,Pe);return this.applyFilter(fe,H.filter,Pe)}evaluateTestExpression(H,Pe){const fe=this.evaluate(H.operand,Pe),Le=Pe.tests.get(H.test.value);if(!Le)throw new Error(`Unknown test: ${H.test.value}`);const Xe=Le(fe);return new rt(H.negate?!Xe:Xe)}evaluateSelectExpression(H,Pe){return this.evaluate(H.test,Pe).__bool__().value?this.evaluate(H.lhs,Pe):new bt}evaluateUnaryExpression(H,Pe){const fe=this.evaluate(H.argument,Pe);switch(H.operator.value){case"not":return new rt(!fe.value);default:throw new SyntaxError(`Unknown operator: ${H.operator.value}`)}}evaluateTernaryExpression(H,Pe){return this.evaluate(H.condition,Pe).__bool__().value?this.evaluate(H.trueExpr,Pe):this.evaluate(H.falseExpr,Pe)}evalProgram(H,Pe){return this.evaluateBlock(H.body,Pe)}evaluateBlock(H,Pe){let fe="";for(const Le of H){const Xe=this.evaluate(Le,Pe);Xe.type!=="NullValue"&&Xe.type!=="UndefinedValue"&&(fe+=Xe.toString())}return new ze(fe)}evaluateIdentifier(H,Pe){return Pe.lookupVariable(H.value)}evaluateCallExpression(H,Pe){const[fe,Le]=this.evaluateArguments(H.args,Pe);Le.size>0&&fe.push(new Ge(Le));const Xe=this.evaluate(H.callee,Pe);if(Xe.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${Xe.type}`);return Xe.value(fe,Pe)}evaluateSliceExpression(H,Pe,fe){if(!(H instanceof qe||H instanceof ze))throw new Error("Slice object must be an array or string");const Le=this.evaluate(Pe.start,fe),Xe=this.evaluate(Pe.stop,fe),ft=this.evaluate(Pe.step,fe);if(!(Le instanceof Se||Le instanceof bt))throw new Error("Slice start must be numeric or undefined");if(!(Xe instanceof Se||Xe instanceof bt))throw new Error("Slice stop must be numeric or undefined");if(!(ft instanceof Se||ft instanceof bt))throw new Error("Slice step must be numeric or undefined");return H instanceof qe?new qe(Ue(H.value,Le.value,Xe.value,ft.value)):new ze(Ue(Array.from(H.value),Le.value,Xe.value,ft.value).join(""))}evaluateMemberExpression(H,Pe){var ft;const fe=this.evaluate(H.object,Pe);let Le;if(H.computed){if(H.property.type==="SliceExpression")return this.evaluateSliceExpression(fe,H.property,Pe);Le=this.evaluate(H.property,Pe)}else Le=new ze(H.property.value);let Xe;if(fe instanceof nt){if(!(Le instanceof ze))throw new Error(`Cannot access property with non-string: got ${Le.type}`);Xe=(ft=fe.value.get(Le.value))!=null?ft:fe.builtins.get(Le.value)}else if(fe instanceof qe||fe instanceof ze)if(Le instanceof Se)Xe=fe.value.at(Le.value),fe instanceof ze&&(Xe=new ze(fe.value.at(Le.value)));else if(Le instanceof ze)Xe=fe.builtins.get(Le.value);else throw new Error(`Cannot access property with non-string/non-number: got ${Le.type}`);else{if(!(Le instanceof ze))throw new Error(`Cannot access property with non-string: got ${Le.type}`);Xe=fe.builtins.get(Le.value)}return Xe instanceof Be?Xe:new bt}evaluateSet(H,Pe){const fe=H.value?this.evaluate(H.value,Pe):this.evaluateBlock(H.body,Pe);if(H.assignee.type==="Identifier"){const Le=H.assignee.value;Pe.setVariable(Le,fe)}else if(H.assignee.type==="TupleLiteral"){const Le=H.assignee;if(!(fe instanceof qe))throw new Error(`Cannot unpack non-iterable type in set: ${fe.type}`);const Xe=fe.value;if(Xe.length!==Le.value.length)throw new Error(`Too ${Le.value.length>Xe.length?"few":"many"} items to unpack in set`);for(let ft=0;ft<Le.value.length;++ft){const pt=Le.value[ft];if(pt.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${pt.type}`);Pe.setVariable(pt.value,Xe[ft])}}else if(H.assignee.type==="MemberExpression"){const Le=H.assignee,Xe=this.evaluate(Le.object,Pe);if(!(Xe instanceof nt))throw new Error("Cannot assign to member of non-object");if(Le.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");Xe.value.set(Le.property.value,fe)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(H.assignee)}`);return new wt}evaluateIf(H,Pe){const fe=this.evaluate(H.test,Pe);return this.evaluateBlock(fe.__bool__().value?H.body:H.alternate,Pe)}evaluateFor(H,Pe){const fe=new Ct(Pe);let Le,Xe;if(H.iterable.type==="SelectExpression"){const or=H.iterable;Xe=this.evaluate(or.lhs,fe),Le=or.test}else Xe=this.evaluate(H.iterable,fe);if(!(Xe instanceof qe||Xe instanceof nt))throw new Error(`Expected iterable or object type in for loop: got ${Xe.type}`);Xe instanceof nt&&(Xe=Xe.keys());const ft=[],pt=[];for(let or=0;or<Xe.value.length;++or){const Nt=new Ct(fe),qt=Xe.value[or];let jr;if(H.loopvar.type==="Identifier")jr=Sn=>Sn.setVariable(H.loopvar.value,qt);else if(H.loopvar.type==="TupleLiteral"){const Sn=H.loopvar;if(qt.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${qt.type}`);const bi=qt;if(Sn.value.length!==bi.value.length)throw new Error(`Too ${Sn.value.length>bi.value.length?"few":"many"} items to unpack`);jr=hi=>{for(let bn=0;bn<Sn.value.length;++bn){if(Sn.value[bn].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${Sn.value[bn].type}`);hi.setVariable(Sn.value[bn].value,bi.value[bn])}}}else throw new Error(`Invalid loop variable(s): ${H.loopvar.type}`);Le&&(jr(Nt),!this.evaluate(Le,Nt).__bool__().value)||(ft.push(qt),pt.push(jr))}let nr="",vr=!0;for(let or=0;or<ft.length;++or){const Nt=new Map([["index",new Se(or+1)],["index0",new Se(or)],["revindex",new Se(ft.length-or)],["revindex0",new Se(ft.length-or-1)],["first",new rt(or===0)],["last",new rt(or===ft.length-1)],["length",new Se(ft.length)],["previtem",or>0?ft[or-1]:new bt],["nextitem",or<ft.length-1?ft[or+1]:new bt]]);fe.setVariable("loop",new nt(Nt)),pt[or](fe);try{const qt=this.evaluateBlock(H.body,fe);nr+=qt.value}catch(qt){if(qt instanceof Re)continue;if(qt instanceof we)break;throw qt}vr=!1}if(vr){const or=this.evaluateBlock(H.defaultBlock,fe);nr+=or.value}return new ze(nr)}evaluateMacro(H,Pe){return Pe.setVariable(H.name.value,new ct((fe,Le)=>{var pt,nr;const Xe=new Ct(Le);fe=fe.slice();let ft;((pt=fe.at(-1))==null?void 0:pt.type)==="KeywordArgumentsValue"&&(ft=fe.pop());for(let vr=0;vr<H.args.length;++vr){const or=H.args[vr],Nt=fe[vr];if(or.type==="Identifier"){const qt=or;if(!Nt)throw new Error(`Missing positional argument: ${qt.value}`);Xe.setVariable(qt.value,Nt)}else if(or.type==="KeywordArgumentExpression"){const qt=or,jr=(nr=Nt!=null?Nt:ft==null?void 0:ft.value.get(qt.key.value))!=null?nr:this.evaluate(qt.value,Xe);Xe.setVariable(qt.key.value,jr)}else throw new Error(`Unknown argument type: ${or.type}`)}return this.evaluateBlock(H.body,Xe)})),new wt}evaluateCallStatement(H,Pe){const fe=new ct((nr,vr)=>{var Nt;const or=new Ct(vr);if(H.callerArgs)for(let qt=0;qt<H.callerArgs.length;++qt){const jr=H.callerArgs[qt];if(jr.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${jr.type}`);or.setVariable(jr.value,(Nt=nr[qt])!=null?Nt:new bt)}return this.evaluateBlock(H.body,or)}),[Le,Xe]=this.evaluateArguments(H.call.args,Pe);Le.push(new Ge(Xe));const ft=this.evaluate(H.call.callee,Pe);if(ft.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${ft.type}`);const pt=new Ct(Pe);return pt.setVariable("caller",fe),ft.value(Le,pt)}evaluateFilterStatement(H,Pe){const fe=this.evaluateBlock(H.body,Pe);return this.applyFilter(fe,H.filter,Pe)}evaluate(H,Pe){if(!H)return new bt;switch(H.type){case"Program":return this.evalProgram(H,Pe);case"Set":return this.evaluateSet(H,Pe);case"If":return this.evaluateIf(H,Pe);case"For":return this.evaluateFor(H,Pe);case"Macro":return this.evaluateMacro(H,Pe);case"CallStatement":return this.evaluateCallStatement(H,Pe);case"Break":throw new we;case"Continue":throw new Re;case"IntegerLiteral":return new Se(H.value);case"FloatLiteral":return new Ne(H.value);case"StringLiteral":return new ze(H.value);case"ArrayLiteral":return new qe(H.value.map(fe=>this.evaluate(fe,Pe)));case"TupleLiteral":return new gt(H.value.map(fe=>this.evaluate(fe,Pe)));case"ObjectLiteral":{const fe=new Map;for(const[Le,Xe]of H.value){const ft=this.evaluate(Le,Pe);if(!(ft instanceof ze))throw new Error(`Object keys must be strings: got ${ft.type}`);fe.set(ft.value,this.evaluate(Xe,Pe))}return new nt(fe)}case"Identifier":return this.evaluateIdentifier(H,Pe);case"CallExpression":return this.evaluateCallExpression(H,Pe);case"MemberExpression":return this.evaluateMemberExpression(H,Pe);case"UnaryExpression":return this.evaluateUnaryExpression(H,Pe);case"BinaryExpression":return this.evaluateBinaryExpression(H,Pe);case"FilterExpression":return this.evaluateFilterExpression(H,Pe);case"FilterStatement":return this.evaluateFilterStatement(H,Pe);case"TestExpression":return this.evaluateTestExpression(H,Pe);case"SelectExpression":return this.evaluateSelectExpression(H,Pe);case"Ternary":return this.evaluateTernaryExpression(H,Pe);case"Comment":return new wt;default:throw new SyntaxError(`Unknown node type: ${H.type}`)}}};function Fr(H){switch(typeof H){case"number":return Number.isInteger(H)?new Se(H):new Ne(H);case"string":return new ze(H);case"boolean":return new rt(H);case"undefined":return new bt;case"object":return H===null?new wt:Array.isArray(H)?new qe(H.map(Fr)):new nt(new Map(Object.entries(H).map(([Pe,fe])=>[Pe,Fr(fe)])));case"function":return new ct((Pe,fe)=>{var Xe;const Le=(Xe=H(...Pe.map(ft=>ft.value)))!=null?Xe:null;return Fr(Le)});default:throw new Error(`Cannot convert to runtime value: ${H}`)}}function lr(H,Pe,fe){const Le=fe!=null?fe:0;switch(H.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(H.value);case"ArrayValue":case"ObjectValue":{const Xe=Pe?" ".repeat(Pe):"",ft=`
`+Xe.repeat(Le),pt=ft+Xe;if(H.type==="ArrayValue"){const nr=H.value.map(vr=>lr(vr,Pe,Le+1));return Pe?`[${pt}${nr.join(`,${pt}`)}${ft}]`:`[${nr.join(", ")}]`}else{const nr=Array.from(H.value.entries()).map(([vr,or])=>{const Nt=`"${vr}": ${lr(or,Pe,Le+1)}`;return Pe?`${pt}${Nt}`:Nt});return Pe?`{${nr.join(",")}${ft}}`:`{${nr.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${H.type}`)}}var cr=`
`,gn="{%- ",Jr=" -%}";function Zn(H){switch(H.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return H.operator.value==="and"?1:H.operator.value==="in"||H.operator.value==="not in"?2:0}return 0}function ai(H,Pe="	"){const fe=typeof Pe=="number"?" ".repeat(Pe):Pe;return Nn(H.body,0,fe).replace(/\n$/,"")}function vn(...H){return gn+H.join(" ")+Jr}function Nn(H,Pe,fe){return H.map(Le=>Ji(Le,Pe,fe)).join(cr)}function Ji(H,Pe,fe){const Le=fe.repeat(Pe);switch(H.type){case"Program":return Nn(H.body,Pe,fe);case"If":return Zi(H,Pe,fe);case"For":return io(H,Pe,fe);case"Set":return oa(H,Pe,fe);case"Macro":return dr(H,Pe,fe);case"Break":return Le+vn("break");case"Continue":return Le+vn("continue");case"CallStatement":return ko(H,Pe,fe);case"FilterStatement":return so(H,Pe,fe);case"Comment":return Le+"{# "+H.value+" #}";default:return Le+"{{- "+yr(H)+" -}}"}}function Zi(H,Pe,fe){const Le=fe.repeat(Pe),Xe=[];let ft=H;for(;ft&&(Xe.push({test:ft.test,body:ft.body}),ft.alternate.length===1&&ft.alternate[0].type==="If");)ft=ft.alternate[0];let pt=Le+vn("if",yr(Xe[0].test))+cr+Nn(Xe[0].body,Pe+1,fe);for(let nr=1;nr<Xe.length;++nr)pt+=cr+Le+vn("elif",yr(Xe[nr].test))+cr+Nn(Xe[nr].body,Pe+1,fe);return ft&&ft.alternate.length>0&&(pt+=cr+Le+vn("else")+cr+Nn(ft.alternate,Pe+1,fe)),pt+=cr+Le+vn("endif"),pt}function io(H,Pe,fe){const Le=fe.repeat(Pe);let Xe="";if(H.iterable.type==="SelectExpression"){const pt=H.iterable;Xe=`${yr(pt.lhs)} if ${yr(pt.test)}`}else Xe=yr(H.iterable);let ft=Le+vn("for",yr(H.loopvar),"in",Xe)+cr+Nn(H.body,Pe+1,fe);return H.defaultBlock.length>0&&(ft+=cr+Le+vn("else")+cr+Nn(H.defaultBlock,Pe+1,fe)),ft+=cr+Le+vn("endfor"),ft}function oa(H,Pe,fe){const Le=fe.repeat(Pe),Xe=yr(H.assignee),ft=H.value?yr(H.value):"",pt=Le+vn("set",`${Xe}${H.value?" = "+ft:""}`);return H.body.length===0?pt:pt+cr+Nn(H.body,Pe+1,fe)+cr+Le+vn("endset")}function dr(H,Pe,fe){const Le=fe.repeat(Pe),Xe=H.args.map(yr).join(", ");return Le+vn("macro",`${H.name.value}(${Xe})`)+cr+Nn(H.body,Pe+1,fe)+cr+Le+vn("endmacro")}function ko(H,Pe,fe){const Le=fe.repeat(Pe),Xe=H.callerArgs&&H.callerArgs.length>0?`(${H.callerArgs.map(yr).join(", ")})`:"",ft=yr(H.call);let pt=Le+vn(`call${Xe}`,ft)+cr;return pt+=Nn(H.body,Pe+1,fe)+cr,pt+=Le+vn("endcall"),pt}function so(H,Pe,fe){const Le=fe.repeat(Pe),Xe=H.filter.type==="Identifier"?H.filter.value:yr(H.filter);let ft=Le+vn("filter",Xe)+cr;return ft+=Nn(H.body,Pe+1,fe)+cr,ft+=Le+vn("endfilter"),ft}function yr(H,Pe=-1){switch(H.type){case"SpreadExpression":return`*${yr(H.argument)}`;case"Identifier":return H.value;case"IntegerLiteral":return`${H.value}`;case"FloatLiteral":return`${H.value}`;case"StringLiteral":return JSON.stringify(H.value);case"BinaryExpression":{const fe=H,Le=Zn(fe),Xe=yr(fe.left,Le),ft=yr(fe.right,Le+1),pt=`${Xe} ${fe.operator.value} ${ft}`;return Le<Pe?`(${pt})`:pt}case"UnaryExpression":{const fe=H;return fe.operator.value+(fe.operator.value==="not"?" ":"")+yr(fe.argument,1/0)}case"CallExpression":{const fe=H,Le=fe.args.map(yr).join(", ");return`${yr(fe.callee)}(${Le})`}case"MemberExpression":{const fe=H;let Le=yr(fe.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(fe.object.type)||(Le=`(${Le})`);let Xe=yr(fe.property);return!fe.computed&&fe.property.type!=="Identifier"&&(Xe=`(${Xe})`),fe.computed?`${Le}[${Xe}]`:`${Le}.${Xe}`}case"FilterExpression":{const fe=H,Le=yr(fe.operand,1/0);return fe.filter.type==="CallExpression"?`${Le} | ${yr(fe.filter)}`:`${Le} | ${fe.filter.value}`}case"SelectExpression":{const fe=H;return`${yr(fe.lhs)} if ${yr(fe.test)}`}case"TestExpression":{const fe=H;return`${yr(fe.operand)} is${fe.negate?" not":""} ${fe.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const fe=H.value.map(yr),Le=H.type==="ArrayLiteral"?"[]":"()";return`${Le[0]}${fe.join(", ")}${Le[1]}`}case"ObjectLiteral":return`{${Array.from(H.value.entries()).map(([Le,Xe])=>`${yr(Le)}: ${yr(Xe)}`).join(", ")}}`;case"SliceExpression":{const fe=H,Le=fe.start?yr(fe.start):"",Xe=fe.stop?yr(fe.stop):"",ft=fe.step?`:${yr(fe.step)}`:"";return`${Le}:${Xe}${ft}`}case"KeywordArgumentExpression":{const fe=H;return`${fe.key.value}=${yr(fe.value)}`}case"Ternary":{const fe=H,Le=`${yr(fe.trueExpr)} if ${yr(fe.condition,0)} else ${yr(fe.falseExpr)}`;return Pe>-1?`(${Le})`:Le}default:throw new Error(`Unknown expression type: ${H.type}`)}}var As=class{constructor(H){$e(this,"parsed");const Pe=m(H,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=be(Pe)}render(H){const Pe=new Ct;if(It(Pe),H)for(const[Xe,ft]of Object.entries(H))Pe.set(Xe,ft);return new jt(Pe).run(this.parsed).value}format(H){return ai(this.parsed,(H==null?void 0:H.indent)||"	")}}},"./src/backends/onnx.js":(t,e,r)=>{var n;r.r(e),r.d(e,{Tensor:()=>f.Tensor,createInferenceSession:()=>_,deviceToExecutionProviders:()=>p,isONNXProxy:()=>T,isONNXTensor:()=>v});var a=r("./src/env.js"),h=r("?2ce3"),x=r("onnxruntime-web"),f=r("onnxruntime-common");const s=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),d=[];let m,o;const l=Symbol.for("onnxruntime");if(l in globalThis)o=globalThis[l];else if(a.apis.IS_NODE_ENV){switch(o=h!=null?h:n||(n=r.t(h,2)),process.platform){case"win32":d.push("dml");break;case"linux":process.arch==="x64"&&d.push("cuda");break}d.push("cpu"),m=["cpu"]}else o=x,a.apis.IS_WEBNN_AVAILABLE&&d.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),a.apis.IS_WEBGPU_AVAILABLE&&d.push("webgpu"),d.push("wasm"),m=["wasm"];const u=o.InferenceSession;function p(C=null){var P;if(!C)return m;switch(C){case"auto":return d;case"gpu":return d.filter(O=>["webgpu","cuda","dml","webnn-gpu"].includes(O))}if(d.includes(C))return[(P=s[C])!=null?P:C];throw new Error(`Unsupported device: "${C}". Should be one of: ${d.join(", ")}.`)}let w=null;async function _(C,P,O){w&&await w;const D=u.create(C,P);w!=null||(w=D);const L=await D;return L.config=O,L}function v(C){return C instanceof o.Tensor}const y=o==null?void 0:o.env;y!=null&&y.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!y.wasm.wasmPaths&&(y.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${a.env.version}/dist/`),y.wasm.proxy=!1),y!=null&&y.webgpu&&(y.webgpu.powerPreference="high-performance");function T(){var C;return(C=y==null?void 0:y.wasm)==null?void 0:C.proxy}a.env.backends.onnx=y},"./src/base/feature_extraction_utils.js":(t,e,r)=>{r.r(e),r.d(e,{FeatureExtractor:()=>x,validate_audio_inputs:()=>f});var n=r("./src/utils/constants.js"),a=r("./src/utils/generic.js"),h=r("./src/utils/hub.js");class x extends a.Callable{constructor(d){super(),this.config=d}static async from_pretrained(d,m={}){const o=await(0,h.getModelJSON)(d,n.FEATURE_EXTRACTOR_NAME,!0,m);return new this(o)}}function f(s,d){var m,o;if(!(s instanceof Float32Array||s instanceof Float64Array))throw new Error(`${d} expects input to be a Float32Array or a Float64Array, but got ${(o=(m=s==null?void 0:s.constructor)==null?void 0:m.name)!=null?o:typeof s} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(t,e,r)=>{r.r(e),r.d(e,{ImageProcessor:()=>C,center_to_corners_format:()=>o,post_process_instance_segmentation:()=>T,post_process_object_detection:()=>l,post_process_panoptic_segmentation:()=>y,post_process_semantic_segmentation:()=>u});var n=r("./src/utils/generic.js"),a=r("./src/utils/tensor.js"),h=r("./src/utils/maths.js");r("./src/utils/image.js");var x=r("./src/utils/core.js"),f=r("./src/utils/hub.js"),s=r("./src/utils/constants.js");function d(P,O,D=0,L=null){const W=P/O;let U=(0,h.bankers_round)(W)*O;return L!==null&&U>L&&(U=Math.floor(W)*O),U<D&&(U=Math.ceil(W)*O),U}function m([P,O],D){return[Math.max(Math.floor(P/D),1)*D,Math.max(Math.floor(O/D),1)*D]}function o([P,O,D,L]){return[P-D/2,O-L/2,P+D/2,O+L/2]}function l(P,O=.5,D=null,L=!1){const W=P.logits,U=P.pred_boxes,[te,pe,ne]=W.dims;if(D!==null&&D.length!==te)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ye=[];for(let ce=0;ce<te;++ce){let Me=D!==null?D[ce]:null,ke={boxes:[],classes:[],scores:[]},ve=W[ce],K=U[ce];for(let re=0;re<pe;++re){let X=ve[re],N=[],ae;if(L){ae=X.sigmoid().data;for(let J=0;J<ae.length;++J)ae[J]>O&&N.push(J)}else{let J=(0,h.max)(X.data)[1];if(J===ne-1||(ae=(0,h.softmax)(X.data),ae[J]<O))continue;N.push(J)}for(const J of N){let Y=K[re].data;Y=o(Y),Me!==null&&(Y=Y.map((be,Ce)=>be*Me[(Ce+1)%2])),ke.boxes.push(Y),ke.classes.push(J),ke.scores.push(ae[J])}}ye.push(ke)}return ye}function u(P,O=null){const D=P.logits,L=D.dims[0];if(O!==null&&O.length!==L)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const W=[];for(let U=0;U<L;++U){const te=O!==null?O[U]:null;let pe=D[U];te!==null&&(pe=(0,a.interpolate)(pe,te,"bilinear",!1));const[ne,ye]=te!=null?te:pe.dims.slice(-2),ce=new a.Tensor("int32",new Int32Array(ne*ye),[ne,ye]),Me=pe[0].data,ke=ce.data;for(let re=1;re<pe.dims[0];++re){const X=pe[re].data;for(let N=0;N<X.length;++N)X[N]>Me[N]&&(Me[N]=X[N],ke[N]=re)}const ve=new Array(pe.dims[0]);for(let re=0;re<ke.length;++re){const X=ke[re];ve[X]=X}const K=ve.filter(re=>re!==void 0);W.push({segmentation:ce,labels:K})}return W}function p(P,O,D,L){const W=[],U=[],te=[];for(let pe=0;pe<P.dims[0];++pe){const ne=P[pe],ye=O[pe],ce=(0,h.max)(ne.data)[1];if(ce===L)continue;const ke=(0,h.softmax)(ne.data)[ce];ke>D&&(W.push(ye),U.push(ke),te.push(ce))}return[W,U,te]}function w(P,O,D,L=.5,W=.8){const U=[];let te=0,pe=0;const ne=O[D].data;for(let ce=0;ce<P.length;++ce)P[ce]===D&&(U.push(ce),++te),ne[ce]>=L&&++pe;let ye=te>0&&pe>0;return ye&&(ye=te/pe>W),[ye,U]}function _(P,O,D,L,W,U=null,te=null){const[pe,ne]=te!=null?te:P[0].dims,ye=new a.Tensor("int32",new Int32Array(pe*ne),[pe,ne]),ce=[];if(te!==null)for(let re=0;re<P.length;++re)P[re]=(0,a.interpolate)(P[re],te,"bilinear",!1);const Me=new Int32Array(P[0].data.length),ke=new Float32Array(P[0].data.length);for(let re=0;re<P.length;++re){let X=O[re];const N=P[re].data;for(let ae=0;ae<N.length;++ae)N[ae]*=X,N[ae]>ke[ae]&&(Me[ae]=re,ke[ae]=N[ae])}let ve=0;const K=ye.data;for(let re=0;re<D.length;++re){const X=D[re],[N,ae]=w(Me,P,re,L,W);if(!!N){++ve;for(const J of ae)K[J]=ve;ce.push({id:ve,label_id:X,score:O[re]})}}return[ye,ce]}function v(P,O,D=28,L=56*56,W=14*14*4*1280){if(P<D||O<D)throw new Error(`height:${P} or width:${O} must be larger than factor:${D}`);if(Math.max(P,O)/Math.min(P,O)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(P,O)/Math.min(P,O)}`);let U=Math.round(P/D)*D,te=Math.round(O/D)*D;if(U*te>W){const pe=Math.sqrt(P*O/W);U=Math.floor(P/pe/D)*D,te=Math.floor(O/pe/D)*D}else if(U*te<L){const pe=Math.sqrt(L/(P*O));U=Math.ceil(P*pe/D)*D,te=Math.ceil(O*pe/D)*D}return[U,te]}function y(P,O=.5,D=.5,L=.8,W=null,U=null){var ve,K;W===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),W=new Set);const te=(ve=P.class_queries_logits)!=null?ve:P.logits,ne=((K=P.masks_queries_logits)!=null?K:P.pred_masks).sigmoid();let[ye,ce,Me]=te.dims;if(Me-=1,U!==null&&U.length!==ye)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ke=[];for(let re=0;re<ye;++re){let X=U!==null?U[re]:null,N=te[re],ae=ne[re],[J,Y,be]=p(N,ae,O,Me);if(be.length===0){let[Ve,Ie]=X!=null?X:ae.dims.slice(-2),he=new a.Tensor("int32",new Int32Array(Ve*Ie).fill(-1),[Ve,Ie]);ke.push({segmentation:he,segments_info:[]});continue}let[Ce,Ue]=_(J,Y,be,D,L,W,X);ke.push({segmentation:Ce,segments_info:Ue})}return ke}function T(P,O=.5,D=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class C extends n.Callable{constructor(O){var D,L,W,U,te,pe,ne,ye,ce,Me;super(),this.image_mean=(D=O.image_mean)!=null?D:O.mean,this.image_std=(L=O.image_std)!=null?L:O.std,this.resample=(W=O.resample)!=null?W:2,this.do_rescale=(U=O.do_rescale)!=null?U:!0,this.rescale_factor=(te=O.rescale_factor)!=null?te:1/255,this.do_normalize=O.do_normalize,this.do_thumbnail=O.do_thumbnail,this.size=(pe=O.size)!=null?pe:O.image_size,this.do_resize=(ne=O.do_resize)!=null?ne:this.size!==void 0,this.size_divisibility=(ye=O.size_divisibility)!=null?ye:O.size_divisor,this.do_center_crop=O.do_center_crop,this.crop_size=O.crop_size,this.do_convert_rgb=(ce=O.do_convert_rgb)!=null?ce:!0,this.do_crop_margin=O.do_crop_margin,this.pad_size=O.pad_size,this.do_pad=O.do_pad,this.min_pixels=O.min_pixels,this.max_pixels=O.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=(Me=O.do_flip_channel_order)!=null?Me:!1,this.config=O}async thumbnail(O,D,L=2){const W=O.height,U=O.width,te=D.height,pe=D.width;let ne=Math.min(W,te),ye=Math.min(U,pe);return ne===W&&ye===U?O:(W>U?ye=Math.floor(U*ne/W):U>W&&(ne=Math.floor(W*ye/U)),await O.resize(ye,ne,{resample:L}))}async crop_margin(O,D=200){const L=O.clone().grayscale(),W=(0,h.min)(L.data)[0],te=(0,h.max)(L.data)[0]-W;if(te===0)return O;const pe=D/255;let ne=L.width,ye=L.height,ce=0,Me=0;const ke=L.data;for(let ve=0;ve<L.height;++ve){const K=ve*L.width;for(let re=0;re<L.width;++re)(ke[K+re]-W)/te<pe&&(ne=Math.min(ne,re),ye=Math.min(ye,ve),ce=Math.max(ce,re),Me=Math.max(Me,ve))}return O=await O.crop([ne,ye,ce,Me]),O}pad_image(O,D,L,{mode:W="constant",center:U=!1,constant_values:te=0}={}){const[pe,ne,ye]=D;let ce,Me;if(typeof L=="number"?(ce=L,Me=L):L==="square"?ce=Me=Math.max(pe,ne):(ce=L.width,Me=L.height),ce!==ne||Me!==pe){const ke=new Float32Array(ce*Me*ye);if(Array.isArray(te))for(let re=0;re<ke.length;++re)ke[re]=te[re%ye];else te!==0&&ke.fill(te);const[ve,K]=U?[Math.floor((ce-ne)/2),Math.floor((Me-pe)/2)]:[0,0];for(let re=0;re<pe;++re){const X=(re+K)*ce,N=re*ne;for(let ae=0;ae<ne;++ae){const J=(X+ae+ve)*ye,Y=(N+ae)*ye;for(let be=0;be<ye;++be)ke[J+be]=O[Y+be]}}if(W==="symmetric"){if(U)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const re=pe-1,X=ne-1;for(let N=0;N<Me;++N){const ae=N*ce,J=(0,x.calculateReflectOffset)(N,re)*ne;for(let Y=0;Y<ce;++Y){if(N<pe&&Y<ne)continue;const be=(ae+Y)*ye,Ce=(J+(0,x.calculateReflectOffset)(Y,X))*ye;for(let Ue=0;Ue<ye;++Ue)ke[be+Ue]=O[Ce+Ue]}}}O=ke,D=[Me,ce,ye]}return[O,D]}rescale(O){for(let D=0;D<O.length;++D)O[D]=this.rescale_factor*O[D]}get_resize_output_image_size(O,D){var pe;const[L,W]=O.size;let U,te;if(this.do_thumbnail){const{height:ne,width:ye}=D;U=Math.min(ne,ye)}else Number.isInteger(D)?(U=D,te=(pe=this.config.max_size)!=null?pe:U):D!==void 0&&(U=D.shortest_edge,te=D.longest_edge);if(U!==void 0||te!==void 0){const ne=U===void 0?1:Math.max(U/L,U/W),ye=L*ne,ce=W*ne,Me=te===void 0?1:Math.min(te/ye,te/ce);let ke=Math.floor(Number((ye*Me).toFixed(2))),ve=Math.floor(Number((ce*Me).toFixed(2)));return this.size_divisibility!==void 0&&([ke,ve]=m([ke,ve],this.size_divisibility)),[ke,ve]}else if(D!==void 0&&D.width!==void 0&&D.height!==void 0){let ne=D.width,ye=D.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let ce=ye/W,Me=ne/L;Math.abs(1-Me)<Math.abs(1-ce)?ce=Me:Me=ce,ye=d(ce*W,this.config.ensure_multiple_of),ne=d(Me*L,this.config.ensure_multiple_of)}return[ne,ye]}else{if(this.size_divisibility!==void 0)return m([L,W],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const ne=this.config.patch_size*this.config.merge_size;return v(W,L,ne,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(D)}`)}}async resize(O){const[D,L]=this.get_resize_output_image_size(O,this.size);return await O.resize(D,L,{resample:this.resample})}async preprocess(O,{do_normalize:D=null,do_pad:L=null,do_convert_rgb:W=null,do_convert_grayscale:U=null,do_flip_channel_order:te=null}={}){this.do_crop_margin&&(O=await this.crop_margin(O));const[pe,ne]=O.size;if((W!=null?W:this.do_convert_rgb)?O=O.rgb():U&&(O=O.grayscale()),this.do_resize&&(O=await this.resize(O)),this.do_thumbnail&&(O=await this.thumbnail(O,this.size,this.resample)),this.do_center_crop){let ve,K;Number.isInteger(this.crop_size)?(ve=this.crop_size,K=this.crop_size):(ve=this.crop_size.width,K=this.crop_size.height),O=await O.center_crop(ve,K)}const ye=[O.height,O.width];let ce=Float32Array.from(O.data),Me=[O.height,O.width,O.channels];if(this.do_rescale&&this.rescale(ce),D!=null?D:this.do_normalize){let ve=this.image_mean;Array.isArray(this.image_mean)||(ve=new Array(O.channels).fill(ve));let K=this.image_std;if(Array.isArray(this.image_std)||(K=new Array(O.channels).fill(ve)),ve.length!==O.channels||K.length!==O.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${ve.length}) and \`image_std\` (${K.length}) must match the number of channels in the image (${O.channels}).`);for(let re=0;re<ce.length;re+=O.channels)for(let X=0;X<O.channels;++X)ce[re+X]=(ce[re+X]-ve[X])/K[X]}if(L!=null?L:this.do_pad){if(this.pad_size)[ce,Me]=this.pad_image(ce,[O.height,O.width,O.channels],this.pad_size);else if(this.size_divisibility){const[ve,K]=m([Me[1],Me[0]],this.size_divisibility);[ce,Me]=this.pad_image(ce,Me,{width:ve,height:K})}}if(te!=null?te:this.do_flip_channel_order){if(Me[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let ve=0;ve<ce.length;ve+=3){const K=ce[ve];ce[ve]=ce[ve+2],ce[ve+2]=K}}const ke=new a.Tensor("float32",ce,Me).permute(2,0,1);return{original_size:[ne,pe],reshaped_input_size:ye,pixel_values:ke}}async _call(O,...D){Array.isArray(O)||(O=[O]);const L=await Promise.all(O.map(U=>this.preprocess(U)));return{pixel_values:(0,a.stack)(L.map(U=>U.pixel_values),0),original_sizes:L.map(U=>U.original_size),reshaped_input_sizes:L.map(U=>U.reshaped_input_size)}}static async from_pretrained(O,D={}){const L=await(0,f.getModelJSON)(O,s.IMAGE_PROCESSOR_NAME,!0,D);return new this(L)}}},"./src/base/processing_utils.js":(t,e,r)=>{r.r(e),r.d(e,{Processor:()=>x});var n=r("./src/utils/constants.js"),a=r("./src/utils/generic.js"),h=r("./src/utils/hub.js");class x extends a.Callable{constructor(s,d,m){super(),this.config=s,this.components=d,this.chat_template=m}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(s,d={}){var m;if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(s,{tokenize:!1,chat_template:(m=this.chat_template)!=null?m:void 0,...d})}batch_decode(...s){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...s)}decode(...s){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...s)}async _call(s,...d){for(const m of[this.image_processor,this.feature_extractor,this.tokenizer])if(m)return m(s,...d);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(s,d={}){const[m,o,l]=await Promise.all([this.uses_processor_config?(0,h.getModelJSON)(s,n.PROCESSOR_NAME,!0,d):{},Promise.all(this.classes.filter(u=>u in this).map(async u=>{const p=await this[u].from_pretrained(s,d);return[u.replace(/_class$/,""),p]})).then(Object.fromEntries),this.uses_chat_template_file?(0,h.getModelText)(s,n.CHAT_TEMPLATE_NAME,!0,d):null]);return new this(m,o,l)}}$e(x,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),$e(x,"uses_processor_config",!1),$e(x,"uses_chat_template_file",!1)},"./src/configs.js":(t,e,r)=>{r.r(e),r.d(e,{AutoConfig:()=>d,PretrainedConfig:()=>s,getKeyValueShapes:()=>f});var n=r("./src/utils/core.js"),a=r("./src/utils/hub.js");async function h(m,o){return await(0,a.getModelJSON)(m,"config.json",!0,o)}function x(m){const o={};let l={};switch(m.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"smolvlm":case"gemma3n":l=x(m.text_config);break;case"moondream1":l=x(m.phi_config);break;case"musicgen":l=x(m.decoder);break;case"multi_modality":l=x(m.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":o.num_heads="n_head",o.num_layers="n_layer",o.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":o.num_heads="num_attention_heads",o.num_layers="num_hidden_layers",o.hidden_size="hidden_size";break;case"llama":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":o.num_heads="num_key_value_heads",o.num_layers="num_hidden_layers",o.hidden_size="hidden_size",o.num_attention_heads="num_attention_heads";break;case"qwen3":case"gemma":case"gemma2":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":o.num_heads="num_key_value_heads",o.num_layers="num_hidden_layers",o.dim_kv="head_dim";break;case"openelm":o.num_heads="num_kv_heads",o.num_layers="num_transformer_layers",o.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":o.num_heads="num_heads",o.num_layers="num_layers",o.hidden_size="hidden_size";break;case"bloom":o.num_heads="n_head",o.num_layers="n_layer",o.hidden_size="hidden_size";break;case"mpt":o.num_heads="n_heads",o.num_layers="n_layers",o.hidden_size="d_model";break;case"exaone":o.num_heads="num_key_value_heads",o.num_layers="num_layers",o.dim_kv="head_dim",o.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":o.num_decoder_layers="num_decoder_layers",o.num_decoder_heads="num_heads",o.decoder_dim_kv="d_kv",o.num_encoder_layers="num_layers",o.num_encoder_heads="num_heads",o.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":o.num_decoder_layers="decoder_layers",o.num_decoder_heads="decoder_attention_heads",o.decoder_hidden_size="d_model",o.num_encoder_layers="encoder_layers",o.num_encoder_heads="encoder_attention_heads",o.encoder_hidden_size="d_model";break;case"speecht5":o.num_decoder_layers="decoder_layers",o.num_decoder_heads="decoder_attention_heads",o.decoder_hidden_size="hidden_size",o.num_encoder_layers="encoder_layers",o.num_encoder_heads="encoder_attention_heads",o.encoder_hidden_size="hidden_size";break;case"trocr":o.num_encoder_layers=o.num_decoder_layers="decoder_layers",o.num_encoder_heads=o.num_decoder_heads="decoder_attention_heads",o.encoder_hidden_size=o.decoder_hidden_size="d_model";break;case"musicgen_decoder":o.num_encoder_layers=o.num_decoder_layers="num_hidden_layers",o.num_encoder_heads=o.num_decoder_heads="num_attention_heads",o.encoder_hidden_size=o.decoder_hidden_size="hidden_size";break;case"moonshine":o.num_decoder_layers="decoder_num_hidden_layers",o.num_decoder_heads="decoder_num_key_value_heads",o.num_encoder_layers="encoder_num_hidden_layers",o.num_encoder_heads="encoder_num_key_value_heads",o.encoder_hidden_size=o.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const p=x(m.decoder),w="num_decoder_layers"in p,_=(0,n.pick)(m,["model_type","is_encoder_decoder"]);return w?(_.num_decoder_layers=p.num_decoder_layers,_.num_decoder_heads=p.num_decoder_heads,_.decoder_hidden_size=p.decoder_hidden_size,_.num_encoder_layers=p.num_encoder_layers,_.num_encoder_heads=p.num_encoder_heads,_.encoder_hidden_size=p.encoder_hidden_size):(_.num_layers=p.num_layers,_.num_heads=p.num_heads,_.hidden_size=p.hidden_size),_}const u={...l,...(0,n.pick)(m,["model_type","multi_query","is_encoder_decoder"])};for(const p in o)u[p]=m[o[p]];return u}function f(m,{prefix:o="past_key_values",batch_size:l=1}={}){var w,_,v,y;const u={},p=m.normalized_config;if(p.is_encoder_decoder&&"num_encoder_heads"in p&&"num_decoder_heads"in p){const T=(w=p.encoder_dim_kv)!=null?w:p.encoder_hidden_size/p.num_encoder_heads,C=(_=p.decoder_dim_kv)!=null?_:p.decoder_hidden_size/p.num_decoder_heads,P=[l,p.num_encoder_heads,0,T],O=[l,p.num_decoder_heads,0,C];for(let D=0;D<p.num_decoder_layers;++D)u[`${o}.${D}.encoder.key`]=P,u[`${o}.${D}.encoder.value`]=P,u[`${o}.${D}.decoder.key`]=O,u[`${o}.${D}.decoder.value`]=O}else{const T=p.num_heads,C=p.num_layers,P=(y=p.dim_kv)!=null?y:p.hidden_size/((v=p.num_attention_heads)!=null?v:T);if(p.model_type==="falcon"){const O=[l*T,0,P];for(let D=0;D<C;++D)u[`${o}.${D}.key`]=O,u[`${o}.${D}.value`]=O}else if(p.multi_query){const O=[l*T,0,2*P];for(let D=0;D<C;++D)u[`${o}.${D}.key_value`]=O}else if(p.model_type==="bloom"){const O=[l*T,P,0],D=[l*T,0,P];for(let L=0;L<C;++L)u[`${o}.${L}.key`]=O,u[`${o}.${L}.value`]=D}else if(p.model_type==="openelm")for(let O=0;O<C;++O){const D=[l,T[O],0,P];u[`${o}.${O}.key`]=D,u[`${o}.${O}.value`]=D}else{const O=[l,T,0,P];for(let D=0;D<C;++D)u[`${o}.${D}.key`]=O,u[`${o}.${D}.value`]=O}}return u}class s{constructor(o){$e(this,"model_type",null);$e(this,"is_encoder_decoder",!1);$e(this,"max_position_embeddings");$e(this,"transformers.js_config");Object.assign(this,o),this.normalized_config=x(this)}static async from_pretrained(o,{progress_callback:l=null,config:u=null,cache_dir:p=null,local_files_only:w=!1,revision:_="main"}={}){u&&!(u instanceof s)&&(u=new s(u));const v=u!=null?u:await h(o,{progress_callback:l,config:u,cache_dir:p,local_files_only:w,revision:_});return new this(v)}}class d{static async from_pretrained(...o){return s.from_pretrained(...o)}}},"./src/env.js":(t,e,r)=>{var W,U;r.r(e),r.d(e,{apis:()=>v,env:()=>D});var n=r("?db59"),a=r("?383f"),h=r("?fa4b");const x="3.6.3",f=typeof window<"u"&&typeof window.document<"u",s=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes((W=self.constructor)==null?void 0:W.name),d=typeof self<"u"&&"caches"in self,m=typeof navigator<"u"&&"gpu"in navigator,o=typeof navigator<"u"&&"ml"in navigator,l=typeof process<"u",u=l&&((U=process==null?void 0:process.release)==null?void 0:U.name)==="node",p=!L(n),w=!L(a),_=typeof globalThis.Deno<"u",v=Object.freeze({IS_BROWSER_ENV:f,IS_WEBWORKER_ENV:s,IS_WEB_CACHE_AVAILABLE:d,IS_WEBGPU_AVAILABLE:m,IS_WEBNN_AVAILABLE:o,IS_PROCESS_AVAILABLE:l,IS_NODE_ENV:u,IS_FS_AVAILABLE:p,IS_PATH_AVAILABLE:w}),y=p&&w;let T="./";if(y){const te=Object(import.meta).url;te?T=a.dirname(a.dirname(h.fileURLToPath(te))):typeof __dirname<"u"&&(T=a.dirname(__dirname))}const C=y?a.join(T,"/.cache/"):null,P="/models/",O=y?a.join(T,P):P,D={version:x,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(f||s),localModelPath:O,useFS:p,useBrowserCache:d&&!_,useFSCache:p,cacheDir:C,useCustomCache:!1,customCache:null};function L(te){return Object.keys(te).length===0}},"./src/generation/configuration_utils.js":(t,e,r)=>{r.r(e),r.d(e,{GenerationConfig:()=>a});var n=r("./src/utils/core.js");class a{constructor(x){$e(this,"max_length",20);$e(this,"max_new_tokens",null);$e(this,"min_length",0);$e(this,"min_new_tokens",null);$e(this,"early_stopping",!1);$e(this,"max_time",null);$e(this,"do_sample",!1);$e(this,"num_beams",1);$e(this,"num_beam_groups",1);$e(this,"penalty_alpha",null);$e(this,"use_cache",!0);$e(this,"temperature",1);$e(this,"top_k",50);$e(this,"top_p",1);$e(this,"typical_p",1);$e(this,"epsilon_cutoff",0);$e(this,"eta_cutoff",0);$e(this,"diversity_penalty",0);$e(this,"repetition_penalty",1);$e(this,"encoder_repetition_penalty",1);$e(this,"length_penalty",1);$e(this,"no_repeat_ngram_size",0);$e(this,"bad_words_ids",null);$e(this,"force_words_ids",null);$e(this,"renormalize_logits",!1);$e(this,"constraints",null);$e(this,"forced_bos_token_id",null);$e(this,"forced_eos_token_id",null);$e(this,"remove_invalid_values",!1);$e(this,"exponential_decay_length_penalty",null);$e(this,"suppress_tokens",null);$e(this,"streamer",null);$e(this,"begin_suppress_tokens",null);$e(this,"forced_decoder_ids",null);$e(this,"guidance_scale",null);$e(this,"num_return_sequences",1);$e(this,"output_attentions",!1);$e(this,"output_hidden_states",!1);$e(this,"output_scores",!1);$e(this,"return_dict_in_generate",!1);$e(this,"pad_token_id",null);$e(this,"bos_token_id",null);$e(this,"eos_token_id",null);$e(this,"encoder_no_repeat_ngram_size",0);$e(this,"decoder_start_token_id",null);$e(this,"generation_kwargs",{});Object.assign(this,(0,n.pick)(x,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(t,e,r)=>{r.r(e),r.d(e,{ClassifierFreeGuidanceLogitsProcessor:()=>v,ForcedBOSTokenLogitsProcessor:()=>s,ForcedEOSTokenLogitsProcessor:()=>d,LogitsProcessor:()=>h,LogitsProcessorList:()=>f,LogitsWarper:()=>x,MinLengthLogitsProcessor:()=>p,MinNewTokensLengthLogitsProcessor:()=>w,NoBadWordsLogitsProcessor:()=>_,NoRepeatNGramLogitsProcessor:()=>l,RepetitionPenaltyLogitsProcessor:()=>u,SuppressTokensAtBeginLogitsProcessor:()=>m,TemperatureLogitsWarper:()=>y,TopKLogitsWarper:()=>C,TopPLogitsWarper:()=>T,WhisperTimeStampLogitsProcessor:()=>o});var n=r("./src/utils/generic.js");r("./src/utils/tensor.js");var a=r("./src/utils/maths.js");class h extends n.Callable{_call(O,D){throw Error("`_call` should be implemented in a subclass")}}class x extends n.Callable{_call(O,D){throw Error("`_call` should be implemented in a subclass")}}class f extends n.Callable{constructor(){super(),this.processors=[]}push(O){this.processors.push(O)}extend(O){this.processors.push(...O)}_call(O,D){let L=D;for(const W of this.processors)L=W(O,L);return L}[Symbol.iterator](){return this.processors.values()}}class s extends h{constructor(O){super(),this.bos_token_id=O}_call(O,D){for(let L=0;L<O.length;++L)if(O[L].length===1){const W=D[L].data;W.fill(-1/0),W[this.bos_token_id]=0}return D}}class d extends h{constructor(O,D){super(),this.max_length=O,this.eos_token_id=Array.isArray(D)?D:[D]}_call(O,D){for(let L=0;L<O.length;++L)if(O[L].length===this.max_length-1){const W=D[L].data;W.fill(-1/0);for(const U of this.eos_token_id)W[U]=0}return D}}class m extends h{constructor(O,D){super(),this.begin_suppress_tokens=O,this.begin_index=D}_call(O,D){for(let L=0;L<O.length;++L)if(O[L].length===this.begin_index){const W=D[L].data;for(const U of this.begin_suppress_tokens)W[U]=-1/0}return D}}class o extends h{constructor(O,D){super(),this.eos_token_id=Array.isArray(O.eos_token_id)?O.eos_token_id[0]:O.eos_token_id,this.no_timestamps_token_id=O.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=D.length,D.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=O.max_initial_timestamp_index}_call(O,D){for(let L=0;L<O.length;++L){const W=D[L].data;if(W[this.no_timestamps_token_id]=-1/0,O[L].length===this.begin_index-1){W.fill(-1/0),W[this.timestamp_begin]=0;continue}const U=O[L].slice(this.begin_index),te=U.length>=1&&U[U.length-1]>=this.timestamp_begin,pe=U.length<2||U[U.length-2]>=this.timestamp_begin;if(te&&(pe?W.subarray(this.timestamp_begin).fill(-1/0):W.subarray(0,this.eos_token_id).fill(-1/0)),O[L].length===this.begin_index&&this.max_initial_timestamp_index!==null){const Me=this.timestamp_begin+this.max_initial_timestamp_index;W.subarray(Me+1).fill(-1/0)}const ne=(0,a.log_softmax)(W),ye=Math.log(ne.subarray(this.timestamp_begin).map(Math.exp).reduce((Me,ke)=>Me+ke)),ce=(0,a.max)(ne.subarray(0,this.timestamp_begin))[0];ye>ce&&W.subarray(0,this.timestamp_begin).fill(-1/0)}return D}}class l extends h{constructor(O){super(),this.no_repeat_ngram_size=O}getNgrams(O){var U;const D=O.length,L=[];for(let te=0;te<D+1-this.no_repeat_ngram_size;++te){const pe=[];for(let ne=0;ne<this.no_repeat_ngram_size;++ne)pe.push(O[te+ne]);L.push(pe.map(Number))}const W=new Map;for(const te of L){const pe=te.slice(0,te.length-1),ne=JSON.stringify(pe),ye=(U=W.get(ne))!=null?U:[];ye.push(te[te.length-1]),W.set(ne,ye)}return W}getGeneratedNgrams(O,D){var U;const L=D.slice(D.length+1-this.no_repeat_ngram_size,D.length);return(U=O.get(JSON.stringify(L.map(Number))))!=null?U:[]}calcBannedNgramTokens(O){const D=[];if(O.length+1<this.no_repeat_ngram_size)return D;{const L=this.getNgrams(O);return this.getGeneratedNgrams(L,O)}}_call(O,D){for(let L=0;L<O.length;++L){const W=D[L].data,U=this.calcBannedNgramTokens(O[L]);for(const te of U)W[te]=-1/0}return D}}class u extends h{constructor(O){super(),this.penalty=O}_call(O,D){for(let L=0;L<O.length;++L){const W=D[L].data;for(const U of new Set(O[L])){const te=Number(U);W[te]<0?W[te]*=this.penalty:W[te]/=this.penalty}}return D}}class p extends h{constructor(O,D){super(),this.min_length=O,this.eos_token_id=Array.isArray(D)?D:[D]}_call(O,D){for(let L=0;L<O.length;++L)if(O[L].length<this.min_length){const W=D[L].data;for(const U of this.eos_token_id)W[U]=-1/0}return D}}class w extends h{constructor(O,D,L){super(),this.prompt_length_to_skip=O,this.min_new_tokens=D,this.eos_token_id=Array.isArray(L)?L:[L]}_call(O,D){for(let L=0;L<O.length;++L)if(O[L].length-this.prompt_length_to_skip<this.min_new_tokens){const U=D[L].data;for(const te of this.eos_token_id)U[te]=-1/0}return D}}class _ extends h{constructor(O,D){super(),this.bad_words_ids=O,this.eos_token_id=Array.isArray(D)?D:[D]}_call(O,D){for(let L=0;L<O.length;++L){const W=D[L].data,U=O[L];for(const te of this.bad_words_ids){if(U.length<te.length-1)continue;let pe=!0;for(let ne=1;ne<=te.length-1;++ne)if(te.at(-ne-1)!=U.at(-ne)){pe=!1;break}pe&&(W[te.at(-1)]=-1/0)}}return D}}class v extends h{constructor(O){if(super(),O<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${O}.`);this.guidance_scale=O}_call(O,D){if(D.dims[0]!==2*O.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${D.dims[0]} for the logits and ${O.length} for the input ids.`);const L=O.length,W=D.slice([0,L],null),U=D.slice([L,D.dims[0]],null);for(let te=0;te<U.data.length;++te)U.data[te]+=(W.data[te]-U.data[te])*this.guidance_scale;return U}}class y extends x{constructor(O){super(),this.temperature=O}_call(O,D){const L=D.data;for(let W=0;W<L.length;++W)L[W]/=this.temperature;return D}}class T extends x{constructor(O,{filter_value:D=-1/0,min_tokens_to_keep:L=1}={}){if(super(),O<0||O>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${O}`);if(!Number.isInteger(L)||L<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${L}`);this.top_p=O,this.filter_value=D,this.min_tokens_to_keep=L}}class C extends x{constructor(O,{filter_value:D=-1/0,min_tokens_to_keep:L=1}={}){if(super(),!Number.isInteger(O)||O<0)throw new Error(`\`top_k\` must be a positive integer, but is ${O}`);this.top_k=Math.max(O,L),this.filter_value=D}}},"./src/generation/logits_sampler.js":(t,e,r)=>{r.r(e),r.d(e,{LogitsSampler:()=>x});var n=r("./src/utils/generic.js"),a=r("./src/utils/tensor.js"),h=r("./src/utils/maths.js");r("./src/generation/configuration_utils.js");class x extends n.Callable{constructor(o){super(),this.generation_config=o}async _call(o){return this.sample(o)}async sample(o){throw Error("sample should be implemented in subclasses.")}getLogits(o,l){let u=o.dims.at(-1),p=o.data;if(l===-1)p=p.slice(-u);else{let w=l*u;p=p.slice(w,w+u)}return p}randomSelect(o){let l=0;for(let p=0;p<o.length;++p)l+=o[p];let u=Math.random()*l;for(let p=0;p<o.length;++p)if(u-=o[p],u<=0)return p;return 0}static getSampler(o){if(o.do_sample)return new s(o);if(o.num_beams>1)return new d(o);if(o.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${o.num_return_sequences}.`);return new f(o)}}class f extends x{async sample(o){const l=(0,h.max)(o.data)[1];return[[BigInt(l),0]]}}class s extends x{async sample(o){let l=o.dims.at(-1);this.generation_config.top_k>0&&(l=Math.min(this.generation_config.top_k,l));const[u,p]=await(0,a.topk)(o,l),w=(0,h.softmax)(u.data);return Array.from({length:this.generation_config.num_beams},()=>{const _=this.randomSelect(w);return[p.data[_],Math.log(w[_])]})}}class d extends x{async sample(o){let l=o.dims.at(-1);this.generation_config.top_k>0&&(l=Math.min(this.generation_config.top_k,l));const[u,p]=await(0,a.topk)(o,l),w=(0,h.softmax)(u.data);return Array.from({length:this.generation_config.num_beams},(_,v)=>[p.data[v],Math.log(w[v])])}}},"./src/generation/stopping_criteria.js":(t,e,r)=>{r.r(e),r.d(e,{EosTokenCriteria:()=>f,InterruptableStoppingCriteria:()=>s,MaxLengthCriteria:()=>x,StoppingCriteria:()=>a,StoppingCriteriaList:()=>h});var n=r("./src/utils/generic.js");class a extends n.Callable{_call(m,o){throw Error("StoppingCriteria needs to be subclassed")}}class h extends n.Callable{constructor(){super(),this.criteria=[]}push(m){this.criteria.push(m)}extend(m){m instanceof h?m=m.criteria:m instanceof a&&(m=[m]),this.criteria.push(...m)}_call(m,o){const l=new Array(m.length).fill(!1);for(const u of this.criteria){const p=u(m,o);for(let w=0;w<l.length;++w)l[w]||(l[w]=p[w])}return l}[Symbol.iterator](){return this.criteria.values()}}class x extends a{constructor(m,o=null){super(),this.max_length=m,this.max_position_embeddings=o}_call(m){return m.map(o=>o.length>=this.max_length)}}class f extends a{constructor(m){super(),Array.isArray(m)||(m=[m]),this.eos_token_id=m}_call(m,o){return m.map(l=>{const u=l.at(-1);return this.eos_token_id.some(p=>u==p)})}}class s extends a{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(m,o){return new Array(m.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(t,e,r)=>{r.r(e),r.d(e,{BaseStreamer:()=>x,TextStreamer:()=>s,WhisperTextStreamer:()=>d});var n=r("./src/utils/core.js"),a=r("./src/tokenizers.js"),h=r("./src/env.js");class x{put(o){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const f=h.apis.IS_PROCESS_AVAILABLE?m=>process.stdout.write(m):m=>console.log(m);class s extends x{constructor(o,{skip_prompt:l=!1,callback_function:u=null,token_callback_function:p=null,skip_special_tokens:w=!0,decode_kwargs:_={},...v}={}){super(),this.tokenizer=o,this.skip_prompt=l,this.callback_function=u!=null?u:f,this.token_callback_function=p,this.decode_kwargs={skip_special_tokens:w,..._,...v},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(o){var _;if(o.length>1)throw Error("TextStreamer only supports batch size of 1");const l=this.next_tokens_are_prompt;if(l&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const u=o[0];(_=this.token_callback_function)==null||_.call(this,u),this.token_cache=(0,n.mergeArrays)(this.token_cache,u);const p=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let w;l||p.endsWith(`
`)?(w=p.slice(this.print_len),this.token_cache=[],this.print_len=0):p.length>0&&(0,a.is_chinese_char)(p.charCodeAt(p.length-1))?(w=p.slice(this.print_len),this.print_len+=w.length):(w=p.slice(this.print_len,p.lastIndexOf(" ")+1),this.print_len+=w.length),this.on_finalized_text(w,!1)}end(){let o;this.token_cache.length>0?(o=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):o="",this.next_tokens_are_prompt=!0,this.on_finalized_text(o,!0)}on_finalized_text(o,l){var u,p;o.length>0&&((u=this.callback_function)==null||u.call(this,o)),l&&this.callback_function===f&&h.apis.IS_PROCESS_AVAILABLE&&((p=this.callback_function)==null||p.call(this,`
`))}}class d extends s{constructor(o,{skip_prompt:l=!1,callback_function:u=null,token_callback_function:p=null,on_chunk_start:w=null,on_chunk_end:_=null,on_finalize:v=null,time_precision:y=.02,skip_special_tokens:T=!0,decode_kwargs:C={}}={}){super(o,{skip_prompt:l,skip_special_tokens:T,callback_function:u,token_callback_function:p,decode_kwargs:C}),this.timestamp_begin=o.timestamp_begin,this.on_chunk_start=w,this.on_chunk_end=_,this.on_finalize=v,this.time_precision=y,this.waiting_for_timestamp=!1}put(o){var u,p,w;if(o.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const l=o[0];if(l.length===1){const _=Number(l[0])-this.timestamp_begin;if(_>=0){const v=_*this.time_precision;this.waiting_for_timestamp?(u=this.on_chunk_end)==null||u.call(this,v):(p=this.on_chunk_start)==null||p.call(this,v),this.waiting_for_timestamp=!this.waiting_for_timestamp,(w=this.token_callback_function)==null||w.call(this,l);return}}return super.put(o)}end(){var o;super.end(),(o=this.on_finalize)==null||o.call(this)}}},"./src/models.js":(t,e,r)=>{r.r(e),r.d(e,{ASTForAudioClassification:()=>hs,ASTModel:()=>tc,ASTPreTrainedModel:()=>br,AlbertForMaskedLM:()=>Dt,AlbertForQuestionAnswering:()=>_t,AlbertForSequenceClassification:()=>at,AlbertModel:()=>Ye,AlbertPreTrainedModel:()=>We,AutoModel:()=>Ud,AutoModelForAudioClassification:()=>wp,AutoModelForAudioFrameClassification:()=>Bu,AutoModelForAudioTextToText:()=>Ei,AutoModelForCTC:()=>_o,AutoModelForCausalLM:()=>mp,AutoModelForDepthEstimation:()=>Yd,AutoModelForDocumentQuestionAnswering:()=>Hd,AutoModelForImageClassification:()=>kl,AutoModelForImageFeatureExtraction:()=>xp,AutoModelForImageMatting:()=>Kd,AutoModelForImageSegmentation:()=>Vd,AutoModelForImageTextToText:()=>is,AutoModelForImageToImage:()=>Xd,AutoModelForMaskGeneration:()=>Da,AutoModelForMaskedLM:()=>gp,AutoModelForNormalEstimation:()=>qd,AutoModelForObjectDetection:()=>yp,AutoModelForPoseEstimation:()=>Qd,AutoModelForQuestionAnswering:()=>Sm,AutoModelForSemanticSegmentation:()=>vp,AutoModelForSeq2SeqLM:()=>Tm,AutoModelForSequenceClassification:()=>Mm,AutoModelForSpeechSeq2Seq:()=>fp,AutoModelForTextToSpectrogram:()=>hp,AutoModelForTextToWaveform:()=>pp,AutoModelForTokenClassification:()=>dp,AutoModelForUniversalSegmentation:()=>Cm,AutoModelForVision2Seq:()=>_p,AutoModelForXVector:()=>Gd,AutoModelForZeroShotObjectDetection:()=>Wd,BartForConditionalGeneration:()=>Gn,BartForSequenceClassification:()=>$s,BartModel:()=>Ls,BartPretrainedModel:()=>li,BaseModelOutput:()=>Re,BeitForImageClassification:()=>hl,BeitModel:()=>gs,BeitPreTrainedModel:()=>Ac,BertForMaskedLM:()=>Ne,BertForQuestionAnswering:()=>nt,BertForSequenceClassification:()=>ze,BertForTokenClassification:()=>rt,BertModel:()=>Se,BertPreTrainedModel:()=>Be,BlenderbotForConditionalGeneration:()=>Hn,BlenderbotModel:()=>fs,BlenderbotPreTrainedModel:()=>Lr,BlenderbotSmallForConditionalGeneration:()=>_r,BlenderbotSmallModel:()=>An,BlenderbotSmallPreTrainedModel:()=>En,BloomForCausalLM:()=>dl,BloomModel:()=>No,BloomPreTrainedModel:()=>ge,CLIPModel:()=>Xl,CLIPPreTrainedModel:()=>Rn,CLIPSegForImageSegmentation:()=>Af,CLIPSegModel:()=>If,CLIPSegPreTrainedModel:()=>da,CLIPTextModel:()=>el,CLIPTextModelWithProjection:()=>oc,CLIPVisionModel:()=>Pf,CLIPVisionModelWithProjection:()=>Xp,CamembertForMaskedLM:()=>pt,CamembertForQuestionAnswering:()=>or,CamembertForSequenceClassification:()=>nr,CamembertForTokenClassification:()=>vr,CamembertModel:()=>ft,CamembertPreTrainedModel:()=>Xe,CausalLMOutput:()=>Li,CausalLMOutputWithPast:()=>La,ChineseCLIPModel:()=>kf,ChineseCLIPPreTrainedModel:()=>ci,ClapAudioModelWithProjection:()=>bh,ClapModel:()=>wh,ClapPreTrainedModel:()=>wl,ClapTextModelWithProjection:()=>xh,CodeGenForCausalLM:()=>gi,CodeGenModel:()=>Rf,CodeGenPreTrainedModel:()=>Zl,CohereForCausalLM:()=>ru,CohereModel:()=>al,CoherePreTrainedModel:()=>pa,ConvBertForMaskedLM:()=>oa,ConvBertForQuestionAnswering:()=>so,ConvBertForSequenceClassification:()=>dr,ConvBertForTokenClassification:()=>ko,ConvBertModel:()=>io,ConvBertPreTrainedModel:()=>Zi,ConvNextForImageClassification:()=>Zc,ConvNextModel:()=>Di,ConvNextPreTrainedModel:()=>fh,ConvNextV2ForImageClassification:()=>ed,ConvNextV2Model:()=>vu,ConvNextV2PreTrainedModel:()=>Ca,DFineForObjectDetection:()=>_i,DFineModel:()=>Lc,DFinePreTrainedModel:()=>Gs,DPTForDepthEstimation:()=>Vc,DPTModel:()=>Uc,DPTPreTrainedModel:()=>Nc,DacDecoderModel:()=>Uh,DacDecoderOutput:()=>Fi,DacEncoderModel:()=>Fd,DacEncoderOutput:()=>jh,DacModel:()=>Nh,DacPreTrainedModel:()=>Dd,DebertaForMaskedLM:()=>jr,DebertaForQuestionAnswering:()=>hi,DebertaForSequenceClassification:()=>Sn,DebertaForTokenClassification:()=>bi,DebertaModel:()=>qt,DebertaPreTrainedModel:()=>Nt,DebertaV2ForMaskedLM:()=>ir,DebertaV2ForQuestionAnswering:()=>nn,DebertaV2ForSequenceClassification:()=>Ar,DebertaV2ForTokenClassification:()=>Gr,DebertaV2Model:()=>wr,DebertaV2PreTrainedModel:()=>bn,DecisionTransformerModel:()=>Oh,DecisionTransformerPreTrainedModel:()=>Ed,DeiTForImageClassification:()=>wa,DeiTModel:()=>$c,DeiTPreTrainedModel:()=>ya,DepthAnythingForDepthEstimation:()=>Gc,DepthAnythingPreTrainedModel:()=>Wc,DepthProForDepthEstimation:()=>Xc,DepthProPreTrainedModel:()=>ch,DetrForObjectDetection:()=>Dc,DetrForSegmentation:()=>au,DetrModel:()=>Ai,DetrObjectDetectionOutput:()=>_a,DetrPreTrainedModel:()=>ts,DetrSegmentationOutput:()=>Wo,Dinov2ForImageClassification:()=>Hs,Dinov2Model:()=>Ci,Dinov2PreTrainedModel:()=>td,Dinov2WithRegistersForImageClassification:()=>_l,Dinov2WithRegistersModel:()=>rd,Dinov2WithRegistersPreTrainedModel:()=>yu,DistilBertForMaskedLM:()=>ti,DistilBertForQuestionAnswering:()=>ei,DistilBertForSequenceClassification:()=>pi,DistilBertForTokenClassification:()=>sn,DistilBertModel:()=>yn,DistilBertPreTrainedModel:()=>Nr,DonutSwinModel:()=>dh,DonutSwinPreTrainedModel:()=>Jc,EfficientNetForImageClassification:()=>xd,EfficientNetModel:()=>wd,EfficientNetPreTrainedModel:()=>Yo,ElectraForMaskedLM:()=>H,ElectraForQuestionAnswering:()=>Le,ElectraForSequenceClassification:()=>Pe,ElectraForTokenClassification:()=>fe,ElectraModel:()=>As,ElectraPreTrainedModel:()=>yr,Ernie4_5_ForCausalLM:()=>Xo,Ernie4_5_Model:()=>Iu,Ernie4_5_PretrainedModel:()=>ka,EsmForMaskedLM:()=>Ds,EsmForSequenceClassification:()=>oo,EsmForTokenClassification:()=>Io,EsmModel:()=>rr,EsmPreTrainedModel:()=>Mi,ExaoneForCausalLM:()=>nl,ExaoneModel:()=>Us,ExaonePreTrainedModel:()=>ha,FalconForCausalLM:()=>yh,FalconModel:()=>am,FalconPreTrainedModel:()=>Yn,FastViTForImageClassification:()=>Ui,FastViTModel:()=>ih,FastViTPreTrainedModel:()=>Oc,Florence2ForConditionalGeneration:()=>Sf,Florence2PreTrainedModel:()=>Ao,GLPNForDepthEstimation:()=>Sa,GLPNModel:()=>Qc,GLPNPreTrainedModel:()=>qc,GPT2LMHeadModel:()=>Pn,GPT2Model:()=>Do,GPT2PreTrainedModel:()=>uc,GPTBigCodeForCausalLM:()=>dn,GPTBigCodeModel:()=>Dn,GPTBigCodePreTrainedModel:()=>Zr,GPTJForCausalLM:()=>Tr,GPTJModel:()=>Ht,GPTJPreTrainedModel:()=>ot,GPTNeoForCausalLM:()=>$f,GPTNeoModel:()=>Lf,GPTNeoPreTrainedModel:()=>cc,GPTNeoXForCausalLM:()=>ht,GPTNeoXModel:()=>Qe,GPTNeoXPreTrainedModel:()=>uo,Gemma2ForCausalLM:()=>ii,Gemma2Model:()=>Cn,Gemma2PreTrainedModel:()=>vc,Gemma3ForCausalLM:()=>wc,Gemma3Model:()=>Uf,Gemma3PreTrainedModel:()=>yc,Gemma3nForConditionalGeneration:()=>Ii,Gemma3nPreTrainedModel:()=>Hl,GemmaForCausalLM:()=>ll,GemmaModel:()=>_c,GemmaPreTrainedModel:()=>gc,GlmForCausalLM:()=>Yp,GlmModel:()=>zf,GlmPreTrainedModel:()=>fc,GraniteForCausalLM:()=>Nf,GraniteModel:()=>jf,GranitePreTrainedModel:()=>mc,GroundingDinoForObjectDetection:()=>wu,GroundingDinoPreTrainedModel:()=>nd,GroupViTModel:()=>ho,GroupViTPreTrainedModel:()=>nh,HeliumForCausalLM:()=>rl,HeliumModel:()=>dc,HeliumPreTrainedModel:()=>eu,HieraForImageClassification:()=>Zp,HieraModel:()=>Rc,HieraPreTrainedModel:()=>pu,HubertForCTC:()=>Eu,HubertForSequenceClassification:()=>vl,HubertModel:()=>gh,HubertPreTrainedModel:()=>Cu,IJepaForImageClassification:()=>ps,IJepaModel:()=>qf,IJepaPreTrainedModel:()=>Ni,Idefics3ForConditionalGeneration:()=>ca,Idefics3PreTrainedModel:()=>Cf,ImageMattingOutput:()=>bp,JAISLMHeadModel:()=>Ff,JAISModel:()=>Df,JAISPreTrainedModel:()=>Jl,JinaCLIPModel:()=>Ql,JinaCLIPPreTrainedModel:()=>ql,JinaCLIPTextModel:()=>lc,JinaCLIPVisionModel:()=>js,LiteWhisperForConditionalGeneration:()=>Bs,LlamaForCausalLM:()=>Fo,LlamaModel:()=>Bf,LlamaPreTrainedModel:()=>fa,LlavaForConditionalGeneration:()=>Wl,LlavaOnevisionForConditionalGeneration:()=>nc,LlavaPreTrainedModel:()=>rc,LlavaQwen2ForCausalLM:()=>Gl,LongT5ForConditionalGeneration:()=>rn,LongT5Model:()=>ri,LongT5PreTrainedModel:()=>Hr,M2M100ForConditionalGeneration:()=>ad,M2M100Model:()=>hh,M2M100PreTrainedModel:()=>od,MBartForCausalLM:()=>qr,MBartForConditionalGeneration:()=>Ti,MBartForSequenceClassification:()=>ds,MBartModel:()=>In,MBartPreTrainedModel:()=>un,MPNetForMaskedLM:()=>ao,MPNetForQuestionAnswering:()=>lo,MPNetForSequenceClassification:()=>Fs,MPNetForTokenClassification:()=>st,MPNetModel:()=>Vn,MPNetPreTrainedModel:()=>xr,MT5ForConditionalGeneration:()=>Wn,MT5Model:()=>Mn,MT5PreTrainedModel:()=>Ur,MarianMTModel:()=>nm,MarianModel:()=>Tu,MarianPreTrainedModel:()=>Mu,MaskFormerForInstanceSegmentation:()=>Rr,MaskFormerModel:()=>_u,MaskFormerPreTrainedModel:()=>Yc,MaskedLMOutput:()=>On,Metric3DForDepthEstimation:()=>Ma,Metric3DPreTrainedModel:()=>tm,Metric3Dv2ForDepthEstimation:()=>gl,Metric3Dv2PreTrainedModel:()=>Ta,MgpstrForSceneTextRecognition:()=>Dh,MgpstrModelOutput:()=>Ah,MgpstrPreTrainedModel:()=>dm,MimiDecoderModel:()=>zh,MimiDecoderOutput:()=>Ad,MimiEncoderModel:()=>Bh,MimiEncoderOutput:()=>Ru,MimiModel:()=>Rh,MimiPreTrainedModel:()=>$u,MistralForCausalLM:()=>fr,MistralModel:()=>Ko,MistralPreTrainedModel:()=>Oa,MobileBertForMaskedLM:()=>Ot,MobileBertForQuestionAnswering:()=>pn,MobileBertForSequenceClassification:()=>Ut,MobileBertModel:()=>Tt,MobileBertPreTrainedModel:()=>Un,MobileLLMForCausalLM:()=>Xr,MobileLLMModel:()=>il,MobileLLMPreTrainedModel:()=>hc,MobileNetV1ForImageClassification:()=>Ml,MobileNetV1ForSemanticSegmentation:()=>Tl,MobileNetV1Model:()=>Eh,MobileNetV1PreTrainedModel:()=>bl,MobileNetV2ForImageClassification:()=>Sl,MobileNetV2ForSemanticSegmentation:()=>Td,MobileNetV2Model:()=>qo,MobileNetV2PreTrainedModel:()=>Ia,MobileNetV3ForImageClassification:()=>Lu,MobileNetV3ForSemanticSegmentation:()=>ns,MobileNetV3Model:()=>Aa,MobileNetV3PreTrainedModel:()=>Cl,MobileNetV4ForImageClassification:()=>Cd,MobileNetV4ForSemanticSegmentation:()=>Ph,MobileNetV4Model:()=>Sd,MobileNetV4PreTrainedModel:()=>Ts,MobileViTForImageClassification:()=>kc,MobileViTModel:()=>Vo,MobileViTPreTrainedModel:()=>po,MobileViTV2ForImageClassification:()=>sh,MobileViTV2Model:()=>Bn,MobileViTV2PreTrainedModel:()=>Vs,ModelOutput:()=>we,ModernBertForMaskedLM:()=>jt,ModernBertForSequenceClassification:()=>Fr,ModernBertForTokenClassification:()=>lr,ModernBertModel:()=>It,ModernBertPreTrainedModel:()=>Ct,Moondream1ForConditionalGeneration:()=>Ja,MoonshineForConditionalGeneration:()=>Vl,MoonshineModel:()=>Kp,MoonshinePreTrainedModel:()=>ui,MptForCausalLM:()=>Sc,MptModel:()=>Vr,MptPreTrainedModel:()=>Si,MultiModalityCausalLM:()=>Ih,MultiModalityPreTrainedModel:()=>kh,MusicgenForCausalLM:()=>cm,MusicgenForConditionalGeneration:()=>Md,MusicgenModel:()=>um,MusicgenPreTrainedModel:()=>bd,NeoBertForMaskedLM:()=>gt,NeoBertForQuestionAnswering:()=>bt,NeoBertForSequenceClassification:()=>ct,NeoBertForTokenClassification:()=>wt,NeoBertModel:()=>qe,NeoBertPreTrainedModel:()=>Ge,NomicBertModel:()=>gn,NomicBertPreTrainedModel:()=>cr,OPTForCausalLM:()=>fo,OPTModel:()=>Hf,OPTPreTrainedModel:()=>Cc,Olmo2ForCausalLM:()=>ol,Olmo2Model:()=>co,Olmo2PreTrainedModel:()=>Lo,OlmoForCausalLM:()=>pc,OlmoModel:()=>sl,OlmoPreTrainedModel:()=>tu,OpenELMForCausalLM:()=>ma,OpenELMModel:()=>nu,OpenELMPreTrainedModel:()=>xc,OwlViTForObjectDetection:()=>fl,OwlViTModel:()=>su,OwlViTPreTrainedModel:()=>iu,Owlv2ForObjectDetection:()=>ou,Owlv2Model:()=>Ic,Owlv2PreTrainedModel:()=>Ws,PaliGemmaForConditionalGeneration:()=>sc,PaliGemmaPreTrainedModel:()=>ic,PatchTSMixerForPrediction:()=>Id,PatchTSMixerModel:()=>kd,PatchTSMixerPreTrainedModel:()=>Od,PatchTSTForPrediction:()=>Lh,PatchTSTModel:()=>Fh,PatchTSTPreTrainedModel:()=>Pd,Phi3ForCausalLM:()=>Tc,Phi3Model:()=>jo,Phi3PreTrainedModel:()=>zo,Phi3VForCausalLM:()=>Kl,Phi3VPreTrainedModel:()=>Ef,PhiForCausalLM:()=>Gf,PhiModel:()=>Mc,PhiPreTrainedModel:()=>bc,PreTrainedModel:()=>ee,PretrainedMixin:()=>Qr,PvtForImageClassification:()=>eh,PvtModel:()=>Zf,PvtPreTrainedModel:()=>Ec,PyAnnoteForAudioFrameClassification:()=>vs,PyAnnoteModel:()=>sm,PyAnnotePreTrainedModel:()=>Vi,QuestionAnsweringModelOutput:()=>Fn,Qwen2ForCausalLM:()=>ga,Qwen2Model:()=>$o,Qwen2PreTrainedModel:()=>ul,Qwen2VLForConditionalGeneration:()=>Wf,Qwen2VLPreTrainedModel:()=>Vf,Qwen3ForCausalLM:()=>Bo,Qwen3Model:()=>cl,Qwen3PreTrainedModel:()=>Ro,RFDetrForObjectDetection:()=>cu,RFDetrModel:()=>rs,RFDetrObjectDetectionOutput:()=>du,RFDetrPreTrainedModel:()=>uu,RTDetrForObjectDetection:()=>Jp,RTDetrModel:()=>Fc,RTDetrObjectDetectionOutput:()=>mo,RTDetrPreTrainedModel:()=>_s,RTDetrV2ForObjectDetection:()=>Xn,RTDetrV2Model:()=>va,RTDetrV2ObjectDetectionOutput:()=>pl,RTDetrV2PreTrainedModel:()=>lu,ResNetForImageClassification:()=>ah,ResNetModel:()=>em,ResNetPreTrainedModel:()=>Go,RoFormerForMaskedLM:()=>ai,RoFormerForQuestionAnswering:()=>Ji,RoFormerForSequenceClassification:()=>vn,RoFormerForTokenClassification:()=>Nn,RoFormerModel:()=>Zn,RoFormerPreTrainedModel:()=>Jr,RobertaForMaskedLM:()=>aa,RobertaForQuestionAnswering:()=>Gt,RobertaForSequenceClassification:()=>Kr,RobertaForTokenClassification:()=>Kn,RobertaModel:()=>es,RobertaPreTrainedModel:()=>Br,SamImageSegmentationOutput:()=>sd,SamModel:()=>Xs,SamPreTrainedModel:()=>rm,SapiensForDepthEstimation:()=>Hc,SapiensForNormalEstimation:()=>Kc,SapiensForSemanticSegmentation:()=>uh,SapiensPreTrainedModel:()=>ba,SegformerForImageClassification:()=>Fu,SegformerForSemanticSegmentation:()=>Sh,SegformerModel:()=>yi,SegformerPreTrainedModel:()=>Hi,Seq2SeqLMOutput:()=>Fa,SequenceClassifierOutput:()=>mr,SiglipModel:()=>Of,SiglipPreTrainedModel:()=>ji,SiglipTextModel:()=>Yl,SiglipVisionModel:()=>ac,SmolLM3ForCausalLM:()=>on,SmolLM3Model:()=>tl,SmolLM3PreTrainedModel:()=>Ns,SmolVLMForConditionalGeneration:()=>Za,SnacDecoderModel:()=>Gh,SnacEncoderModel:()=>Wh,SnacModel:()=>Vh,SnacPreTrainedModel:()=>El,SpeechT5ForSpeechToText:()=>vh,SpeechT5ForTextToSpeech:()=>Ms,SpeechT5HifiGan:()=>Pa,SpeechT5Model:()=>om,SpeechT5PreTrainedModel:()=>yl,SqueezeBertForMaskedLM:()=>Q,SqueezeBertForQuestionAnswering:()=>De,SqueezeBertForSequenceClassification:()=>ue,SqueezeBertModel:()=>Je,SqueezeBertPreTrainedModel:()=>cs,StableLmForCausalLM:()=>Ch,StableLmModel:()=>lm,StableLmPreTrainedModel:()=>xl,Starcoder2ForCausalLM:()=>yd,Starcoder2Model:()=>Du,Starcoder2PreTrainedModel:()=>Au,StyleTextToSpeech2Model:()=>vd,StyleTextToSpeech2PreTrainedModel:()=>_d,Swin2SRForImageSuperResolution:()=>gu,Swin2SRModel:()=>mu,Swin2SRPreTrainedModel:()=>jc,SwinForImageClassification:()=>zc,SwinForSemanticSegmentation:()=>lh,SwinModel:()=>Bc,SwinPreTrainedModel:()=>xa,T5ForConditionalGeneration:()=>pr,T5Model:()=>zt,T5PreTrainedModel:()=>Et,TableTransformerForObjectDetection:()=>oh,TableTransformerModel:()=>fu,TableTransformerObjectDetectionOutput:()=>hu,TableTransformerPreTrainedModel:()=>ml,TokenClassifierOutput:()=>Tn,TrOCRForCausalLM:()=>ku,TrOCRPreTrainedModel:()=>Ou,UltravoxModel:()=>fm,UltravoxPreTrainedModel:()=>$h,UniSpeechForCTC:()=>ph,UniSpeechForSequenceClassification:()=>dd,UniSpeechModel:()=>cd,UniSpeechPreTrainedModel:()=>ys,UniSpeechSatForAudioFrameClassification:()=>hd,UniSpeechSatForCTC:()=>mh,UniSpeechSatForSequenceClassification:()=>fd,UniSpeechSatModel:()=>Ea,UniSpeechSatPreTrainedModel:()=>ws,ViTForImageClassification:()=>Yf,ViTMAEModel:()=>th,ViTMAEPreTrainedModel:()=>ms,ViTMSNForImageClassification:()=>rh,ViTMSNModel:()=>qp,ViTMSNPreTrainedModel:()=>Pc,ViTModel:()=>Xf,ViTPreTrainedModel:()=>Kf,VisionEncoderDecoderModel:()=>zs,VitMatteForImageMatting:()=>Uo,VitMattePreTrainedModel:()=>Qp,VitPoseForPoseEstimation:()=>Jf,VitPosePreTrainedModel:()=>Qf,VitsModel:()=>Th,VitsModelOutput:()=>Mp,VitsPreTrainedModel:()=>Mh,Wav2Vec2BertForCTC:()=>Su,Wav2Vec2BertForSequenceClassification:()=>si,Wav2Vec2BertModel:()=>pd,Wav2Vec2BertPreTrainedModel:()=>Ho,Wav2Vec2ForAudioFrameClassification:()=>vi,Wav2Vec2ForCTC:()=>ld,Wav2Vec2ForSequenceClassification:()=>ud,Wav2Vec2Model:()=>im,Wav2Vec2PreTrainedModel:()=>Ys,WavLMForAudioFrameClassification:()=>gd,WavLMForCTC:()=>_h,WavLMForSequenceClassification:()=>md,WavLMForXVector:()=>bs,WavLMModel:()=>Pu,WavLMPreTrainedModel:()=>xs,WeSpeakerResNetModel:()=>Gi,WeSpeakerResNetPreTrainedModel:()=>Wi,WhisperForConditionalGeneration:()=>_n,WhisperModel:()=>Ul,WhisperPreTrainedModel:()=>ua,XLMForQuestionAnswering:()=>la,XLMForSequenceClassification:()=>Rs,XLMForTokenClassification:()=>Yt,XLMModel:()=>Qa,XLMPreTrainedModel:()=>cn,XLMRobertaForMaskedLM:()=>ec,XLMRobertaForQuestionAnswering:()=>ki,XLMRobertaForSequenceClassification:()=>mi,XLMRobertaForTokenClassification:()=>Tf,XLMRobertaModel:()=>Xt,XLMRobertaPreTrainedModel:()=>dt,XLMWithLMHeadModel:()=>ni,XVectorOutput:()=>Qo,YolosForObjectDetection:()=>bu,YolosModel:()=>xu,YolosObjectDetectionOutput:()=>Ks,YolosPreTrainedModel:()=>id});var n=r("./src/configs.js"),a=r("./src/backends/onnx.js"),h=r("./src/utils/dtypes.js"),x=r("./src/utils/generic.js"),f=r("./src/utils/core.js"),s=r("./src/utils/hub.js"),d=r("./src/utils/constants.js"),m=r("./src/generation/logits_process.js"),o=r("./src/generation/configuration_utils.js"),l=r("./src/utils/tensor.js"),u=r("./src/utils/image.js"),p=r("./src/utils/maths.js"),w=r("./src/generation/stopping_criteria.js"),_=r("./src/generation/logits_sampler.js"),v=r("./src/env.js"),y=r("./src/models/whisper/generation_whisper.js"),T=r("./src/models/whisper/common_whisper.js");const C={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12},P=new Map,O=new Map,D=new Map;async function L(R,V,oe){var E,I,k,$,B,z,G,q,Z,se,le,me,Te;let Ee=(I=(E=oe.config)==null?void 0:E["transformers.js_config"])!=null?I:{},tt=(k=oe.device)!=null?k:Ee.device;tt&&typeof tt!="string"&&(tt.hasOwnProperty(V)?tt=tt[V]:(console.warn(`device not specified for "${V}". Using the default device.`),tt=null));const Ze=tt!=null?tt:v.apis.IS_NODE_ENV?"cpu":"wasm",ut=(0,a.deviceToExecutionProviders)(Ze),xt=($=Ee.device_config)!=null?$:{};xt.hasOwnProperty(Ze)&&(Ee={...Ee,...xt[Ze]});let Pt=(B=oe.dtype)!=null?B:Ee.dtype;if(typeof Pt!="string"&&(Pt&&Pt.hasOwnProperty(V)?Pt=Pt[V]:(Pt=(z=h.DEFAULT_DEVICE_DTYPE_MAPPING[Ze])!=null?z:h.DATA_TYPES.fp32,console.warn(`dtype not specified for "${V}". Using the default dtype (${Pt}) for this device (${Ze}).`))),Pt===h.DATA_TYPES.auto){let de=Ee.dtype;typeof de!="string"&&(de=de==null?void 0:de[V]),de&&de!==h.DATA_TYPES.auto&&h.DATA_TYPES.hasOwnProperty(de)?Pt=de:Pt=(G=h.DEFAULT_DEVICE_DTYPE_MAPPING[Ze])!=null?G:h.DATA_TYPES.fp32}const Bt=Pt;if(h.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(Bt)){if(Bt===h.DATA_TYPES.fp16&&Ze==="webgpu"&&!await(0,h.isWebGpuFp16Supported)())throw new Error(`The device (${Ze}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${Bt}. Should be one of: ${Object.keys(h.DATA_TYPES).join(", ")}`);const Zt=Ee.kv_cache_dtype,Er=Zt?typeof Zt=="string"?Zt:(q=Zt[Bt])!=null?q:"float32":void 0;if(Er&&!["float32","float16"].includes(Er))throw new Error(`Invalid kv_cache_dtype: ${Er}. Should be one of: float32, float16`);const hr={dtype:Bt,kv_cache_dtype:Er,device:Ze},Pr=h.DEFAULT_DTYPE_SUFFIX_MAPPING[Bt],sr=`${V}${Pr}.onnx`,Sr=`${(Z=oe.subfolder)!=null?Z:""}/${sr}`,Qt={...oe.session_options};(se=Qt.executionProviders)!=null||(Qt.executionProviders=ut);const Dr=Ee.free_dimension_overrides;Dr?(le=Qt.freeDimensionOverrides)!=null||(Qt.freeDimensionOverrides=Dr):Ze.startsWith("webnn")&&!Qt.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${Ze}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const mn=v.apis.IS_NODE_ENV&&v.env.useFSCache,i=(0,s.getModelFile)(R,Sr,!0,oe,mn),c=(me=oe.use_external_data_format)!=null?me:Ee.use_external_data_format;let b=[];if(c){let de;typeof c=="object"?c.hasOwnProperty(sr)?de=c[sr]:c.hasOwnProperty(V)?de=c[V]:de=!1:de=c;const _e=+de;if(_e>s.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${_e}) exceeds the maximum allowed value (${s.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let Ae=0;Ae<_e;++Ae){const Oe=`${sr}_data${Ae===0?"":"_"+Ae}`,He=`${(Te=oe.subfolder)!=null?Te:""}/${Oe}`;b.push(new Promise(async(lt,it)=>{const mt=await(0,s.getModelFile)(R,He,!0,oe,mn);lt(mt instanceof Uint8Array?{path:Oe,data:mt}:Oe)}))}}else Qt.externalData!==void 0&&(b=Qt.externalData.map(async de=>{if(typeof de.data=="string"){const _e=await(0,s.getModelFile)(R,de.data,!0,oe);return{...de,data:_e}}return de}));if(b.length>0){const de=await Promise.all(b);v.apis.IS_NODE_ENV||(Qt.externalData=de)}if(Ze==="webgpu"){const de=(0,n.getKeyValueShapes)(oe.config,{prefix:"present"});if(Object.keys(de).length>0&&!(0,a.isONNXProxy)()){const _e={};for(const Ae in de)_e[Ae]="gpu-buffer";Qt.preferredOutputLocation=_e}}return{buffer_or_path:await i,session_options:Qt,session_config:hr}}async function W(R,V,oe){return Object.fromEntries(await Promise.all(Object.keys(V).map(async Ee=>{const{buffer_or_path:tt,session_options:Ze,session_config:ut}=await L(R,V[Ee],oe),xt=await(0,a.createInferenceSession)(tt,Ze,ut);return[Ee,xt]})))}async function U(R,V,oe){return Object.fromEntries(await Promise.all(Object.keys(V).map(async Ee=>{const tt=await(0,s.getModelJSON)(R,V[Ee],!1,oe);return[Ee,tt]})))}function te(R,V){const oe=Object.create(null),Ee=[];for(const ut of R.inputNames){const xt=V[ut];if(!(xt instanceof l.Tensor)){Ee.push(ut);continue}oe[ut]=(0,a.isONNXProxy)()?xt.clone():xt}if(Ee.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${Ee.join(", ")}.`);const tt=Object.keys(V).length,Ze=R.inputNames.length;if(tt>Ze){let ut=Object.keys(V).filter(xt=>!R.inputNames.includes(xt));console.warn(`WARNING: Too many inputs were provided (${tt} > ${Ze}). The following inputs will be ignored: "${ut.join(", ")}".`)}return oe}let pe=Promise.resolve();async function ne(R,V){const oe=te(R,V);try{const Ee=Object.fromEntries(Object.entries(oe).map(([ut,xt])=>[ut,xt.ort_tensor])),tt=()=>R.run(Ee),Ze=await(v.apis.IS_BROWSER_ENV||v.apis.IS_WEBWORKER_ENV?pe=pe.then(tt):tt());return ye(Ze)}catch(Ee){const tt=Object.fromEntries(Object.entries(oe).map(([Ze,ut])=>{const xt={type:ut.type,dims:ut.dims,location:ut.location};return xt.location!=="gpu-buffer"&&(xt.data=ut.data),[Ze,xt]}));throw console.error(`An error occurred during model execution: "${Ee}".`),console.error("Inputs given to model:",tt),Ee}}function ye(R){for(let V in R)(0,a.isONNXTensor)(R[V])?R[V]=new l.Tensor(R[V]):typeof R[V]=="object"&&ye(R[V]);return R}function ce(R){if(R instanceof l.Tensor)return R;if(R.length===0)throw Error("items must be non-empty");if(Array.isArray(R[0])){if(R.some(V=>V.length!==R[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new l.Tensor("int64",BigInt64Array.from(R.flat().map(V=>BigInt(V))),[R.length,R[0].length])}else return new l.Tensor("int64",BigInt64Array.from(R.map(V=>BigInt(V))),[1,R.length])}function Me(R){return new l.Tensor("bool",[R],[1])}async function ke(R,V){let{encoder_outputs:oe,input_ids:Ee,decoder_input_ids:tt,...Ze}=V;if(!oe){const xt=(0,f.pick)(V,R.sessions.model.inputNames);oe=(await ve(R,xt)).last_hidden_state}return Ze.input_ids=tt,Ze.encoder_hidden_states=oe,R.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(Ze.encoder_attention_mask=V.attention_mask),await re(R,Ze,!0)}async function ve(R,V){const oe=R.sessions.model,Ee=(0,f.pick)(V,oe.inputNames);if(oe.inputNames.includes("inputs_embeds")&&!Ee.inputs_embeds){if(!V.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");Ee.inputs_embeds=await R.encode_text({input_ids:V.input_ids})}if(oe.inputNames.includes("token_type_ids")&&!Ee.token_type_ids){if(!Ee.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");Ee.token_type_ids=(0,l.zeros_like)(Ee.input_ids)}if(oe.inputNames.includes("pixel_mask")&&!Ee.pixel_mask){if(!Ee.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const tt=Ee.pixel_values.dims;Ee.pixel_mask=(0,l.ones)([tt[0],tt[2],tt[3]])}return await ne(oe,Ee)}async function K(R,V){const oe=await R.encode(V);return await R.decode(oe)}async function re(R,V,oe=!1){const Ee=R.sessions[oe?"decoder_model_merged":"model"],{past_key_values:tt,...Ze}=V;if(Ee.inputNames.includes("use_cache_branch")&&(Ze.use_cache_branch=Me(!!tt)),Ee.inputNames.includes("position_ids")&&Ze.attention_mask&&!Ze.position_ids){const xt=["paligemma","gemma3_text","gemma3"].includes(R.config.model_type)?1:0;Ze.position_ids=Ue(Ze,tt,xt)}R.addPastKeyValues(Ze,tt);const ut=(0,f.pick)(Ze,Ee.inputNames);return await ne(Ee,ut)}function X({modality_token_id:R,inputs_embeds:V,modality_features:oe,input_ids:Ee,attention_mask:tt}){const Ze=Ee.tolist().map(Bt=>Bt.reduce((Zt,Er,hr)=>(Er==R&&Zt.push(hr),Zt),[])),ut=Ze.reduce((Bt,Zt)=>Bt+Zt.length,0),xt=oe.dims[0];if(ut!==xt)throw new Error(`Number of tokens and features do not match: tokens: ${ut}, features ${xt}`);let Pt=0;for(let Bt=0;Bt<Ze.length;++Bt){const Zt=Ze[Bt],Er=V[Bt];for(let hr=0;hr<Zt.length;++hr)Er[Zt[hr]].data.set(oe[Pt++].data)}return{inputs_embeds:V,attention_mask:tt}}function N({image_token_id:R,inputs_embeds:V,image_features:oe,input_ids:Ee,attention_mask:tt}){return X({modality_token_id:R,inputs_embeds:V,modality_features:oe,input_ids:Ee,attention_mask:tt})}function ae({audio_token_id:R,inputs_embeds:V,audio_features:oe,input_ids:Ee,attention_mask:tt}){return X({modality_token_id:R,inputs_embeds:V,modality_features:oe,input_ids:Ee,attention_mask:tt})}async function J(R,{encode_function:V,merge_function:oe,modality_input_name:Ee,modality_output_name:tt,input_ids:Ze=null,attention_mask:ut=null,position_ids:xt=null,inputs_embeds:Pt=null,past_key_values:Bt=null,generation_config:Zt=null,logits_processor:Er=null,...hr}){const Pr=hr[Ee];if(!Pt){if(Pt=await R.encode_text({input_ids:Ze,...hr}),Pr&&Ze.dims[1]!==1){const Sr=await V({[Ee]:Pr,...hr});({inputs_embeds:Pt,attention_mask:ut}=oe({[tt]:Sr,inputs_embeds:Pt,input_ids:Ze,attention_mask:ut}))}else if(Bt&&Pr&&Ze.dims[1]===1){const Sr=Ze.dims[1],Qt=Object.values(Bt)[0].dims.at(-2);ut=(0,l.cat)([(0,l.ones)([Ze.dims[0],Qt]),ut.slice(null,[ut.dims[1]-Sr,ut.dims[1]])],1)}}if(!xt&&R.config.model_type==="qwen2_vl"){const{image_grid_thw:Sr,video_grid_thw:Qt}=hr;[xt]=R.get_rope_index(Ze,Sr,Qt,ut)}return await re(R,{inputs_embeds:Pt,past_key_values:Bt,attention_mask:ut,position_ids:xt,generation_config:Zt,logits_processor:Er},!0)}async function Y(R,V){return await J(R,{...V,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:R.encode_audio.bind(R),merge_function:R._merge_input_ids_with_audio_features.bind(R)})}async function be(R,V){return await J(R,{...V,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:R.encode_image.bind(R),merge_function:R._merge_input_ids_with_image_features.bind(R)})}function Ce(R,V=0){const[oe,Ee]=R.dims,tt=R.data,Ze=new BigInt64Array(tt.length);for(let ut=0;ut<oe;++ut){const xt=ut*Ee;let Pt=BigInt(V);for(let Bt=0;Bt<Ee;++Bt){const Zt=xt+Bt;tt[Zt]===0n?Ze[Zt]=BigInt(1):(Ze[Zt]=Pt,Pt+=tt[Zt])}}return{data:Ze,dims:R.dims}}function Ue(R,V=null,oe=0){const{input_ids:Ee,inputs_embeds:tt,attention_mask:Ze}=R,{data:ut,dims:xt}=Ce(Ze,oe);let Pt=new l.Tensor("int64",ut,xt);if(V){const Bt=-(Ee!=null?Ee:tt).dims.at(1);Pt=Pt.slice(null,[Bt,null])}return Pt}function Ve(R,V,oe,Ee){const tt=oe.past_key_values?Object.values(oe.past_key_values)[0].dims.at(-2):0;if(!oe.attention_mask){let Ze;for(const ut of["input_ids","inputs_embeds","position_ids"])if(oe[ut]){Ze=oe[ut].dims;break}if(!Ze)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");oe.attention_mask=(0,l.ones)([Ze[0],tt+Ze[1]])}if(oe.past_key_values){const{input_ids:Ze,attention_mask:ut}=oe;ut&&ut.dims[1]>Ze.dims[1]||tt<Ze.dims[1]&&(oe.input_ids=Ze.slice(null,[tt,null]))}return oe}function Ie(R,V,oe,Ee){return oe.past_key_values&&(V=V.map(tt=>[tt.at(-1)])),{...oe,decoder_input_ids:ce(V)}}function he(R,...V){return R.config.is_encoder_decoder?Ie(R,...V):Ve(R,...V)}function Fe(R,V,oe,Ee){const tt=!!oe.past_key_values;return Ee.guidance_scale!==null&&Ee.guidance_scale>1&&(tt?oe.input_ids=(0,l.cat)([oe.input_ids,oe.input_ids],0):(oe.input_ids=(0,l.cat)([oe.input_ids,(0,l.full_like)(oe.input_ids,BigInt(Ee.pad_token_id))],0),oe.attention_mask=(0,l.cat)([oe.attention_mask,(0,l.full_like)(oe.attention_mask,0n)],0))),(tt||!oe.pixel_values)&&(oe.pixel_values=(0,l.full)([0,0,3,384,384],1)),tt&&(oe.images_seq_mask=new l.Tensor("bool",new Array(0+1).fill(!0).fill(!1,0,1),[1,0+1]),oe.images_emb_mask=new l.Tensor("bool",new Array(0).fill(!1),[1,1,0])),oe}class ee extends x.Callable{constructor(oe,Ee,tt){var xt;super();$e(this,"main_input_name","input_ids");$e(this,"forward_params",["input_ids","attention_mask"]);this.config=oe,this.sessions=Ee,this.configs=tt;const Ze=D.get(this.constructor),ut=P.get(Ze);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,ut){case C.DecoderOnly:this.can_generate=!0,this._forward=re,this._prepare_inputs_for_generation=Ve;break;case C.Seq2Seq:case C.Vision2Seq:case C.Musicgen:this.can_generate=!0,this._forward=ke,this._prepare_inputs_for_generation=Ie;break;case C.EncoderDecoder:this._forward=ke;break;case C.ImageTextToText:this.can_generate=!0,this._forward=be,this._prepare_inputs_for_generation=he;break;case C.AudioTextToText:this.can_generate=!0,this._forward=Y,this._prepare_inputs_for_generation=he;break;case C.Phi3V:case C.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=he;break;case C.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=Fe;break;case C.AutoEncoder:this._forward=K;break;default:this._forward=ve;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=(xt=this.config["transformers.js_config"])!=null?xt:{}}async dispose(){var Ee;const oe=[];for(const tt of Object.values(this.sessions))(Ee=tt==null?void 0:tt.handler)!=null&&Ee.dispose&&oe.push(tt.handler.dispose());return await Promise.all(oe)}static async from_pretrained(oe,{progress_callback:Ee=null,config:tt=null,cache_dir:Ze=null,local_files_only:ut=!1,revision:xt="main",model_file_name:Pt=null,subfolder:Bt="onnx",device:Zt=null,dtype:Er=null,use_external_data_format:hr=null,session_options:Pr={}}={}){var mn,i;let sr={progress_callback:Ee,config:tt,cache_dir:Ze,local_files_only:ut,revision:xt,model_file_name:Pt,subfolder:Bt,device:Zt,dtype:Er,use_external_data_format:hr,session_options:Pr};const Sr=D.get(this),Qt=P.get(Sr);tt=sr.config=await n.AutoConfig.from_pretrained(oe,sr);let Dr;if(Qt===C.DecoderOnly)Dr=await Promise.all([W(oe,{model:(mn=sr.model_file_name)!=null?mn:"model"},sr),U(oe,{generation_config:"generation_config.json"},sr)]);else if(Qt===C.Seq2Seq||Qt===C.Vision2Seq)Dr=await Promise.all([W(oe,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},sr),U(oe,{generation_config:"generation_config.json"},sr)]);else if(Qt===C.MaskGeneration)Dr=await Promise.all([W(oe,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},sr)]);else if(Qt===C.EncoderDecoder)Dr=await Promise.all([W(oe,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},sr)]);else if(Qt===C.ImageTextToText){const c={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};tt.is_encoder_decoder&&(c.model="encoder_model"),Dr=await Promise.all([W(oe,c,sr),U(oe,{generation_config:"generation_config.json"},sr)])}else if(Qt===C.AudioTextToText){const c={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};Dr=await Promise.all([W(oe,c,sr),U(oe,{generation_config:"generation_config.json"},sr)])}else if(Qt===C.ImageAudioTextToText){const c={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};Dr=await Promise.all([W(oe,c,sr),U(oe,{generation_config:"generation_config.json"},sr)])}else if(Qt===C.Musicgen)Dr=await Promise.all([W(oe,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},sr),U(oe,{generation_config:"generation_config.json"},sr)]);else if(Qt===C.MultiModality)Dr=await Promise.all([W(oe,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},sr),U(oe,{generation_config:"generation_config.json"},sr)]);else if(Qt===C.Phi3V)Dr=await Promise.all([W(oe,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},sr),U(oe,{generation_config:"generation_config.json"},sr)]);else if(Qt===C.AutoEncoder)Dr=await Promise.all([W(oe,{encoder_model:"encoder_model",decoder_model:"decoder_model"},sr)]);else{if(Qt!==C.EncoderOnly){const c=Sr!=null?Sr:tt==null?void 0:tt.model_type;c!=="custom"&&console.warn(`Model type for '${c}' not found, assuming encoder-only architecture. Please report this at ${d.GITHUB_ISSUE_URL}.`)}Dr=await Promise.all([W(oe,{model:(i=sr.model_file_name)!=null?i:"model"},sr)])}return new this(tt,...Dr)}async _call(oe){return await this.forward(oe)}async forward(oe){return await this._forward(this,oe)}get generation_config(){var oe,Ee;return(Ee=(oe=this.configs)==null?void 0:oe.generation_config)!=null?Ee:null}_get_logits_warper(oe){const Ee=new m.LogitsProcessorList;return oe.temperature!==null&&oe.temperature!==1&&Ee.push(new m.TemperatureLogitsWarper(oe.temperature)),oe.top_k!==null&&oe.top_k!==0&&Ee.push(new m.TopKLogitsWarper(oe.top_k)),oe.top_p!==null&&oe.top_p<1&&Ee.push(new m.TopPLogitsWarper(oe.top_p)),Ee}_get_logits_processor(oe,Ee,tt=null){const Ze=new m.LogitsProcessorList;if(oe.repetition_penalty!==null&&oe.repetition_penalty!==1&&Ze.push(new m.RepetitionPenaltyLogitsProcessor(oe.repetition_penalty)),oe.no_repeat_ngram_size!==null&&oe.no_repeat_ngram_size>0&&Ze.push(new m.NoRepeatNGramLogitsProcessor(oe.no_repeat_ngram_size)),oe.bad_words_ids!==null&&Ze.push(new m.NoBadWordsLogitsProcessor(oe.bad_words_ids,oe.eos_token_id)),oe.min_length!==null&&oe.eos_token_id!==null&&oe.min_length>0&&Ze.push(new m.MinLengthLogitsProcessor(oe.min_length,oe.eos_token_id)),oe.min_new_tokens!==null&&oe.eos_token_id!==null&&oe.min_new_tokens>0&&Ze.push(new m.MinNewTokensLengthLogitsProcessor(Ee,oe.min_new_tokens,oe.eos_token_id)),oe.forced_bos_token_id!==null&&Ze.push(new m.ForcedBOSTokenLogitsProcessor(oe.forced_bos_token_id)),oe.forced_eos_token_id!==null&&Ze.push(new m.ForcedEOSTokenLogitsProcessor(oe.max_length,oe.forced_eos_token_id)),oe.begin_suppress_tokens!==null){const ut=Ee>1||oe.forced_bos_token_id===null?Ee:Ee+1;Ze.push(new m.SuppressTokensAtBeginLogitsProcessor(oe.begin_suppress_tokens,ut))}return oe.guidance_scale!==null&&oe.guidance_scale>1&&Ze.push(new m.ClassifierFreeGuidanceLogitsProcessor(oe.guidance_scale)),tt!==null&&Ze.extend(tt),Ze}_prepare_generation_config(oe,Ee,tt=o.GenerationConfig){var xt;const Ze={...this.config};for(const Pt of["decoder","generator","text_config"])Pt in Ze&&Object.assign(Ze,Ze[Pt]);const ut=new tt(Ze);return Object.assign(ut,(xt=this.generation_config)!=null?xt:{}),oe&&Object.assign(ut,oe),Ee&&Object.assign(ut,(0,f.pick)(Ee,Object.getOwnPropertyNames(ut))),ut}_get_stopping_criteria(oe,Ee=null){var Ze;const tt=new w.StoppingCriteriaList;return oe.max_length!==null&&tt.push(new w.MaxLengthCriteria(oe.max_length,(Ze=this.config.max_position_embeddings)!=null?Ze:null)),oe.eos_token_id!==null&&tt.push(new w.EosTokenCriteria(oe.eos_token_id)),Ee&&tt.extend(Ee),tt}_validate_model_class(){if(!this.can_generate){const oe=[Qh,ep,Rd,$d],Ee=D.get(this.constructor),tt=new Set,Ze=this.config.model_type;for(const xt of oe){const Pt=xt.get(Ze);Pt&&tt.add(Pt[0])}let ut=`The current model class (${Ee}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw tt.size>0&&(ut+=` Please use the following class instead: ${[...tt].join(", ")}`),Error(ut)}}prepare_inputs_for_generation(...oe){return this._prepare_inputs_for_generation(this,...oe)}_update_model_kwargs_for_generation({generated_input_ids:oe,outputs:Ee,model_inputs:tt,is_encoder_decoder:Ze}){return tt.past_key_values=this.getPastKeyValues(Ee,tt.past_key_values),tt.input_ids=new l.Tensor("int64",oe.flat(),[oe.length,1]),Ze||(tt.attention_mask=(0,l.cat)([tt.attention_mask,(0,l.ones)([tt.attention_mask.dims[0],1])],1)),tt.position_ids=null,tt}_prepare_model_inputs({inputs:oe,bos_token_id:Ee,model_kwargs:tt}){const Ze=(0,f.pick)(tt,this.forward_params),ut=this.main_input_name;if(ut in Ze){if(oe)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else Ze[ut]=oe;return{inputs_tensor:Ze[ut],model_inputs:Ze,model_input_name:ut}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:oe,model_inputs:Ee,model_input_name:tt,generation_config:Ze}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!Ee.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:xt,pixel_values:Pt,attention_mask:Bt,...Zt}=Ee,Er=await this._prepare_inputs_embeds(Ee);Ee={...Zt,...(0,f.pick)(Er,["inputs_embeds","attention_mask"])}}let{last_hidden_state:ut}=await ve(this,Ee);if(Ze.guidance_scale!==null&&Ze.guidance_scale>1)ut=(0,l.cat)([ut,(0,l.full_like)(ut,0)],0),"attention_mask"in Ee&&(Ee.attention_mask=(0,l.cat)([Ee.attention_mask,(0,l.zeros_like)(Ee.attention_mask)],0));else if(Ee.decoder_input_ids){const xt=ce(Ee.decoder_input_ids).dims[0];if(xt!==ut.dims[0]){if(ut.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${ut.dims[0]}) than the decoder inputs (${xt}).`);ut=(0,l.cat)(Array.from({length:xt},()=>ut),0)}}return Ee.encoder_outputs=ut,Ee}_prepare_decoder_input_ids_for_generation({batch_size:oe,model_input_name:Ee,model_kwargs:tt,decoder_start_token_id:Ze,bos_token_id:ut,generation_config:xt}){let{decoder_input_ids:Pt,...Bt}=tt;if(!(Pt instanceof l.Tensor)){if(Pt)Array.isArray(Pt[0])||(Pt=Array.from({length:oe},()=>Pt));else if(Ze!=null||(Ze=ut),this.config.model_type==="musicgen")Pt=Array.from({length:oe*this.config.decoder.num_codebooks},()=>[Ze]);else if(Array.isArray(Ze)){if(Ze.length!==oe)throw new Error(`\`decoder_start_token_id\` expcted to have length ${oe} but got ${Ze.length}`);Pt=Ze}else Pt=Array.from({length:oe},()=>[Ze]);Pt=ce(Pt)}return tt.decoder_attention_mask=(0,l.ones_like)(Pt),{input_ids:Pt,model_inputs:Bt}}async generate({inputs:oe=null,generation_config:Ee=null,logits_processor:tt=null,stopping_criteria:Ze=null,streamer:ut=null,...xt}){this._validate_model_class(),Ee=this._prepare_generation_config(Ee,xt);let{inputs_tensor:Pt,model_inputs:Bt,model_input_name:Zt}=this._prepare_model_inputs({inputs:oe,model_kwargs:xt});const Er=this.config.is_encoder_decoder;Er&&("encoder_outputs"in Bt||(Bt=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:Pt,model_inputs:Bt,model_input_name:Zt,generation_config:Ee})));let hr;Er?{input_ids:hr,model_inputs:Bt}=this._prepare_decoder_input_ids_for_generation({batch_size:Bt[Zt].dims.at(0),model_input_name:Zt,model_kwargs:Bt,decoder_start_token_id:Ee.decoder_start_token_id,bos_token_id:Ee.bos_token_id,generation_config:Ee}):hr=Bt[Zt];let Pr=hr.dims.at(-1);Ee.max_new_tokens!==null&&(Ee.max_length=Pr+Ee.max_new_tokens);const sr=this._get_logits_processor(Ee,Pr,tt),Sr=this._get_stopping_criteria(Ee,Ze),Qt=Bt[Zt].dims.at(0),Dr=_.LogitsSampler.getSampler(Ee),mn=new Array(Qt).fill(0),i=hr.tolist();ut&&ut.put(i);let c,b={};for(;;){if(Bt=this.prepare_inputs_for_generation(i,Bt,Ee),c=await this.forward(Bt),Ee.output_attentions&&Ee.return_dict_in_generate){const z=this.getAttentions(c);for(const G in z)G in b||(b[G]=[]),b[G].push(z[G])}const I=c.logits.slice(null,-1,null),k=sr(i,I),$=[];for(let z=0;z<k.dims.at(0);++z){const G=k[z],q=await Dr(G);for(const[Z,se]of q){const le=BigInt(Z);mn[z]+=se,i[z].push(le),$.push([le]);break}}if(ut&&ut.put($),Sr(i).every(z=>z))break;Bt=this._update_model_kwargs_for_generation({generated_input_ids:$,outputs:c,model_inputs:Bt,is_encoder_decoder:Er})}ut&&ut.end();const S=this.getPastKeyValues(c,Bt.past_key_values,!0),E=new l.Tensor("int64",i.flat(),[i.length,i[0].length]);if(Ee.return_dict_in_generate)return{sequences:E,past_key_values:S,...b};for(const I of Object.values(c))I.location==="gpu-buffer"&&I.dispose();return E}getPastKeyValues(oe,Ee,tt=!1){const Ze=Object.create(null);for(const ut in oe)if(ut.startsWith("present")){const xt=ut.replace("present","past_key_values"),Pt=ut.includes("encoder");if(Pt&&Ee?Ze[xt]=Ee[xt]:Ze[xt]=oe[ut],Ee&&(!Pt||tt)){const Bt=Ee[xt];Bt.location==="gpu-buffer"&&Bt.dispose()}}return Ze}getAttentions(oe){const Ee={};for(const tt of["cross_attentions","encoder_attentions","decoder_attentions"])for(const Ze in oe)Ze.startsWith(tt)&&(tt in Ee||(Ee[tt]=[]),Ee[tt].push(oe[Ze]));return Ee}addPastKeyValues(oe,Ee){var tt,Ze,ut,xt,Pt,Bt,Zt;if(Ee)Object.assign(oe,Ee);else{const Er=(tt=this.sessions.decoder_model_merged)!=null?tt:this.sessions.model,hr=(ut=(Ze=Er==null?void 0:Er.config)==null?void 0:Ze.kv_cache_dtype)!=null?ut:"float32",Pr=hr==="float16"?new l.DataTypeMap.float16:[],sr=(Zt=(Bt=(Pt=(xt=oe[this.main_input_name])!=null?xt:oe.attention_mask)==null?void 0:Pt.dims)==null?void 0:Bt[0])!=null?Zt:1,Sr=(0,n.getKeyValueShapes)(this.config,{batch_size:sr});for(const Qt in Sr)oe[Qt]=new l.Tensor(hr,Pr,Sr[Qt])}}async encode_image({pixel_values:oe}){return(await ne(this.sessions.vision_encoder,{pixel_values:oe})).image_features}async encode_text({input_ids:oe}){return(await ne(this.sessions.embed_tokens,{input_ids:oe})).inputs_embeds}async encode_audio({audio_values:oe}){return(await ne(this.sessions.audio_encoder,{audio_values:oe})).audio_features}}class we{}class Re extends we{constructor({last_hidden_state:V,hidden_states:oe=null,attentions:Ee=null}){super(),this.last_hidden_state=V,this.hidden_states=oe,this.attentions=Ee}}class Be extends ee{}class Se extends Be{}class Ne extends Be{async _call(V){return new On(await super._call(V))}}class ze extends Be{async _call(V){return new mr(await super._call(V))}}class rt extends Be{async _call(V){return new Tn(await super._call(V))}}class nt extends Be{async _call(V){return new Fn(await super._call(V))}}class Ge extends ee{}class qe extends Ge{}class gt extends Ge{async _call(V){return new On(await super._call(V))}}class ct extends Ge{async _call(V){return new mr(await super._call(V))}}class wt extends Ge{async _call(V){return new Tn(await super._call(V))}}class bt extends Ge{async _call(V){return new Fn(await super._call(V))}}class Ct extends ee{}class It extends Ct{}class jt extends Ct{async _call(V){return new On(await super._call(V))}}class Fr extends Ct{async _call(V){return new mr(await super._call(V))}}class lr extends Ct{async _call(V){return new Tn(await super._call(V))}}class cr extends ee{}class gn extends cr{}class Jr extends ee{}class Zn extends Jr{}class ai extends Jr{async _call(V){return new On(await super._call(V))}}class vn extends Jr{async _call(V){return new mr(await super._call(V))}}class Nn extends Jr{async _call(V){return new Tn(await super._call(V))}}class Ji extends Jr{async _call(V){return new Fn(await super._call(V))}}class Zi extends ee{}class io extends Zi{}class oa extends Zi{async _call(V){return new On(await super._call(V))}}class dr extends Zi{async _call(V){return new mr(await super._call(V))}}class ko extends Zi{async _call(V){return new Tn(await super._call(V))}}class so extends Zi{async _call(V){return new Fn(await super._call(V))}}class yr extends ee{}class As extends yr{}class H extends yr{async _call(V){return new On(await super._call(V))}}class Pe extends yr{async _call(V){return new mr(await super._call(V))}}class fe extends yr{async _call(V){return new Tn(await super._call(V))}}class Le extends yr{async _call(V){return new Fn(await super._call(V))}}class Xe extends ee{}class ft extends Xe{}class pt extends Xe{async _call(V){return new On(await super._call(V))}}class nr extends Xe{async _call(V){return new mr(await super._call(V))}}class vr extends Xe{async _call(V){return new Tn(await super._call(V))}}class or extends Xe{async _call(V){return new Fn(await super._call(V))}}class Nt extends ee{}class qt extends Nt{}class jr extends Nt{async _call(V){return new On(await super._call(V))}}class Sn extends Nt{async _call(V){return new mr(await super._call(V))}}class bi extends Nt{async _call(V){return new Tn(await super._call(V))}}class hi extends Nt{async _call(V){return new Fn(await super._call(V))}}class bn extends ee{}class wr extends bn{}class ir extends bn{async _call(V){return new On(await super._call(V))}}class Ar extends bn{async _call(V){return new mr(await super._call(V))}}class Gr extends bn{async _call(V){return new Tn(await super._call(V))}}class nn extends bn{async _call(V){return new Fn(await super._call(V))}}class Nr extends ee{}class yn extends Nr{}class pi extends Nr{async _call(V){return new mr(await super._call(V))}}class sn extends Nr{async _call(V){return new Tn(await super._call(V))}}class ei extends Nr{async _call(V){return new Fn(await super._call(V))}}class ti extends Nr{async _call(V){return new On(await super._call(V))}}class Mi extends ee{}class rr extends Mi{}class Ds extends Mi{async _call(V){return new On(await super._call(V))}}class oo extends Mi{async _call(V){return new mr(await super._call(V))}}class Io extends Mi{async _call(V){return new Tn(await super._call(V))}}class Un extends ee{}class Tt extends Un{}class Ot extends Un{async _call(V){return new On(await super._call(V))}}class Ut extends Un{async _call(V){return new mr(await super._call(V))}}class pn extends Un{async _call(V){return new Fn(await super._call(V))}}class xr extends ee{}class Vn extends xr{}class ao extends xr{async _call(V){return new On(await super._call(V))}}class Fs extends xr{async _call(V){return new mr(await super._call(V))}}class st extends xr{async _call(V){return new Tn(await super._call(V))}}class lo extends xr{async _call(V){return new Fn(await super._call(V))}}class cs extends ee{}class Je extends cs{}class Q extends cs{async _call(V){return new On(await super._call(V))}}class ue extends cs{async _call(V){return new mr(await super._call(V))}}class De extends cs{async _call(V){return new Fn(await super._call(V))}}class We extends ee{}class Ye extends We{}class at extends We{async _call(V){return new mr(await super._call(V))}}class _t extends We{async _call(V){return new Fn(await super._call(V))}}class Dt extends We{async _call(V){return new On(await super._call(V))}}class Et extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class zt extends Et{}class pr extends Et{}class Hr extends ee{}class ri extends Hr{}class rn extends Hr{}class Ur extends ee{}class Mn extends Ur{}class Wn extends Ur{}class li extends ee{}class Ls extends li{}class Gn extends li{}class $s extends li{async _call(V){return new mr(await super._call(V))}}class un extends ee{}class In extends un{}class Ti extends un{}class ds extends un{async _call(V){return new mr(await super._call(V))}}class qr extends un{}class Lr extends ee{}class fs extends Lr{}class Hn extends Lr{}class En extends ee{}class An extends En{}class _r extends En{}class Br extends ee{}class es extends Br{}class aa extends Br{async _call(V){return new On(await super._call(V))}}class Kr extends Br{async _call(V){return new mr(await super._call(V))}}class Kn extends Br{async _call(V){return new Tn(await super._call(V))}}class Gt extends Br{async _call(V){return new Fn(await super._call(V))}}class cn extends ee{}class Qa extends cn{}class ni extends cn{async _call(V){return new On(await super._call(V))}}class Rs extends cn{async _call(V){return new mr(await super._call(V))}}class Yt extends cn{async _call(V){return new Tn(await super._call(V))}}class la extends cn{async _call(V){return new Fn(await super._call(V))}}class dt extends ee{}class Xt extends dt{}class ec extends dt{async _call(V){return new On(await super._call(V))}}class mi extends dt{async _call(V){return new mr(await super._call(V))}}class Tf extends dt{async _call(V){return new Tn(await super._call(V))}}class ki extends dt{async _call(V){return new Fn(await super._call(V))}}class br extends ee{}class tc extends br{}class hs extends br{}class ua extends ee{constructor(){super(...arguments);$e(this,"requires_attention_mask",!1);$e(this,"main_input_name","input_features");$e(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class Ul extends ua{}class _n extends ua{_prepare_generation_config(V,oe){return super._prepare_generation_config(V,oe,y.WhisperGenerationConfig)}_retrieve_init_tokens(V){const oe=[V.decoder_start_token_id];let Ee=V.language;const tt=V.task;if(V.is_multilingual){Ee||(console.warn("No language specified - defaulting to English (en)."),Ee="en");const ut=`<|${(0,T.whisper_language_to_code)(Ee)}|>`;oe.push(V.lang_to_id[ut]),oe.push(V.task_to_id[tt!=null?tt:"transcribe"])}else if(Ee||tt)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!V.return_timestamps&&V.no_timestamps_token_id&&oe.at(-1)!==V.no_timestamps_token_id?oe.push(V.no_timestamps_token_id):V.return_timestamps&&oe.at(-1)===V.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),oe.pop()),oe.filter(Ze=>Ze!=null)}async generate({inputs:V=null,generation_config:oe=null,logits_processor:Ee=null,stopping_criteria:tt=null,...Ze}){var Pt;oe=this._prepare_generation_config(oe,Ze);const ut=(Pt=Ze.decoder_input_ids)!=null?Pt:this._retrieve_init_tokens(oe);if(oe.return_timestamps&&(Ee!=null||(Ee=new m.LogitsProcessorList),Ee.push(new m.WhisperTimeStampLogitsProcessor(oe,ut))),oe.begin_suppress_tokens&&(Ee!=null||(Ee=new m.LogitsProcessorList),Ee.push(new m.SuppressTokensAtBeginLogitsProcessor(oe.begin_suppress_tokens,ut.length))),oe.return_token_timestamps){if(!oe.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");oe.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),oe.output_attentions=!0,oe.return_dict_in_generate=!0}const xt=await super.generate({inputs:V,generation_config:oe,logits_processor:Ee,decoder_input_ids:ut,...Ze});return oe.return_token_timestamps&&(xt.token_timestamps=this._extract_token_timestamps(xt,oe.alignment_heads,oe.num_frames)),xt}_extract_token_timestamps(V,oe,Ee=null,tt=.02){if(!V.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");Ee==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let Ze=this.config.median_filter_width;Ze===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Ze=7);const ut=V.cross_attentions,xt=Array.from({length:this.config.decoder_layers},(Sr,Qt)=>(0,l.cat)(ut.map(Dr=>Dr[Qt]),2)),Pt=(0,l.stack)(oe.map(([Sr,Qt])=>{if(Sr>=xt.length)throw new Error(`Layer index ${Sr} is out of bounds for cross attentions (length ${xt.length}).`);return Ee?xt[Sr].slice(null,Qt,null,[0,Ee]):xt[Sr].slice(null,Qt)})).transpose(1,0,2,3),[Bt,Zt]=(0,l.std_mean)(Pt,-2,0,!0),Er=Pt.clone();for(let Sr=0;Sr<Er.dims[0];++Sr){const Qt=Er[Sr];for(let Dr=0;Dr<Qt.dims[0];++Dr){const mn=Qt[Dr],i=Bt[Sr][Dr][0].data,c=Zt[Sr][Dr][0].data;for(let b=0;b<mn.dims[0];++b){let S=mn[b].data;for(let E=0;E<S.length;++E)S[E]=(S[E]-c[E])/i[E];S.set((0,p.medianFilter)(S,Ze))}}}const hr=[(0,l.mean)(Er,1)],Pr=V.sequences.dims,sr=new l.Tensor("float32",new Float32Array(Pr[0]*Pr[1]),Pr);for(let Sr=0;Sr<Pr[0];++Sr){const Qt=hr[Sr].neg().squeeze_(0),[Dr,mn]=(0,p.dynamic_time_warping)(Qt.tolist()),i=Array.from({length:Dr.length-1},(S,E)=>Dr[E+1]-Dr[E]),c=(0,f.mergeArrays)([1],i).map(S=>!!S),b=[];for(let S=0;S<c.length;++S)c[S]&&b.push(mn[S]*tt);sr[Sr].data.set(b,1)}return sr}}class Bs extends _n{}class ui extends ee{constructor(){super(...arguments);$e(this,"requires_attention_mask",!1);$e(this,"main_input_name","input_values");$e(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class Kp extends ui{}class Vl extends ui{}class zs extends ee{constructor(){super(...arguments);$e(this,"main_input_name","pixel_values");$e(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class rc extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class Wl extends rc{_merge_input_ids_with_image_features(V){const oe=V.image_features.dims.at(-1),Ee=V.image_features.view(-1,oe);return N({image_token_id:this.config.image_token_index,...V,image_features:Ee})}}class nc extends Wl{}class Ja extends Wl{}class Ao extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);$e(this,"main_input_name","inputs_embeds")}}class Sf extends Ao{_merge_input_ids_with_image_features({inputs_embeds:V,image_features:oe,input_ids:Ee,attention_mask:tt}){return{inputs_embeds:(0,l.cat)([oe,V],1),attention_mask:(0,l.cat)([(0,l.ones)(oe.dims.slice(0,2)),tt],1)}}async _prepare_inputs_embeds({input_ids:V,pixel_values:oe,inputs_embeds:Ee,attention_mask:tt}){if(!V&&!oe)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let Ze,ut;return V&&(Ze=await this.encode_text({input_ids:V})),oe&&(ut=await this.encode_image({pixel_values:oe})),Ze&&ut?{inputs_embeds:Ee,attention_mask:tt}=this._merge_input_ids_with_image_features({inputs_embeds:Ze,image_features:ut,input_ids:V,attention_mask:tt}):Ee=Ze||ut,{inputs_embeds:Ee,attention_mask:tt}}async forward({input_ids:V,pixel_values:oe,attention_mask:Ee,decoder_input_ids:tt,decoder_attention_mask:Ze,encoder_outputs:ut,past_key_values:xt,inputs_embeds:Pt,decoder_inputs_embeds:Bt}){if(Pt||({inputs_embeds:Pt,attention_mask:Ee}=await this._prepare_inputs_embeds({input_ids:V,pixel_values:oe,inputs_embeds:Pt,attention_mask:Ee})),!ut){let{last_hidden_state:hr}=await ve(this,{inputs_embeds:Pt,attention_mask:Ee});ut=hr}if(!Bt){if(!tt)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");Bt=await this.encode_text({input_ids:tt})}return await re(this,{inputs_embeds:Bt,attention_mask:Ze,encoder_attention_mask:Ee,encoder_hidden_states:ut,past_key_values:xt},!0)}}class ic extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class sc extends ic{_merge_input_ids_with_image_features(V){const oe=V.image_features.dims.at(-1),Ee=V.image_features.view(-1,oe);return N({image_token_id:this.config.image_token_index,...V,image_features:Ee})}}class Gl extends rc{_merge_input_ids_with_image_features(V){const oe=V.image_features.dims.at(-1),Ee=V.image_features.view(-1,oe);return N({image_token_id:this.config.image_token_index,...V,image_features:Ee})}}class Hl extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"])}}class Ii extends Hl{async forward({input_ids:V=null,attention_mask:oe=null,pixel_values:Ee=null,input_features:tt=null,input_features_mask:Ze=null,position_ids:ut=null,inputs_embeds:xt=null,per_layer_inputs:Pt=null,past_key_values:Bt=null,generation_config:Zt=null,logits_processor:Er=null,...hr}){if((!xt||!Pt)&&({inputs_embeds:xt,per_layer_inputs:Pt}=await ne(this.sessions.embed_tokens,{input_ids:V}),V.dims[1]!==1)){if(Ee){const{image_features:sr}=await ne(this.sessions.vision_encoder,{pixel_values:Ee});({inputs_embeds:xt,attention_mask:oe}=this._merge_input_ids_with_image_features({image_features:sr,inputs_embeds:xt,input_ids:V,attention_mask:oe}))}if(tt){const{audio_features:sr}=await ne(this.sessions.audio_encoder,{input_features:tt,input_features_mask:Ze});({inputs_embeds:xt,attention_mask:oe}=this._merge_input_ids_with_audio_features({audio_features:sr,inputs_embeds:xt,input_ids:V,attention_mask:oe}))}}return await re(this,{inputs_embeds:xt,per_layer_inputs:Pt,past_key_values:Bt,attention_mask:oe,position_ids:ut,generation_config:Zt,logits_processor:Er},!0)}_merge_input_ids_with_image_features(V){const oe=V.image_features.dims.at(-1),Ee=V.image_features.view(-1,oe);return N({image_token_id:this.config.image_token_id,...V,image_features:Ee})}_merge_input_ids_with_audio_features(V){const oe=V.audio_features.dims.at(-1),Ee=V.audio_features.view(-1,oe);return ae({audio_token_id:this.config.audio_token_id,...V,audio_features:Ee})}}class Cf extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class ca extends Cf{async encode_image({pixel_values:V,pixel_attention_mask:oe}){return(await ne(this.sessions.vision_encoder,{pixel_values:V,pixel_attention_mask:oe})).image_features}_merge_input_ids_with_image_features(V){const oe=V.image_features.dims.at(-1),Ee=V.image_features.view(-1,oe);return N({image_token_id:this.config.image_token_id,...V,image_features:Ee})}}class Za extends ca{}class Ef extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class Kl extends Ef{async forward({input_ids:V=null,attention_mask:oe=null,pixel_values:Ee=null,image_sizes:tt=null,position_ids:Ze=null,inputs_embeds:ut=null,past_key_values:xt=null,generation_config:Pt=null,logits_processor:Bt=null,...Zt}){if(!ut){let hr;if(Ee&&V.dims[1]!==1){if(!tt)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:hr}=await ne(this.sessions.vision_encoder,{pixel_values:Ee,image_sizes:tt}))}else{const Pr=this.config.normalized_config.hidden_size;hr=new l.Tensor("float32",[],[0,Pr])}({inputs_embeds:ut}=await ne(this.sessions.prepare_inputs_embeds,{input_ids:V,image_features:hr}))}return await re(this,{inputs_embeds:ut,past_key_values:xt,attention_mask:oe,position_ids:Ze,generation_config:Pt,logits_processor:Bt},!1)}}class Rn extends ee{}class Xl extends Rn{}class el extends Rn{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"text_model"})}}class oc extends Rn{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"text_model"})}}class Pf extends Rn{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"vision_model"})}}class Xp extends Rn{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"vision_model"})}}class ji extends ee{}class Of extends ji{}class Yl extends ji{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"text_model"})}}class ac extends Rn{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"vision_model"})}}class ci extends ee{}class kf extends ci{}class ql extends ee{}class Ql extends ql{async forward(V){const oe=!V.input_ids,Ee=!V.pixel_values;if(oe&&Ee)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(oe&&(V.input_ids=(0,l.ones)([V.pixel_values.dims[0],1])),Ee){const{image_size:Bt}=this.config.vision_config;V.pixel_values=(0,l.full)([0,3,Bt,Bt],0)}const{text_embeddings:tt,image_embeddings:Ze,l2norm_text_embeddings:ut,l2norm_image_embeddings:xt}=await super.forward(V),Pt={};return oe||(Pt.text_embeddings=tt,Pt.l2norm_text_embeddings=ut),Ee||(Pt.image_embeddings=Ze,Pt.l2norm_image_embeddings=xt),Pt}}class lc extends ql{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"text_model"})}}class js extends ql{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"vision_model"})}}class da extends ee{}class If extends da{}class Af extends da{}class uc extends ee{}class Do extends uc{}class Pn extends uc{}class Jl extends ee{}class Df extends Jl{}class Ff extends Jl{}class cc extends ee{}class Lf extends cc{}class $f extends cc{}class uo extends ee{}class Qe extends uo{}class ht extends uo{}class ot extends ee{}class Ht extends ot{}class Tr extends ot{}class Zr extends ee{}class Dn extends Zr{}class dn extends Zr{}class Zl extends ee{}class Rf extends Zl{}class gi extends Zl{}class fa extends ee{}class Bf extends fa{}class Fo extends fa{}class Ns extends ee{}class tl extends Ns{}class on extends Ns{}class eu extends ee{}class dc extends eu{}class rl extends eu{}class fc extends ee{}class zf extends fc{}class Yp extends fc{}class ha extends ee{}class Us extends ha{}class nl extends ha{}class hc extends ee{}class il extends hc{}class Xr extends hc{}class tu extends ee{}class sl extends tu{}class pc extends tu{}class Lo extends ee{}class co extends Lo{}class ol extends Lo{}class mc extends ee{}class jf extends mc{}class Nf extends mc{}class pa extends ee{}class al extends pa{}class ru extends pa{}class gc extends ee{}class _c extends gc{}class ll extends gc{}class vc extends ee{}class Cn extends vc{}class ii extends vc{}class yc extends ee{}class Uf extends yc{}class wc extends yc{}class xc extends ee{}class nu extends xc{}class ma extends xc{}class ul extends ee{}class $o extends ul{}class ga extends ul{}class Ro extends ee{}class cl extends Ro{}class Bo extends Ro{}class Vf extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class Wf extends Vf{get_rope_index(V,oe,Ee,tt){var Er;const{vision_config:Ze,image_token_id:ut,video_token_id:xt,vision_start_token_id:Pt}=this.config,Bt=(Er=Ze.spatial_merge_size)!=null?Er:2,Zt=[];if(oe||Ee){let hr=V.tolist();tt||(tt=(0,l.ones_like)(V));const Pr=tt.tolist(),sr=Array.from({length:3},i=>Array.from({length:V.dims[0]},c=>Array.from({length:V.dims[1]},b=>1))),Sr=oe?oe.tolist():[],Qt=Ee?Ee.tolist():[];let Dr=0,mn=0;for(let i=0;i<hr.length;++i){const c=hr[i].filter((Te,de)=>Pr[i][de]==1),S=c.reduce((Te,de,_e)=>(de==Pt&&Te.push(_e),Te),[]).map(Te=>c[Te+1]),E=S.filter(Te=>Te==ut).length,I=S.filter(Te=>Te==xt).length;let k=[],$=0,B=E,z=I;for(let Te=0;Te<S.length;++Te){const de=c.findIndex((ar,Cr)=>Cr>$&&ar==ut),_e=c.findIndex((ar,Cr)=>Cr>$&&ar==xt),Ae=B>0&&de!==-1?de:c.length+1,Oe=z>0&&_e!==-1?_e:c.length+1;let He,lt,it,mt;Ae<Oe?([lt,it,mt]=Sr[Dr],++Dr,--B,He=Ae):([lt,it,mt]=Qt[mn],++mn,--z,He=Oe);const[Mt,At,$t]=[Number(lt),Math.floor(Number(it)/Bt),Math.floor(Number(mt)/Bt)],Vt=He-$,Kt=k.length>0?(0,p.max)(k.at(-1))[0]+1:0;k.push(Array.from({length:3*Vt},(ar,Cr)=>Kt+Cr%Vt));const Mr=Vt+Kt,tr=Mt*At*$t,Jt=Array.from({length:tr},(ar,Cr)=>Mr+Math.floor(Cr/(At*$t))),Lt=Array.from({length:tr},(ar,Cr)=>Mr+Math.floor(Cr/$t)%At),$r=Array.from({length:tr},(ar,Cr)=>Mr+Cr%$t);k.push([Jt,Lt,$r].flat()),$=He+tr}if($<c.length){const Te=k.length>0?(0,p.max)(k.at(-1))[0]+1:0,de=c.length-$;k.push(Array.from({length:3*de},(_e,Ae)=>Te+Ae%de))}const G=k.reduce((Te,de)=>Te+de.length,0),q=new Array(G);let Z=0;for(let Te=0;Te<3;++Te)for(let de=0;de<k.length;++de){const _e=k[de],Ae=_e.length/3;for(let Oe=Te*Ae;Oe<(Te+1)*Ae;++Oe)q[Z++]=_e[Oe]}let se=0;const le=Pr[i];for(let Te=0;Te<le.length;++Te)if(le[Te]==1){for(let de=0;de<3;++de)sr[de][i][Te]=q[de*G/3+se];++se}const me=(0,p.max)(q)[0];Zt.push(me+1-hr[i].length)}return[new l.Tensor("int64",sr.flat(1/0),[3,V.dims[0],V.dims[1]]),new l.Tensor("int64",Zt,[Zt.length,1])]}else if(tt){const{data:hr,dims:Pr}=Ce(tt),sr=BigInt64Array.from({length:3*hr.length},(Qt,Dr)=>hr[Dr%hr.length]),Sr=Array.from({length:Pr[0]},(Qt,Dr)=>(0,p.max)(hr.subarray(Pr[1]*Dr,Pr[1]*(Dr+1)))[0]+1n+BigInt(Pr[1]));return[new l.Tensor("int64",sr,[3,...Pr]),new l.Tensor("int64",Sr,[Sr.length,1])]}else{const[hr,Pr]=V.dims,sr=BigInt64Array.from({length:3*hr*Pr},(Sr,Qt)=>BigInt(Math.floor(Qt%Pr/hr)));return[new l.Tensor("int64",sr,[3,...V.dims]),(0,l.zeros)([hr,1])]}}async encode_image({pixel_values:V,image_grid_thw:oe}){return(await ne(this.sessions.vision_encoder,{pixel_values:V,grid_thw:oe})).image_features}_merge_input_ids_with_image_features(V){return N({image_token_id:this.config.image_token_id,...V})}prepare_inputs_for_generation(V,oe,Ee){if(oe.attention_mask&&!oe.position_ids)if(!oe.past_key_values)[oe.position_ids,oe.rope_deltas]=this.get_rope_index(oe.input_ids,oe.image_grid_thw,oe.video_grid_thw,oe.attention_mask);else{oe.pixel_values=null;const tt=BigInt(Object.values(oe.past_key_values)[0].dims.at(-2)),Ze=oe.rope_deltas.map(ut=>tt+ut);oe.position_ids=(0,l.stack)([Ze,Ze,Ze],0)}return oe}}class bc extends ee{}class Mc extends bc{}class Gf extends bc{}class zo extends ee{}class jo extends zo{}class Tc extends zo{}class ge extends ee{}class No extends ge{}class dl extends ge{}class Si extends ee{}class Vr extends Si{}class Sc extends Si{}class Cc extends ee{}class Hf extends Cc{}class fo extends Cc{}class Kf extends ee{}class Xf extends Kf{}class Yf extends Kf{async _call(V){return new mr(await super._call(V))}}class Ni extends ee{}class qf extends Ni{}class ps extends Ni{async _call(V){return new mr(await super._call(V))}}class Qf extends ee{}class Jf extends Qf{}class Ec extends ee{}class Zf extends Ec{}class eh extends Ec{async _call(V){return new mr(await super._call(V))}}class ms extends ee{}class th extends ms{}class Pc extends ee{}class qp extends Pc{}class rh extends Pc{async _call(V){return new mr(await super._call(V))}}class nh extends ee{}class ho extends nh{}class Oc extends ee{}class ih extends Oc{}class Ui extends Oc{async _call(V){return new mr(await super._call(V))}}class Qp extends ee{}class Uo extends Qp{async _call(V){return new bp(await super._call(V))}}class po extends ee{}class Vo extends po{}class kc extends po{async _call(V){return new mr(await super._call(V))}}class Vs extends ee{}class Bn extends Vs{}class sh extends Vs{async _call(V){return new mr(await super._call(V))}}class iu extends ee{}class su extends iu{}class fl extends iu{}class Ws extends ee{}class Ic extends Ws{}class ou extends Ws{}class Ac extends ee{}class gs extends Ac{}class hl extends Ac{async _call(V){return new mr(await super._call(V))}}class ts extends ee{}class Ai extends ts{}class Dc extends ts{async _call(V){return new _a(await super._call(V))}}class au extends ts{async _call(V){return new Wo(await super._call(V))}}class _a extends we{constructor({logits:V,pred_boxes:oe}){super(),this.logits=V,this.pred_boxes=oe}}class Wo extends we{constructor({logits:V,pred_boxes:oe,pred_masks:Ee}){super(),this.logits=V,this.pred_boxes=oe,this.pred_masks=Ee}}class _s extends ee{}class Fc extends _s{}class Jp extends _s{async _call(V){return new mo(await super._call(V))}}class mo extends we{constructor({logits:V,pred_boxes:oe}){super(),this.logits=V,this.pred_boxes=oe}}class lu extends ee{}class va extends lu{}class Xn extends lu{async _call(V){return new pl(await super._call(V))}}class pl extends mo{}class uu extends ee{}class rs extends uu{}class cu extends uu{async _call(V){return new du(await super._call(V))}}class du extends mo{}class Gs extends ee{}class Lc extends Gs{}class _i extends Gs{async _call(V){return new mo(await super._call(V))}}class ml extends ee{}class fu extends ml{}class oh extends ml{async _call(V){return new hu(await super._call(V))}}class hu extends _a{}class ya extends ee{}class $c extends ya{}class wa extends ya{async _call(V){return new mr(await super._call(V))}}class pu extends ee{}class Rc extends pu{}class Zp extends pu{async _call(V){return new mr(await super._call(V))}}class Go extends ee{}class em extends Go{}class ah extends Go{async _call(V){return new mr(await super._call(V))}}class xa extends ee{}class Bc extends xa{}class zc extends xa{async _call(V){return new mr(await super._call(V))}}class lh extends xa{}class jc extends ee{}class mu extends jc{}class gu extends jc{}class Nc extends ee{}class Uc extends Nc{}class Vc extends Nc{}class Wc extends ee{}class Gc extends Wc{}class ba extends ee{}class uh extends ba{}class Hc extends ba{}class Kc extends ba{}class ch extends ee{}class Xc extends ch{}class tm extends ee{}class Ma extends tm{}class Ta extends ee{}class gl extends Ta{}class Yc extends ee{}class _u extends Yc{}class Rr extends Yc{}class qc extends ee{}class Qc extends qc{}class Sa extends qc{}class Jc extends ee{}class dh extends Jc{}class fh extends ee{}class Di extends fh{}class Zc extends fh{async _call(V){return new mr(await super._call(V))}}class Ca extends ee{}class vu extends Ca{}class ed extends Ca{async _call(V){return new mr(await super._call(V))}}class td extends ee{}class Ci extends td{}class Hs extends td{async _call(V){return new mr(await super._call(V))}}class yu extends ee{}class rd extends yu{}class _l extends yu{async _call(V){return new mr(await super._call(V))}}class nd extends ee{}class wu extends nd{}class id extends ee{}class xu extends id{}class bu extends id{async _call(V){return new Ks(await super._call(V))}}class Ks extends we{constructor({logits:V,pred_boxes:oe}){super(),this.logits=V,this.pred_boxes=oe}}class rm extends ee{}class Xs extends rm{async get_image_embeddings({pixel_values:V}){return await ve(this,{pixel_values:V})}async forward(V){if((!V.image_embeddings||!V.image_positional_embeddings)&&(V={...V,...await this.get_image_embeddings(V)}),!V.input_labels&&V.input_points){const Ee=V.input_points.dims.slice(0,-1),tt=Ee.reduce((Ze,ut)=>Ze*ut,1);V.input_labels=new l.Tensor("int64",new BigInt64Array(tt).fill(1n),Ee)}const oe={image_embeddings:V.image_embeddings,image_positional_embeddings:V.image_positional_embeddings};return V.input_points&&(oe.input_points=V.input_points),V.input_labels&&(oe.input_labels=V.input_labels),V.input_boxes&&(oe.input_boxes=V.input_boxes),await ne(this.sessions.prompt_encoder_mask_decoder,oe)}async _call(V){return new sd(await super._call(V))}}class sd extends we{constructor({iou_scores:V,pred_masks:oe}){super(),this.iou_scores=V,this.pred_masks=oe}}class Mu extends ee{}class Tu extends Mu{}class nm extends Mu{}class od extends ee{}class hh extends od{}class ad extends od{}class Ys extends ee{}class im extends Ys{}class ld extends Ys{async _call(V){return new Li(await super._call(V))}}class ud extends Ys{async _call(V){return new mr(await super._call(V))}}class vi extends Ys{async _call(V){return new Tn(await super._call(V))}}class Vi extends ee{}class sm extends Vi{}class vs extends Vi{async _call(V){return new Tn(await super._call(V))}}class Wi extends ee{}class Gi extends Wi{}class ys extends ee{}class cd extends ys{}class ph extends ys{async _call(V){return new Li(await super._call(V))}}class dd extends ys{async _call(V){return new mr(await super._call(V))}}class ws extends ee{}class Ea extends ws{}class mh extends ws{async _call(V){return new Li(await super._call(V))}}class fd extends ws{async _call(V){return new mr(await super._call(V))}}class hd extends ws{async _call(V){return new Tn(await super._call(V))}}class Ho extends ee{}class pd extends Ho{}class Su extends Ho{async _call(V){return new Li(await super._call(V))}}class si extends Ho{async _call(V){return new mr(await super._call(V))}}class Cu extends ee{}class gh extends Ys{}class Eu extends Ys{async _call(V){return new Li(await super._call(V))}}class vl extends Ys{async _call(V){return new mr(await super._call(V))}}class xs extends ee{}class Pu extends xs{}class _h extends xs{async _call(V){return new Li(await super._call(V))}}class md extends xs{async _call(V){return new mr(await super._call(V))}}class bs extends xs{async _call(V){return new Qo(await super._call(V))}}class gd extends xs{async _call(V){return new Tn(await super._call(V))}}class _d extends ee{}class vd extends _d{}class yl extends ee{}class om extends yl{}class vh extends yl{}class Ms extends yl{async generate_speech(V,oe,{threshold:Ee=.5,minlenratio:tt=0,maxlenratio:Ze=20,vocoder:ut=null}={}){const xt={input_ids:V},{encoder_outputs:Pt,encoder_attention_mask:Bt}=await ve(this,xt),Zt=Pt.dims[1]/this.config.reduction_factor,Er=Math.floor(Zt*Ze),hr=Math.floor(Zt*tt),Pr=this.config.num_mel_bins;let sr=[],Sr=null,Qt=null,Dr=0;for(;;){++Dr;const c=Me(!!Qt);let b;Qt?b=Qt.output_sequence_out:b=new l.Tensor("float32",new Float32Array(Pr),[1,1,Pr]);let S={use_cache_branch:c,output_sequence:b,encoder_attention_mask:Bt,speaker_embeddings:oe,encoder_hidden_states:Pt};this.addPastKeyValues(S,Sr),Qt=await ne(this.sessions.decoder_model_merged,S),Sr=this.getPastKeyValues(Qt,Sr);const{prob:E,spectrum:I}=Qt;if(sr.push(I),Dr>=hr&&(Array.from(E.data).filter(k=>k>=Ee).length>0||Dr>=Er))break}const mn=(0,l.cat)(sr),{waveform:i}=await ne(ut.sessions.model,{spectrogram:mn});return{spectrogram:mn,waveform:i}}}class Pa extends ee{constructor(){super(...arguments);$e(this,"main_input_name","spectrogram")}}class Ou extends ee{}class ku extends Ou{}class Oa extends ee{}class Ko extends Oa{}class fr extends Oa{}class ka extends ee{}class Iu extends ka{}class Xo extends ka{}class Au extends ee{}class Du extends Au{}class yd extends Au{}class Yn extends ee{}class am extends Yn{}class yh extends Yn{}class wl extends ee{}class wh extends wl{}class xh extends wl{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"text_model"})}}class bh extends wl{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"audio_model"})}}class Mh extends ee{}class Th extends Mh{async _call(V){return new Mp(await super._call(V))}}class Hi extends ee{}class yi extends Hi{}class Fu extends Hi{}class Sh extends Hi{}class xl extends ee{}class lm extends xl{}class Ch extends xl{}class Yo extends ee{}class wd extends Yo{}class xd extends Yo{async _call(V){return new mr(await super._call(V))}}class bd extends ee{}class um extends bd{}class cm extends bd{}class Md extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(oe){const[Ee,tt]=oe.dims,Ze=this.config.decoder.num_codebooks,ut=tt-Ze;let xt=0;for(let Zt=0;Zt<oe.size;++Zt){if(oe.data[Zt]===this.config.decoder.pad_token_id)continue;const Er=Zt%tt,hr=Math.floor(Zt/tt)%Ze,Pr=Er-hr;Pr>0&&Pr<=ut&&(oe.data[xt++]=oe.data[Zt])}const Pt=Math.floor(Ee/Ze),Bt=xt/(Pt*Ze);return new l.Tensor(oe.type,oe.data.slice(0,xt),[Pt,Ze,Bt])}prepare_inputs_for_generation(oe,Ee,tt){let Ze=structuredClone(oe);for(let xt=0;xt<Ze.length;++xt)for(let Pt=0;Pt<Ze[xt].length;++Pt)xt%this.config.decoder.num_codebooks>=Pt&&(Ze[xt][Pt]=BigInt(this.config.decoder.pad_token_id));return tt.guidance_scale!==null&&tt.guidance_scale>1&&(Ze=Ze.concat(Ze)),super.prepare_inputs_for_generation(Ze,Ee,tt)}async generate(oe){const Ee=await super.generate(oe),tt=this._apply_and_filter_by_delay_pattern_mask(Ee).unsqueeze_(0),{audio_values:Ze}=await ne(this.sessions.encodec_decode,{audio_codes:tt});return Ze}}class bl extends ee{}class Eh extends bl{}class Ml extends bl{async _call(V){return new mr(await super._call(V))}}class Tl extends bl{}class Ia extends ee{}class qo extends Ia{}class Sl extends Ia{async _call(V){return new mr(await super._call(V))}}class Td extends Ia{}class Cl extends ee{}class Aa extends Cl{}class Lu extends Cl{async _call(V){return new mr(await super._call(V))}}class ns extends Cl{}class Ts extends ee{}class Sd extends Ts{}class Cd extends Ts{async _call(V){return new mr(await super._call(V))}}class Ph extends Ts{}class Ed extends ee{}class Oh extends Ed{}class kh extends ee{}class Ih extends kh{constructor(...oe){super(...oe);$e(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(oe){var Bt;const Ee=(Bt=this._generation_mode)!=null?Bt:"text";let tt;if(Ee==="text"||!oe.past_key_values){const Zt=this.sessions.prepare_inputs_embeds,Er=(0,f.pick)(oe,Zt.inputNames);tt=await ne(Zt,Er)}else{const Zt=this.sessions.gen_img_embeds,Er=(0,f.pick)({image_ids:oe.input_ids},Zt.inputNames);tt=await ne(Zt,Er)}const Ze={...oe,...tt},ut=await re(this,Ze),xt=this.sessions[Ee==="text"?"lm_head":"gen_head"];if(!xt)throw new Error(`Unable to find "${xt}" generation head`);const Pt=await ne(xt,(0,f.pick)(ut,xt.inputNames));return{...tt,...ut,...Pt}}async generate(oe){return this._generation_mode="text",super.generate(oe)}async generate_images(oe){var Zt;this._generation_mode="image";const Ee=((Zt=oe.inputs)!=null?Zt:oe[this.main_input_name]).dims[1],Ze=(await super.generate(oe)).slice(null,[Ee,null]),ut=this.sessions.image_decode,{decoded_image:xt}=await ne(ut,{generated_tokens:Ze}),Pt=xt.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),Bt=[];for(const Er of Pt){const hr=u.RawImage.fromTensor(Er);Bt.push(hr)}return Bt}}class Ah extends we{constructor({char_logits:V,bpe_logits:oe,wp_logits:Ee}){super(),this.char_logits=V,this.bpe_logits=oe,this.wp_logits=Ee}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class dm extends ee{}class Dh extends dm{async _call(V){return new Ah(await super._call(V))}}class Pd extends ee{}class Fh extends Pd{}class Lh extends Pd{}class Od extends ee{}class kd extends Od{}class Id extends Od{}class $h extends ee{constructor(){super(...arguments);$e(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class fm extends $h{_merge_input_ids_with_audio_features(V){const oe=V.audio_features.dims.at(-1),Ee=V.audio_features.view(-1,oe);return ae({audio_token_id:this.config.ignore_index,...V,audio_features:Ee})}}class $u extends ee{constructor(){super(...arguments);$e(this,"main_input_name","input_values");$e(this,"forward_params",["input_values"])}}class Ru extends we{constructor({audio_codes:V}){super(),this.audio_codes=V}}class Ad extends we{constructor({audio_values:V}){super(),this.audio_values=V}}class Rh extends $u{async encode(V){return new Ru(await ne(this.sessions.encoder_model,V))}async decode(V){return new Ad(await ne(this.sessions.decoder_model,V))}}class Bh extends $u{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"encoder_model"})}}class zh extends $u{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"decoder_model"})}}class Dd extends ee{constructor(){super(...arguments);$e(this,"main_input_name","input_values");$e(this,"forward_params",["input_values"])}}class jh extends we{constructor({audio_codes:V}){super(),this.audio_codes=V}}class Fi extends we{constructor({audio_values:V}){super(),this.audio_values=V}}class Nh extends Dd{async encode(V){return new jh(await ne(this.sessions.encoder_model,V))}async decode(V){return new Fi(await ne(this.sessions.decoder_model,V))}}class Fd extends Dd{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"encoder_model"})}}class Uh extends Dd{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"decoder_model"})}}class El extends ee{constructor(){super(...arguments);$e(this,"main_input_name","input_values");$e(this,"forward_params",["input_values"])}}class Vh extends El{async encode(V){return await ne(this.sessions.encoder_model,V)}async decode(V){return await ne(this.sessions.decoder_model,V)}}class Wh extends El{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"encoder_model"})}}class Gh extends El{static async from_pretrained(V,oe={}){var Ee;return super.from_pretrained(V,{...oe,model_file_name:(Ee=oe.model_file_name)!=null?Ee:"decoder_model"})}}class Qr{static async from_pretrained(V,{progress_callback:oe=null,config:Ee=null,cache_dir:tt=null,local_files_only:Ze=!1,revision:ut="main",model_file_name:xt=null,subfolder:Pt="onnx",device:Bt=null,dtype:Zt=null,use_external_data_format:Er=null,session_options:hr={}}={}){const Pr={progress_callback:oe,config:Ee,cache_dir:tt,local_files_only:Ze,revision:ut,model_file_name:xt,subfolder:Pt,device:Bt,dtype:Zt,use_external_data_format:Er,session_options:hr};if(Pr.config=await n.AutoConfig.from_pretrained(V,Pr),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const sr=Pr.config.model_type;for(const Sr of this.MODEL_CLASS_MAPPINGS){let Qt=Sr.get(sr);if(!Qt){for(const Dr of Sr.values())if(Dr[0]===sr){Qt=Dr;break}if(!Qt)continue}return await Qt[1].from_pretrained(V,Pr)}if(this.BASE_IF_FAIL)return bm.has(sr)||console.warn(`Unknown model class "${sr}", attempting to construct from base class.`),await ee.from_pretrained(V,Pr);throw Error(`Unsupported model type: ${sr}`)}}$e(Qr,"MODEL_CLASS_MAPPINGS",null),$e(Qr,"BASE_IF_FAIL",!1);const Ld=new Map([["bert",["BertModel",Se]],["neobert",["NeoBertModel",qe]],["modernbert",["ModernBertModel",It]],["nomic_bert",["NomicBertModel",gn]],["roformer",["RoFormerModel",Zn]],["electra",["ElectraModel",As]],["esm",["EsmModel",rr]],["convbert",["ConvBertModel",io]],["camembert",["CamembertModel",ft]],["deberta",["DebertaModel",qt]],["deberta-v2",["DebertaV2Model",wr]],["mpnet",["MPNetModel",Vn]],["albert",["AlbertModel",Ye]],["distilbert",["DistilBertModel",yn]],["roberta",["RobertaModel",es]],["xlm",["XLMModel",Qa]],["xlm-roberta",["XLMRobertaModel",Xt]],["clap",["ClapModel",wh]],["clip",["CLIPModel",Xl]],["clipseg",["CLIPSegModel",If]],["chinese_clip",["ChineseCLIPModel",kf]],["siglip",["SiglipModel",Of]],["jina_clip",["JinaCLIPModel",Ql]],["mobilebert",["MobileBertModel",Tt]],["squeezebert",["SqueezeBertModel",Je]],["wav2vec2",["Wav2Vec2Model",im]],["wav2vec2-bert",["Wav2Vec2BertModel",pd]],["unispeech",["UniSpeechModel",cd]],["unispeech-sat",["UniSpeechSatModel",Ea]],["hubert",["HubertModel",gh]],["wavlm",["WavLMModel",Pu]],["audio-spectrogram-transformer",["ASTModel",tc]],["vits",["VitsModel",Th]],["pyannote",["PyAnnoteModel",sm]],["wespeaker-resnet",["WeSpeakerResNetModel",Gi]],["detr",["DetrModel",Ai]],["rt_detr",["RTDetrModel",Fc]],["rt_detr_v2",["RTDetrV2Model",va]],["rf_detr",["RFDetrModel",rs]],["d_fine",["DFineModel",Lc]],["table-transformer",["TableTransformerModel",fu]],["vit",["ViTModel",Xf]],["ijepa",["IJepaModel",qf]],["pvt",["PvtModel",Zf]],["vit_msn",["ViTMSNModel",qp]],["vit_mae",["ViTMAEModel",th]],["groupvit",["GroupViTModel",ho]],["fastvit",["FastViTModel",ih]],["mobilevit",["MobileViTModel",Vo]],["mobilevitv2",["MobileViTV2Model",Bn]],["owlvit",["OwlViTModel",su]],["owlv2",["Owlv2Model",Ic]],["beit",["BeitModel",gs]],["deit",["DeiTModel",$c]],["hiera",["HieraModel",Rc]],["convnext",["ConvNextModel",Di]],["convnextv2",["ConvNextV2Model",vu]],["dinov2",["Dinov2Model",Ci]],["dinov2_with_registers",["Dinov2WithRegistersModel",rd]],["resnet",["ResNetModel",em]],["swin",["SwinModel",Bc]],["swin2sr",["Swin2SRModel",mu]],["donut-swin",["DonutSwinModel",dh]],["yolos",["YolosModel",xu]],["dpt",["DPTModel",Uc]],["glpn",["GLPNModel",Qc]],["hifigan",["SpeechT5HifiGan",Pa]],["efficientnet",["EfficientNetModel",wd]],["decision_transformer",["DecisionTransformerModel",Oh]],["patchtst",["PatchTSTForPrediction",Fh]],["patchtsmixer",["PatchTSMixerForPrediction",kd]],["mobilenet_v1",["MobileNetV1Model",Eh]],["mobilenet_v2",["MobileNetV2Model",qo]],["mobilenet_v3",["MobileNetV3Model",Aa]],["mobilenet_v4",["MobileNetV4Model",Sd]],["maskformer",["MaskFormerModel",_u]],["mgp-str",["MgpstrForSceneTextRecognition",Dh]],["style_text_to_speech_2",["StyleTextToSpeech2Model",vd]]]),hm=new Map([["t5",["T5Model",zt]],["longt5",["LongT5Model",ri]],["mt5",["MT5Model",Mn]],["bart",["BartModel",Ls]],["mbart",["MBartModel",In]],["marian",["MarianModel",Tu]],["whisper",["WhisperModel",Ul]],["m2m_100",["M2M100Model",hh]],["blenderbot",["BlenderbotModel",fs]],["blenderbot-small",["BlenderbotSmallModel",An]]]),Hh=new Map([["mimi",["MimiModel",Rh]],["dac",["DacModel",Nh]],["snac",["SnacModel",Vh]]]),pm=new Map([["bloom",["BloomModel",No]],["jais",["JAISModel",Df]],["gpt2",["GPT2Model",Do]],["gptj",["GPTJModel",Ht]],["gpt_bigcode",["GPTBigCodeModel",Dn]],["gpt_neo",["GPTNeoModel",Lf]],["gpt_neox",["GPTNeoXModel",Qe]],["codegen",["CodeGenModel",Rf]],["llama",["LlamaModel",Bf]],["smollm3",["SmolLM3Model",tl]],["exaone",["ExaoneModel",Us]],["olmo",["OlmoModel",sl]],["olmo2",["Olmo2Model",co]],["mobilellm",["MobileLLMModel",il]],["granite",["GraniteModel",jf]],["cohere",["CohereModel",al]],["gemma",["GemmaModel",_c]],["gemma2",["Gemma2Model",Cn]],["gemma3_text",["Gemma3Model",Uf]],["helium",["HeliumModel",dc]],["glm",["GlmModel",zf]],["openelm",["OpenELMModel",nu]],["qwen2",["Qwen2Model",$o]],["qwen3",["Qwen3Model",cl]],["phi",["PhiModel",Mc]],["phi3",["Phi3Model",jo]],["mpt",["MptModel",Vr]],["opt",["OPTModel",Hf]],["mistral",["MistralModel",Ko]],["ernie4_5",["Ernie4_5_Model",Iu]],["starcoder2",["Starcoder2Model",Du]],["falcon",["FalconModel",am]],["stablelm",["StableLmModel",lm]]]),$d=new Map([["speecht5",["SpeechT5ForSpeechToText",vh]],["whisper",["WhisperForConditionalGeneration",_n]],["lite-whisper",["LiteWhisperForConditionalGeneration",Bs]],["moonshine",["MoonshineForConditionalGeneration",Vl]]]),Kh=new Map([["speecht5",["SpeechT5ForTextToSpeech",Ms]]]),Xh=new Map([["vits",["VitsModel",Th]],["musicgen",["MusicgenForConditionalGeneration",Md]]]),Yh=new Map([["bert",["BertForSequenceClassification",ze]],["neobert",["NeoBertForSequenceClassification",ct]],["modernbert",["ModernBertForSequenceClassification",Fr]],["roformer",["RoFormerForSequenceClassification",vn]],["electra",["ElectraForSequenceClassification",Pe]],["esm",["EsmForSequenceClassification",oo]],["convbert",["ConvBertForSequenceClassification",dr]],["camembert",["CamembertForSequenceClassification",nr]],["deberta",["DebertaForSequenceClassification",Sn]],["deberta-v2",["DebertaV2ForSequenceClassification",Ar]],["mpnet",["MPNetForSequenceClassification",Fs]],["albert",["AlbertForSequenceClassification",at]],["distilbert",["DistilBertForSequenceClassification",pi]],["roberta",["RobertaForSequenceClassification",Kr]],["xlm",["XLMForSequenceClassification",Rs]],["xlm-roberta",["XLMRobertaForSequenceClassification",mi]],["bart",["BartForSequenceClassification",$s]],["mbart",["MBartForSequenceClassification",ds]],["mobilebert",["MobileBertForSequenceClassification",Ut]],["squeezebert",["SqueezeBertForSequenceClassification",ue]]]),qh=new Map([["bert",["BertForTokenClassification",rt]],["neobert",["NeoBertForTokenClassification",wt]],["modernbert",["ModernBertForTokenClassification",lr]],["roformer",["RoFormerForTokenClassification",Nn]],["electra",["ElectraForTokenClassification",fe]],["esm",["EsmForTokenClassification",Io]],["convbert",["ConvBertForTokenClassification",ko]],["camembert",["CamembertForTokenClassification",vr]],["deberta",["DebertaForTokenClassification",bi]],["deberta-v2",["DebertaV2ForTokenClassification",Gr]],["mpnet",["MPNetForTokenClassification",st]],["distilbert",["DistilBertForTokenClassification",sn]],["roberta",["RobertaForTokenClassification",Kn]],["xlm",["XLMForTokenClassification",Yt]],["xlm-roberta",["XLMRobertaForTokenClassification",Tf]]]),Rd=new Map([["t5",["T5ForConditionalGeneration",pr]],["longt5",["LongT5ForConditionalGeneration",rn]],["mt5",["MT5ForConditionalGeneration",Wn]],["bart",["BartForConditionalGeneration",Gn]],["mbart",["MBartForConditionalGeneration",Ti]],["marian",["MarianMTModel",nm]],["m2m_100",["M2M100ForConditionalGeneration",ad]],["blenderbot",["BlenderbotForConditionalGeneration",Hn]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",_r]]]),Qh=new Map([["bloom",["BloomForCausalLM",dl]],["gpt2",["GPT2LMHeadModel",Pn]],["jais",["JAISLMHeadModel",Ff]],["gptj",["GPTJForCausalLM",Tr]],["gpt_bigcode",["GPTBigCodeForCausalLM",dn]],["gpt_neo",["GPTNeoForCausalLM",$f]],["gpt_neox",["GPTNeoXForCausalLM",ht]],["codegen",["CodeGenForCausalLM",gi]],["llama",["LlamaForCausalLM",Fo]],["smollm3",["SmolLM3ForCausalLM",on]],["exaone",["ExaoneForCausalLM",nl]],["olmo",["OlmoForCausalLM",pc]],["olmo2",["Olmo2ForCausalLM",ol]],["mobilellm",["MobileLLMForCausalLM",Xr]],["granite",["GraniteForCausalLM",Nf]],["cohere",["CohereForCausalLM",ru]],["gemma",["GemmaForCausalLM",ll]],["gemma2",["Gemma2ForCausalLM",ii]],["gemma3_text",["Gemma3ForCausalLM",wc]],["helium",["HeliumForCausalLM",rl]],["glm",["GlmForCausalLM",Yp]],["openelm",["OpenELMForCausalLM",ma]],["qwen2",["Qwen2ForCausalLM",ga]],["qwen3",["Qwen3ForCausalLM",Bo]],["phi",["PhiForCausalLM",Gf]],["phi3",["Phi3ForCausalLM",Tc]],["mpt",["MptForCausalLM",Sc]],["opt",["OPTForCausalLM",fo]],["mbart",["MBartForCausalLM",qr]],["mistral",["MistralForCausalLM",fr]],["ernie4_5",["Ernie4_5_ForCausalLM",Xo]],["starcoder2",["Starcoder2ForCausalLM",yd]],["falcon",["FalconForCausalLM",yh]],["trocr",["TrOCRForCausalLM",ku]],["stablelm",["StableLmForCausalLM",Ch]],["phi3_v",["Phi3VForCausalLM",Kl]]]),mm=new Map([["multi_modality",["MultiModalityCausalLM",Ih]]]),Jh=new Map([["bert",["BertForMaskedLM",Ne]],["neobert",["NeoBertForMaskedLM",gt]],["modernbert",["ModernBertForMaskedLM",jt]],["roformer",["RoFormerForMaskedLM",ai]],["electra",["ElectraForMaskedLM",H]],["esm",["EsmForMaskedLM",Ds]],["convbert",["ConvBertForMaskedLM",oa]],["camembert",["CamembertForMaskedLM",pt]],["deberta",["DebertaForMaskedLM",jr]],["deberta-v2",["DebertaV2ForMaskedLM",ir]],["mpnet",["MPNetForMaskedLM",ao]],["albert",["AlbertForMaskedLM",Dt]],["distilbert",["DistilBertForMaskedLM",ti]],["roberta",["RobertaForMaskedLM",aa]],["xlm",["XLMWithLMHeadModel",ni]],["xlm-roberta",["XLMRobertaForMaskedLM",ec]],["mobilebert",["MobileBertForMaskedLM",Ot]],["squeezebert",["SqueezeBertForMaskedLM",Q]]]),Zh=new Map([["bert",["BertForQuestionAnswering",nt]],["neobert",["NeoBertForQuestionAnswering",bt]],["roformer",["RoFormerForQuestionAnswering",Ji]],["electra",["ElectraForQuestionAnswering",Le]],["convbert",["ConvBertForQuestionAnswering",so]],["camembert",["CamembertForQuestionAnswering",or]],["deberta",["DebertaForQuestionAnswering",hi]],["deberta-v2",["DebertaV2ForQuestionAnswering",nn]],["mpnet",["MPNetForQuestionAnswering",lo]],["albert",["AlbertForQuestionAnswering",_t]],["distilbert",["DistilBertForQuestionAnswering",ei]],["roberta",["RobertaForQuestionAnswering",Gt]],["xlm",["XLMForQuestionAnswering",la]],["xlm-roberta",["XLMRobertaForQuestionAnswering",ki]],["mobilebert",["MobileBertForQuestionAnswering",pn]],["squeezebert",["SqueezeBertForQuestionAnswering",De]]]),ep=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",zs]],["idefics3",["Idefics3ForConditionalGeneration",ca]],["smolvlm",["SmolVLMForConditionalGeneration",Za]]]),tp=new Map([["llava",["LlavaForConditionalGeneration",Wl]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",nc]],["moondream1",["Moondream1ForConditionalGeneration",Ja]],["florence2",["Florence2ForConditionalGeneration",Sf]],["qwen2-vl",["Qwen2VLForConditionalGeneration",Wf]],["idefics3",["Idefics3ForConditionalGeneration",ca]],["smolvlm",["SmolVLMForConditionalGeneration",Za]],["paligemma",["PaliGemmaForConditionalGeneration",sc]],["llava_qwen2",["LlavaQwen2ForCausalLM",Gl]],["gemma3n",["Gemma3nForConditionalGeneration",Ii]]]),Pl=new Map([["ultravox",["UltravoxModel",fm]]]),gm=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",zs]]]),Bd=new Map([["vit",["ViTForImageClassification",Yf]],["ijepa",["IJepaForImageClassification",ps]],["pvt",["PvtForImageClassification",eh]],["vit_msn",["ViTMSNForImageClassification",rh]],["fastvit",["FastViTForImageClassification",Ui]],["mobilevit",["MobileViTForImageClassification",kc]],["mobilevitv2",["MobileViTV2ForImageClassification",sh]],["beit",["BeitForImageClassification",hl]],["deit",["DeiTForImageClassification",wa]],["hiera",["HieraForImageClassification",Zp]],["convnext",["ConvNextForImageClassification",Zc]],["convnextv2",["ConvNextV2ForImageClassification",ed]],["dinov2",["Dinov2ForImageClassification",Hs]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",_l]],["resnet",["ResNetForImageClassification",ah]],["swin",["SwinForImageClassification",zc]],["segformer",["SegformerForImageClassification",Fu]],["efficientnet",["EfficientNetForImageClassification",xd]],["mobilenet_v1",["MobileNetV1ForImageClassification",Ml]],["mobilenet_v2",["MobileNetV2ForImageClassification",Sl]],["mobilenet_v3",["MobileNetV3ForImageClassification",Lu]],["mobilenet_v4",["MobileNetV4ForImageClassification",Cd]]]),rp=new Map([["detr",["DetrForObjectDetection",Dc]],["rt_detr",["RTDetrForObjectDetection",Jp]],["rt_detr_v2",["RTDetrV2ForObjectDetection",Xn]],["rf_detr",["RFDetrForObjectDetection",cu]],["d_fine",["DFineForObjectDetection",_i]],["table-transformer",["TableTransformerForObjectDetection",oh]],["yolos",["YolosForObjectDetection",bu]]]),np=new Map([["owlvit",["OwlViTForObjectDetection",fl]],["owlv2",["Owlv2ForObjectDetection",ou]],["grounding-dino",["GroundingDinoForObjectDetection",wu]]]),go=new Map([["detr",["DetrForSegmentation",au]],["clipseg",["CLIPSegForImageSegmentation",Af]]]),zd=new Map([["segformer",["SegformerForSemanticSegmentation",Sh]],["sapiens",["SapiensForSemanticSegmentation",uh]],["swin",["SwinForSemanticSegmentation",lh]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",Tl]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",Td]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",ns]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",Ph]]]),_m=new Map([["detr",["DetrForSegmentation",au]],["maskformer",["MaskFormerForInstanceSegmentation",Rr]]]),ip=new Map([["sam",["SamModel",Xs]]]),sp=new Map([["wav2vec2",["Wav2Vec2ForCTC",ld]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Su]],["unispeech",["UniSpeechForCTC",ph]],["unispeech-sat",["UniSpeechSatForCTC",mh]],["wavlm",["WavLMForCTC",_h]],["hubert",["HubertForCTC",Eu]]]),op=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",ud]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",si]],["unispeech",["UniSpeechForSequenceClassification",dd]],["unispeech-sat",["UniSpeechSatForSequenceClassification",fd]],["wavlm",["WavLMForSequenceClassification",md]],["hubert",["HubertForSequenceClassification",vl]],["audio-spectrogram-transformer",["ASTForAudioClassification",hs]]]),ap=new Map([["wavlm",["WavLMForXVector",bs]]]),vm=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",hd]],["wavlm",["WavLMForAudioFrameClassification",gd]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",vi]],["pyannote",["PyAnnoteForAudioFrameClassification",vs]]]),jd=new Map([["vitmatte",["VitMatteForImageMatting",Uo]]]),ym=new Map([["patchtst",["PatchTSTForPrediction",Lh]],["patchtsmixer",["PatchTSMixerForPrediction",Id]]]),Nd=new Map([["swin2sr",["Swin2SRForImageSuperResolution",gu]]]),lp=new Map([["dpt",["DPTForDepthEstimation",Vc]],["depth_anything",["DepthAnythingForDepthEstimation",Gc]],["glpn",["GLPNForDepthEstimation",Sa]],["sapiens",["SapiensForDepthEstimation",Hc]],["depth_pro",["DepthProForDepthEstimation",Xc]],["metric3d",["Metric3DForDepthEstimation",Ma]],["metric3dv2",["Metric3Dv2ForDepthEstimation",gl]]]),Ol=new Map([["sapiens",["SapiensForNormalEstimation",Kc]]]),wm=new Map([["vitpose",["VitPoseForPoseEstimation",Jf]]]),up=new Map([["clip",["CLIPVisionModelWithProjection",Xp]],["siglip",["SiglipVisionModel",ac]],["jina_clip",["JinaCLIPVisionModel",js]]]),cp=[[Ld,C.EncoderOnly],[hm,C.EncoderDecoder],[pm,C.DecoderOnly],[Hh,C.AutoEncoder],[Yh,C.EncoderOnly],[qh,C.EncoderOnly],[Rd,C.Seq2Seq],[$d,C.Seq2Seq],[Qh,C.DecoderOnly],[mm,C.MultiModality],[Jh,C.EncoderOnly],[Zh,C.EncoderOnly],[ep,C.Vision2Seq],[tp,C.ImageTextToText],[Pl,C.AudioTextToText],[Bd,C.EncoderOnly],[go,C.EncoderOnly],[_m,C.EncoderOnly],[zd,C.EncoderOnly],[jd,C.EncoderOnly],[ym,C.EncoderOnly],[Nd,C.EncoderOnly],[lp,C.EncoderOnly],[Ol,C.EncoderOnly],[wm,C.EncoderOnly],[rp,C.EncoderOnly],[np,C.EncoderOnly],[ip,C.MaskGeneration],[sp,C.EncoderOnly],[op,C.EncoderOnly],[Kh,C.Seq2Seq],[Xh,C.EncoderOnly],[ap,C.EncoderOnly],[vm,C.EncoderOnly],[up,C.EncoderOnly]];for(const[R,V]of cp)for(const[oe,Ee]of R.values())P.set(oe,V),D.set(Ee,oe),O.set(oe,Ee);const xm=[["MusicgenForConditionalGeneration",Md,C.Musicgen],["Phi3VForCausalLM",Kl,C.Phi3V],["CLIPTextModelWithProjection",oc,C.EncoderOnly],["SiglipTextModel",Yl,C.EncoderOnly],["JinaCLIPTextModel",lc,C.EncoderOnly],["ClapTextModelWithProjection",xh,C.EncoderOnly],["ClapAudioModelWithProjection",bh,C.EncoderOnly],["DacEncoderModel",Fd,C.EncoderOnly],["DacDecoderModel",Uh,C.EncoderOnly],["MimiEncoderModel",Bh,C.EncoderOnly],["MimiDecoderModel",zh,C.EncoderOnly],["SnacEncoderModel",Wh,C.EncoderOnly],["SnacDecoderModel",Gh,C.EncoderOnly],["Gemma3nForConditionalGeneration",Ii,C.ImageAudioTextToText]];for(const[R,V,oe]of xm)P.set(R,oe),D.set(V,R),O.set(R,V);const bm=new Map([["modnet",go],["birefnet",go],["isnet",go],["ben",go]]);for(const[R,V]of bm.entries())V.set(R,["PreTrainedModel",ee]),P.set(R,C.EncoderOnly),D.set(ee,R),O.set(R,ee);class Ud extends Qr{}$e(Ud,"MODEL_CLASS_MAPPINGS",cp.map(V=>V[0])),$e(Ud,"BASE_IF_FAIL",!0);class Mm extends Qr{}$e(Mm,"MODEL_CLASS_MAPPINGS",[Yh]);class dp extends Qr{}$e(dp,"MODEL_CLASS_MAPPINGS",[qh]);class Tm extends Qr{}$e(Tm,"MODEL_CLASS_MAPPINGS",[Rd]);class fp extends Qr{}$e(fp,"MODEL_CLASS_MAPPINGS",[$d]);class hp extends Qr{}$e(hp,"MODEL_CLASS_MAPPINGS",[Kh]);class pp extends Qr{}$e(pp,"MODEL_CLASS_MAPPINGS",[Xh]);class mp extends Qr{}$e(mp,"MODEL_CLASS_MAPPINGS",[Qh]);class gp extends Qr{}$e(gp,"MODEL_CLASS_MAPPINGS",[Jh]);class Sm extends Qr{}$e(Sm,"MODEL_CLASS_MAPPINGS",[Zh]);class _p extends Qr{}$e(_p,"MODEL_CLASS_MAPPINGS",[ep]);class kl extends Qr{}$e(kl,"MODEL_CLASS_MAPPINGS",[Bd]);class Vd extends Qr{}$e(Vd,"MODEL_CLASS_MAPPINGS",[go]);class vp extends Qr{}$e(vp,"MODEL_CLASS_MAPPINGS",[zd]);class Cm extends Qr{}$e(Cm,"MODEL_CLASS_MAPPINGS",[_m]);class yp extends Qr{}$e(yp,"MODEL_CLASS_MAPPINGS",[rp]);class Wd extends Qr{}$e(Wd,"MODEL_CLASS_MAPPINGS",[np]);class Da extends Qr{}$e(Da,"MODEL_CLASS_MAPPINGS",[ip]);class _o extends Qr{}$e(_o,"MODEL_CLASS_MAPPINGS",[sp]);class wp extends Qr{}$e(wp,"MODEL_CLASS_MAPPINGS",[op]);class Gd extends Qr{}$e(Gd,"MODEL_CLASS_MAPPINGS",[ap]);class Bu extends Qr{}$e(Bu,"MODEL_CLASS_MAPPINGS",[vm]);class Hd extends Qr{}$e(Hd,"MODEL_CLASS_MAPPINGS",[gm]);class Kd extends Qr{}$e(Kd,"MODEL_CLASS_MAPPINGS",[jd]);class Xd extends Qr{}$e(Xd,"MODEL_CLASS_MAPPINGS",[Nd]);class Yd extends Qr{}$e(Yd,"MODEL_CLASS_MAPPINGS",[lp]);class qd extends Qr{}$e(qd,"MODEL_CLASS_MAPPINGS",[Ol]);class Qd extends Qr{}$e(Qd,"MODEL_CLASS_MAPPINGS",[wm]);class xp extends Qr{}$e(xp,"MODEL_CLASS_MAPPINGS",[up]);class is extends Qr{}$e(is,"MODEL_CLASS_MAPPINGS",[tp]);class Ei extends Qr{}$e(Ei,"MODEL_CLASS_MAPPINGS",[Pl]);class Fa extends we{constructor({logits:V,past_key_values:oe,encoder_outputs:Ee,decoder_attentions:tt=null,cross_attentions:Ze=null}){super(),this.logits=V,this.past_key_values=oe,this.encoder_outputs=Ee,this.decoder_attentions=tt,this.cross_attentions=Ze}}class mr extends we{constructor({logits:V,...oe}){super(),this.logits=V;const Ee=Object.values(oe);Ee.length>0&&(this.attentions=Ee)}}class Qo extends we{constructor({logits:V,embeddings:oe}){super(),this.logits=V,this.embeddings=oe}}class Tn extends we{constructor({logits:V}){super(),this.logits=V}}class On extends we{constructor({logits:V}){super(),this.logits=V}}class Fn extends we{constructor({start_logits:V,end_logits:oe}){super(),this.start_logits=V,this.end_logits=oe}}class Li extends we{constructor({logits:V}){super(),this.logits=V}}class La extends we{constructor({logits:V,past_key_values:oe}){super(),this.logits=V,this.past_key_values=oe}}class bp extends we{constructor({alphas:V}){super(),this.alphas=V}}class Mp extends we{constructor({waveform:V,spectrogram:oe}){super(),this.waveform=V,this.spectrogram=oe}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(t,e,r)=>{r.r(e),r.d(e,{ASTFeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var a=r("./src/utils/audio.js");class h extends n.FeatureExtractor{constructor(f){super(f);const s=this.config.sampling_rate,d=(0,a.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(s/2),s,null,"kaldi",!0);this.mel_filters=d,this.window=(0,a.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(f,s){return(0,a.spectrogram)(f,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:s,transpose:!0})}async _call(f){(0,n.validate_audio_inputs)(f,"ASTFeatureExtractor");const s=await this._extract_fbank_features(f,this.config.max_length);if(this.config.do_normalize){const d=this.std*2,m=s.data;for(let o=0;o<m.length;++o)m[o]=(m[o]-this.mean)/d}return{input_values:s.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoFeatureExtractor:()=>x});var n=r("./src/utils/constants.js"),a=r("./src/utils/hub.js");r("./src/base/feature_extraction_utils.js");var h=r("./src/models/feature_extractors.js");class x{static async from_pretrained(s,d={}){const m=await(0,a.getModelJSON)(s,n.FEATURE_EXTRACTOR_NAME,!0,d),o=m.feature_extractor_type,l=h[o];if(!l)throw new Error(`Unknown feature_extractor_type: '${o}'. Please report this at ${n.GITHUB_ISSUE_URL}.`);return new l(m)}}},"./src/models/auto/image_processing_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoImageProcessor:()=>f});var n=r("./src/utils/constants.js"),a=r("./src/utils/hub.js"),h=r("./src/base/image_processors_utils.js"),x=r("./src/models/image_processors.js");class f{static async from_pretrained(d,m={}){var p;const o=await(0,a.getModelJSON)(d,n.IMAGE_PROCESSOR_NAME,!0,m),l=(p=o.image_processor_type)!=null?p:o.feature_extractor_type;let u=x[l==null?void 0:l.replace(/Fast$/,"")];return u||(l!==void 0&&console.warn(`Image processor type '${l}' not found, assuming base ImageProcessor. Please report this at ${n.GITHUB_ISSUE_URL}.`),u=h.ImageProcessor),new u(o)}}},"./src/models/auto/processing_auto.js":(t,e,r)=>{r.r(e),r.d(e,{AutoProcessor:()=>d});var n=r("./src/utils/constants.js"),a=r("./src/utils/hub.js"),h=r("./src/base/processing_utils.js"),x=r("./src/models/processors.js"),f=r("./src/models/image_processors.js"),s=r("./src/models/feature_extractors.js");class d{static async from_pretrained(o,l={}){const u=await(0,a.getModelJSON)(o,n.IMAGE_PROCESSOR_NAME,!0,l),{image_processor_type:p,feature_extractor_type:w,processor_class:_}=u;if(_&&x[_])return x[_].from_pretrained(o,l);if(!p&&!w)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const v={};if(p){const T=f[p.replace(/Fast$/,"")];if(!T)throw new Error(`Unknown image_processor_type: '${p}'.`);v.image_processor=new T(u)}if(w){const T=f[w];if(T)v.image_processor=new T(u);else{const C=s[w];if(!C)throw new Error(`Unknown feature_extractor_type: '${w}'.`);v.feature_extractor=new C(u)}}const y={};return new h.Processor(y,v,null)}}},"./src/models/beit/image_processing_beit.js":(t,e,r)=>{r.r(e),r.d(e,{BeitFeatureExtractor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(t,e,r)=>{r.r(e),r.d(e,{BitImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(t,e,r)=>{r.r(e),r.d(e,{ChineseCLIPFeatureExtractor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(t,e,r)=>{r.r(e),r.d(e,{ClapFeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var a=r("./src/utils/audio.js");class h extends n.FeatureExtractor{constructor(f){super(f),this.mel_filters=(0,a.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,a.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,a.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(f,s,d,m){let o;const l=f.length-s;if(l>0)if(d==="rand_trunc"){const u=Math.floor(Math.random()*(l+1));f=f.subarray(u,u+s),o=await this._extract_fbank_features(f,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${d}" not implemented`);else{if(l<0){let u=new Float64Array(s);if(u.set(f),m==="repeat")for(let p=f.length;p<s;p+=f.length)u.set(f.subarray(0,Math.min(f.length,s-p)),p);else if(m==="repeatpad")for(let p=f.length;p<-l;p+=f.length)u.set(f,p);f=u}if(d==="fusion")throw new Error(`Truncation strategy "${d}" not implemented`);o=await this._extract_fbank_features(f,this.mel_filters_slaney,this.config.nb_max_samples)}return o.unsqueeze_(0)}async _extract_fbank_features(f,s,d=null){return(0,a.spectrogram)(f,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:s,log_mel:"dB",max_num_frames:d,do_pad:!1,transpose:!0})}async _call(f,{max_length:s=null}={}){return(0,n.validate_audio_inputs)(f,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(f,s!=null?s:this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(t,e,r)=>{r.r(e),r.d(e,{CLIPFeatureExtractor:()=>h,CLIPImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/convnext/image_processing_convnext.js":(t,e,r)=>{r.r(e),r.d(e,{ConvNextFeatureExtractor:()=>h,ConvNextImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{constructor(f){var s;super(f),this.crop_pct=(s=this.config.crop_pct)!=null?s:224/256}async resize(f){var d;const s=(d=this.size)==null?void 0:d.shortest_edge;if(s===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(s<384){const m=Math.floor(s/this.crop_pct),[o,l]=this.get_resize_output_image_size(f,{shortest_edge:m});f=await f.resize(o,l,{resample:this.resample}),f=await f.center_crop(s,s)}else f=await f.resize(s,s,{resample:this.resample});return f}}class h extends a{}},"./src/models/dac/feature_extraction_dac.js":(t,e,r)=>{r.r(e),r.d(e,{DacFeatureExtractor:()=>a});var n=r("./src/models/encodec/feature_extraction_encodec.js");class a extends n.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(t,e,r)=>{r.r(e),r.d(e,{DeiTFeatureExtractor:()=>h,DeiTImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/detr/image_processing_detr.js":(t,e,r)=>{r.r(e),r.d(e,{DetrFeatureExtractor:()=>x,DetrImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");class h extends n.ImageProcessor{async _call(s){const d=await super._call(s),m=[d.pixel_values.dims[0],64,64],o=(0,a.full)(m,1n);return{...d,pixel_mask:o}}post_process_object_detection(...s){return(0,n.post_process_object_detection)(...s)}post_process_panoptic_segmentation(...s){return(0,n.post_process_panoptic_segmentation)(...s)}post_process_instance_segmentation(...s){return(0,n.post_process_instance_segmentation)(...s)}}class x extends h{}},"./src/models/donut/image_processing_donut.js":(t,e,r)=>{r.r(e),r.d(e,{DonutFeatureExtractor:()=>h,DonutImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{pad_image(f,s,d,m={}){const[o,l,u]=s;let p=this.image_mean;Array.isArray(this.image_mean)||(p=new Array(u).fill(p));let w=this.image_std;Array.isArray(w)||(w=new Array(u).fill(p));const _=p.map((v,y)=>-v/w[y]);return super.pad_image(f,s,d,{center:!0,constant_values:_,...m})}}class h extends a{}},"./src/models/dpt/image_processing_dpt.js":(t,e,r)=>{r.r(e),r.d(e,{DPTFeatureExtractor:()=>h,DPTImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/efficientnet/image_processing_efficientnet.js":(t,e,r)=>{r.r(e),r.d(e,{EfficientNetImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{constructor(x){var f;super(x),this.include_top=(f=this.config.include_top)!=null?f:!0,this.include_top&&(this.image_std=this.image_std.map(s=>s*s))}}},"./src/models/encodec/feature_extraction_encodec.js":(t,e,r)=>{r.r(e),r.d(e,{EncodecFeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js");class h extends n.FeatureExtractor{async _call(f){(0,n.validate_audio_inputs)(f,"EncodecFeatureExtractor"),f instanceof Float64Array&&(f=new Float32Array(f));const s=this.config.feature_size;if(f.length%s!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${s}).`);const d=[1,s,f.length/s];return{input_values:new a.Tensor("float32",f,d)}}}},"./src/models/feature_extractors.js":(t,e,r)=>{r.r(e),r.d(e,{ASTFeatureExtractor:()=>n.ASTFeatureExtractor,ClapFeatureExtractor:()=>h.ClapFeatureExtractor,DacFeatureExtractor:()=>x.DacFeatureExtractor,EncodecFeatureExtractor:()=>a.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>f.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>_.ImageProcessor,MoonshineFeatureExtractor:()=>s.MoonshineFeatureExtractor,PyAnnoteFeatureExtractor:()=>d.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>m.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>o.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>l.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>u.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>p.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>w.WhisperFeatureExtractor});var n=r("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),a=r("./src/models/encodec/feature_extraction_encodec.js"),h=r("./src/models/clap/feature_extraction_clap.js"),x=r("./src/models/dac/feature_extraction_dac.js"),f=r("./src/models/gemma3n/feature_extraction_gemma3n.js"),s=r("./src/models/moonshine/feature_extraction_moonshine.js"),d=r("./src/models/pyannote/feature_extraction_pyannote.js"),m=r("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),o=r("./src/models/snac/feature_extraction_snac.js"),l=r("./src/models/speecht5/feature_extraction_speecht5.js"),u=r("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),p=r("./src/models/wespeaker/feature_extraction_wespeaker.js"),w=r("./src/models/whisper/feature_extraction_whisper.js"),_=r("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(t,e,r)=>{r.r(e),r.d(e,{Florence2Processor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");class x extends n.Processor{constructor(s,d,m){super(s,d,m);const{tasks_answer_post_processing_type:o,task_prompts_without_inputs:l,task_prompts_with_input:u}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(o!=null?o:{})),this.task_prompts_without_inputs=new Map(Object.entries(l!=null?l:{})),this.task_prompts_with_input=new Map(Object.entries(u!=null?u:{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(s){typeof s=="string"&&(s=[s]);const d=[];for(const m of s)if(this.task_prompts_without_inputs.has(m))d.push(this.task_prompts_without_inputs.get(m));else{for(const[o,l]of this.task_prompts_with_input)if(m.includes(o)){d.push(l.replaceAll("{input}",m).replaceAll(o,""));break}d.length!==s.length&&d.push(m)}return d}post_process_generation(s,d,m){var u,p;const o=(u=this.tasks_answer_post_processing_type.get(d))!=null?u:"pure_text";s=s.replaceAll("<s>","").replaceAll("</s>","");let l;switch(o){case"pure_text":l=s;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const w=o==="ocr"?"quad_boxes":"bboxes",_=s.matchAll(this.regexes[w]),v=[],y=[];for(const[T,C,...P]of _)v.push(C?C.trim():(p=v.at(-1))!=null?p:""),y.push(P.map((O,D)=>(Number(O)+.5)/this.size_per_bin*m[D%2]));l={labels:v,[w]:y};break;default:throw new Error(`Task "${d}" (of type "${o}") not yet implemented.`)}return{[d]:l}}async _call(s,d=null,m={}){if(!s&&!d)throw new Error("Either text or images must be provided");const o=await this.image_processor(s,m),l=d?this.tokenizer(this.construct_prompts(d),m):{};return{...o,...l}}}$e(x,"tokenizer_class",h.AutoTokenizer),$e(x,"image_processor_class",a.AutoImageProcessor)},"./src/models/gemma3n/feature_extraction_gemma3n.js":(t,e,r)=>{r.r(e),r.d(e,{Gemma3nAudioFeatureExtractor:()=>x});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js"),h=r("./src/utils/audio.js");class x extends n.FeatureExtractor{constructor(s){super(s);const{fft_length:d,feature_size:m,min_frequency:o,max_frequency:l,sampling_rate:u,frame_length:p}=this.config,w=(0,h.mel_filter_bank)(Math.floor(1+d/2),m,o,l,u,null,"htk",!1);this.mel_filters=w,this.window=(0,h.window_function)(p,"hann")}async _extract_fbank_features(s,d){return(0,h.spectrogram)(s,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(s,{max_length:d=48e4,truncation:m=!0,padding:o=!0,pad_to_multiple_of:l=128}={}){if((0,n.validate_audio_inputs)(s,"Gemma3nAudioFeatureExtractor"),m&&s.length>d&&(s=s.slice(0,d)),o&&s.length%l!==0){const w=l-s.length%l,_=new Float64Array(s.length+w);_.set(s),this.config.padding_value!==0&&_.fill(this.config.padding_value,s.length),s=_}const u=await this._extract_fbank_features(s,this.config.max_length),p=(0,a.full)([1,u.dims[0]],!0);return{input_features:u.unsqueeze_(0),input_features_mask:p}}}},"./src/models/gemma3n/processing_gemma3n.js":(t,e,r)=>{r.r(e),r.d(e,{Gemma3nProcessor:()=>f});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/models/auto/feature_extraction_auto.js"),x=r("./src/tokenizers.js");r("./src/utils/image.js"),r("./src/utils/audio.js");class f extends n.Processor{constructor(d,m,o){super(d,m,o),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:l,boa_token:u,audio_token:p,eoa_token:w,image_token_id:_,boi_token:v,image_token:y,eoi_token:T}=this.tokenizer.config;this.audio_token_id=l,this.boa_token=u,this.audio_token=p;const C=p.repeat(this.audio_seq_length);this.full_audio_sequence=`

${u}${C}${w}

`,this.image_token_id=_,this.boi_token=v,this.image_token=y;const P=y.repeat(this.image_seq_length);this.full_image_sequence=`

${v}${P}${T}

`}async _call(d,m=null,o=null,l={}){typeof d=="string"&&(d=[d]);let u;o&&(u=await this.feature_extractor(o,l),d=d.map(_=>_.replaceAll(this.audio_token,this.full_audio_sequence)));let p;return m&&(p=await this.image_processor(m,l),d=d.map(_=>_.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(d,l),...p,...u}}}$e(f,"image_processor_class",a.AutoImageProcessor),$e(f,"feature_extractor_class",h.AutoFeatureExtractor),$e(f,"tokenizer_class",x.AutoTokenizer),$e(f,"uses_processor_config",!0),$e(f,"uses_chat_template_file",!0)},"./src/models/glpn/image_processing_glpn.js":(t,e,r)=>{r.r(e),r.d(e,{GLPNFeatureExtractor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(t,e,r)=>{r.r(e),r.d(e,{GroundingDinoImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");class h extends n.ImageProcessor{async _call(f){const s=await super._call(f),d=s.pixel_values.dims,m=(0,a.ones)([d[0],d[2],d[3]]);return{...s,pixel_mask:m}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(t,e,r)=>{r.r(e),r.d(e,{GroundingDinoProcessor:()=>s});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js"),x=r("./src/base/image_processors_utils.js");function f(d,m){const l=d.dims.at(-1)-1,u=d.tolist();u.fill(!1,0,0+1),u.fill(!1,l);const p=m.tolist();return u.map((w,_)=>w?_:null).filter(w=>w!==null).map(w=>p[w])}class s extends n.Processor{async _call(m,o,l={}){const u=m?await this.image_processor(m,l):{};return{...o?this.tokenizer(o,l):{},...u}}post_process_grounded_object_detection(m,o,{box_threshold:l=.25,text_threshold:u=.25,target_sizes:p=null}={}){const{logits:w,pred_boxes:_}=m,v=w.dims[0];if(p!==null&&p.length!==v)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const y=w.dims.at(1),T=w.sigmoid(),C=T.max(-1).tolist(),P=_.tolist().map(D=>D.map(L=>(0,x.center_to_corners_format)(L))),O=[];for(let D=0;D<v;++D){const L=p!==null?p[D]:null;L!==null&&(P[D]=P[D].map(ne=>ne.map((ye,ce)=>ye*L[(ce+1)%2])));const W=C[D],U=[],te=[],pe=[];for(let ne=0;ne<y;++ne){const ye=W[ne];if(ye<=l)continue;const ce=P[D][ne],Me=T[D][ne];U.push(ye),pe.push(ce);const ke=f(Me.gt(u),o[D]);te.push(ke)}O.push({scores:U,boxes:pe,labels:this.batch_decode(te)})}return O}}$e(s,"tokenizer_class",h.AutoTokenizer),$e(s,"image_processor_class",a.AutoImageProcessor)},"./src/models/idefics3/image_processing_idefics3.js":(t,e,r)=>{r.r(e),r.d(e,{Idefics3ImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");class h extends n.ImageProcessor{constructor(f){var s;super(f),this.do_image_splitting=(s=f.do_image_splitting)!=null?s:!0,this.max_image_size=f.max_image_size}get_resize_for_vision_encoder(f,s){let[d,m]=f.dims.slice(-2);const o=m/d;return m>=d?(m=Math.ceil(m/s)*s,d=Math.floor(m/o),d=Math.ceil(d/s)*s):(d=Math.ceil(d/s)*s,m=Math.floor(d*o),m=Math.ceil(m/s)*s),{height:d,width:m}}async _call(f,{do_image_splitting:s=null,return_row_col_info:d=!1}={}){let m;if(!Array.isArray(f))m=[[f]];else{if(f.length===0||!f[0])throw new Error("No images provided.");Array.isArray(f[0])?m=f:m=[f]}let o=[],l=[],u=[];const p=[],w=[];for(const D of m){let L=await Promise.all(D.map(te=>this.preprocess(te)));p.push(...L.map(te=>te.original_size)),w.push(...L.map(te=>te.reshaped_input_size)),L.forEach(te=>te.pixel_values.unsqueeze_(0));const{longest_edge:W}=this.max_image_size;let U;if(s!=null?s:this.do_image_splitting){let te=new Array(L.length),pe=new Array(L.length);U=await Promise.all(L.map(async(ne,ye)=>{const ce=this.get_resize_for_vision_encoder(ne.pixel_values,W),Me=await(0,a.interpolate_4d)(ne.pixel_values,{size:[ce.height,ce.width]}),{frames:ke,num_splits_h:ve,num_splits_w:K}=await this.split_image(Me,this.max_image_size);return te[ye]=ve,pe[ye]=K,(0,a.cat)(ke,0)})),l.push(te),u.push(pe)}else{const te=[W,W];U=await Promise.all(L.map(pe=>(0,a.interpolate_4d)(pe.pixel_values,{size:te}))),l.push(new Array(L.length).fill(0)),u.push(new Array(L.length).fill(0))}o.push((0,a.cat)(U,0))}const _=o.length,[v,y,T,C]=o[0].dims;let P,O;if(_===1)P=o[0].unsqueeze_(0),O=(0,a.full)([_,v,T,C],!0);else{const D=Math.max(...o.map(U=>U.dims.at(0)));O=(0,a.full)([_,D,T,C],!0);const L=O.data,W=D*T*C;for(let U=0;U<_;++U){const te=o[U].dims[0];if(te<D){o[U]=(0,a.cat)([o[U],(0,a.full)([D-te,y,T,C],0)],0);const pe=U*W+te*T*C,ne=(U+1)*W;L.fill(!1,pe,ne)}}P=(0,a.stack)(o,0)}return{pixel_values:P,pixel_attention_mask:O,original_sizes:p,reshaped_input_sizes:w,...d?{rows:l,cols:u}:{}}}async split_image(f,{longest_edge:s}){const d=s,m=s,o=[],[l,u]=f.dims.slice(-2);let p=0,w=0;if(l>d||u>m){p=Math.ceil(l/d),w=Math.ceil(u/m);const _=Math.ceil(l/p),v=Math.ceil(u/w);for(let C=0;C<p;++C)for(let P=0;P<w;++P){let O,D,L,W;C===p-1?(D=l-_,W=l):(D=C*_,W=(C+1)*_),P===w-1?(O=u-v,L=u):(O=P*v,L=(P+1)*v);const U=[D,O],te=[W,L],pe=await(0,a.slice)(f,U,te,[2,3]);o.push(pe)}const y=d,T=m;(l!==y||u!==T)&&(f=await(0,a.interpolate_4d)(f,{size:[y,T]}))}return o.push(f),{frames:o,num_splits_h:p,num_splits_w:w}}}},"./src/models/idefics3/processing_idefics3.js":(t,e,r)=>{r.r(e),r.d(e,{Idefics3Processor:()=>m});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");r("./src/utils/image.js");var x=r("./src/utils/core.js");function f(o,l,u,p,w,_){let v="";for(let y=0;y<l;++y){for(let T=0;T<u;++T)v+=p+`<row_${y+1}_col_${T+1}>`+w.repeat(o);v+=`
`}return v+=`
${p}${_}`+w.repeat(o)+`${p}`,v}function s(o,l,u,p){return`${l}${p}`+u.repeat(o)+`${l}`}function d(o,l,u,p,w,_){return o===0&&l===0?s(u,p,w,_):f(u,o,l,p,w,_)}class m extends n.Processor{constructor(){super(...arguments);$e(this,"fake_image_token","<fake_token_around_image>");$e(this,"image_token","<image>");$e(this,"global_img_token","<global-img>")}async _call(u,p=null,w={}){var D,L,W;(D=w.return_row_col_info)!=null||(w.return_row_col_info=!0);let _;p&&(_=await this.image_processor(p,w)),Array.isArray(u)||(u=[u]);const v=(L=_.rows)!=null?L:[new Array(u.length).fill(0)],y=(W=_.cols)!=null?W:[new Array(u.length).fill(0)],T=this.config.image_seq_len,C=[],P=[];for(let U=0;U<u.length;++U){const te=u[U],pe=v[U],ne=y[U];C.push((0,x.count)(te,this.image_token));const ye=pe.map((ke,ve)=>d(ke,ne[ve],T,this.fake_image_token,this.image_token,this.global_img_token)),ce=te.split(this.image_token);if(ce.length===0)throw new Error("The image token should be present in the text.");let Me=ce[0];for(let ke=0;ke<ye.length;++ke)Me+=ye[ke]+ce[ke+1];P.push(Me)}return{...this.tokenizer(P),..._}}}$e(m,"image_processor_class",a.AutoImageProcessor),$e(m,"tokenizer_class",h.AutoTokenizer),$e(m,"uses_processor_config",!0)},"./src/models/image_processors.js":(t,e,r)=>{r.r(e),r.d(e,{BeitFeatureExtractor:()=>n.BeitFeatureExtractor,BitImageProcessor:()=>a.BitImageProcessor,CLIPFeatureExtractor:()=>x.CLIPFeatureExtractor,CLIPImageProcessor:()=>x.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>h.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>f.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>f.ConvNextImageProcessor,DPTFeatureExtractor:()=>o.DPTFeatureExtractor,DPTImageProcessor:()=>o.DPTImageProcessor,DeiTFeatureExtractor:()=>s.DeiTFeatureExtractor,DeiTImageProcessor:()=>s.DeiTImageProcessor,DetrFeatureExtractor:()=>d.DetrFeatureExtractor,DetrImageProcessor:()=>d.DetrImageProcessor,DonutFeatureExtractor:()=>m.DonutFeatureExtractor,DonutImageProcessor:()=>m.DonutImageProcessor,EfficientNetImageProcessor:()=>l.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>u.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>p.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>w.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>v.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>y.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>T.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>C.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>C.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>P.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>P.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>O.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>O.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>D.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>D.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>L.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>L.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>W.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>W.MobileViTImageProcessor,NougatImageProcessor:()=>U.NougatImageProcessor,OwlViTFeatureExtractor:()=>pe.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>pe.OwlViTImageProcessor,Owlv2ImageProcessor:()=>te.Owlv2ImageProcessor,Phi3VImageProcessor:()=>ne.Phi3VImageProcessor,PvtImageProcessor:()=>ye.PvtImageProcessor,Qwen2VLImageProcessor:()=>ce.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>Me.RTDetrImageProcessor,SamImageProcessor:()=>ke.SamImageProcessor,SegformerFeatureExtractor:()=>ve.SegformerFeatureExtractor,SegformerImageProcessor:()=>ve.SegformerImageProcessor,SiglipImageProcessor:()=>K.SiglipImageProcessor,SmolVLMImageProcessor:()=>re.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>X.Swin2SRImageProcessor,VLMImageProcessor:()=>_.VLMImageProcessor,ViTFeatureExtractor:()=>N.ViTFeatureExtractor,ViTImageProcessor:()=>N.ViTImageProcessor,VitMatteImageProcessor:()=>ae.VitMatteImageProcessor,VitPoseImageProcessor:()=>J.VitPoseImageProcessor,YolosFeatureExtractor:()=>Y.YolosFeatureExtractor,YolosImageProcessor:()=>Y.YolosImageProcessor});var n=r("./src/models/beit/image_processing_beit.js"),a=r("./src/models/bit/image_processing_bit.js"),h=r("./src/models/chinese_clip/image_processing_chinese_clip.js"),x=r("./src/models/clip/image_processing_clip.js"),f=r("./src/models/convnext/image_processing_convnext.js"),s=r("./src/models/deit/image_processing_deit.js"),d=r("./src/models/detr/image_processing_detr.js"),m=r("./src/models/donut/image_processing_donut.js"),o=r("./src/models/dpt/image_processing_dpt.js"),l=r("./src/models/efficientnet/image_processing_efficientnet.js"),u=r("./src/models/glpn/image_processing_glpn.js"),p=r("./src/models/grounding_dino/image_processing_grounding_dino.js"),w=r("./src/models/idefics3/image_processing_idefics3.js"),_=r("./src/models/janus/image_processing_janus.js"),v=r("./src/models/jina_clip/image_processing_jina_clip.js"),y=r("./src/models/llava_onevision/image_processing_llava_onevision.js"),T=r("./src/models/mask2former/image_processing_mask2former.js"),C=r("./src/models/maskformer/image_processing_maskformer.js"),P=r("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),O=r("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),D=r("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),L=r("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),W=r("./src/models/mobilevit/image_processing_mobilevit.js"),U=r("./src/models/nougat/image_processing_nougat.js"),te=r("./src/models/owlv2/image_processing_owlv2.js"),pe=r("./src/models/owlvit/image_processing_owlvit.js"),ne=r("./src/models/phi3_v/image_processing_phi3_v.js"),ye=r("./src/models/pvt/image_processing_pvt.js"),ce=r("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),Me=r("./src/models/rt_detr/image_processing_rt_detr.js"),ke=r("./src/models/sam/image_processing_sam.js"),ve=r("./src/models/segformer/image_processing_segformer.js"),K=r("./src/models/siglip/image_processing_siglip.js"),re=r("./src/models/smolvlm/image_processing_smolvlm.js"),X=r("./src/models/swin2sr/image_processing_swin2sr.js"),N=r("./src/models/vit/image_processing_vit.js"),ae=r("./src/models/vitmatte/image_processing_vitmatte.js"),J=r("./src/models/vitpose/image_processing_vitpose.js"),Y=r("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(t,e,r)=>{r.r(e),r.d(e,{VLMImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{constructor(x){super({do_pad:!0,pad_size:{width:x.image_size,height:x.image_size},...x}),this.constant_values=this.config.background_color.map(f=>f*this.rescale_factor)}pad_image(x,f,s,d){return super.pad_image(x,f,s,{constant_values:this.constant_values,center:!0,...d})}}},"./src/models/janus/processing_janus.js":(t,e,r)=>{r.r(e),r.d(e,{VLChatProcessor:()=>d});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js"),x=r("./src/utils/core.js"),f=r("./src/utils/tensor.js"),s=r("./src/utils/image.js");class d extends n.Processor{constructor(o,l,u){super(o,l,u),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(o,{images:l=null,chat_template:u="default"}={}){l?Array.isArray(l)||(l=[l]):l=await Promise.all(o.filter(U=>U.images).flatMap(U=>U.images).map(U=>s.RawImage.read(U)));const p=this.tokenizer,w=p.apply_chat_template(o,{tokenize:!1,add_generation_prompt:!0,chat_template:u}),_=U=>p.encode(U,{add_special_tokens:!1}),v=w.split(this.image_tag),y=v.length-1;if(l.length!==y)throw new Error(`Number of images provided (${l.length}) does not match number of "${this.image_tag}" image tags (${y})`);const[T,C,P]=p.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let O=_(v[0]),D=new Array(O.length).fill(!1);for(let U=1;U<v.length;++U){const te=new Array(this.num_image_tokens).fill(T),pe=_(v[U]);O=(0,x.mergeArrays)(O,[C],te,[P],pe);const ne=new Array(this.num_image_tokens).fill(!0);D=(0,x.mergeArrays)(D,[!1],ne,[!1],new Array(pe.length).fill(!1))}const L=[1,O.length],W={input_ids:new f.Tensor("int64",O,L),attention_mask:new f.Tensor("int64",new Array(O.length).fill(1),L),images_seq_mask:new f.Tensor("bool",D,L),images_emb_mask:new f.Tensor("bool",new Array(y*this.num_image_tokens).fill(!0),[1,y,this.num_image_tokens])};if(l&&l.length>0){const U=await this.image_processor(l);return U.pixel_values.unsqueeze_(0),{...W,...U}}return W}}$e(d,"image_processor_class",a.AutoImageProcessor),$e(d,"tokenizer_class",h.AutoTokenizer),$e(d,"uses_processor_config",!0)},"./src/models/jina_clip/image_processing_jina_clip.js":(t,e,r)=>{r.r(e),r.d(e,{JinaCLIPImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{constructor(x){const{resize_mode:f,fill_color:s,interpolation:d,size:m,...o}=x,l=f==="squash"?{width:m,height:m}:f==="shortest"?{shortest_edge:m}:{longest_edge:m},u=d==="bicubic"?3:2;super({...o,size:l,resample:u,do_center_crop:!0,crop_size:m,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(t,e,r)=>{r.r(e),r.d(e,{JinaCLIPProcessor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");class x extends n.Processor{async _call(s=null,d=null,m={}){if(!s&&!d)throw new Error("Either text or images must be provided");const o=s?this.tokenizer(s,m):{},l=d?await this.image_processor(d,m):{};return{...o,...l}}}$e(x,"tokenizer_class",h.AutoTokenizer),$e(x,"image_processor_class",a.AutoImageProcessor)},"./src/models/llava/processing_llava.js":(t,e,r)=>{r.r(e),r.d(e,{LlavaProcessor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");class x extends n.Processor{async _call(s,d=null,m={}){const o=await this.image_processor(s,m);if(d){const[u,p]=o.pixel_values.dims.slice(-2),{image_token:w,patch_size:_,num_additional_image_tokens:v}=this.config,y=Math.floor(u/_)*Math.floor(p/_)+v;d=structuredClone(d),Array.isArray(d)||(d=[d]);for(let T=0;T<d.length;++T)d[T]=d[T].replace(w,w.repeat(y))}const l=d?this.tokenizer(d,m):{};return{...o,...l}}}$e(x,"tokenizer_class",h.AutoTokenizer),$e(x,"image_processor_class",a.AutoImageProcessor),$e(x,"uses_processor_config",!0)},"./src/models/llava_onevision/image_processing_llava_onevision.js":(t,e,r)=>{r.r(e),r.d(e,{LlavaOnevisionImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(t,e,r)=>{r.r(e),r.d(e,{Mask2FormerImageProcessor:()=>a});var n=r("./src/models/maskformer/image_processing_maskformer.js");class a extends n.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(t,e,r)=>{r.r(e),r.d(e,{MaskFormerFeatureExtractor:()=>h,MaskFormerImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_panoptic_segmentation(...f){return(0,n.post_process_panoptic_segmentation)(...f)}post_process_instance_segmentation(...f){return(0,n.post_process_instance_segmentation)(...f)}}class h extends a{}},"./src/models/mgp_str/processing_mgp_str.js":(t,e,r)=>{r.r(e),r.d(e,{MgpstrProcessor:()=>s});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js"),x=r("./src/utils/maths.js");const f={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class s extends n.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(m,o){if(!f.hasOwnProperty(o))throw new Error(`Format ${o} is not supported.`);const[l,u]=f[o],p=this[l].bind(this),[w,_]=m.dims,v=[],y=[],T=m.tolist();for(let P=0;P<w;++P){const O=T[P],D=[],L=[];for(let U=1;U<_;++U){const[te,pe]=(0,x.max)((0,x.softmax)(O[U]));if(L.push(te),pe==u)break;D.push(pe)}const W=L.length>0?L.reduce((U,te)=>U*te,1):0;y.push(D),v.push(W)}return[p(y),v]}char_decode(m){return this.char_tokenizer.batch_decode(m).map(o=>o.replaceAll(" ",""))}bpe_decode(m){return this.bpe_tokenizer.batch_decode(m)}wp_decode(m){return this.wp_tokenizer.batch_decode(m).map(o=>o.replaceAll(" ",""))}batch_decode([m,o,l]){const[u,p]=this._decode_helper(m,"char"),[w,_]=this._decode_helper(o,"bpe"),[v,y]=this._decode_helper(l,"wp"),T=[],C=[];for(let P=0;P<u.length;++P){const[O,D]=(0,x.max)([p[P],_[P],y[P]]);T.push([u[P],w[P],v[P]][D]),C.push(O)}return{generated_text:T,scores:C,char_preds:u,bpe_preds:w,wp_preds:v}}static async from_pretrained(...m){const o=await super.from_pretrained(...m),l=await h.AutoTokenizer.from_pretrained("Xenova/gpt2"),u=await h.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return o.components={image_processor:o.image_processor,char_tokenizer:o.tokenizer,bpe_tokenizer:l,wp_tokenizer:u},o}async _call(m,o=null){const l=await this.image_processor(m);return o&&(l.labels=this.tokenizer(o).input_ids),l}}$e(s,"tokenizer_class",h.AutoTokenizer),$e(s,"image_processor_class",a.AutoImageProcessor)},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV1FeatureExtractor:()=>h,MobileNetV1ImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV2FeatureExtractor:()=>h,MobileNetV2ImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV3FeatureExtractor:()=>h,MobileNetV3ImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(t,e,r)=>{r.r(e),r.d(e,{MobileNetV4FeatureExtractor:()=>h,MobileNetV4ImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/mobilevit/image_processing_mobilevit.js":(t,e,r)=>{r.r(e),r.d(e,{MobileViTFeatureExtractor:()=>h,MobileViTImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/moonshine/feature_extraction_moonshine.js":(t,e,r)=>{r.r(e),r.d(e,{MoonshineFeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js");class h extends n.FeatureExtractor{async _call(f){(0,n.validate_audio_inputs)(f,"MoonshineFeatureExtractor"),f instanceof Float64Array&&(f=new Float32Array(f));const s=[1,f.length];return{input_values:new a.Tensor("float32",f,s)}}}},"./src/models/moonshine/processing_moonshine.js":(t,e,r)=>{r.r(e),r.d(e,{MoonshineProcessor:()=>x});var n=r("./src/models/auto/feature_extraction_auto.js"),a=r("./src/tokenizers.js"),h=r("./src/base/processing_utils.js");class x extends h.Processor{async _call(s){return await this.feature_extractor(s)}}$e(x,"tokenizer_class",a.AutoTokenizer),$e(x,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/nougat/image_processing_nougat.js":(t,e,r)=>{r.r(e),r.d(e,{NougatImageProcessor:()=>a});var n=r("./src/models/donut/image_processing_donut.js");class a extends n.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(t,e,r)=>{r.r(e),r.d(e,{Owlv2ImageProcessor:()=>a});var n=r("./src/models/owlvit/image_processing_owlvit.js");class a extends n.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(t,e,r)=>{r.r(e),r.d(e,{OwlViTFeatureExtractor:()=>h,OwlViTImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_object_detection(...f){return(0,n.post_process_object_detection)(...f)}}class h extends a{}},"./src/models/owlvit/processing_owlvit.js":(t,e,r)=>{r.r(e),r.d(e,{OwlViTProcessor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");class x extends n.Processor{}$e(x,"tokenizer_class",h.AutoTokenizer),$e(x,"image_processor_class",a.AutoImageProcessor)},"./src/models/paligemma/processing_paligemma.js":(t,e,r)=>{r.r(e),r.d(e,{PaliGemmaProcessor:()=>s});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");const x="<image>";function f(d,m,o,l,u){return`${l.repeat(o*u)}${m}${d}
`}class s extends n.Processor{async _call(m,o=null,l={}){o||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),o=""),Array.isArray(m)||(m=[m]),Array.isArray(o)||(o=[o]);const u=this.tokenizer.bos_token,p=this.image_processor.config.image_seq_length;let w;o.some(y=>y.includes(x))?w=o.map(y=>{const T=y.replaceAll(x,x.repeat(p)),C=T.lastIndexOf(x),P=C===-1?0:C+x.length;return T.slice(0,P)+u+T.slice(P)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),w=o.map(y=>f(y,u,p,x,m.length)));const _=this.tokenizer(w,l);return{...await this.image_processor(m,l),..._}}}$e(s,"tokenizer_class",h.AutoTokenizer),$e(s,"image_processor_class",a.AutoImageProcessor),$e(s,"uses_processor_config",!1)},"./src/models/phi3_v/image_processing_phi3_v.js":(t,e,r)=>{r.r(e),r.d(e,{Phi3VImageProcessor:()=>m});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");const h=336,x=[2,3],{ceil:f,floor:s,sqrt:d}=Math;class m extends n.ImageProcessor{constructor(l){super({...l,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=l.num_crops}calc_num_image_tokens_from_image_size(l,u){const{num_img_tokens:p}=this.config;return s((s(u/h)*s(l/h)+1)*p+1+(s(u/h)+1)*d(p))}get_resize_output_image_size(l,u){const p=this._num_crops,[w,_]=l.size;let v=w/_,y=1;for(;y*Math.ceil(y/v)<=p;)y+=1;y-=1;const T=Math.floor(y*336),C=Math.floor(T/v);return[T,C]}pad_image(l,u,p,w={}){const[_,v]=u,y=h*f(_/h),T=h*f(v/h),C=[1,1,1].map((P,O)=>(P-this.image_mean[O])/this.image_std[O]);return super.pad_image(l,u,{width:T,height:y},{center:!0,constant_values:C,...w})}async _call(l,{num_crops:u=null}={}){if(this._num_crops=u!=null?u:u=this.config.num_crops,u<4||d(u)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(l)||(l=[l]);const p=l.length,w=await Promise.all(l.map(D=>this.preprocess(D))),_=w.map(D=>D.original_size),v=w.map(D=>D.reshaped_input_size),y=[];for(const{pixel_values:D}of w){D.unsqueeze_(0);const[L,W]=D.dims.slice(-2),U=await(0,a.interpolate_4d)(D,{size:[h,h],mode:"bicubic"});if(u>0){const te=[],pe=d(u),ne=s(W/pe),ye=s(L/pe);for(let Me=0;Me<pe;++Me)for(let ke=0;ke<pe;++ke){let ve,K,re,X;Me===pe-1?(K=L-ye,X=L):(K=Me*ye,X=(Me+1)*ye),ke===pe-1?(ve=W-ne,re=W):(ve=ke*ne,re=(ke+1)*ne);const N=[K,ve],ae=[X,re],J=await(0,a.slice)(D,N,ae,x);te.push(J)}const ce=await(0,a.interpolate_4d)((0,a.cat)(te,0),{size:[h,h],mode:"bicubic"});y.push((0,a.cat)([U,ce],0))}else y.push(U)}const T=(0,a.stack)(y,0),C=v.map(D=>D.map(L=>h*f(L/h))),P=new a.Tensor("int64",C.flat(),[p,2]),O=C.map(([D,L])=>this.calc_num_image_tokens_from_image_size(L,D));return{pixel_values:T,original_sizes:_,reshaped_input_sizes:v,image_sizes:P,num_img_tokens:O}}}},"./src/models/phi3_v/processing_phi3_v.js":(t,e,r)=>{r.r(e),r.d(e,{Phi3VProcessor:()=>s});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");r("./src/utils/image.js");const x="<|image|>",f=/<\|image_\d+\|>/g;class s extends n.Processor{async _call(m,o=null,{padding:l=!0,truncation:u=!0,num_crops:p=null}={}){Array.isArray(m)||(m=[m]);let w,_;if(o){_=await this.image_processor(o,{num_crops:p});const{num_img_tokens:v}=_,y=m.map((C,P)=>C.split(f).join(x.repeat(v[P])));w=this.tokenizer(y,{padding:l,truncation:u});const T=this.tokenizer.model.convert_tokens_to_ids([x])[0];w.input_ids.map_(C=>C==T?-C:C)}else w=this.tokenizer(m);return{...w,..._}}}$e(s,"image_processor_class",a.AutoImageProcessor),$e(s,"tokenizer_class",h.AutoTokenizer)},"./src/models/processors.js":(t,e,r)=>{r.r(e),r.d(e,{Florence2Processor:()=>n.Florence2Processor,Gemma3nProcessor:()=>a.Gemma3nProcessor,GroundingDinoProcessor:()=>h.GroundingDinoProcessor,Idefics3Processor:()=>x.Idefics3Processor,JinaCLIPProcessor:()=>s.JinaCLIPProcessor,LlavaProcessor:()=>d.LlavaProcessor,MgpstrProcessor:()=>m.MgpstrProcessor,MoonshineProcessor:()=>o.MoonshineProcessor,OwlViTProcessor:()=>l.OwlViTProcessor,PaliGemmaProcessor:()=>p.PaliGemmaProcessor,Phi3VProcessor:()=>u.Phi3VProcessor,PyAnnoteProcessor:()=>w.PyAnnoteProcessor,Qwen2VLProcessor:()=>_.Qwen2VLProcessor,SamProcessor:()=>v.SamProcessor,SmolVLMProcessor:()=>y.SmolVLMProcessor,SpeechT5Processor:()=>T.SpeechT5Processor,UltravoxProcessor:()=>C.UltravoxProcessor,VLChatProcessor:()=>f.VLChatProcessor,Wav2Vec2Processor:()=>P.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>O.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>D.WhisperProcessor});var n=r("./src/models/florence2/processing_florence2.js"),a=r("./src/models/gemma3n/processing_gemma3n.js"),h=r("./src/models/grounding_dino/processing_grounding_dino.js"),x=r("./src/models/idefics3/processing_idefics3.js"),f=r("./src/models/janus/processing_janus.js"),s=r("./src/models/jina_clip/processing_jina_clip.js"),d=r("./src/models/llava/processing_llava.js"),m=r("./src/models/mgp_str/processing_mgp_str.js"),o=r("./src/models/moonshine/processing_moonshine.js"),l=r("./src/models/owlvit/processing_owlvit.js"),u=r("./src/models/phi3_v/processing_phi3_v.js"),p=r("./src/models/paligemma/processing_paligemma.js"),w=r("./src/models/pyannote/processing_pyannote.js"),_=r("./src/models/qwen2_vl/processing_qwen2_vl.js"),v=r("./src/models/sam/processing_sam.js"),y=r("./src/models/smolvlm/processing_smolvlm.js"),T=r("./src/models/speecht5/processing_speecht5.js"),C=r("./src/models/ultravox/processing_ultravox.js"),P=r("./src/models/wav2vec2/processing_wav2vec2.js"),O=r("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),D=r("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(t,e,r)=>{r.r(e),r.d(e,{PvtImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(t,e,r)=>{r.r(e),r.d(e,{PyAnnoteFeatureExtractor:()=>x});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js"),h=r("./src/utils/maths.js");class x extends n.FeatureExtractor{async _call(s){(0,n.validate_audio_inputs)(s,"PyAnnoteFeatureExtractor"),s instanceof Float64Array&&(s=new Float32Array(s));const d=[1,1,s.length];return{input_values:new a.Tensor("float32",s,d)}}samples_to_frames(s){return(s-this.config.offset)/this.config.step}post_process_speaker_diarization(s,d){const m=d/this.samples_to_frames(d)/this.config.sampling_rate,o=[];for(const l of s.tolist()){const u=[];let p=-1;for(let w=0;w<l.length;++w){const _=(0,h.softmax)(l[w]),[v,y]=(0,h.max)(_),[T,C]=[w,w+1];y!==p?(p=y,u.push({id:y,start:T,end:C,score:v})):(u.at(-1).end=C,u.at(-1).score+=v)}o.push(u.map(({id:w,start:_,end:v,score:y})=>({id:w,start:_*m,end:v*m,confidence:y/(v-_)})))}return o}}},"./src/models/pyannote/processing_pyannote.js":(t,e,r)=>{r.r(e),r.d(e,{PyAnnoteProcessor:()=>h});var n=r("./src/base/processing_utils.js"),a=r("./src/models/pyannote/feature_extraction_pyannote.js");class h extends n.Processor{async _call(f){return await this.feature_extractor(f)}post_process_speaker_diarization(...f){return this.feature_extractor.post_process_speaker_diarization(...f)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}$e(h,"feature_extractor_class",a.PyAnnoteFeatureExtractor)},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(t,e,r)=>{r.r(e),r.d(e,{Qwen2VLImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");class h extends n.ImageProcessor{async _call(f,...s){const{pixel_values:d,original_sizes:m,reshaped_input_sizes:o}=await super._call(f,...s);let l=d;const{temporal_patch_size:u,merge_size:p,patch_size:w}=this.config;l.dims[0]===1&&(l=(0,a.cat)(Array.from({length:u},()=>l),0));const _=l.dims[0]/u,v=l.dims[1],y=Math.floor(l.dims[2]/w),T=Math.floor(l.dims[3]/w),C=l.view(_,u,v,Math.floor(y/p),p,w,Math.floor(T/p),p,w).permute(0,3,6,4,7,2,1,5,8).view(_*y*T,v*u*w*w),P=new a.Tensor("int64",[_,y,T],[1,3]);return{pixel_values:C,image_grid_thw:P,original_sizes:m,reshaped_input_sizes:o}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(t,e,r)=>{r.r(e),r.d(e,{Qwen2VLProcessor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js"),h=r("./src/tokenizers.js");r("./src/utils/image.js");class x extends n.Processor{async _call(s,d=null,...m){Array.isArray(s)||(s=[s]);let o,l;if(d&&(o=await this.image_processor(d),l=o.image_grid_thw),l){let p=this.image_processor.config.merge_size**2,w=0;const _=l.tolist();s=s.map(v=>{for(;v.includes("<|image_pad|>");){const y=Number(_[w++].reduce((T,C)=>T*C,1n));v=v.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(y/p)))}return v.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(s),...o}}}$e(x,"image_processor_class",a.AutoImageProcessor),$e(x,"tokenizer_class",h.AutoTokenizer)},"./src/models/rt_detr/image_processing_rt_detr.js":(t,e,r)=>{r.r(e),r.d(e,{RTDetrImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_object_detection(...x){return(0,n.post_process_object_detection)(...x)}}},"./src/models/sam/image_processing_sam.js":(t,e,r)=>{r.r(e),r.d(e,{SamImageProcessor:()=>x});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/core.js"),h=r("./src/utils/tensor.js");class x extends n.ImageProcessor{reshape_input_points(s,d,m,o=!1){s=structuredClone(s);let l=(0,a.calculateDimensions)(s);if(l.length===3)o||(l=[1,...l]),s=[s];else if(l.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let u=0;u<s.length;++u){let p=d[u],w=m[u],_=[w[0]/p[0],w[1]/p[1]];for(let v=0;v<s[u].length;++v)for(let y=0;y<s[u][v].length;++y)for(let T=0;T<s[u][v][y].length;++T)s[u][v][y][T]*=_[T%2]}return new h.Tensor("float32",Float32Array.from(s.flat(1/0)),l)}add_input_labels(s,d){let m=(0,a.calculateDimensions)(s);if(m.length===2)m=[1,...m],s=[s];else if(m.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(m.some((o,l)=>o!==d.dims[l]))throw Error(`The first ${m.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new h.Tensor("int64",s.flat(1/0).map(BigInt),m)}async _call(s,{input_points:d=null,input_labels:m=null,input_boxes:o=null}={}){const l=await super._call(s);if(d&&(l.input_points=this.reshape_input_points(d,l.original_sizes,l.reshaped_input_sizes)),m){if(!l.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");l.input_labels=this.add_input_labels(m,l.input_points)}return o&&(l.input_boxes=this.reshape_input_points(o,l.original_sizes,l.reshaped_input_sizes,!0)),l}async post_process_masks(s,d,m,{mask_threshold:o=0,binarize:l=!0,pad_size:u=null}={}){const p=[];u=u!=null?u:this.pad_size;const w=[u.height,u.width];for(let _=0;_<d.length;++_){const v=d[_],y=m[_];let T=await(0,h.interpolate_4d)(s[_],{mode:"bilinear",size:w});if(T=T.slice(null,null,[0,y[0]],[0,y[1]]),T=await(0,h.interpolate_4d)(T,{mode:"bilinear",size:v}),l){const C=T.data,P=new Uint8Array(C.length);for(let O=0;O<C.length;++O)C[O]>o&&(P[O]=1);T=new h.Tensor("bool",P,T.dims)}p.push(T)}return p}generate_crop_boxes(s,d,{crop_n_layers:m=0,overlap_ratio:o=512/1500,points_per_crop:l=32,crop_n_points_downscale_factor:u=1}={}){}}},"./src/models/sam/processing_sam.js":(t,e,r)=>{r.r(e),r.d(e,{SamProcessor:()=>h});var n=r("./src/base/processing_utils.js"),a=r("./src/models/auto/image_processing_auto.js");class h extends n.Processor{async _call(...f){return await this.image_processor(...f)}post_process_masks(...f){return this.image_processor.post_process_masks(...f)}reshape_input_points(...f){return this.image_processor.reshape_input_points(...f)}}$e(h,"image_processor_class",a.AutoImageProcessor)},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(t,e,r)=>{r.r(e),r.d(e,{SeamlessM4TFeatureExtractor:()=>x});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js"),h=r("./src/utils/audio.js");class x extends n.FeatureExtractor{constructor(s){super(s);const d=this.config.sampling_rate,m=(0,h.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(d/2),d,null,"kaldi",!0);this.mel_filters=m,this.window=(0,h.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(s,d){return s=s.map(m=>m*32768),(0,h.spectrogram)(s,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:d,transpose:!0})}async _call(s,{padding:d=!0,pad_to_multiple_of:m=2,do_normalize_per_mel_bins:o=!0,return_attention_mask:l=!0}={}){(0,n.validate_audio_inputs)(s,"SeamlessM4TFeatureExtractor");let u=await this._extract_fbank_features(s,this.config.max_length);if(o){const[P,O]=u.dims,D=u.data;for(let L=0;L<O;++L){let W=0;for(let ne=0;ne<P;++ne)W+=D[ne*O+L];const U=W/P;let te=0;for(let ne=0;ne<P;++ne)te+=(D[ne*O+L]-U)**2;te/=P-1;const pe=Math.sqrt(te+1e-7);for(let ne=0;ne<P;++ne){const ye=ne*O+L;D[ye]=(D[ye]-U)/pe}}}let p;if(d){const[P,O]=u.dims,D=u.data,L=P%m;if(L>0){const W=new Float32Array(O*(P+L));W.set(D),W.fill(this.config.padding_value,D.length);const U=P+L;u=new a.Tensor(u.type,W,[U,O]),l&&(p=new a.Tensor("int64",new BigInt64Array(U),[1,U]),p.data.fill(1n,0,P))}}const[w,_]=u.dims,v=this.config.stride;if(w%v!==0)throw new Error(`The number of frames (${w}) must be a multiple of the stride (${v}).`);const T=u.view(1,Math.floor(w/v),_*v),C={input_features:T};if(l){const P=T.dims[1],O=new BigInt64Array(P);if(p){const D=p.data;for(let L=1,W=0;L<w;L+=v,++W)O[W]=D[L]}else O.fill(1n);C.attention_mask=new a.Tensor("int64",O,[1,P])}return C}}},"./src/models/segformer/image_processing_segformer.js":(t,e,r)=>{r.r(e),r.d(e,{SegformerFeatureExtractor:()=>h,SegformerImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_semantic_segmentation(...f){return(0,n.post_process_semantic_segmentation)(...f)}}class h extends a{}},"./src/models/siglip/image_processing_siglip.js":(t,e,r)=>{r.r(e),r.d(e,{SiglipImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(t,e,r)=>{r.r(e),r.d(e,{SmolVLMImageProcessor:()=>n.Idefics3ImageProcessor});var n=r("./src/models/idefics3/image_processing_idefics3.js")},"./src/models/smolvlm/processing_smolvlm.js":(t,e,r)=>{r.r(e),r.d(e,{SmolVLMProcessor:()=>n.Idefics3Processor});var n=r("./src/models/idefics3/processing_idefics3.js")},"./src/models/snac/feature_extraction_snac.js":(t,e,r)=>{r.r(e),r.d(e,{SnacFeatureExtractor:()=>a});var n=r("./src/models/dac/feature_extraction_dac.js");class a extends n.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(t,e,r)=>{r.r(e),r.d(e,{SpeechT5FeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js");class a extends n.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(t,e,r)=>{r.r(e),r.d(e,{SpeechT5Processor:()=>x});var n=r("./src/base/processing_utils.js"),a=r("./src/tokenizers.js"),h=r("./src/models/auto/feature_extraction_auto.js");class x extends n.Processor{async _call(s){return await this.feature_extractor(s)}}$e(x,"tokenizer_class",a.AutoTokenizer),$e(x,"feature_extractor_class",h.AutoFeatureExtractor)},"./src/models/swin2sr/image_processing_swin2sr.js":(t,e,r)=>{r.r(e),r.d(e,{Swin2SRImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{pad_image(x,f,s,d={}){const[m,o,l]=f;return super.pad_image(x,f,{width:o+(s-o%s)%s,height:m+(s-m%s)%s},{mode:"symmetric",center:!1,constant_values:-1,...d})}}},"./src/models/ultravox/processing_ultravox.js":(t,e,r)=>{r.r(e),r.d(e,{UltravoxProcessor:()=>x});var n=r("./src/models/auto/feature_extraction_auto.js"),a=r("./src/tokenizers.js"),h=r("./src/base/processing_utils.js");class x extends h.Processor{async _call(s,d=null,m={}){if(Array.isArray(s))throw new Error("Batched inputs are not supported yet.");let o={};if(d){const u=d.length,{input_features:p}=await this.feature_extractor(d,{...m,max_length:u}),w=Math.round(u/this.config.encoder_ds_factor+1e-4),_=1+Math.ceil(w/this.config.stack_factor);o.audio_token_len=[_],o.audio_values=p;const v=this.config.audio_placeholder;if(!s.includes(v))throw new Error(`The input text does not contain the image token ${v}.`);s=s.replaceAll(v,v.repeat(_))}return{...this.tokenizer(s,{add_special_tokens:!1,...m}),...o}}}$e(x,"tokenizer_class",a.AutoTokenizer),$e(x,"feature_extractor_class",n.AutoFeatureExtractor),$e(x,"uses_processor_config",!0)},"./src/models/vit/image_processing_vit.js":(t,e,r)=>{r.r(e),r.d(e,{ViTFeatureExtractor:()=>h,ViTImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{}class h extends a{}},"./src/models/vitmatte/image_processing_vitmatte.js":(t,e,r)=>{r.r(e),r.d(e,{VitMatteImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),a=r("./src/utils/tensor.js");class h extends n.ImageProcessor{async _call(f,s){Array.isArray(f)||(f=[f]),Array.isArray(s)||(s=[s]);const d=await Promise.all(f.map(l=>this.preprocess(l))),m=await Promise.all(s.map(l=>this.preprocess(l,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,a.stack)(d.map((l,u)=>(0,a.cat)([l.pixel_values,m[u].pixel_values],0)),0),original_sizes:d.map(l=>l.original_size),reshaped_input_sizes:d.map(l=>l.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(t,e,r)=>{r.r(e),r.d(e,{VitPoseImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_pose_estimation(x,f,{threshold:s=null}={}){const d=x.tolist(),[m,o,l,u]=x.dims,p=[];for(let w=0;w<m;++w){const _=d[w],v=f[w],y=[];for(let T=0;T<v.length;++T){const C=v[T],P=[],O=[],D=[],L=C.at(-2)/u,W=C.at(-1)/l;for(let U=0;U<_.length;++U){let[te,pe]=[0,0],ne=0,ye=-1/0;const ce=_[U];for(let ke=0;ke<ce.length;++ke){const ve=ce[ke];for(let K=0;K<ve.length;++K){const re=ve[K];ne+=re,ye=Math.max(ye,re),te+=(K+.5)*re,pe+=ke*re}}if(s!=null&&ye<s)continue;const Me=[L*te/ne,W*pe/ne];P.push(Me),D.push(U),O.push(ye)}y.push({bbox:C,scores:O,labels:D,keypoints:P})}p.push(y)}return p}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2FeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js"),a=r("./src/utils/tensor.js");class h extends n.FeatureExtractor{_zero_mean_unit_var_norm(f){const d=f.reduce((o,l)=>o+l,0)/f.length,m=f.reduce((o,l)=>o+(l-d)**2,0)/f.length;return f.map(o=>(o-d)/Math.sqrt(m+1e-7))}async _call(f){(0,n.validate_audio_inputs)(f,"Wav2Vec2FeatureExtractor"),f instanceof Float64Array&&(f=new Float32Array(f));let s=f;this.config.do_normalize&&(s=this._zero_mean_unit_var_norm(s));const d=[1,s.length];return{input_values:new a.Tensor("float32",s,d),attention_mask:new a.Tensor("int64",new BigInt64Array(s.length).fill(1n),d)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2Processor:()=>x});var n=r("./src/tokenizers.js"),a=r("./src/models/auto/feature_extraction_auto.js"),h=r("./src/base/processing_utils.js");class x extends h.Processor{async _call(s){return await this.feature_extractor(s)}}$e(x,"tokenizer_class",n.AutoTokenizer),$e(x,"feature_extractor_class",a.AutoFeatureExtractor)},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(t,e,r)=>{r.r(e),r.d(e,{Wav2Vec2ProcessorWithLM:()=>x});var n=r("./src/tokenizers.js"),a=r("./src/models/auto/feature_extraction_auto.js"),h=r("./src/base/processing_utils.js");class x extends h.Processor{async _call(s){return await this.feature_extractor(s)}}$e(x,"tokenizer_class",n.AutoTokenizer),$e(x,"feature_extractor_class",a.AutoFeatureExtractor)},"./src/models/wespeaker/feature_extraction_wespeaker.js":(t,e,r)=>{r.r(e),r.d(e,{WeSpeakerFeatureExtractor:()=>h});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var a=r("./src/utils/audio.js");class h extends n.FeatureExtractor{constructor(f){super(f);const s=this.config.sampling_rate,d=(0,a.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(s/2),s,null,"kaldi",!0);this.mel_filters=d,this.window=(0,a.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(f){return f=f.map(s=>s*32768),(0,a.spectrogram)(f,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(f){(0,n.validate_audio_inputs)(f,"WeSpeakerFeatureExtractor");const s=(await this._extract_fbank_features(f)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const d=s.mean(1).data,m=s.data,[o,l,u]=s.dims;for(let p=0;p<o;++p){const w=p*l*u,_=p*u;for(let v=0;v<l;++v){const y=w+v*u;for(let T=0;T<u;++T)m[y+T]-=d[_+T]}}}return{input_features:s}}}},"./src/models/whisper/common_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WHISPER_LANGUAGE_MAPPING:()=>a,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>h,whisper_language_to_code:()=>x});const n=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],a=new Map(n),h=new Map([...n.map(([f,s])=>[s,f]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function x(f){f=f.toLowerCase();let s=h.get(f);if(s===void 0){const d=f.match(/^<\|([a-z]{2})\|>$/);if(d&&(f=d[1]),a.has(f))s=f;else{const o=f.length===2?a.keys():a.values();throw new Error(`Language "${f}" is not supported. Must be one of: ${JSON.stringify(Array.from(o))}`)}}return s}},"./src/models/whisper/feature_extraction_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperFeatureExtractor:()=>x});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var a=r("./src/utils/audio.js"),h=r("./src/utils/maths.js");class x extends n.FeatureExtractor{constructor(s){var d,m;super(s),(m=(d=this.config).mel_filters)!=null||(d.mel_filters=(0,a.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,a.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(s){const d=await(0,a.spectrogram)(s,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(s.length/this.config.hop_length),this.config.nb_max_frames)}),m=d.data,o=(0,h.max)(m)[0];for(let l=0;l<m.length;++l)m[l]=(Math.max(m[l],o-8)+4)/4;return d}async _call(s,{max_length:d=null}={}){(0,n.validate_audio_inputs)(s,"WhisperFeatureExtractor");let m;const o=d!=null?d:this.config.n_samples;return s.length>o?(s.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),m=s.slice(0,o)):(m=new Float32Array(o),m.set(s)),{input_features:(await this._extract_fbank_features(m)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperGenerationConfig:()=>a});var n=r("./src/generation/configuration_utils.js");class a extends n.GenerationConfig{constructor(){super(...arguments);$e(this,"return_timestamps",null);$e(this,"return_token_timestamps",null);$e(this,"num_frames",null);$e(this,"alignment_heads",null);$e(this,"task",null);$e(this,"language",null);$e(this,"no_timestamps_token_id",null);$e(this,"prompt_ids",null);$e(this,"is_multilingual",null);$e(this,"lang_to_id",null);$e(this,"task_to_id",null);$e(this,"max_initial_timestamp_index",1)}}},"./src/models/whisper/processing_whisper.js":(t,e,r)=>{r.r(e),r.d(e,{WhisperProcessor:()=>x});var n=r("./src/models/auto/feature_extraction_auto.js"),a=r("./src/tokenizers.js"),h=r("./src/base/processing_utils.js");class x extends h.Processor{async _call(s){return await this.feature_extractor(s)}}$e(x,"tokenizer_class",a.AutoTokenizer),$e(x,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/yolos/image_processing_yolos.js":(t,e,r)=>{r.r(e),r.d(e,{YolosFeatureExtractor:()=>h,YolosImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js");class a extends n.ImageProcessor{post_process_object_detection(...f){return(0,n.post_process_object_detection)(...f)}}class h extends a{}},"./src/ops/registry.js":(t,e,r)=>{r.r(e),r.d(e,{TensorOpRegistry:()=>s});var n=r("./src/backends/onnx.js"),a=r("./src/utils/tensor.js"),h=r("./src/env.js");const x=h.apis.IS_BROWSER_ENV||h.apis.IS_WEBWORKER_ENV,f=async(d,m,o)=>{const l=await(0,n.createInferenceSession)(new Uint8Array(d),m);let u=Promise.resolve();return async p=>{const w=(0,n.isONNXProxy)(),_=Object.fromEntries(Object.entries(p).map(([y,T])=>[y,(w?T.clone():T).ort_tensor])),v=await(u=x?u.then(()=>l.run(_)):l.run(_));return Array.isArray(o)?o.map(y=>new a.Tensor(v[y])):new a.Tensor(v[o])}};class s{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=f([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=f([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=f([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=f([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=f([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=f([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=f([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=f([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}$e(s,"session_options",{})},"./src/pipelines.js":(t,e,r)=>{r.r(e),r.d(e,{AudioClassificationPipeline:()=>pe,AutomaticSpeechRecognitionPipeline:()=>ye,BackgroundRemovalPipeline:()=>ve,DepthEstimationPipeline:()=>Y,DocumentQuestionAnsweringPipeline:()=>N,FeatureExtractionPipeline:()=>U,FillMaskPipeline:()=>T,ImageClassificationPipeline:()=>Me,ImageFeatureExtractionPipeline:()=>te,ImageSegmentationPipeline:()=>ke,ImageToImagePipeline:()=>J,ImageToTextPipeline:()=>ce,ObjectDetectionPipeline:()=>re,Pipeline:()=>w,QuestionAnsweringPipeline:()=>y,SummarizationPipeline:()=>P,Text2TextGenerationPipeline:()=>C,TextClassificationPipeline:()=>_,TextGenerationPipeline:()=>L,TextToAudioPipeline:()=>ae,TokenClassificationPipeline:()=>v,TranslationPipeline:()=>O,ZeroShotAudioClassificationPipeline:()=>ne,ZeroShotClassificationPipeline:()=>W,ZeroShotImageClassificationPipeline:()=>K,ZeroShotObjectDetectionPipeline:()=>X,pipeline:()=>Ue});var n=r("./src/tokenizers.js"),a=r("./src/models.js"),h=r("./src/models/auto/processing_auto.js");r("./src/base/processing_utils.js");var x=r("./src/utils/generic.js"),f=r("./src/utils/core.js"),s=r("./src/utils/maths.js"),d=r("./src/utils/audio.js"),m=r("./src/utils/tensor.js"),o=r("./src/utils/image.js");async function l(Ie){return Array.isArray(Ie)||(Ie=[Ie]),await Promise.all(Ie.map(he=>o.RawImage.read(he)))}async function u(Ie,he){return Array.isArray(Ie)||(Ie=[Ie]),await Promise.all(Ie.map(Fe=>typeof Fe=="string"||Fe instanceof URL?(0,d.read_audio)(Fe,he):Fe instanceof Float64Array?new Float32Array(Fe):Fe))}function p(Ie,he){he&&(Ie=Ie.map(Be=>Be|0));const[Fe,ee,we,Re]=Ie;return{xmin:Fe,ymin:ee,xmax:we,ymax:Re}}class w extends x.Callable{constructor({task:he,model:Fe,tokenizer:ee=null,processor:we=null}){super(),this.task=he,this.model=Fe,this.tokenizer=ee,this.processor=we}async dispose(){await this.model.dispose()}}class _ extends w{constructor(he){super(he)}async _call(he,{top_k:Fe=1}={}){const ee=this.tokenizer(he,{padding:!0,truncation:!0}),we=await this.model(ee),Re=this.model.config.problem_type==="multi_label_classification"?Ne=>Ne.sigmoid():Ne=>new m.Tensor("float32",(0,s.softmax)(Ne.data),Ne.dims),Be=this.model.config.id2label,Se=[];for(const Ne of we.logits){const ze=Re(Ne),rt=await(0,m.topk)(ze,Fe),nt=rt[0].tolist(),qe=rt[1].tolist().map((gt,ct)=>({label:Be?Be[gt]:`LABEL_${gt}`,score:nt[ct]}));Fe===1?Se.push(...qe):Se.push(qe)}return Array.isArray(he)||Fe===1?Se:Se[0]}}class v extends w{constructor(he){super(he)}async _call(he,{ignore_labels:Fe=["O"]}={}){const ee=Array.isArray(he),we=this.tokenizer(ee?he:[he],{padding:!0,truncation:!0}),Be=(await this.model(we)).logits,Se=this.model.config.id2label,Ne=[];for(let ze=0;ze<Be.dims[0];++ze){const rt=we.input_ids[ze],nt=Be[ze],Ge=[];for(let qe=0;qe<nt.dims[0];++qe){const gt=nt[qe],ct=(0,s.max)(gt.data)[1],wt=Se?Se[ct]:`LABEL_${ct}`;if(Fe.includes(wt))continue;const bt=this.tokenizer.decode([rt[qe].item()],{skip_special_tokens:!0});if(bt==="")continue;const Ct=(0,s.softmax)(gt.data);Ge.push({entity:wt,score:Ct[ct],index:qe,word:bt})}Ne.push(Ge)}return ee?Ne:Ne[0]}}class y extends w{constructor(he){super(he)}async _call(he,Fe,{top_k:ee=1}={}){const we=this.tokenizer(he,{text_pair:Fe,padding:!0,truncation:!0}),{start_logits:Re,end_logits:Be}=await this.model(we),Se=we.input_ids.tolist(),Ne=we.attention_mask.tolist(),ze=this.tokenizer.all_special_ids,rt=[];for(let nt=0;nt<Re.dims[0];++nt){const Ge=Se[nt],qe=Ge.findIndex(It=>It==this.tokenizer.sep_token_id);Ne[nt].map((It,jt)=>It==1&&(jt===0||jt>qe&&ze.findIndex(Fr=>Fr==Ge[jt])===-1));const gt=Re[nt].tolist(),ct=Be[nt].tolist();for(let It=1;It<gt.length;++It)(Ne[nt]==0||It<=qe||ze.findIndex(jt=>jt==Ge[It])!==-1)&&(gt[It]=-1/0,ct[It]=-1/0);const wt=(0,s.softmax)(gt).map((It,jt)=>[It,jt]),bt=(0,s.softmax)(ct).map((It,jt)=>[It,jt]);wt[0][0]=0,bt[0][0]=0;const Ct=(0,f.product)(wt,bt).filter(It=>It[0][1]<=It[1][1]).map(It=>[It[0][1],It[1][1],It[0][0]*It[1][0]]).sort((It,jt)=>jt[2]-It[2]);for(let It=0;It<Math.min(Ct.length,ee);++It){const[jt,Fr,lr]=Ct[It],cr=Ge.slice(jt,Fr+1),gn=this.tokenizer.decode(cr,{skip_special_tokens:!0});rt.push({answer:gn,score:lr})}}return ee===1?rt[0]:rt}}class T extends w{constructor(he){super(he)}async _call(he,{top_k:Fe=5}={}){const ee=this.tokenizer(he,{padding:!0,truncation:!0}),{logits:we}=await this.model(ee),Re=[],Be=ee.input_ids.tolist();for(let Se=0;Se<Be.length;++Se){const Ne=Be[Se],ze=Ne.findIndex(gt=>gt==this.tokenizer.mask_token_id);if(ze===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const rt=we[Se][ze],nt=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(rt.data),rt.dims),Fe),Ge=nt[0].tolist(),qe=nt[1].tolist();Re.push(qe.map((gt,ct)=>{const wt=Ne.slice();return wt[ze]=gt,{score:Ge[ct],token:Number(gt),token_str:this.tokenizer.decode([gt]),sequence:this.tokenizer.decode(wt,{skip_special_tokens:!0})}}))}return Array.isArray(he)?Re:Re[0]}}class C extends w{constructor(Fe){super(Fe);$e(this,"_key","generated_text")}async _call(Fe,ee={}){Array.isArray(Fe)||(Fe=[Fe]),this.model.config.prefix&&(Fe=Fe.map(ze=>this.model.config.prefix+ze));const we=this.model.config.task_specific_params;we&&we[this.task]&&we[this.task].prefix&&(Fe=Fe.map(ze=>we[this.task].prefix+ze));const Re=this.tokenizer,Be={padding:!0,truncation:!0};let Se;this instanceof O&&"_build_translation_inputs"in Re?Se=Re._build_translation_inputs(Fe,Be,ee):Se=Re(Fe,Be);const Ne=await this.model.generate({...Se,...ee});return Re.batch_decode(Ne,{skip_special_tokens:!0}).map(ze=>({[this._key]:ze}))}}class P extends C{constructor(Fe){super(Fe);$e(this,"_key","summary_text")}}class O extends C{constructor(Fe){super(Fe);$e(this,"_key","translation_text")}}function D(Ie){return Array.isArray(Ie)&&Ie.every(he=>"role"in he&&"content"in he)}class L extends w{constructor(he){super(he)}async _call(he,Fe={}){var qe,gt;let ee=!1,we=!1,Re;if(typeof he=="string")Re=he=[he];else if(Array.isArray(he)&&he.every(ct=>typeof ct=="string"))ee=!0,Re=he;else{if(D(he))he=[he];else if(Array.isArray(he)&&he.every(D))ee=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");we=!0,Re=he.map(ct=>this.tokenizer.apply_chat_template(ct,{tokenize:!1,add_generation_prompt:!0}))}const Be=(qe=Fe.add_special_tokens)!=null?qe:!1,Se=we?!1:(gt=Fe.return_full_text)!=null?gt:!0;this.tokenizer.padding_side="left";const Ne=this.tokenizer(Re,{add_special_tokens:Be,padding:!0,truncation:!0}),ze=await this.model.generate({...Ne,...Fe}),rt=this.tokenizer.batch_decode(ze,{skip_special_tokens:!0});let nt;!Se&&Ne.input_ids.dims.at(-1)>0&&(nt=this.tokenizer.batch_decode(Ne.input_ids,{skip_special_tokens:!0}).map(ct=>ct.length));const Ge=Array.from({length:he.length},ct=>[]);for(let ct=0;ct<rt.length;++ct){const wt=Math.floor(ct/ze.dims[0]*he.length);nt&&(rt[ct]=rt[ct].slice(nt[wt])),Ge[wt].push({generated_text:we?[...he[wt],{role:"assistant",content:rt[ct]}]:rt[ct]})}return!ee&&Ge.length===1?Ge[0]:Ge}}class W extends w{constructor(he){var Fe;super(he),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([ee,we])=>[ee.toLowerCase(),we])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=(Fe=this.label2id.contradiction)!=null?Fe:this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(he,Fe,{hypothesis_template:ee="This example is {}.",multi_label:we=!1}={}){const Re=Array.isArray(he);Re||(he=[he]),Array.isArray(Fe)||(Fe=[Fe]);const Be=Fe.map(ze=>ee.replace("{}",ze)),Se=we||Fe.length===1,Ne=[];for(const ze of he){const rt=[];for(const qe of Be){const gt=this.tokenizer(ze,{text_pair:qe,padding:!0,truncation:!0}),ct=await this.model(gt);Se?rt.push([ct.logits.data[this.contradiction_id],ct.logits.data[this.entailment_id]]):rt.push(ct.logits.data[this.entailment_id])}const Ge=(Se?rt.map(qe=>(0,s.softmax)(qe)[1]):(0,s.softmax)(rt)).map((qe,gt)=>[qe,gt]).sort((qe,gt)=>gt[0]-qe[0]);Ne.push({sequence:ze,labels:Ge.map(qe=>Fe[qe[1]]),scores:Ge.map(qe=>qe[0])})}return Re?Ne:Ne[0]}}class U extends w{constructor(he){super(he)}async _call(he,{pooling:Fe="none",normalize:ee=!1,quantize:we=!1,precision:Re="binary"}={}){var ze,rt;const Be=this.tokenizer(he,{padding:!0,truncation:!0}),Se=await this.model(Be);let Ne=(rt=(ze=Se.last_hidden_state)!=null?ze:Se.logits)!=null?rt:Se.token_embeddings;switch(Fe){case"none":break;case"mean":Ne=(0,m.mean_pooling)(Ne,Be.attention_mask);break;case"first_token":case"cls":Ne=Ne.slice(null,0);break;case"last_token":case"eos":Ne=Ne.slice(null,-1);break;default:throw Error(`Pooling method '${Fe}' not supported.`)}return ee&&(Ne=Ne.normalize(2,-1)),we&&(Ne=(0,m.quantize_embeddings)(Ne,Re)),Ne}}class te extends w{constructor(he){super(he)}async _call(he,{pool:Fe=null}={}){var Se,Ne;const ee=await l(he),{pixel_values:we}=await this.processor(ee),Re=await this.model({pixel_values:we});let Be;if(Fe){if(!("pooler_output"in Re))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");Be=Re.pooler_output}else Be=(Ne=(Se=Re.last_hidden_state)!=null?Se:Re.logits)!=null?Ne:Re.image_embeds;return Be}}class pe extends w{constructor(he){super(he)}async _call(he,{top_k:Fe=5}={}){const ee=this.processor.feature_extractor.config.sampling_rate,we=await u(he,ee),Re=this.model.config.id2label,Be=[];for(const Se of we){const Ne=await this.processor(Se),rt=(await this.model(Ne)).logits[0],nt=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(rt.data),rt.dims),Fe),Ge=nt[0].tolist(),gt=nt[1].tolist().map((ct,wt)=>({label:Re?Re[ct]:`LABEL_${ct}`,score:Ge[wt]}));Be.push(gt)}return Array.isArray(he)?Be:Be[0]}}class ne extends w{constructor(he){super(he)}async _call(he,Fe,{hypothesis_template:ee="This is a sound of {}."}={}){const we=!Array.isArray(he);we&&(he=[he]);const Re=Fe.map(rt=>ee.replace("{}",rt)),Be=this.tokenizer(Re,{padding:!0,truncation:!0}),Se=this.processor.feature_extractor.config.sampling_rate,Ne=await u(he,Se),ze=[];for(const rt of Ne){const nt=await this.processor(rt),Ge=await this.model({...Be,...nt}),qe=(0,s.softmax)(Ge.logits_per_audio.data);ze.push([...qe].map((gt,ct)=>({score:gt,label:Fe[ct]})))}return we?ze[0]:ze}}class ye extends w{constructor(he){super(he)}async _call(he,Fe={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(he,Fe);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(he,Fe);case"moonshine":return this._call_moonshine(he,Fe);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(he,Fe){Fe.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),Fe.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const ee=!Array.isArray(he);ee&&(he=[he]);const we=this.processor.feature_extractor.config.sampling_rate,Re=await u(he,we),Be=[];for(const Se of Re){const Ne=await this.processor(Se),rt=(await this.model(Ne)).logits[0],nt=[];for(const qe of rt)nt.push((0,s.max)(qe.data)[1]);const Ge=this.tokenizer.decode(nt);Be.push({text:Ge})}return ee?Be[0]:Be}async _call_whisper(he,Fe){var gt,ct,wt,bt;const ee=(gt=Fe.return_timestamps)!=null?gt:!1,we=(ct=Fe.chunk_length_s)!=null?ct:0,Re=(wt=Fe.force_full_sequences)!=null?wt:!1;let Be=(bt=Fe.stride_length_s)!=null?bt:null;const Se={...Fe};ee==="word"&&(Se.return_token_timestamps=!0,Se.return_timestamps=!1);const Ne=!Array.isArray(he);Ne&&(he=[he]);const ze=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,rt=this.processor.feature_extractor.config.hop_length,nt=this.processor.feature_extractor.config.sampling_rate,Ge=await u(he,nt),qe=[];for(const Ct of Ge){let It=[];if(we>0){if(Be===null)Be=we/6;else if(we<=Be)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const lr=nt*we,cr=nt*Be,gn=lr-2*cr;let Jr=0;for(;;){const Zn=Jr+lr,ai=Ct.subarray(Jr,Zn),vn=await this.processor(ai),Nn=Jr===0,Ji=Zn>=Ct.length;if(It.push({stride:[ai.length,Nn?0:cr,Ji?0:cr],input_features:vn.input_features,is_last:Ji}),Ji)break;Jr+=gn}}else It=[{stride:[Ct.length,0,0],input_features:(await this.processor(Ct)).input_features,is_last:!0}];for(const lr of It){Se.num_frames=Math.floor(lr.stride[0]/rt);const cr=await this.model.generate({inputs:lr.input_features,...Se});ee==="word"?(lr.tokens=cr.sequences.tolist()[0],lr.token_timestamps=cr.token_timestamps.tolist()[0].map(gn=>(0,s.round)(gn,2))):lr.tokens=cr[0].tolist(),lr.stride=lr.stride.map(gn=>gn/nt)}const[jt,Fr]=this.tokenizer._decode_asr(It,{time_precision:ze,return_timestamps:ee,force_full_sequences:Re});qe.push({text:jt,...Fr})}return Ne?qe[0]:qe}async _call_moonshine(he,Fe){const ee=!Array.isArray(he);ee&&(he=[he]);const we=this.processor.feature_extractor.config.sampling_rate,Re=await u(he,we),Be=[];for(const Se of Re){const Ne=await this.processor(Se),ze=Math.floor(Se.length/we)*6,rt=await this.model.generate({max_new_tokens:ze,...Fe,...Ne}),nt=this.processor.batch_decode(rt,{skip_special_tokens:!0})[0];Be.push({text:nt})}return ee?Be[0]:Be}}class ce extends w{constructor(he){super(he)}async _call(he,Fe={}){const ee=Array.isArray(he),we=await l(he),{pixel_values:Re}=await this.processor(we),Be=[];for(const Se of Re){Se.dims=[1,...Se.dims];const Ne=await this.model.generate({inputs:Se,...Fe}),ze=this.tokenizer.batch_decode(Ne,{skip_special_tokens:!0}).map(rt=>({generated_text:rt.trim()}));Be.push(ze)}return ee?Be:Be[0]}}class Me extends w{constructor(he){super(he)}async _call(he,{top_k:Fe=5}={}){const ee=await l(he),{pixel_values:we}=await this.processor(ee),Re=await this.model({pixel_values:we}),Be=this.model.config.id2label,Se=[];for(const Ne of Re.logits){const ze=await(0,m.topk)(new m.Tensor("float32",(0,s.softmax)(Ne.data),Ne.dims),Fe),rt=ze[0].tolist(),Ge=ze[1].tolist().map((qe,gt)=>({label:Be?Be[qe]:`LABEL_${qe}`,score:rt[gt]}));Se.push(Ge)}return Array.isArray(he)?Se:Se[0]}}class ke extends w{constructor(he){super(he),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(he,{threshold:Fe=.5,mask_threshold:ee=.5,overlap_mask_area_threshold:we=.8,label_ids_to_fuse:Re=null,target_sizes:Be=null,subtask:Se=null}={}){if(Array.isArray(he)&&he.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const ze=await l(he),rt=ze.map(Ct=>[Ct.height,Ct.width]),nt=await this.processor(ze),{inputNames:Ge,outputNames:qe}=this.model.sessions.model;if(!Ge.includes("pixel_values")){if(Ge.length!==1)throw Error(`Expected a single input name, but got ${Ge.length} inputs: ${Ge}.`);const Ct=Ge[0];if(Ct in nt)throw Error(`Input name ${Ct} already exists in the inputs.`);nt[Ct]=nt.pixel_values}const gt=await this.model(nt);let ct=null;if(Se!==null)ct=this.subtasks_mapping[Se];else if(this.processor.image_processor){for(const[Ct,It]of Object.entries(this.subtasks_mapping))if(It in this.processor.image_processor){ct=this.processor.image_processor[It].bind(this.processor.image_processor),Se=Ct;break}}const wt=this.model.config.id2label,bt=[];if(Se)if(Se==="panoptic"||Se==="instance"){const Ct=ct(gt,Fe,ee,we,Re,Be!=null?Be:rt)[0],It=Ct.segmentation;for(const jt of Ct.segments_info){const Fr=new Uint8ClampedArray(It.data.length);for(let cr=0;cr<It.data.length;++cr)It.data[cr]===jt.id&&(Fr[cr]=255);const lr=new o.RawImage(Fr,It.dims[1],It.dims[0],1);bt.push({score:jt.score,label:wt[jt.label_id],mask:lr})}}else if(Se==="semantic"){const{segmentation:Ct,labels:It}=ct(gt,Be!=null?Be:rt)[0];for(const jt of It){const Fr=new Uint8ClampedArray(Ct.data.length);for(let cr=0;cr<Ct.data.length;++cr)Ct.data[cr]===jt&&(Fr[cr]=255);const lr=new o.RawImage(Fr,Ct.dims[1],Ct.dims[0],1);bt.push({score:null,label:wt[jt],mask:lr})}}else throw Error(`Subtask ${Se} not supported.`);else{const It=gt[qe[0]];for(let jt=0;jt<rt.length;++jt){const Fr=rt[jt],lr=It[jt];lr.data.some(gn=>gn<-1e-5||gn>1+1e-5)&&lr.sigmoid_();const cr=await o.RawImage.fromTensor(lr.mul_(255).to("uint8")).resize(Fr[1],Fr[0]);bt.push({label:null,score:null,mask:cr})}}return bt}}class ve extends ke{constructor(he){super(he)}async _call(he,Fe={}){if(Array.isArray(he)&&he.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const we=await l(he),Re=await super._call(he,Fe);return we.map((Se,Ne)=>{const ze=Se.clone();return ze.putAlpha(Re[Ne].mask),ze})}}class K extends w{constructor(he){super(he)}async _call(he,Fe,{hypothesis_template:ee="This is a photo of {}"}={}){const we=Array.isArray(he),Re=await l(he),Be=Fe.map(Ge=>ee.replace("{}",Ge)),Se=this.tokenizer(Be,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:Ne}=await this.processor(Re),ze=await this.model({...Se,pixel_values:Ne}),rt=this.model.config.model_type==="siglip"?Ge=>Ge.sigmoid().data:Ge=>(0,s.softmax)(Ge.data),nt=[];for(const Ge of ze.logits_per_image){const gt=[...rt(Ge)].map((ct,wt)=>({score:ct,label:Fe[wt]}));gt.sort((ct,wt)=>wt.score-ct.score),nt.push(gt)}return we?nt:nt[0]}}class re extends w{constructor(he){super(he)}async _call(he,{threshold:Fe=.9,percentage:ee=!1}={}){const we=Array.isArray(he);if(we&&he.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Re=await l(he),Be=ee?null:Re.map(qe=>[qe.height,qe.width]),{pixel_values:Se,pixel_mask:Ne}=await this.processor(Re),ze=await this.model({pixel_values:Se,pixel_mask:Ne}),rt=this.processor.image_processor.post_process_object_detection(ze,Fe,Be),nt=this.model.config.id2label,Ge=rt.map(qe=>qe.boxes.map((gt,ct)=>({score:qe.scores[ct],label:nt[qe.classes[ct]],box:p(gt,!ee)})));return we?Ge:Ge[0]}}class X extends w{constructor(he){super(he)}async _call(he,Fe,{threshold:ee=.1,top_k:we=null,percentage:Re=!1}={}){const Be=Array.isArray(he),Se=await l(he),Ne=this.tokenizer(Fe,{padding:!0,truncation:!0}),ze=await this.processor(Se),rt=[];for(let nt=0;nt<Se.length;++nt){const Ge=Se[nt],qe=Re?null:[[Ge.height,Ge.width]],gt=ze.pixel_values[nt].unsqueeze_(0),ct=await this.model({...Ne,pixel_values:gt});let wt;if("post_process_grounded_object_detection"in this.processor){const bt=this.processor.post_process_grounded_object_detection(ct,Ne.input_ids,{box_threshold:ee,text_threshold:ee,target_sizes:qe})[0];wt=bt.boxes.map((Ct,It)=>({score:bt.scores[It],label:bt.labels[It],box:p(Ct,!Re)}))}else{const bt=this.processor.image_processor.post_process_object_detection(ct,ee,qe,!0)[0];wt=bt.boxes.map((Ct,It)=>({score:bt.scores[It],label:Fe[bt.classes[It]],box:p(Ct,!Re)}))}wt.sort((bt,Ct)=>Ct.score-bt.score),we!==null&&(wt=wt.slice(0,we)),rt.push(wt)}return Be?rt:rt[0]}}class N extends w{constructor(he){super(he)}async _call(he,Fe,ee={}){const we=(await l(he))[0],{pixel_values:Re}=await this.processor(we),Be=`<s_docvqa><s_question>${Fe}</s_question><s_answer>`,Se=this.tokenizer(Be,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,Ne=await this.model.generate({inputs:Re,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Se,...ee}),rt=this.tokenizer.batch_decode(Ne)[0].match(/<s_answer>(.*?)<\/s_answer>/);let nt=null;return rt&&rt.length>=2&&(nt=rt[1].trim()),[{answer:nt}]}}class ae extends w{constructor(Fe){var ee;super(Fe);$e(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=(ee=Fe.vocoder)!=null?ee:null}async _call(Fe,{speaker_embeddings:ee=null}={}){return this.processor?this._call_text_to_spectrogram(Fe,{speaker_embeddings:ee}):this._call_text_to_waveform(Fe)}async _call_text_to_waveform(Fe){const ee=this.tokenizer(Fe,{padding:!0,truncation:!0}),{waveform:we}=await this.model(ee),Re=this.model.config.sampling_rate;return new d.RawAudio(we.data,Re)}async _call_text_to_spectrogram(Fe,{speaker_embeddings:ee}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await a.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"})),(typeof ee=="string"||ee instanceof URL)&&(ee=new Float32Array(await(await fetch(ee)).arrayBuffer())),ee instanceof Float32Array)ee=new m.Tensor("float32",ee,[1,ee.length]);else if(!(ee instanceof m.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:we}=this.tokenizer(Fe,{padding:!0,truncation:!0}),{waveform:Re}=await this.model.generate_speech(we,ee,{vocoder:this.vocoder}),Be=this.processor.feature_extractor.config.sampling_rate;return new d.RawAudio(Re.data,Be)}}class J extends w{constructor(he){super(he)}async _call(he){const Fe=await l(he),ee=await this.processor(Fe),we=await this.model(ee),Re=[];for(const Be of we.reconstruction){const Se=Be.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Re.push(o.RawImage.fromTensor(Se))}return Re.length>1?Re:Re[0]}}class Y extends w{constructor(he){super(he)}async _call(he){const Fe=await l(he),ee=await this.processor(Fe),{predicted_depth:we}=await this.model(ee),Re=[];for(let Be=0;Be<Fe.length;++Be){const Se=we[Be],[Ne,ze]=Se.dims.slice(-2),[rt,nt]=Fe[Be].size,Ge=(await(0,m.interpolate_4d)(Se.view(1,1,Ne,ze),{size:[nt,rt],mode:"bilinear"})).view(nt,rt),qe=Ge.min().item(),gt=Ge.max().item(),ct=Ge.sub(qe).div_(gt-qe).mul_(255).to("uint8").unsqueeze(0),wt=o.RawImage.fromTensor(ct);Re.push({predicted_depth:Ge,depth:wt})}return Re.length>1?Re:Re[0]}}const be=Object.freeze({"text-classification":{tokenizer:n.AutoTokenizer,pipeline:_,model:a.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:n.AutoTokenizer,pipeline:v,model:a.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:n.AutoTokenizer,pipeline:y,model:a.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:n.AutoTokenizer,pipeline:T,model:a.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:n.AutoTokenizer,pipeline:P,model:a.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:n.AutoTokenizer,pipeline:O,model:a.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:n.AutoTokenizer,pipeline:C,model:a.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:n.AutoTokenizer,pipeline:L,model:a.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:n.AutoTokenizer,pipeline:W,model:a.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:pe,model:a.AutoModelForAudioClassification,processor:h.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:n.AutoTokenizer,pipeline:ne,model:a.AutoModel,processor:h.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:n.AutoTokenizer,pipeline:ye,model:[a.AutoModelForSpeechSeq2Seq,a.AutoModelForCTC],processor:h.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:n.AutoTokenizer,pipeline:ae,model:[a.AutoModelForTextToWaveform,a.AutoModelForTextToSpectrogram],processor:[h.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:n.AutoTokenizer,pipeline:ce,model:a.AutoModelForVision2Seq,processor:h.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:Me,model:a.AutoModelForImageClassification,processor:h.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ke,model:[a.AutoModelForImageSegmentation,a.AutoModelForSemanticSegmentation,a.AutoModelForUniversalSegmentation],processor:h.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:ve,model:[a.AutoModelForImageSegmentation,a.AutoModelForSemanticSegmentation,a.AutoModelForUniversalSegmentation],processor:h.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:n.AutoTokenizer,pipeline:K,model:a.AutoModel,processor:h.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:re,model:a.AutoModelForObjectDetection,processor:h.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:n.AutoTokenizer,pipeline:X,model:a.AutoModelForZeroShotObjectDetection,processor:h.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:n.AutoTokenizer,pipeline:N,model:a.AutoModelForDocumentQuestionAnswering,processor:h.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:J,model:a.AutoModelForImageToImage,processor:h.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:Y,model:a.AutoModelForDepthEstimation,processor:h.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:n.AutoTokenizer,pipeline:U,model:a.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:h.AutoProcessor,pipeline:te,model:[a.AutoModelForImageFeatureExtraction,a.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),Ce=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function Ue(Ie,he=null,{progress_callback:Fe=null,config:ee=null,cache_dir:we=null,local_files_only:Re=!1,revision:Be="main",device:Se=null,dtype:Ne=null,subfolder:ze="onnx",use_external_data_format:rt=null,model_file_name:nt=null,session_options:Ge={}}={}){var Ct;Ie=(Ct=Ce[Ie])!=null?Ct:Ie;const qe=be[Ie.split("_",1)[0]];if(!qe)throw Error(`Unsupported pipeline: ${Ie}. Must be one of [${Object.keys(be)}]`);he||(he=qe.default.model,console.log(`No model specified. Using default model: "${he}".`));const gt={progress_callback:Fe,config:ee,cache_dir:we,local_files_only:Re,revision:Be,device:Se,dtype:Ne,subfolder:ze,use_external_data_format:rt,model_file_name:nt,session_options:Ge},ct=new Map([["tokenizer",qe.tokenizer],["model",qe.model],["processor",qe.processor]]),wt=await Ve(ct,he,gt);wt.task=Ie,(0,f.dispatchCallback)(Fe,{status:"ready",task:Ie,model:he});const bt=qe.pipeline;return new bt(wt)}async function Ve(Ie,he,Fe){const ee=Object.create(null),we=[];for(const[Re,Be]of Ie.entries()){if(!Be)continue;let Se;Array.isArray(Be)?Se=new Promise(async(Ne,ze)=>{var nt,Ge;let rt;for(const qe of Be){if(qe===null){Ne(null);return}try{Ne(await qe.from_pretrained(he,Fe));return}catch(gt){if((nt=gt.message)!=null&&nt.includes("Unsupported model type"))rt=gt;else if((Ge=gt.message)!=null&&Ge.includes("Could not locate file"))rt=gt;else{ze(gt);return}}}ze(rt)}):Se=Be.from_pretrained(he,Fe),ee[Re]=Se,we.push(Se)}await Promise.all(we);for(const[Re,Be]of Object.entries(ee))ee[Re]=await Be;return ee}},"./src/tokenizers.js":(t,e,r)=>{r.r(e),r.d(e,{AlbertTokenizer:()=>so,AutoTokenizer:()=>cs,BartTokenizer:()=>qt,BertTokenizer:()=>ko,BlenderbotSmallTokenizer:()=>pn,BlenderbotTokenizer:()=>Ut,BloomTokenizer:()=>hi,CLIPTokenizer:()=>Io,CamembertTokenizer:()=>pt,CodeGenTokenizer:()=>oo,CodeLlamaTokenizer:()=>ir,CohereTokenizer:()=>Fs,ConvBertTokenizer:()=>Le,DebertaTokenizer:()=>H,DebertaV2Tokenizer:()=>Pe,DistilBertTokenizer:()=>ft,ElectraTokenizer:()=>vr,Ernie4_5_Tokenizer:()=>lo,EsmTokenizer:()=>yn,FalconTokenizer:()=>nn,GPT2Tokenizer:()=>Nt,GPTNeoXTokenizer:()=>Nr,GemmaTokenizer:()=>sn,Grok1Tokenizer:()=>ei,HerbertTokenizer:()=>fe,LlamaTokenizer:()=>wr,M2M100Tokenizer:()=>rr,MBart50Tokenizer:()=>Sn,MBartTokenizer:()=>jr,MPNetTokenizer:()=>Gr,MarianTokenizer:()=>Tt,MgpstrTokenizer:()=>st,MobileBertTokenizer:()=>yr,NllbTokenizer:()=>Mi,NougatTokenizer:()=>Vn,PreTrainedTokenizer:()=>dr,Qwen2Tokenizer:()=>pi,RoFormerTokenizer:()=>Xe,RobertaTokenizer:()=>bi,SiglipTokenizer:()=>Un,SpeechT5Tokenizer:()=>xr,SqueezeBertTokenizer:()=>As,T5Tokenizer:()=>or,TokenizerModel:()=>te,VitsTokenizer:()=>ao,Wav2Vec2CTCTokenizer:()=>Ot,WhisperTokenizer:()=>Ds,XLMRobertaTokenizer:()=>Ar,XLMTokenizer:()=>nr,is_chinese_char:()=>T});var n=r("./src/utils/generic.js"),a=r("./src/utils/core.js"),h=r("./src/utils/hub.js"),x=r("./src/utils/maths.js"),f=r("./src/utils/tensor.js"),s=r("./src/utils/data-structures.js"),d=r("./node_modules/@huggingface/jinja/dist/index.js"),m=r("./src/models/whisper/common_whisper.js");async function o(Je,Q){const ue=await Promise.all([(0,h.getModelJSON)(Je,"tokenizer.json",!0,Q),(0,h.getModelJSON)(Je,"tokenizer_config.json",!0,Q)]);return Q.legacy!==null&&(ue[1].legacy=Q.legacy),ue}function l(Je,Q){const ue=[];let De=0;for(const We of Je.matchAll(Q)){const Ye=We[0];De<We.index&&ue.push(Je.slice(De,We.index)),Ye.length>0&&ue.push(Ye),De=We.index+Ye.length}return De<Je.length&&ue.push(Je.slice(De)),ue}function u(Je,Q=!0){if(Je.Regex!==void 0){let ue=Je.Regex.replace(/\\([#&~])/g,"$1");for(const[De,We]of W)ue=ue.replaceAll(De,We);return new RegExp(ue,"gu")}else if(Je.String!==void 0){const ue=(0,a.escapeRegExp)(Je.String);return new RegExp(Q?ue:`(${ue})`,"gu")}else return console.warn("Unknown pattern type:",Je),null}function p(Je){return new Map(Object.entries(Je))}function w(Je){const Q=Je.dims;switch(Q.length){case 1:return Je.tolist();case 2:if(Q[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return Je.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${Q.length}.`)}}function _(Je){return Je.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function v(Je){return Je.replace(/\p{M}/gu,"")}function y(Je){return v(Je.toLowerCase())}function T(Je){return Je>=19968&&Je<=40959||Je>=13312&&Je<=19903||Je>=131072&&Je<=173791||Je>=173824&&Je<=177983||Je>=177984&&Je<=178207||Je>=178208&&Je<=183983||Je>=63744&&Je<=64255||Je>=194560&&Je<=195103}function C(Je,Q,ue){var Ye,at;const De=[];let We=0;for(;We<Je.length;){if(De.push(Je[We]),((Ye=Q.get(Je[We]))!=null?Ye:ue)!==ue){++We;continue}for(;++We<Je.length&&((at=Q.get(Je[We]))!=null?at:ue)===ue;)Q.get(De.at(-1))!==ue&&(De[De.length-1]+=Je[We])}return De}function P(Je){return Je.match(/\S+/g)||[]}const O="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",D=new RegExp(`^[${O}]+$`,"gu"),L=".,!?\u2026\u3002\uFF0C\u3001\u0964\u06D4\u060C",W=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],[` ?[^(\\s|[${L}])]+`,` ?[^\\s${L}]+`]]);class U{constructor(Q){var ue,De,We,Ye,at;this.content=Q.content,this.id=Q.id,this.single_word=(ue=Q.single_word)!=null?ue:!1,this.lstrip=(De=Q.lstrip)!=null?De:!1,this.rstrip=(We=Q.rstrip)!=null?We:!1,this.special=(Ye=Q.special)!=null?Ye:!1,this.normalized=(at=Q.normalized)!=null?at:null}}class te extends n.Callable{constructor(Q){var ue;super(),this.config=Q,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=(ue=this.config.fuse_unk)!=null?ue:!1}static fromConfig(Q,...ue){switch(Q.type){case"WordPiece":return new pe(Q);case"Unigram":return new ne(Q,...ue);case"BPE":return new Me(Q);default:if(Q.vocab)return Array.isArray(Q.vocab)?new ne(Q,...ue):Object.hasOwn(Q,"continuing_subword_prefix")&&Object.hasOwn(Q,"unk_token")?Object.hasOwn(Q,"merges")?new Me(Q):new pe(Q):new ke(Q,...ue);throw new Error(`Unknown TokenizerModel type: ${Q.type}`)}}_call(Q){return Q=this.encode(Q),this.fuse_unk&&(Q=C(Q,this.tokens_to_ids,this.unk_token_id)),Q}encode(Q){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(Q){return Q.map(ue=>{var De;return(De=this.tokens_to_ids.get(ue))!=null?De:this.unk_token_id})}convert_ids_to_tokens(Q){return Q.map(ue=>{var De;return(De=this.vocab[ue])!=null?De:this.unk_token})}}class pe extends te{constructor(Q){var ue;super(Q),this.tokens_to_ids=p(Q.vocab),this.unk_token_id=this.tokens_to_ids.get(Q.unk_token),this.unk_token=Q.unk_token,this.max_input_chars_per_word=(ue=Q.max_input_chars_per_word)!=null?ue:100,this.vocab=new Array(this.tokens_to_ids.size);for(const[De,We]of this.tokens_to_ids)this.vocab[We]=De}encode(Q){const ue=[];for(const De of Q){const We=[...De];if(We.length>this.max_input_chars_per_word){ue.push(this.unk_token);continue}let Ye=!1,at=0;const _t=[];for(;at<We.length;){let Dt=We.length,Et=null;for(;at<Dt;){let zt=We.slice(at,Dt).join("");if(at>0&&(zt=this.config.continuing_subword_prefix+zt),this.tokens_to_ids.has(zt)){Et=zt;break}--Dt}if(Et===null){Ye=!0;break}_t.push(Et),at=Dt}Ye?ue.push(this.unk_token):ue.push(..._t)}return ue}}class ne extends te{constructor(Q,ue){super(Q);const De=Q.vocab.length;this.vocab=new Array(De),this.scores=new Array(De);for(let We=0;We<De;++We)[this.vocab[We],this.scores[We]]=Q.vocab[We];this.unk_token_id=Q.unk_id,this.unk_token=this.vocab[Q.unk_id],this.tokens_to_ids=new Map(this.vocab.map((We,Ye)=>[We,Ye])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=ue.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,x.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new s.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(Q){const ue=Q.chars,De=1;let We=0;for(;We<ue.length;){let Ye=!1;const at=ue.slice(We).join(""),_t=this.trie.commonPrefixSearch(at);for(const Dt of _t){const Et=this.tokens_to_ids.get(Dt),zt=this.scores[Et],pr=(0,a.len)(Dt);Q.insert(We,pr,zt,Et),!Ye&&pr===De&&(Ye=!0)}Ye||Q.insert(We,De,this.unk_score,this.unk_token_id),We+=De}}tokenize(Q){const ue=new s.TokenLattice(Q,this.bos_token_id,this.eos_token_id);return this.populateNodes(ue),ue.tokens()}encode(Q){const ue=[];for(const De of Q){const We=this.tokenize(De);ue.push(...We)}return ue}}const ye=(()=>{const Je=[...Array.from({length:"~".charCodeAt(0)-"!".charCodeAt(0)+1},(We,Ye)=>Ye+"!".charCodeAt(0)),...Array.from({length:"\xAC".charCodeAt(0)-"\xA1".charCodeAt(0)+1},(We,Ye)=>Ye+"\xA1".charCodeAt(0)),...Array.from({length:"\xFF".charCodeAt(0)-"\xAE".charCodeAt(0)+1},(We,Ye)=>Ye+"\xAE".charCodeAt(0))],Q=Je.slice();let ue=0;for(let We=0;We<256;++We)Je.includes(We)||(Je.push(We),Q.push(256+ue),ue+=1);const De=Q.map(We=>String.fromCharCode(We));return Object.fromEntries(Je.map((We,Ye)=>[We,De[Ye]]))})(),ce=(0,a.reverseDictionary)(ye);class Me extends te{constructor(Q){var De,We,Ye;super(Q),this.tokens_to_ids=p(Q.vocab),this.unk_token_id=this.tokens_to_ids.get(Q.unk_token),this.unk_token=Q.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[at,_t]of this.tokens_to_ids)this.vocab[_t]=at;const ue=Array.isArray(Q.merges[0]);this.merges=ue?Q.merges:Q.merges.map(at=>at.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((at,_t)=>[JSON.stringify(at),_t])),this.end_of_word_suffix=Q.end_of_word_suffix,this.continuing_subword_suffix=(De=Q.continuing_subword_suffix)!=null?De:null,this.byte_fallback=(We=this.config.byte_fallback)!=null?We:!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=(Ye=this.config.ignore_merges)!=null?Ye:!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new s.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(Q){if(Q.length===0)return[];const ue=this.cache.get(Q);if(ue!==void 0)return ue;const De=Array.from(Q);this.end_of_word_suffix&&(De[De.length-1]+=this.end_of_word_suffix);let We=[];if(De.length>1){const Ye=new s.PriorityQueue((Dt,Et)=>Dt.score<Et.score);let at={token:De[0],bias:0,prev:null,next:null},_t=at;for(let Dt=1;Dt<De.length;++Dt){const Et={bias:Dt/De.length,token:De[Dt],prev:_t,next:null};_t.next=Et,this._add_node(Ye,_t),_t=Et}for(;!Ye.isEmpty();){const Dt=Ye.pop();if(Dt.deleted||!Dt.next||Dt.next.deleted)continue;if(Dt.deleted=!0,Dt.next.deleted=!0,Dt.prev){const zt={...Dt.prev};Dt.prev.deleted=!0,Dt.prev=zt,zt.prev?zt.prev.next=zt:at=zt}const Et={token:Dt.token+Dt.next.token,bias:Dt.bias,prev:Dt.prev,next:Dt.next.next};Et.prev?(Et.prev.next=Et,this._add_node(Ye,Et.prev)):at=Et,Et.next&&(Et.next.prev=Et,this._add_node(Ye,Et))}for(let Dt=at;Dt!==null;Dt=Dt.next)We.push(Dt.token)}else We=De;if(this.continuing_subword_suffix)for(let Ye=0;Ye<We.length-1;++Ye)We[Ye]+=this.continuing_subword_suffix;return Q.length<this.max_length_to_cache&&this.cache.put(Q,We),We}_add_node(Q,ue){const De=this.bpe_ranks.get(JSON.stringify([ue.token,ue.next.token]));De!==void 0&&(ue.score=De+ue.bias,Q.push(ue))}encode(Q){const ue=[];for(const De of Q){if(this.ignore_merges&&this.tokens_to_ids.has(De)){ue.push(De);continue}const We=this.bpe(De);for(const Ye of We)if(this.tokens_to_ids.has(Ye))ue.push(Ye);else if(this.byte_fallback){const at=Array.from(this.text_encoder.encode(Ye)).map(_t=>`<0x${_t.toString(16).toUpperCase().padStart(2,"0")}>`);at.every(_t=>this.tokens_to_ids.has(_t))?ue.push(...at):ue.push(this.unk_token)}else ue.push(this.unk_token)}return ue}}class ke extends te{constructor(Q,ue){super(Q),this.tokens_to_ids=p(ue.target_lang?Q.vocab[ue.target_lang]:Q.vocab),this.bos_token=ue.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=ue.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=ue.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=ue.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[De,We]of this.tokens_to_ids)this.vocab[We]=De}encode(Q){return Q}}class ve extends n.Callable{constructor(Q){super(),this.config=Q}static fromConfig(Q){if(Q===null)return null;switch(Q.type){case"BertNormalizer":return new Ie(Q);case"Precompiled":return new Zn(Q);case"Sequence":return new Ve(Q);case"Replace":return new K(Q);case"NFC":return new X(Q);case"NFD":return new N(Q);case"NFKC":return new ae(Q);case"NFKD":return new J(Q);case"Strip":return new Y(Q);case"StripAccents":return new be(Q);case"Lowercase":return new Ce(Q);case"Prepend":return new Ue(Q);default:throw new Error(`Unknown Normalizer type: ${Q.type}`)}}normalize(Q){throw Error("normalize should be implemented in subclass.")}_call(Q){return this.normalize(Q)}}class K extends ve{normalize(Q){const ue=u(this.config.pattern);return ue===null?Q:Q.replaceAll(ue,this.config.content)}}class re extends ve{constructor(){super(...arguments);$e(this,"form")}normalize(ue){return ue=ue.normalize(this.form),ue}}class X extends re{constructor(){super(...arguments);$e(this,"form","NFC")}}class N extends re{constructor(){super(...arguments);$e(this,"form","NFD")}}class ae extends re{constructor(){super(...arguments);$e(this,"form","NFKC")}}class J extends re{constructor(){super(...arguments);$e(this,"form","NFKD")}}class Y extends ve{normalize(Q){return this.config.strip_left&&this.config.strip_right?Q=Q.trim():(this.config.strip_left&&(Q=Q.trimStart()),this.config.strip_right&&(Q=Q.trimEnd())),Q}}class be extends ve{normalize(Q){return Q=v(Q),Q}}class Ce extends ve{normalize(Q){return Q=Q.toLowerCase(),Q}}class Ue extends ve{normalize(Q){return Q=this.config.prepend+Q,Q}}class Ve extends ve{constructor(Q){super(Q),this.normalizers=Q.normalizers.map(ue=>ve.fromConfig(ue))}normalize(Q){return this.normalizers.reduce((ue,De)=>De.normalize(ue),Q)}}class Ie extends ve{_tokenize_chinese_chars(Q){const ue=[];for(let De=0;De<Q.length;++De){const We=Q[De],Ye=We.charCodeAt(0);T(Ye)?(ue.push(" "),ue.push(We),ue.push(" ")):ue.push(We)}return ue.join("")}stripAccents(Q){return Q.normalize("NFD").replace(/\p{Mn}/gu,"")}_is_control(Q){switch(Q){case"	":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(Q)}}_clean_text(Q){const ue=[];for(const De of Q){const We=De.charCodeAt(0);We===0||We===65533||this._is_control(De)||(/^\s$/.test(De)?ue.push(" "):ue.push(De))}return ue.join("")}normalize(Q){return this.config.clean_text&&(Q=this._clean_text(Q)),this.config.handle_chinese_chars&&(Q=this._tokenize_chinese_chars(Q)),this.config.lowercase?(Q=Q.toLowerCase(),this.config.strip_accents!==!1&&(Q=this.stripAccents(Q))):this.config.strip_accents&&(Q=this.stripAccents(Q)),Q}}class he extends n.Callable{static fromConfig(Q){if(Q===null)return null;switch(Q.type){case"BertPreTokenizer":return new Fe(Q);case"Sequence":return new ai(Q);case"Whitespace":return new vn(Q);case"WhitespaceSplit":return new Nn(Q);case"Metaspace":return new gn(Q);case"ByteLevel":return new ee(Q);case"Split":return new we(Q);case"Punctuation":return new Re(Q);case"Digits":return new Be(Q);case"Replace":return new Ji(Q);default:throw new Error(`Unknown PreTokenizer type: ${Q.type}`)}}pre_tokenize_text(Q,ue){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(Q,ue){return(Array.isArray(Q)?Q.map(De=>this.pre_tokenize_text(De,ue)):this.pre_tokenize_text(Q,ue)).flat()}_call(Q,ue){return this.pre_tokenize(Q,ue)}}class Fe extends he{constructor(Q){super(),this.pattern=new RegExp(`[^\\s${O}]+|[${O}]`,"gu")}pre_tokenize_text(Q,ue){return Q.trim().match(this.pattern)||[]}}class ee extends he{constructor(Q){var ue;super(),this.config=Q,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=(ue=this.config.use_regex)!=null?ue:!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=ye,this.text_encoder=new TextEncoder}pre_tokenize_text(Q,ue){return this.add_prefix_space&&!Q.startsWith(" ")&&(Q=" "+Q),(this.use_regex?Q.match(this.pattern)||[]:[Q]).map(We=>Array.from(this.text_encoder.encode(We),Ye=>this.byte_encoder[Ye]).join(""))}}class we extends he{constructor(Q){super(),this.config=Q,this.pattern=u(this.config.pattern,this.config.invert)}pre_tokenize_text(Q,ue){var De;return this.pattern===null?[]:this.config.invert?Q.match(this.pattern)||[]:((De=this.config.behavior)==null?void 0:De.toLowerCase())==="removed"?Q.split(this.pattern).filter(We=>We):l(Q,this.pattern)}}class Re extends he{constructor(Q){super(),this.config=Q,this.pattern=new RegExp(`[^${O}]+|[${O}]+`,"gu")}pre_tokenize_text(Q,ue){return Q.match(this.pattern)||[]}}class Be extends he{constructor(Q){super(),this.config=Q;const ue=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(ue,"gu")}pre_tokenize_text(Q,ue){return Q.match(this.pattern)||[]}}class Se extends n.Callable{constructor(Q){super(),this.config=Q}static fromConfig(Q){if(Q===null)return null;switch(Q.type){case"TemplateProcessing":return new rt(Q);case"ByteLevel":return new nt(Q);case"RobertaProcessing":return new ze(Q);case"BertProcessing":return new Ne(Q);case"Sequence":return new Ge(Q);default:throw new Error(`Unknown PostProcessor type: ${Q.type}`)}}post_process(Q,...ue){throw Error("post_process should be implemented in subclass.")}_call(Q,...ue){return this.post_process(Q,...ue)}}class Ne extends Se{constructor(Q){super(Q),this.cls=Q.cls[0],this.sep=Q.sep[0]}post_process(Q,ue=null,{add_special_tokens:De=!0}={}){De&&(Q=(0,a.mergeArrays)([this.cls],Q,[this.sep]));let We=new Array(Q.length).fill(0);if(ue!==null){const Ye=De&&this instanceof ze?[this.sep]:[],at=De?[this.sep]:[];Q=(0,a.mergeArrays)(Q,Ye,ue,at),We=(0,a.mergeArrays)(We,new Array(ue.length+Ye.length+at.length).fill(1))}return{tokens:Q,token_type_ids:We}}}class ze extends Ne{}class rt extends Se{constructor(Q){super(Q),this.single=Q.single,this.pair=Q.pair}post_process(Q,ue=null,{add_special_tokens:De=!0}={}){const We=ue===null?this.single:this.pair;let Ye=[],at=[];for(const _t of We)"SpecialToken"in _t?De&&(Ye.push(_t.SpecialToken.id),at.push(_t.SpecialToken.type_id)):"Sequence"in _t&&(_t.Sequence.id==="A"?(Ye=(0,a.mergeArrays)(Ye,Q),at=(0,a.mergeArrays)(at,new Array(Q.length).fill(_t.Sequence.type_id))):_t.Sequence.id==="B"&&(Ye=(0,a.mergeArrays)(Ye,ue),at=(0,a.mergeArrays)(at,new Array(ue.length).fill(_t.Sequence.type_id))));return{tokens:Ye,token_type_ids:at}}}class nt extends Se{post_process(Q,ue=null){return ue&&(Q=(0,a.mergeArrays)(Q,ue)),{tokens:Q}}}class Ge extends Se{constructor(Q){super(Q),this.processors=Q.processors.map(ue=>Se.fromConfig(ue))}post_process(Q,ue=null,De={}){let We;for(const Ye of this.processors)if(Ye instanceof nt)Q=Ye.post_process(Q).tokens,ue&&(ue=Ye.post_process(ue).tokens);else{const at=Ye.post_process(Q,ue,De);Q=at.tokens,We=at.token_type_ids}return{tokens:Q,token_type_ids:We}}}class qe extends n.Callable{constructor(Q){super(),this.config=Q,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=Q.trim_offsets}static fromConfig(Q){if(Q===null)return null;switch(Q.type){case"WordPiece":return new Ct(Q);case"Metaspace":return new Jr(Q);case"ByteLevel":return new It(Q);case"Replace":return new gt(Q);case"ByteFallback":return new ct(Q);case"Fuse":return new wt(Q);case"Strip":return new bt(Q);case"Sequence":return new Fr(Q);case"CTC":return new jt(Q);case"BPEDecoder":return new lr(Q);default:throw new Error(`Unknown Decoder type: ${Q.type}`)}}_call(Q){return this.decode(Q)}decode(Q){return this.decode_chain(Q).join("")}decode_chain(Q){throw Error("`decode_chain` should be implemented in subclass.")}}class gt extends qe{decode_chain(Q){const ue=u(this.config.pattern);return ue===null?Q:Q.map(De=>De.replaceAll(ue,this.config.content))}}class ct extends qe{constructor(Q){super(Q),this.text_decoder=new TextDecoder}decode_chain(Q){const ue=[];let De=[];for(const We of Q){let Ye=null;if(We.length===6&&We.startsWith("<0x")&&We.endsWith(">")){const at=parseInt(We.slice(3,5),16);isNaN(at)||(Ye=at)}if(Ye!==null)De.push(Ye);else{if(De.length>0){const at=this.text_decoder.decode(Uint8Array.from(De));ue.push(at),De=[]}ue.push(We)}}if(De.length>0){const We=this.text_decoder.decode(Uint8Array.from(De));ue.push(We),De=[]}return ue}}class wt extends qe{decode_chain(Q){return[Q.join("")]}}class bt extends qe{constructor(Q){super(Q),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(Q){return Q.map(ue=>{let De=0;for(let Ye=0;Ye<this.start&&ue[Ye]===this.content;++Ye){De=Ye+1;continue}let We=ue.length;for(let Ye=0;Ye<this.stop;++Ye){const at=ue.length-Ye-1;if(ue[at]===this.content){We=at;continue}else break}return ue.slice(De,We)})}}class Ct extends qe{constructor(Q){super(Q),this.cleanup=Q.cleanup}decode_chain(Q){return Q.map((ue,De)=>(De!==0&&(ue.startsWith(this.config.prefix)?ue=ue.replace(this.config.prefix,""):ue=" "+ue),this.cleanup&&(ue=_(ue)),ue))}}class It extends qe{constructor(Q){super(Q),this.byte_decoder=ce,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(Q){const ue=Q.join(""),De=new Uint8Array([...ue].map(Ye=>this.byte_decoder[Ye]));return this.text_decoder.decode(De)}decode_chain(Q){const ue=[];let De=[];for(const We of Q)this.added_tokens.find(Ye=>Ye.content===We)!==void 0?(De.length>0&&(ue.push(this.convert_tokens_to_string(De)),De=[]),ue.push(We)):De.push(We);return De.length>0&&ue.push(this.convert_tokens_to_string(De)),ue}}class jt extends qe{constructor(Q){super(Q),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(Q){if(Q.length===0)return"";const ue=[Q[0]];for(let Ye=1;Ye<Q.length;++Ye)Q[Ye]!==ue.at(-1)&&ue.push(Q[Ye]);let We=ue.filter(Ye=>Ye!==this.pad_token).join("");return this.cleanup&&(We=_(We).replaceAll(this.word_delimiter_token," ").trim()),We}decode_chain(Q){return[this.convert_tokens_to_string(Q)]}}class Fr extends qe{constructor(Q){super(Q),this.decoders=Q.decoders.map(ue=>qe.fromConfig(ue))}decode_chain(Q){return this.decoders.reduce((ue,De)=>De.decode_chain(ue),Q)}}class lr extends qe{constructor(Q){super(Q),this.suffix=this.config.suffix}decode_chain(Q){return Q.map((ue,De)=>ue.replaceAll(this.suffix,De===Q.length-1?"":" "))}}class cr extends qe{decode_chain(Q){let ue="";for(let De=1;De<Q.length;De+=2)ue+=Q[De];return[ue]}}class gn extends he{constructor(Q){var ue;super(),this.addPrefixSpace=Q.add_prefix_space,this.replacement=Q.replacement,this.strRep=Q.str_rep||this.replacement,this.prepend_scheme=(ue=Q.prepend_scheme)!=null?ue:"always"}pre_tokenize_text(Q,{section_index:ue=void 0}={}){let De=Q.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!De.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&ue===0)&&(De=this.strRep+De),[De]}}class Jr extends qe{constructor(Q){super(Q),this.addPrefixSpace=Q.add_prefix_space,this.replacement=Q.replacement}decode_chain(Q){const ue=[];for(let De=0;De<Q.length;++De){let We=Q[De].replaceAll(this.replacement," ");this.addPrefixSpace&&De==0&&We.startsWith(" ")&&(We=We.substring(1)),ue.push(We)}return ue}}class Zn extends ve{constructor(Q){super(Q),this.charsmap=Q.precompiled_charsmap}normalize(Q){return Q=Q.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),Q=Q.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),Q.includes("\uFF5E")?Q=Q.split("\uFF5E").map(De=>De.normalize("NFKC")).join("\uFF5E"):Q=Q.normalize("NFKC"),Q}}class ai extends he{constructor(Q){super(),this.tokenizers=Q.pretokenizers.map(ue=>he.fromConfig(ue))}pre_tokenize_text(Q,ue){return this.tokenizers.reduce((De,We)=>We.pre_tokenize(De,ue),[Q])}}class vn extends he{constructor(Q){super()}pre_tokenize_text(Q,ue){return Q.match(/\w+|[^\w\s]+/g)||[]}}class Nn extends he{constructor(Q){super()}pre_tokenize_text(Q,ue){return P(Q)}}class Ji extends he{constructor(Q){super(),this.config=Q,this.pattern=u(this.config.pattern),this.content=this.config.content}pre_tokenize_text(Q,ue){return this.pattern===null?[Q]:[Q.replaceAll(this.pattern,this.config.content)]}}const Zi=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function io(Je,Q,ue,De){for(const We of Object.keys(Je)){const Ye=Q-Je[We].length,at=ue(We),_t=new Array(Ye).fill(at);Je[We]=De==="right"?(0,a.mergeArrays)(Je[We],_t):(0,a.mergeArrays)(_t,Je[We])}}function oa(Je,Q){for(const ue of Object.keys(Je))Je[ue].length=Q}class dr extends n.Callable{constructor(ue,De){var We,Ye,at,_t;super();$e(this,"return_token_type_ids",!1);$e(this,"padding_side","right");this.config=De,this.normalizer=ve.fromConfig(ue.normalizer),this.pre_tokenizer=he.fromConfig(ue.pre_tokenizer),this.model=te.fromConfig(ue.model,De),this.post_processor=Se.fromConfig(ue.post_processor),this.decoder=qe.fromConfig(ue.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const Dt of ue.added_tokens){const Et=new U(Dt);this.added_tokens.push(Et),this.model.tokens_to_ids.set(Et.content,Et.id),this.model.vocab[Et.id]=Et.content,Et.special&&(this.special_tokens.push(Et.content),this.all_special_ids.push(Et.id))}if(this.additional_special_tokens=(We=De.additional_special_tokens)!=null?We:[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new s.DictionarySplitter(this.added_tokens.map(Dt=>Dt.content)),this.added_tokens_map=new Map(this.added_tokens.map(Dt=>[Dt.content,Dt])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=De.model_max_length,this.remove_space=De.remove_space,this.clean_up_tokenization_spaces=(Ye=De.clean_up_tokenization_spaces)!=null?Ye:!0,this.do_lowercase_and_remove_accent=(at=De.do_lowercase_and_remove_accent)!=null?at:!1,De.padding_side&&(this.padding_side=De.padding_side),this.legacy=!1,this.chat_template=(_t=De.chat_template)!=null?_t:null,Array.isArray(this.chat_template)){const Dt=Object.create(null);for(const{name:Et,template:zt}of this.chat_template){if(typeof Et!="string"||typeof zt!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');Dt[Et]=zt}this.chat_template=Dt}this._compiled_template_cache=new Map}getToken(...ue){for(const De of ue){const We=this.config[De];if(!!We)if(typeof We=="object"){if(We.__type==="AddedToken")return We.content;throw Error(`Unknown token: ${We}`)}else return We}return null}static async from_pretrained(ue,{progress_callback:De=null,config:We=null,cache_dir:Ye=null,local_files_only:at=!1,revision:_t="main",legacy:Dt=null}={}){const Et=await o(ue,{progress_callback:De,config:We,cache_dir:Ye,local_files_only:at,revision:_t,legacy:Dt});return new this(...Et)}_call(ue,{text_pair:De=null,add_special_tokens:We=!0,padding:Ye=!1,truncation:at=null,max_length:_t=null,return_tensor:Dt=!0,return_token_type_ids:Et=null}={}){var ri;const zt=Array.isArray(ue);let pr;if(zt){if(ue.length===0)throw Error("text array must be non-empty");if(De!==null){if(Array.isArray(De)){if(ue.length!==De.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");pr=ue.map((rn,Ur)=>this._encode_plus(rn,{text_pair:De[Ur],add_special_tokens:We,return_token_type_ids:Et}))}else pr=ue.map(rn=>this._encode_plus(rn,{add_special_tokens:We,return_token_type_ids:Et}))}else{if(ue==null)throw Error("text may not be null or undefined");if(Array.isArray(De))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");pr=[this._encode_plus(ue,{text_pair:De,add_special_tokens:We,return_token_type_ids:Et})]}if(_t===null?_t=this.model_max_length:at===null&&(Ye===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),_t=this.model_max_length):Ye===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),at=!0)),Ye===!0&&(_t=Math.min((0,x.max)(pr.map(rn=>rn.input_ids.length))[0],_t!=null?_t:1/0)),_t=Math.min(_t,(ri=this.model_max_length)!=null?ri:1/0),Ye||at)for(let rn=0;rn<pr.length;++rn)pr[rn].input_ids.length!==_t&&(pr[rn].input_ids.length>_t?at&&oa(pr[rn],_t):Ye&&io(pr[rn],_t,Ur=>Ur==="input_ids"?this.pad_token_id:0,this.padding_side));const Hr={};if(Dt){if(!(Ye&&at)&&pr.some(Ur=>{var Mn;for(const Wn of Object.keys(Ur))if(Ur[Wn].length!==((Mn=pr[0][Wn])==null?void 0:Mn.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const rn=[pr.length,pr[0].input_ids.length];for(const Ur of Object.keys(pr[0]))Hr[Ur]=new f.Tensor("int64",BigInt64Array.from(pr.flatMap(Mn=>Mn[Ur]).map(BigInt)),rn)}else{for(const rn of Object.keys(pr[0]))Hr[rn]=pr.map(Ur=>Ur[rn]);if(!zt)for(const rn of Object.keys(Hr))Hr[rn]=Hr[rn][0]}return Hr}_encode_text(ue){if(ue===null)return null;const De=this.added_tokens_splitter.split(ue);for(let Ye=0;Ye<De.length;++Ye){const at=this.added_tokens_map.get(De[Ye]);at&&(at.lstrip&&Ye>0&&(De[Ye-1]=De[Ye-1].trimEnd()),at.rstrip&&Ye<De.length-1&&(De[Ye+1]=De[Ye+1].trimStart()))}return De.flatMap((Ye,at)=>{if(Ye.length===0)return[];if(this.added_tokens_map.has(Ye))return[Ye];if(this.remove_space===!0&&(Ye=Ye.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(Ye=y(Ye)),this.normalizer!==null&&(Ye=this.normalizer(Ye)),Ye.length===0)return[];const _t=this.pre_tokenizer!==null?this.pre_tokenizer(Ye,{section_index:at}):[Ye];return this.model(_t)})}_encode_plus(ue,{text_pair:De=null,add_special_tokens:We=!0,return_token_type_ids:Ye=null}={}){const{tokens:at,token_type_ids:_t}=this._tokenize_helper(ue,{pair:De,add_special_tokens:We}),Dt=this.model.convert_tokens_to_ids(at),Et={input_ids:Dt,attention_mask:new Array(Dt.length).fill(1)};return(Ye!=null?Ye:this.return_token_type_ids)&&_t&&(Et.token_type_ids=_t),Et}_tokenize_helper(ue,{pair:De=null,add_special_tokens:We=!1}={}){const Ye=this._encode_text(ue),at=this._encode_text(De);return this.post_processor?this.post_processor(Ye,at,{add_special_tokens:We}):{tokens:(0,a.mergeArrays)(Ye!=null?Ye:[],at!=null?at:[])}}tokenize(ue,{pair:De=null,add_special_tokens:We=!1}={}){return this._tokenize_helper(ue,{pair:De,add_special_tokens:We}).tokens}encode(ue,{text_pair:De=null,add_special_tokens:We=!0,return_token_type_ids:Ye=null}={}){return this._encode_plus(ue,{text_pair:De,add_special_tokens:We,return_token_type_ids:Ye}).input_ids}batch_decode(ue,De={}){return ue instanceof f.Tensor&&(ue=ue.tolist()),ue.map(We=>this.decode(We,De))}decode(ue,De={}){if(ue instanceof f.Tensor&&(ue=w(ue)),!Array.isArray(ue)||ue.length===0||!(0,a.isIntegralNumber)(ue[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(ue,De)}decode_single(ue,{skip_special_tokens:De=!1,clean_up_tokenization_spaces:We=null}){let Ye=this.model.convert_ids_to_tokens(ue);De&&(Ye=Ye.filter(_t=>!this.special_tokens.includes(_t)));let at=this.decoder?this.decoder(Ye):Ye.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(at=at.replaceAll(this.decoder.end_of_word_suffix," "),De&&(at=at.trim())),(We!=null?We:this.clean_up_tokenization_spaces)&&(at=_(at)),at}get_chat_template({chat_template:ue=null,tools:De=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const We=this.chat_template;if(ue!==null&&Object.hasOwn(We,ue))ue=We[ue];else if(ue===null)if(De!==null&&"tool_use"in We)ue=We.tool_use;else if("default"in We)ue=We.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(We).sort()}.`)}else if(ue===null)if(this.chat_template)ue=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return ue}apply_chat_template(ue,{tools:De=null,documents:We=null,chat_template:Ye=null,add_generation_prompt:at=!1,tokenize:_t=!0,padding:Dt=!1,truncation:Et=!1,max_length:zt=null,return_tensor:pr=!0,return_dict:Hr=!1,tokenizer_kwargs:ri={},...rn}={}){if(Ye=this.get_chat_template({chat_template:Ye,tools:De}),typeof Ye!="string")throw Error(`chat_template must be a string, but got ${typeof Ye}`);let Ur=this._compiled_template_cache.get(Ye);Ur===void 0&&(Ur=new d.Template(Ye),this._compiled_template_cache.set(Ye,Ur));const Mn=Object.create(null);for(const li of Zi){const Ls=this.getToken(li);Ls&&(Mn[li]=Ls)}const Wn=Ur.render({messages:ue,add_generation_prompt:at,tools:De,documents:We,...Mn,...rn});if(_t){const li=this._call(Wn,{add_special_tokens:!1,padding:Dt,truncation:Et,max_length:zt,return_tensor:pr,...ri});return Hr?li:li.input_ids}return Wn}}class ko extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class so extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class yr extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class As extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class H extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class Pe extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class fe extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class Le extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class Xe extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class ft extends dr{}class pt extends dr{}class nr extends dr{constructor(ue,De){super(ue,De);$e(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class vr extends dr{constructor(){super(...arguments);$e(this,"return_token_type_ids",!0)}}class or extends dr{}class Nt extends dr{}class qt extends dr{}class jr extends dr{constructor(Q,ue){super(Q,ue),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(De=>this.languageRegex.test(De)),this.lang_to_token=De=>De}_build_translation_inputs(Q,ue,De){return ti(this,Q,ue,De)}}class Sn extends jr{}class bi extends dr{}class hi extends dr{}const bn="\u2581";class wr extends dr{constructor(ue,De){var We;super(ue,De);$e(this,"padding_side","left");this.legacy=(We=De.legacy)!=null?We:!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new gn({replacement:bn,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(ue){if(ue===null)return null;if(this.legacy||ue.length===0)return super._encode_text(ue);let De=super._encode_text(bn+ue.replaceAll(bn," "));return De.length>1&&De[0]===bn&&this.special_tokens.includes(De[1])&&(De=De.slice(1)),De}}class ir extends dr{}class Ar extends dr{}class Gr extends dr{}class nn extends dr{}class Nr extends dr{}class yn extends dr{}class pi extends dr{}class sn extends dr{}class ei extends dr{}function ti(Je,Q,ue,De){if(!("language_codes"in Je)||!Array.isArray(Je.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in Je)||!(Je.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in Je)||typeof Je.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const We=De.src_lang,Ye=De.tgt_lang;if(!Je.language_codes.includes(Ye))throw new Error(`Target language code "${Ye}" is not valid. Must be one of: {${Je.language_codes.join(", ")}}`);if(We!==void 0){if(!Je.language_codes.includes(We))throw new Error(`Source language code "${We}" is not valid. Must be one of: {${Je.language_codes.join(", ")}}`);for(const at of Je.post_processor.config.single)if("SpecialToken"in at&&Je.languageRegex.test(at.SpecialToken.id)){at.SpecialToken.id=Je.lang_to_token(We);break}}return De.forced_bos_token_id=Je.model.convert_tokens_to_ids([Je.lang_to_token(Ye)])[0],Je._call(Q,ue)}class Mi extends dr{constructor(Q,ue){super(Q,ue),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(De=>this.languageRegex.test(De)),this.lang_to_token=De=>De}_build_translation_inputs(Q,ue,De){return ti(this,Q,ue,De)}}class rr extends dr{constructor(Q,ue){super(Q,ue),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(De=>this.languageRegex.test(De)).map(De=>De.slice(2,-2)),this.lang_to_token=De=>`__${De}__`}_build_translation_inputs(Q,ue,De){return ti(this,Q,ue,De)}}class Ds extends dr{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(Q,{return_timestamps:ue=!1,return_language:De=!1,time_precision:We=null,force_full_sequences:Ye=!0}={}){if(We===null)throw Error("Must specify time_precision");let at=null;const _t=ue==="word";function Dt(){return{language:at,timestamp:[null,null],text:""}}const Et=[];let zt=Dt(),pr=0;const Hr=this.timestamp_begin,rn=Hr+1500;let Ur=[],Mn=[],Wn=!1,li=null;const Ls=new Set(this.all_special_ids);for(const un of Q){const In=un.tokens,Ti=_t?un.token_timestamps:null;let ds=null,qr=Hr;if("stride"in un){const[Hn,En,An]=un.stride;if(pr-=En,li=Hn-An,En&&(qr=En/We+Hr),An)for(let _r=In.length-1;_r>=0;--_r){const Br=Number(In[_r]);if(Br>=Hr){if(ds!==null&&(Br-Hr)*We<li)break;ds=Br}}}let Lr=[],fs=[];for(let Hn=0;Hn<In.length;++Hn){const En=Number(In[Hn]);if(Ls.has(En)){const An=this.decode([En]),_r=m.WHISPER_LANGUAGE_MAPPING.get(An.slice(2,-2));if(_r!==void 0){if(at!==null&&_r!==at&&!ue){Ur.push(Lr);const Br=this.findLongestCommonSequence(Ur)[0],es=this.decode(Br);zt.text=es,Et.push(zt),Ur=[],Lr=[],zt=Dt()}at=zt.language=_r}}else if(En>=Hr&&En<=rn){const An=(En-Hr)*We+pr,_r=(0,x.round)(An,2);if(ds!==null&&En>=ds)Wn=!0;else if(Wn||Ur.length>0&&En<qr)Wn=!1;else if(zt.timestamp[0]===null)zt.timestamp[0]=_r;else if(_r!==zt.timestamp[0]){zt.timestamp[1]=_r,Ur.push(Lr),_t&&Mn.push(fs);const[Br,es]=this.findLongestCommonSequence(Ur,Mn),aa=this.decode(Br);zt.text=aa,_t&&(zt.words=this.collateWordTimestamps(Br,es,at)),Et.push(zt),Ur=[],Lr=[],Mn=[],fs=[],zt=Dt()}}else if(Lr.push(En),_t){let An=(0,x.round)(Ti[Hn]+pr,2),_r;if(Hn+1<Ti.length){_r=(0,x.round)(Ti[Hn+1]+pr,2);const Br=this.decode([En]);D.test(Br)&&(_r=(0,x.round)(Math.min(An+We,_r),2))}else _r=null;fs.push([An,_r])}}if("stride"in un){const[Hn,En,An]=un.stride;pr+=Hn-An}Lr.length>0?(Ur.push(Lr),_t&&Mn.push(fs)):Ur.every(Hn=>Hn.length===0)&&(zt=Dt(),Ur=[],Lr=[],Mn=[],fs=[])}if(Ur.length>0){if(Ye&&ue)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[un,In]=this.findLongestCommonSequence(Ur,Mn),Ti=this.decode(un);zt.text=Ti,_t&&(zt.words=this.collateWordTimestamps(un,In,at)),Et.push(zt)}let Gn=Object.create(null);const $s=Et.map(un=>un.text).join("");if(ue||De){for(let un=0;un<Et.length;++un){const In=Et[un];ue||delete In.timestamp,De||delete In.language}if(_t){const un=[];for(const In of Et)for(const Ti of In.words)un.push(Ti);Gn={chunks:un}}else Gn={chunks:Et}}return[$s,Gn]}findLongestCommonSequence(Q,ue=null){let De=Q[0],We=De.length,Ye=[];const at=Array.isArray(ue)&&ue.length>0;let _t=at?[]:null,Dt=at?ue[0]:null;for(let Et=1;Et<Q.length;++Et){const zt=Q[Et];let pr=0,Hr=[We,We,0,0];const ri=zt.length;for(let Gn=1;Gn<We+ri;++Gn){const $s=Math.max(0,We-Gn),un=Math.min(We,We+ri-Gn),In=De.slice($s,un),Ti=Math.max(0,Gn-We),ds=Math.min(ri,Gn),qr=zt.slice(Ti,ds);if(In.length!==qr.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let Lr;at?Lr=In.filter((En,An)=>En===qr[An]&&Dt[$s+An]<=ue[Et][Ti+An]).length:Lr=In.filter((En,An)=>En===qr[An]).length;const fs=Gn/1e4,Hn=Lr/Gn+fs;Lr>1&&Hn>pr&&(pr=Hn,Hr=[$s,un,Ti,ds])}const[rn,Ur,Mn,Wn]=Hr,li=Math.floor((Ur+rn)/2),Ls=Math.floor((Wn+Mn)/2);Ye.push(...De.slice(0,li)),De=zt.slice(Ls),We=De.length,at&&(_t.push(...Dt.slice(0,li)),Dt=ue[Et].slice(Ls))}return Ye.push(...De),at?(_t.push(...Dt),[Ye,_t]):[Ye,[]]}collateWordTimestamps(Q,ue,De){const[We,Ye,at]=this.combineTokensIntoWords(Q,De),_t=[];for(let Dt=0;Dt<We.length;++Dt){const Et=at[Dt];_t.push({text:We[Dt],timestamp:[ue[Et.at(0)][0],ue[Et.at(-1)][1]]})}return _t}combineTokensIntoWords(Q,ue,De=`"'\u201C\xA1\xBF([{-`,We=`"'.\u3002,\uFF0C!\uFF01?\uFF1F:\uFF1A\u201D)]}\u3001`){ue=ue!=null?ue:"english";let Ye,at,_t;return["chinese","japanese","thai","lao","myanmar"].includes(ue)?[Ye,at,_t]=this.splitTokensOnUnicode(Q):[Ye,at,_t]=this.splitTokensOnSpaces(Q),this.mergePunctuations(Ye,at,_t,De,We)}decode(Q,ue){let De;return ue!=null&&ue.decode_with_timestamps?(Q instanceof f.Tensor&&(Q=w(Q)),De=this.decodeWithTimestamps(Q,ue)):De=super.decode(Q,ue),De}decodeWithTimestamps(Q,ue){var at;const De=(at=ue==null?void 0:ue.time_precision)!=null?at:.02,We=Array.from(this.all_special_ids).at(-1)+1;let Ye=[[]];for(let _t of Q)if(_t=Number(_t),_t>=We){const Dt=((_t-We)*De).toFixed(2);Ye.push(`<|${Dt}|>`),Ye.push([])}else Ye[Ye.length-1].push(_t);return Ye=Ye.map(_t=>typeof _t=="string"?_t:super.decode(_t,ue)),Ye.join("")}splitTokensOnUnicode(Q){const ue=this.decode(Q,{decode_with_timestamps:!0}),De="\uFFFD",We=[],Ye=[],at=[];let _t=[],Dt=[],Et=0;for(let zt=0;zt<Q.length;++zt){const pr=Q[zt];_t.push(pr),Dt.push(zt);const Hr=this.decode(_t,{decode_with_timestamps:!0});(!Hr.includes(De)||ue[Et+Hr.indexOf(De)]===De)&&(We.push(Hr),Ye.push(_t),at.push(Dt),_t=[],Dt=[],Et+=Hr.length)}return[We,Ye,at]}splitTokensOnSpaces(Q){const[ue,De,We]=this.splitTokensOnUnicode(Q),Ye=[],at=[],_t=[],Dt=new RegExp(`^[${O}]$`,"gu");for(let Et=0;Et<ue.length;++Et){const zt=ue[Et],pr=De[Et],Hr=We[Et],ri=pr[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),rn=zt.startsWith(" "),Ur=zt.trim(),Mn=Dt.test(Ur);if(ri||rn||Mn||Ye.length===0)Ye.push(zt),at.push(pr),_t.push(Hr);else{const Wn=Ye.length-1;Ye[Wn]+=zt,at[Wn].push(...pr),_t[Wn].push(...Hr)}}return[Ye,at,_t]}mergePunctuations(Q,ue,De,We,Ye){const at=structuredClone(Q),_t=structuredClone(ue),Dt=structuredClone(De);let Et=at.length-2,zt=at.length-1;for(;Et>=0;)at[Et].startsWith(" ")&&We.includes(at[Et].trim())?(at[zt]=at[Et]+at[zt],_t[zt]=(0,a.mergeArrays)(_t[Et],_t[zt]),Dt[zt]=(0,a.mergeArrays)(Dt[Et],Dt[zt]),at[Et]="",_t[Et]=[],Dt[Et]=[]):zt=Et,--Et;for(Et=0,zt=1;zt<at.length;)!at[Et].endsWith(" ")&&Ye.includes(at[zt])?(at[Et]+=at[zt],_t[Et]=(0,a.mergeArrays)(_t[Et],_t[zt]),Dt[Et]=(0,a.mergeArrays)(Dt[Et],Dt[zt]),at[zt]="",_t[zt]=[],Dt[zt]=[]):Et=zt,++zt;return[at.filter(pr=>pr),_t.filter(pr=>pr.length>0),Dt.filter(pr=>pr.length>0)]}}class oo extends dr{}class Io extends dr{}class Un extends dr{}class Tt extends dr{constructor(Q,ue){super(Q,ue),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(De=>this.languageRegex.test(De)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(Q){if(Q===null)return null;const[ue,...De]=Q.trim().split(this.languageRegex);if(De.length===0)return super._encode_text(ue);if(De.length===2){const[We,Ye]=De;return this.supported_language_codes.includes(We)||console.warn(`Unsupported language code "${We}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,a.mergeArrays)([We],super._encode_text(Ye))}}}class Ot extends dr{}class Ut extends dr{}class pn extends dr{}class xr extends dr{}class Vn extends dr{}class ao extends dr{constructor(Q,ue){super(Q,ue),this.decoder=new cr({})}}class Fs extends dr{}class st extends dr{}class lo extends dr{}class cs{static async from_pretrained(Q,{progress_callback:ue=null,config:De=null,cache_dir:We=null,local_files_only:Ye=!1,revision:at="main",legacy:_t=null}={}){var Hr,ri;const[Dt,Et]=await o(Q,{progress_callback:ue,config:De,cache_dir:We,local_files_only:Ye,revision:at,legacy:_t}),zt=(ri=(Hr=Et.tokenizer_class)==null?void 0:Hr.replace(/Fast$/,""))!=null?ri:"PreTrainedTokenizer";let pr=this.TOKENIZER_CLASS_MAPPING[zt];return pr||(console.warn(`Unknown tokenizer class "${zt}", attempting to construct from base class.`),pr=dr),new pr(Dt,Et)}}$e(cs,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:or,DistilBertTokenizer:ft,CamembertTokenizer:pt,DebertaTokenizer:H,DebertaV2Tokenizer:Pe,BertTokenizer:ko,HerbertTokenizer:fe,ConvBertTokenizer:Le,RoFormerTokenizer:Xe,XLMTokenizer:nr,ElectraTokenizer:vr,MobileBertTokenizer:yr,SqueezeBertTokenizer:As,AlbertTokenizer:so,GPT2Tokenizer:Nt,BartTokenizer:qt,MBartTokenizer:jr,MBart50Tokenizer:Sn,RobertaTokenizer:bi,WhisperTokenizer:Ds,CodeGenTokenizer:oo,CLIPTokenizer:Io,SiglipTokenizer:Un,MarianTokenizer:Tt,BloomTokenizer:hi,NllbTokenizer:Mi,M2M100Tokenizer:rr,LlamaTokenizer:wr,CodeLlamaTokenizer:ir,XLMRobertaTokenizer:Ar,MPNetTokenizer:Gr,FalconTokenizer:nn,GPTNeoXTokenizer:Nr,EsmTokenizer:yn,Wav2Vec2CTCTokenizer:Ot,BlenderbotTokenizer:Ut,BlenderbotSmallTokenizer:pn,SpeechT5Tokenizer:xr,NougatTokenizer:Vn,VitsTokenizer:ao,Qwen2Tokenizer:pi,GemmaTokenizer:sn,Grok1Tokenizer:ei,CohereTokenizer:Fs,MgpstrTokenizer:st,Ernie4_5_Tokenizer:lo,PreTrainedTokenizer:dr})},"./src/utils/audio.js":(t,e,r)=>{r.r(e),r.d(e,{RawAudio:()=>pe,hamming:()=>l,hanning:()=>o,mel_filter_bank:()=>T,read_audio:()=>d,spectrogram:()=>L,window_function:()=>W});var n=r("./src/utils/hub.js"),a=r("./src/utils/maths.js"),h=r("./src/utils/core.js"),x=r("./src/env.js"),f=r("./src/utils/tensor.js"),s=r("?7992");async function d(ne,ye){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const ce=await(await(0,n.getFile)(ne)).arrayBuffer(),Me=new AudioContext({sampleRate:ye});typeof ye>"u"&&console.warn(`No sampling rate provided, using default of ${Me.sampleRate}Hz.`);const ke=await Me.decodeAudioData(ce);let ve;if(ke.numberOfChannels===2){const K=Math.sqrt(2),re=ke.getChannelData(0),X=ke.getChannelData(1);ve=new Float32Array(re.length);for(let N=0;N<ke.length;++N)ve[N]=K*(re[N]+X[N])/2}else ve=ke.getChannelData(0);return ve}function m(ne,ye){if(ne<1)return new Float64Array;if(ne===1)return new Float64Array([1]);const ce=1-ye,Me=2*Math.PI/(ne-1),ke=new Float64Array(ne);for(let ve=0;ve<ne;++ve)ke[ve]=ye-ce*Math.cos(ve*Me);return ke}function o(ne){return m(ne,.5)}function l(ne){return m(ne,.54)}const u={htk:ne=>2595*Math.log10(1+ne/700),kaldi:ne=>1127*Math.log(1+ne/700),slaney:(ne,ye=1e3,ce=15,Me=27/Math.log(6.4))=>ne>=ye?ce+Math.log(ne/ye)*Me:3*ne/200};function p(ne,ye="htk"){const ce=u[ye];if(!ce)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof ne=="number"?ce(ne):ne.map(Me=>ce(Me))}const w={htk:ne=>700*(10**(ne/2595)-1),kaldi:ne=>700*(Math.exp(ne/1127)-1),slaney:(ne,ye=1e3,ce=15,Me=Math.log(6.4)/27)=>ne>=ce?ye*Math.exp(Me*(ne-ce)):200*ne/3};function _(ne,ye="htk"){const ce=w[ye];if(!ce)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof ne=="number"?ce(ne):ne.map(Me=>ce(Me))}function v(ne,ye){const ce=Float64Array.from({length:ye.length-1},(K,re)=>ye[re+1]-ye[re]),Me=Array.from({length:ne.length},()=>new Array(ye.length));for(let K=0;K<ne.length;++K){const re=Me[K];for(let X=0;X<ye.length;++X)re[X]=ye[X]-ne[K]}const ke=ye.length-2,ve=Array.from({length:ke},()=>new Array(ne.length));for(let K=0;K<ne.length;++K){const re=Me[K];for(let X=0;X<ke;++X){const N=-re[X]/ce[X],ae=re[X+2]/ce[X+1];ve[X][K]=Math.max(0,Math.min(N,ae))}}return ve}function y(ne,ye,ce){const Me=(ye-ne)/(ce-1);return Float64Array.from({length:ce},(ke,ve)=>ne+Me*ve)}function T(ne,ye,ce,Me,ke,ve=null,K="htk",re=!1){if(ve!==null&&ve!=="slaney")throw new Error('norm must be one of null or "slaney"');if(ne<2)throw new Error(`Require num_frequency_bins: ${ne} >= 2`);if(ce>Me)throw new Error(`Require min_frequency: ${ce} <= max_frequency: ${Me}`);const X=p(ce,K),N=p(Me,K),ae=y(X,N,ye+2);let J=_(ae,K),Y;if(re){const Ce=ke/((ne-1)*2);Y=p(Float64Array.from({length:ne},(Ue,Ve)=>Ve*Ce),K),J=ae}else Y=y(0,Math.floor(ke/2),ne);const be=v(Y,J);if(ve!==null&&ve==="slaney")for(let Ce=0;Ce<ye;++Ce){const Ue=be[Ce],Ve=2/(J[Ce+2]-J[Ce]);for(let Ie=0;Ie<ne;++Ie)Ue[Ie]*=Ve}return be}function C(ne,ye,ce){const Me=new ne.constructor(ne.length+ye+ce),ke=ne.length-1;for(let ve=0;ve<ne.length;++ve)Me[ye+ve]=ne[ve];for(let ve=1;ve<=ye;++ve)Me[ye-ve]=ne[(0,h.calculateReflectOffset)(ve,ke)];for(let ve=1;ve<=ce;++ve)Me[ke+ye+ve]=ne[(0,h.calculateReflectOffset)(ke-ve,ke)];return Me}function P(ne,ye,ce,Me,ke){if(ce<=0)throw new Error("reference must be greater than zero");if(Me<=0)throw new Error("min_value must be greater than zero");ce=Math.max(Me,ce);const ve=Math.log10(ce);for(let K=0;K<ne.length;++K)ne[K]=ye*Math.log10(Math.max(Me,ne[K])-ve);if(ke!==null){if(ke<=0)throw new Error("db_range must be greater than zero");const K=(0,a.max)(ne)[0]-ke;for(let re=0;re<ne.length;++re)ne[re]=Math.max(ne[re],K)}return ne}function O(ne,ye=1,ce=1e-5,Me=null){return P(ne,20,ye,ce,Me)}function D(ne,ye=1,ce=1e-10,Me=null){return P(ne,10,ye,ce,Me)}async function L(ne,ye,ce,Me,{fft_length:ke=null,power:ve=1,center:K=!0,pad_mode:re="reflect",onesided:X=!0,preemphasis:N=null,preemphasis_htk_flavor:ae=!0,mel_filters:J=null,mel_floor:Y=1e-10,log_mel:be=null,reference:Ce=1,min_value:Ue=1e-10,db_range:Ve=null,remove_dc_offset:Ie=null,min_num_frames:he=null,max_num_frames:Fe=null,do_pad:ee=!0,transpose:we=!1}={}){const Re=ye.length;if(ke===null&&(ke=ce),ce>ke)throw Error(`frame_length (${ce}) may not be larger than fft_length (${ke})`);if(Re!==ce)throw new Error(`Length of the window (${Re}) must equal frame_length (${ce})`);if(Me<=0)throw new Error("hop_length must be greater than zero");if(ve===null&&J!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!ae)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(K){if(re!=="reflect")throw new Error(`pad_mode="${re}" not implemented yet.`);const bt=Math.floor((ke-1)/2)+1;ne=C(ne,bt,bt)}let Be=Math.floor(1+Math.floor((ne.length-ce)/Me));he!==null&&Be<he&&(Be=he);const Se=X?Math.floor(ke/2)+1:ke;let Ne=Be,ze=Be;Fe!==null&&(Fe>Be?ee&&(ze=Fe):ze=Ne=Fe);const rt=new a.FFT(ke),nt=new Float64Array(ke),Ge=new Float64Array(rt.outputBufferSize),qe=new Float32Array(Se*ze);for(let bt=0;bt<Ne;++bt){const Ct=bt*Me,It=Math.min(ne.length-Ct,ce);It!==ce&&nt.fill(0,0,ce);for(let jt=0;jt<It;++jt)nt[jt]=ne[Ct+jt];if(Ie){let jt=0;for(let lr=0;lr<It;++lr)jt+=nt[lr];const Fr=jt/It;for(let lr=0;lr<It;++lr)nt[lr]-=Fr}if(N!==null){for(let jt=It-1;jt>=1;--jt)nt[jt]-=N*nt[jt-1];nt[0]*=1-N}for(let jt=0;jt<ye.length;++jt)nt[jt]*=ye[jt];rt.realTransform(Ge,nt);for(let jt=0;jt<Se;++jt){const Fr=jt<<1;qe[jt*ze+bt]=Ge[Fr]**2+Ge[Fr+1]**2}}if(ve!==null&&ve!==2){const bt=ve/2;for(let Ct=0;Ct<qe.length;++Ct)qe[Ct]**=bt}const gt=J.length;let ct=await(0,f.matmul)(new f.Tensor("float32",J.flat(),[gt,Se]),new f.Tensor("float32",qe,[Se,ze]));we&&(ct=ct.transpose(1,0));const wt=ct.data;for(let bt=0;bt<wt.length;++bt)wt[bt]=Math.max(Y,wt[bt]);if(ve!==null&&be!==null){const bt=Math.min(wt.length,Ne*gt);switch(be){case"log":for(let Ct=0;Ct<bt;++Ct)wt[Ct]=Math.log(wt[Ct]);break;case"log10":for(let Ct=0;Ct<bt;++Ct)wt[Ct]=Math.log10(wt[Ct]);break;case"dB":if(ve===1)O(wt,Ce,Ue,Ve);else if(ve===2)D(wt,Ce,Ue,Ve);else throw new Error(`Cannot use log_mel option '${be}' with power ${ve}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${be}'`)}}return ct}function W(ne,ye,{periodic:ce=!0,frame_length:Me=null,center:ke=!0}={}){const ve=ce?ne+1:ne;let K;switch(ye){case"boxcar":K=new Float64Array(ve).fill(1);break;case"hann":case"hann_window":K=o(ve);break;case"hamming":K=l(ve);break;case"povey":K=o(ve).map(re=>Math.pow(re,.85));break;default:throw new Error(`Unknown window type ${ye}.`)}if(ce&&(K=K.subarray(0,ne)),Me===null)return K;if(ne>Me)throw new Error(`Length of the window (${ne}) may not be larger than frame_length (${Me})`);return K}function U(ne,ye){let ce=44;const Me=new ArrayBuffer(ce+ne.length*4),ke=new DataView(Me);te(ke,0,"RIFF"),ke.setUint32(4,36+ne.length*4,!0),te(ke,8,"WAVE"),te(ke,12,"fmt "),ke.setUint32(16,16,!0),ke.setUint16(20,3,!0),ke.setUint16(22,1,!0),ke.setUint32(24,ye,!0),ke.setUint32(28,ye*4,!0),ke.setUint16(32,4,!0),ke.setUint16(34,32,!0),te(ke,36,"data"),ke.setUint32(40,ne.length*4,!0);for(let ve=0;ve<ne.length;++ve,ce+=4)ke.setFloat32(ce,ne[ve],!0);return Me}function te(ne,ye,ce){for(let Me=0;Me<ce.length;++Me)ne.setUint8(ye+Me,ce.charCodeAt(Me))}class pe{constructor(ye,ce){this.audio=ye,this.sampling_rate=ce}toWav(){return U(this.audio,this.sampling_rate)}toBlob(){const ye=this.toWav();return new Blob([ye],{type:"audio/wav"})}async save(ye){let ce;if(x.apis.IS_BROWSER_ENV){if(x.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");ce=h.saveBlob}else if(x.apis.IS_FS_AVAILABLE)ce=async(Me,ke)=>{let ve=await ke.arrayBuffer();s.writeFileSync(Me,Buffer.from(ve))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await ce(ye,this.toBlob())}}},"./src/utils/constants.js":(t,e,r)=>{r.r(e),r.d(e,{CHAT_TEMPLATE_NAME:()=>s,CONFIG_NAME:()=>a,FEATURE_EXTRACTOR_NAME:()=>h,GENERATION_CONFIG_NAME:()=>d,GITHUB_ISSUE_URL:()=>n,IMAGE_PROCESSOR_NAME:()=>x,PROCESSOR_NAME:()=>f});const n="https://github.com/huggingface/transformers.js/issues/new/choose",a="config.json",h="preprocessor_config.json",x=h,f="processor_config.json",s="chat_template.jinja",d="generation_config.json"},"./src/utils/core.js":(t,e,r)=>{r.r(e),r.d(e,{calculateDimensions:()=>d,calculateReflectOffset:()=>u,count:()=>v,dispatchCallback:()=>n,escapeRegExp:()=>h,isIntegralNumber:()=>f,isNullishDimension:()=>s,isTypedArray:()=>x,len:()=>_,mergeArrays:()=>o,pick:()=>w,pop:()=>m,product:()=>l,reverseDictionary:()=>a,saveBlob:()=>p});function n(y,T){y&&y(T)}function a(y){return Object.fromEntries(Object.entries(y).map(([T,C])=>[C,T]))}function h(y){return y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x(y){var T,C,P;return((P=(C=(T=y==null?void 0:y.prototype)==null?void 0:T.__proto__)==null?void 0:C.constructor)==null?void 0:P.name)==="TypedArray"}function f(y){return Number.isInteger(y)||typeof y=="bigint"}function s(y){return y==null||y===-1}function d(y){const T=[];let C=y;for(;Array.isArray(C);)T.push(C.length),C=C[0];return T}function m(y,T,C=void 0){const P=y[T];if(P!==void 0)return delete y[T],P;if(C===void 0)throw Error(`Key ${T} does not exist in object.`);return C}function o(...y){return Array.prototype.concat.apply([],y)}function l(...y){return y.reduce((T,C)=>T.flatMap(P=>C.map(O=>[P,O])))}function u(y,T){return Math.abs((y+T)%(2*T)-T)}function p(y,T){const C=URL.createObjectURL(T),P=document.createElement("a");P.href=C,P.download=y,P.click(),P.remove(),URL.revokeObjectURL(C)}function w(y,T){return Object.assign({},...T.map(C=>{if(y[C]!==void 0)return{[C]:y[C]}}))}function _(y){let T=0;for(const C of y)++T;return T}function v(y,T){let C=0;for(const P of y)P===T&&++C;return C}},"./src/utils/data-structures.js":(t,e,r)=>{r.r(e),r.d(e,{CharTrie:()=>a,DictionarySplitter:()=>s,LRUCache:()=>d,PriorityQueue:()=>n,TokenLattice:()=>x});class n{constructor(o=(u,p)=>u>p,l=1/0){this._heap=[],this._comparator=o,this._maxSize=l}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...o){return this.extend(o)}extend(o){for(const l of o)if(this.size<this._maxSize)this._heap.push(l),this._siftUp();else{const u=this._smallest();this._comparator(l,this._heap[u])&&(this._heap[u]=l,this._siftUpFrom(u))}return this.size}pop(){const o=this.peek(),l=this.size-1;return l>0&&this._swap(0,l),this._heap.pop(),this._siftDown(),o}replace(o){const l=this.peek();return this._heap[0]=o,this._siftDown(),l}_parent(o){return(o+1>>>1)-1}_left(o){return(o<<1)+1}_right(o){return o+1<<1}_greater(o,l){return this._comparator(this._heap[o],this._heap[l])}_swap(o,l){const u=this._heap[o];this._heap[o]=this._heap[l],this._heap[l]=u}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(o){for(;o>0&&this._greater(o,this._parent(o));)this._swap(o,this._parent(o)),o=this._parent(o)}_siftDown(){let o=0;for(;this._left(o)<this.size&&this._greater(this._left(o),o)||this._right(o)<this.size&&this._greater(this._right(o),o);){const l=this._right(o)<this.size&&this._greater(this._right(o),this._left(o))?this._right(o):this._left(o);this._swap(o,l),o=l}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class a{constructor(){this.root=h.default()}extend(o){for(const l of o)this.push(l)}push(o){let l=this.root;for(const u of o){let p=l.children.get(u);p===void 0&&(p=h.default(),l.children.set(u,p)),l=p}l.isLeaf=!0}*commonPrefixSearch(o){let l=this.root;if(l===void 0)return;let u="";for(const p of o){if(u+=p,l=l.children.get(p),l===void 0)return;l.isLeaf&&(yield u)}}}class h{constructor(o,l){this.isLeaf=o,this.children=l}static default(){return new h(!1,new Map)}}class x{constructor(o,l,u){this.chars=Array.from(o),this.len=this.chars.length,this.bosTokenId=l,this.eosTokenId=u,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const p=new f(this.bosTokenId,0,0,0,0),w=new f(this.eosTokenId,1,this.len,0,0);this.nodes.push(p.clone()),this.nodes.push(w.clone()),this.beginNodes[this.len].push(w),this.endNodes[0].push(p)}insert(o,l,u,p){const w=this.nodes.length,_=new f(p,w,o,l,u);this.beginNodes[o].push(_),this.endNodes[o+l].push(_),this.nodes.push(_)}viterbi(){const o=this.len;let l=0;for(;l<=o;){if(this.beginNodes[l].length==0)return[];for(let v of this.beginNodes[l]){v.prev=null;let y=0,T=null;for(let C of this.endNodes[l]){const P=C.backtraceScore+v.score;(T===null||P>y)&&(T=C.clone(),y=P)}if(T!==null)v.prev=T,v.backtraceScore=y;else return[]}++l}const u=[],w=this.beginNodes[o][0].prev;if(w===null)return[];let _=w.clone();for(;_.prev!==null;)u.push(_.clone()),_=_.clone().prev.clone();return u.reverse(),u}piece(o){return this.chars.slice(o.pos,o.pos+o.length).join("")}tokens(){return this.viterbi().map(l=>this.piece(l))}tokenIds(){return this.viterbi().map(l=>l.tokenId)}}class f{constructor(o,l,u,p,w){this.tokenId=o,this.nodeId=l,this.pos=u,this.length=p,this.score=w,this.prev=null,this.backtraceScore=0}clone(){const o=new f(this.tokenId,this.nodeId,this.pos,this.length,this.score);return o.prev=this.prev,o.backtraceScore=this.backtraceScore,o}}class s{constructor(o){this.trie=this._buildTrie(o)}_buildTrie(o){var u,p;const l=Object.create(null);for(const w of o){let _=l;for(let v=0;v<w.length;++v)_=(p=_[u=w[v]])!=null?p:_[u]=Object.create(null);_.end=w}return l}split(o){const l=[],u=o.length;let p=0,w=0;for(;w<u;){let _=this.trie,v=null,y=w;for(;y<u&&(_=_[o[y]]);)_.end&&(v=_.end),++y;v?(w>p&&l.push(o.slice(p,w)),l.push(v),w+=v.length,p=w):++w}return p<u&&l.push(o.slice(p)),l}}class d{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)&&this.cache.delete(o),this.cache.set(o,l),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(t,e,r)=>{r.r(e),r.d(e,{DEVICE_TYPES:()=>n});const n=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(t,e,r)=>{r.r(e),r.d(e,{DATA_TYPES:()=>x,DEFAULT_DEVICE_DTYPE_MAPPING:()=>f,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>s,isWebGpuFp16Supported:()=>h});var n=r("./src/env.js"),a=r("./src/utils/devices.js");const h=function(){let d;return async function(){if(d===void 0)if(!n.apis.IS_WEBGPU_AVAILABLE)d=!1;else try{d=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{d=!1}return d}}(),x=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),f=Object.freeze({[a.DEVICE_TYPES.wasm]:x.q8}),s=Object.freeze({[x.fp32]:"",[x.fp16]:"_fp16",[x.int8]:"_int8",[x.uint8]:"_uint8",[x.q8]:"_quantized",[x.q4]:"_q4",[x.q4f16]:"_q4f16",[x.bnb4]:"_bnb4"})},"./src/utils/generic.js":(t,e,r)=>{r.r(e),r.d(e,{Callable:()=>n});const n=class{constructor(){let a=function(...h){return a._call(...h)};return Object.setPrototypeOf(a,new.target.prototype)}_call(...a){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(t,e,r)=>{r.r(e),r.d(e,{MAX_EXTERNAL_DATA_CHUNKS:()=>f,getFile:()=>u,getModelFile:()=>y,getModelJSON:()=>C,getModelText:()=>T});var n=r("?7992"),a=r("?5af5"),h=r("./src/env.js"),x=r("./src/utils/core.js");const f=100,s={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class d{constructor(L){if(this.filePath=L,this.headers=new Headers,this.exists=n.existsSync(L),this.exists){this.status=200,this.statusText="OK";let W=n.statSync(L);this.headers.set("content-length",W.size.toString()),this.updateContentType();const U=n.createReadStream(L);this.body=new ReadableStream({start(te){U.on("data",pe=>te.enqueue(pe)),U.on("end",()=>te.close()),U.on("error",pe=>te.error(pe))},cancel(){U.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){var W;const L=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",(W=s[L])!=null?W:"application/octet-stream")}clone(){let L=new d(this.filePath);return L.exists=this.exists,L.status=this.status,L.statusText=this.statusText,L.headers=new Headers(this.headers),L}async arrayBuffer(){return(await n.promises.readFile(this.filePath)).buffer}async blob(){const L=await n.promises.readFile(this.filePath);return new Blob([L],{type:this.headers.get("content-type")})}async text(){return await n.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function m(D,L=null,W=null){let U;try{U=new URL(D)}catch{return!1}return!(L&&!L.includes(U.protocol)||W&&!W.includes(U.hostname))}const o=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function l(D){return!(!o.test(D)||D.includes("..")||D.includes("--")||D.endsWith(".git")||D.endsWith(".ipynb"))}async function u(D){var L,W,U,te,pe;if(h.env.useFS&&!m(D,["http:","https:","blob:"]))return new d(D instanceof URL?D.protocol==="file:"?D.pathname:D.toString():D);if(typeof process<"u"&&((L=process==null?void 0:process.release)==null?void 0:L.name)==="node"){const ne=!!((W=process.env)!=null&&W.TESTING_REMOTELY),ye=h.env.version,ce=new Headers;if(ce.set("User-Agent",`transformers.js/${ye}; is_ci/${ne};`),m(D,["http:","https:"],["huggingface.co","hf.co"])){const ke=(pe=(U=process.env)==null?void 0:U.HF_TOKEN)!=null?pe:(te=process.env)==null?void 0:te.HF_ACCESS_TOKEN;ke&&ce.set("Authorization",`Bearer ${ke}`)}return fetch(D,{headers:ce})}else return fetch(D)}const p={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function w(D,L,W){var te;if(!W)return null;const U=(te=p[D])!=null?te:`Error (${D}) occurred while trying to load file`;throw Error(`${U}: "${L}".`)}class _{constructor(L){this.path=L}async match(L){let W=a.join(this.path,L),U=new d(W);if(U.exists)return U}async put(L,W,U=void 0){let te=a.join(this.path,L);try{const pe=W.headers.get("Content-Length"),ne=parseInt(pe!=null?pe:"0");let ye=0;await n.promises.mkdir(a.dirname(te),{recursive:!0});const ce=n.createWriteStream(te),Me=W.body.getReader();for(;;){const{done:ke,value:ve}=await Me.read();if(ke)break;await new Promise((re,X)=>{ce.write(ve,N=>{if(N){X(N);return}re()})}),ye+=ve.length;const K=ne?ye/ne*100:0;U==null||U({progress:K,loaded:ye,total:ne})}ce.close()}catch(pe){try{await n.promises.unlink(te)}catch{}throw pe}}}async function v(D,...L){for(let W of L)try{let U=await D.match(W);if(U)return U}catch{continue}}async function y(D,L,W=!0,U={},te=!1){var Y,be;if(!h.env.allowLocalModels){if(U.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!h.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,x.dispatchCallback)(U.progress_callback,{status:"initiate",name:D,file:L});let pe;if(!pe&&h.env.useCustomCache){if(!h.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!h.env.customCache.match||!h.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");pe=h.env.customCache}if(!pe&&h.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{pe=await caches.open("transformers-cache")}catch(Ce){console.warn("An error occurred while opening the browser cache:",Ce)}}if(!pe&&h.env.useFSCache){if(!h.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");pe=new _((Y=U.cache_dir)!=null?Y:h.env.cacheDir)}const ne=(be=U.revision)!=null?be:"main",ye=O(D,L),ce=l(D),Me=ce?O(h.env.localModelPath,ye):ye,ke=O(h.env.remoteHost,h.env.remotePathTemplate.replaceAll("{model}",D).replaceAll("{revision}",encodeURIComponent(ne)),L);let ve;const K=pe instanceof _?ne==="main"?ye:O(D,ne,L):ke;let re=!1,X;pe&&(X=await v(pe,Me,K));const N=X!==void 0;if(X===void 0){if(h.env.allowLocalModels)if(m(ye,["http:","https:"])){if(U.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${ye}.`);if(!h.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${ye}.`)}else try{X=await u(Me),ve=Me}catch(Ue){console.warn(`Unable to load from local path "${Me}": "${Ue}"`)}if(X===void 0||X.status===404){if(U.local_files_only||!h.env.allowRemoteModels){if(W)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${Me}".`);return null}if(!ce)throw Error(`Local file missing at "${Me}" and download aborted due to invalid model ID "${D}".`);if(X=await u(ke),X.status!==200)return w(X.status,ke,W);ve=K}re=pe&&typeof Response<"u"&&X instanceof Response&&X.status===200}(0,x.dispatchCallback)(U.progress_callback,{status:"download",name:D,file:L});let ae;if(!(h.apis.IS_NODE_ENV&&te)){let Ce;U.progress_callback?N&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(Ce=new Uint8Array(await X.arrayBuffer()),(0,x.dispatchCallback)(U.progress_callback,{status:"progress",name:D,file:L,progress:100,loaded:Ce.length,total:Ce.length})):Ce=await P(X,Ue=>{(0,x.dispatchCallback)(U.progress_callback,{status:"progress",name:D,file:L,...Ue})}):Ce=new Uint8Array(await X.arrayBuffer()),ae=Ce}if(re&&ve&&await pe.match(ve)===void 0&&(ae?await pe.put(ve,new Response(ae,{headers:X.headers})).catch(Ce=>{console.warn(`Unable to add response to browser cache: ${Ce}.`)}):await pe.put(ve,X,U.progress_callback)),(0,x.dispatchCallback)(U.progress_callback,{status:"done",name:D,file:L}),ae){if(!h.apis.IS_NODE_ENV&&te)throw new Error("Cannot return path in a browser environment.");return ae}if(X instanceof d)return X.filePath;const J=await(pe==null?void 0:pe.match(ve));if(J instanceof d)return J.filePath;if(J instanceof Response)return new Uint8Array(await J.arrayBuffer());if(typeof J=="string")return J;throw new Error("Unable to get model file path or buffer.")}async function T(D,L,W=!0,U={}){const te=await y(D,L,W,U,!1);return te===null?null:new TextDecoder("utf-8").decode(te)}async function C(D,L,W=!0,U={}){const te=await T(D,L,W,U);return te===null?{}:JSON.parse(te)}async function P(D,L){const W=D.headers.get("Content-Length");W===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let U=parseInt(W!=null?W:"0"),te=new Uint8Array(U),pe=0;const ne=D.body.getReader();async function ye(){const{done:ce,value:Me}=await ne.read();if(ce)return;const ke=pe+Me.length;if(ke>U){U=ke;const K=new Uint8Array(U);K.set(te),te=K}te.set(Me,pe),pe=ke;const ve=pe/U*100;return L({progress:ve,loaded:pe,total:U}),ye()}return await ye(),te}function O(...D){return D=D.map((L,W)=>(W&&(L=L.replace(new RegExp("^/"),"")),W!==D.length-1&&(L=L.replace(new RegExp("/$"),"")),L)),D.join("/")}},"./src/utils/image.js":(t,e,r)=>{r.r(e),r.d(e,{RawImage:()=>p,load_image:()=>w});var n=r("./src/utils/core.js"),a=r("./src/utils/hub.js"),h=r("./src/env.js"),x=r("./src/utils/tensor.js"),f=r("?2b25");let s,d,m;const o=h.apis.IS_BROWSER_ENV||h.apis.IS_WEBWORKER_ENV;if(o)s=(_,v)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(_,v)},m=self.createImageBitmap,d=self.ImageData;else if(f)m=async _=>{const y=(await _.metadata()).channels,{data:T,info:C}=await _.rotate().raw().toBuffer({resolveWithObject:!0}),P=new p(new Uint8ClampedArray(T),C.width,C.height,C.channels);return y!==void 0&&y!==C.channels&&P.convert(y),P};else throw new Error("Unable to load image processing library.");const l={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},u=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class p{constructor(v,y,T,C){this.data=v,this.width=y,this.height=T,this.channels=C}get size(){return[this.width,this.height]}static async read(v){if(v instanceof p)return v;if(typeof v=="string"||v instanceof URL)return await this.fromURL(v);if(v instanceof Blob)return await this.fromBlob(v);if(typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&v instanceof OffscreenCanvas)return this.fromCanvas(v);throw new Error(`Unsupported input type: ${typeof v}`)}static fromCanvas(v){if(!o)throw new Error("fromCanvas() is only supported in browser environments.");const T=v.getContext("2d").getImageData(0,0,v.width,v.height).data;return new p(T,v.width,v.height,4)}static async fromURL(v){const y=await(0,a.getFile)(v);if(y.status!==200)throw new Error(`Unable to read image from "${v}" (${y.status} ${y.statusText})`);const T=await y.blob();return this.fromBlob(T)}static async fromBlob(v){if(o){const y=await m(v),T=s(y.width,y.height).getContext("2d");return T.drawImage(y,0,0),new this(T.getImageData(0,0,y.width,y.height).data,y.width,y.height,4)}else{const y=f(await v.arrayBuffer());return await m(y)}}static fromTensor(v,y="CHW"){if(v.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${v.dims.length} dimensions.`);if(y==="CHW")v=v.transpose(1,2,0);else if(y!=="HWC")throw new Error(`Unsupported channel format: ${y}`);if(!(v.data instanceof Uint8ClampedArray||v.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${v.type}`);switch(v.dims[2]){case 1:case 2:case 3:case 4:return new p(v.data,v.dims[1],v.dims[0],v.dims[2]);default:throw new Error(`Unsupported number of channels: ${v.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const v=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let y=0,T=0;y<this.data.length;y+=this.channels){const C=this.data[y],P=this.data[y+1],O=this.data[y+2];v[T++]=Math.round(.2989*C+.587*P+.114*O)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(v,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const v=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let y=0,T=0;y<this.data.length;++y)v[T++]=this.data[y],v[T++]=this.data[y],v[T++]=this.data[y];break;case 4:for(let y=0,T=0;y<this.data.length;y+=4)v[T++]=this.data[y],v[T++]=this.data[y+1],v[T++]=this.data[y+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(v,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const v=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let y=0,T=0;y<this.data.length;++y)v[T++]=this.data[y],v[T++]=this.data[y],v[T++]=this.data[y],v[T++]=255;break;case 3:for(let y=0,T=0;y<this.data.length;y+=3)v[T++]=this.data[y],v[T++]=this.data[y+1],v[T++]=this.data[y+2],v[T++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(v,this.width,this.height,4)}putAlpha(v){if(v.width!==this.width||v.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${v.width}x${v.height}`);if(v.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${v.channels}`);const y=this.data,T=v.data,C=this.width*this.height;if(this.channels===3){const P=new Uint8ClampedArray(C*4);for(let O=0,D=0,L=0;O<C;++O)P[L++]=y[D++],P[L++]=y[D++],P[L++]=y[D++],P[L++]=T[O];return this._update(P,this.width,this.height,4)}else if(this.channels===4){for(let P=0;P<C;++P)y[4*P+3]=T[P];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(v,y,{resample:T=2}={}){var D;if(this.width===v&&this.height===y)return this;let C=(D=l[T])!=null?D:T;const P=(0,n.isNullishDimension)(v),O=(0,n.isNullishDimension)(y);if(P&&O)return this;if(P?v=y/this.height*this.width:O&&(y=v/this.width*this.height),o){const L=this.channels,W=this.toCanvas(),U=s(v,y).getContext("2d");return U.drawImage(W,0,0,v,y),new p(U.getImageData(0,0,v,y).data,v,y,4).convert(L)}else{let L=this.toSharp();switch(C){case"box":case"hamming":(C==="box"||C==="hamming")&&(console.warn(`Resampling method ${C} is not yet supported. Using bilinear instead.`),C="bilinear");case"nearest":case"bilinear":case"bicubic":L=L.affine([v/this.width,0,0,y/this.height],{interpolator:C});break;case"lanczos":L=L.resize({width:v,height:y,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${C} is not supported.`)}return await m(L)}}async pad([v,y,T,C]){if(v=Math.max(v,0),y=Math.max(y,0),T=Math.max(T,0),C=Math.max(C,0),v===0&&y===0&&T===0&&C===0)return this;if(o){const P=this.channels,O=this.toCanvas(),D=this.width+v+y,L=this.height+T+C,W=s(D,L).getContext("2d");return W.drawImage(O,0,0,this.width,this.height,v,T,this.width,this.height),new p(W.getImageData(0,0,D,L).data,D,L,4).convert(P)}else{const P=this.toSharp().extend({left:v,right:y,top:T,bottom:C});return await m(P)}}async crop([v,y,T,C]){if(v=Math.max(v,0),y=Math.max(y,0),T=Math.min(T,this.width-1),C=Math.min(C,this.height-1),v===0&&y===0&&T===this.width-1&&C===this.height-1)return this;const P=T-v+1,O=C-y+1;if(o){const D=this.channels,L=this.toCanvas(),W=s(P,O).getContext("2d");return W.drawImage(L,v,y,P,O,0,0,P,O),new p(W.getImageData(0,0,P,O).data,P,O,4).convert(D)}else{const D=this.toSharp().extract({left:v,top:y,width:P,height:O});return await m(D)}}async center_crop(v,y){if(this.width===v&&this.height===y)return this;const T=(this.width-v)/2,C=(this.height-y)/2;if(o){const P=this.channels,O=this.toCanvas(),D=s(v,y).getContext("2d");let L=0,W=0,U=0,te=0;return T>=0?L=T:U=-T,C>=0?W=C:te=-C,D.drawImage(O,L,W,v,y,U,te,v,y),new p(D.getImageData(0,0,v,y).data,v,y,4).convert(P)}else{let P=this.toSharp();if(T>=0&&C>=0)P=P.extract({left:Math.floor(T),top:Math.floor(C),width:v,height:y});else if(T<=0&&C<=0){const O=Math.floor(-C),D=Math.floor(-T);P=P.extend({top:O,left:D,right:v-this.width-D,bottom:y-this.height-O})}else{let O=[0,0],D=0;C<0?(O[0]=Math.floor(-C),O[1]=y-this.height-O[0]):D=Math.floor(C);let L=[0,0],W=0;T<0?(L[0]=Math.floor(-T),L[1]=v-this.width-L[0]):W=Math.floor(T),P=P.extend({top:O[0],bottom:O[1],left:L[0],right:L[1]}).extract({left:W,top:D,width:v,height:y})}return await m(P)}}async toBlob(v="image/png",y=1){if(!o)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:v,quality:y})}toTensor(v="CHW"){let y=new x.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(v!=="HWC")if(v==="CHW")y=y.permute(2,0,1);else throw new Error(`Unsupported channel format: ${v}`);return y}toCanvas(){if(!o)throw new Error("toCanvas() is only supported in browser environments.");const v=this.clone().rgba(),y=s(v.width,v.height),T=new d(v.data,v.width,v.height);return y.getContext("2d").putImageData(T,0,0),y}split(){const{data:v,width:y,height:T,channels:C}=this,P=v.constructor,O=v.length/C,D=Array.from({length:C},()=>new P(O));for(let L=0;L<O;++L){const W=C*L;for(let U=0;U<C;++U)D[U][L]=v[W+U]}return D.map(L=>new p(L,y,T,1))}_update(v,y,T,C=null){return this.data=v,this.width=y,this.height=T,C!==null&&(this.channels=C),this}clone(){return new p(this.data.slice(),this.width,this.height,this.channels)}convert(v){if(this.channels===v)return this;switch(v){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(v){var y;if(o){if(h.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const T=v.split(".").pop().toLowerCase(),C=(y=u.get(T))!=null?y:"image/png",P=await this.toBlob(C);(0,n.saveBlob)(v,P)}else{if(h.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(v);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(o)throw new Error("toSharp() is only supported in server-side environments.");return f(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const w=p.read.bind(p)},"./src/utils/maths.js":(t,e,r)=>{r.r(e),r.d(e,{FFT:()=>w,bankers_round:()=>y,cos_sim:()=>s,dot:()=>f,dynamic_time_warping:()=>T,interpolate_data:()=>n,log_softmax:()=>x,magnitude:()=>d,max:()=>o,medianFilter:()=>_,min:()=>m,permute_data:()=>a,round:()=>v,softmax:()=>h});function n(C,[P,O,D],[L,W],U="bilinear",te=!1){const pe=W/D,ne=L/O,ye=new C.constructor(L*W*P),ce=O*D,Me=L*W;for(let ke=0;ke<L;++ke)for(let ve=0;ve<W;++ve){const K=ke*W+ve,re=(ve+.5)/pe-.5,X=(ke+.5)/ne-.5;let N=Math.floor(re),ae=Math.floor(X);const J=Math.min(N+1,D-1),Y=Math.min(ae+1,O-1);N=Math.max(N,0),ae=Math.max(ae,0);const be=re-N,Ce=X-ae,Ue=(1-be)*(1-Ce),Ve=be*(1-Ce),Ie=(1-be)*Ce,he=be*Ce,Fe=ae*D,ee=Y*D,we=Fe+N,Re=Fe+J,Be=ee+N,Se=ee+J;for(let Ne=0;Ne<P;++Ne){const ze=Ne*ce;ye[Ne*Me+K]=Ue*C[ze+we]+Ve*C[ze+Re]+Ie*C[ze+Be]+he*C[ze+Se]}}return ye}function a(C,P,O){const D=new Array(O.length),L=new Array(O.length);for(let te=O.length-1,pe=1;te>=0;--te)L[te]=pe,D[te]=P[O[te]],pe*=D[te];const W=O.map((te,pe)=>L[O.indexOf(pe)]),U=new C.constructor(C.length);for(let te=0;te<C.length;++te){let pe=0;for(let ne=P.length-1,ye=te;ne>=0;--ne)pe+=ye%P[ne]*W[ne],ye=Math.floor(ye/P[ne]);U[pe]=C[te]}return[U,D]}function h(C){const P=o(C)[0],O=C.map(W=>Math.exp(W-P)),D=O.reduce((W,U)=>W+U,0);return O.map(W=>W/D)}function x(C){const P=o(C)[0];let O=0;for(let W=0;W<C.length;++W)O+=Math.exp(C[W]-P);const D=Math.log(O);return C.map(W=>W-P-D)}function f(C,P){let O=0;for(let D=0;D<C.length;++D)O+=C[D]*P[D];return O}function s(C,P){const O=f(C,P),D=d(C),L=d(P);return O/(D*L)}function d(C){return Math.sqrt(C.reduce((P,O)=>P+O*O,0))}function m(C){if(C.length===0)throw Error("Array must not be empty");let P=C[0],O=0;for(let D=1;D<C.length;++D)C[D]<P&&(P=C[D],O=D);return[P,O]}function o(C){if(C.length===0)throw Error("Array must not be empty");let P=C[0],O=0;for(let D=1;D<C.length;++D)C[D]>P&&(P=C[D],O=D);return[P,O]}function l(C){return C>0&&(C&C-1)===0}class u{constructor(P){if(this.size=P|0,this.size<=1||!l(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=P<<1,this.table=new Float64Array(this.size*2);for(let D=0;D<this.table.length;D+=2){const L=Math.PI*D/this.size;this.table[D]=Math.cos(L),this.table[D+1]=-Math.sin(L)}let O=0;for(let D=1;this.size>D;D<<=1)++O;this._width=O%2===0?O-1:O,this._bitrev=new Int32Array(1<<this._width);for(let D=0;D<this._bitrev.length;++D){this._bitrev[D]=0;for(let L=0;L<this._width;L+=2){const W=this._width-L-2;this._bitrev[D]|=(D>>>L&3)<<W}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(P,O){const D=O||new Array(P.length>>>1);for(let L=0;L<P.length;L+=2)D[L>>>1]=P[L];return D}toComplexArray(P,O){const D=O||this.createComplexArray();for(let L=0;L<D.length;L+=2)D[L]=P[L>>>1],D[L+1]=0;return D}transform(P,O){if(P===O)throw new Error("Input and output buffers must be different");this._transform4(P,O,1)}realTransform(P,O){if(P===O)throw new Error("Input and output buffers must be different");this._realTransform4(P,O,1)}inverseTransform(P,O){if(P===O)throw new Error("Input and output buffers must be different");this._transform4(P,O,-1);for(let D=0;D<P.length;++D)P[D]/=this.size}_transform4(P,O,D){const L=this._csize;let U=1<<this._width,te=L/U<<1,pe,ne;const ye=this._bitrev;if(te===4)for(pe=0,ne=0;pe<L;pe+=te,++ne){const Me=ye[ne];this._singleTransform2(O,P,pe,Me,U)}else for(pe=0,ne=0;pe<L;pe+=te,++ne){const Me=ye[ne];this._singleTransform4(O,P,pe,Me,U,D)}const ce=this.table;for(U>>=2;U>=2;U>>=2){te=L/U<<1;const Me=te>>>2;for(pe=0;pe<L;pe+=te){const ke=pe+Me-1;for(let ve=pe,K=0;ve<ke;ve+=2,K+=U){const re=ve,X=re+Me,N=X+Me,ae=N+Me,J=P[re],Y=P[re+1],be=P[X],Ce=P[X+1],Ue=P[N],Ve=P[N+1],Ie=P[ae],he=P[ae+1],Fe=ce[K],ee=D*ce[K+1],we=be*Fe-Ce*ee,Re=be*ee+Ce*Fe,Be=ce[2*K],Se=D*ce[2*K+1],Ne=Ue*Be-Ve*Se,ze=Ue*Se+Ve*Be,rt=ce[3*K],nt=D*ce[3*K+1],Ge=Ie*rt-he*nt,qe=Ie*nt+he*rt,gt=J+Ne,ct=Y+ze,wt=J-Ne,bt=Y-ze,Ct=we+Ge,It=Re+qe,jt=D*(we-Ge),Fr=D*(Re-qe);P[re]=gt+Ct,P[re+1]=ct+It,P[X]=wt+Fr,P[X+1]=bt-jt,P[N]=gt-Ct,P[N+1]=ct-It,P[ae]=wt-Fr,P[ae+1]=bt+jt}}}}_singleTransform2(P,O,D,L,W){const U=P[L],te=P[L+1],pe=P[L+W],ne=P[L+W+1];O[D]=U+pe,O[D+1]=te+ne,O[D+2]=U-pe,O[D+3]=te-ne}_singleTransform4(P,O,D,L,W,U){const te=W*2,pe=W*3,ne=P[L],ye=P[L+1],ce=P[L+W],Me=P[L+W+1],ke=P[L+te],ve=P[L+te+1],K=P[L+pe],re=P[L+pe+1],X=ne+ke,N=ye+ve,ae=ne-ke,J=ye-ve,Y=ce+K,be=Me+re,Ce=U*(ce-K),Ue=U*(Me-re);O[D]=X+Y,O[D+1]=N+be,O[D+2]=ae+Ue,O[D+3]=J-Ce,O[D+4]=X-Y,O[D+5]=N-be,O[D+6]=ae-Ue,O[D+7]=J+Ce}_realTransform4(P,O,D){const L=this._csize;let U=1<<this._width,te=L/U<<1,pe,ne;const ye=this._bitrev;if(te===4)for(pe=0,ne=0;pe<L;pe+=te,++ne){const ke=ye[ne];this._singleRealTransform2(O,P,pe,ke>>>1,U>>>1)}else for(pe=0,ne=0;pe<L;pe+=te,++ne){const ke=ye[ne];this._singleRealTransform4(O,P,pe,ke>>>1,U>>>1,D)}const ce=this.table;for(U>>=2;U>=2;U>>=2){te=L/U<<1;const ke=te>>>1,ve=ke>>>1,K=ve>>>1;for(pe=0;pe<L;pe+=te)for(let re=0,X=0;re<=K;re+=2,X+=U){const N=pe+re,ae=N+ve,J=ae+ve,Y=J+ve,be=P[N],Ce=P[N+1],Ue=P[ae],Ve=P[ae+1],Ie=P[J],he=P[J+1],Fe=P[Y],ee=P[Y+1],we=be,Re=Ce,Be=ce[X],Se=D*ce[X+1],Ne=Ue*Be-Ve*Se,ze=Ue*Se+Ve*Be,rt=ce[2*X],nt=D*ce[2*X+1],Ge=Ie*rt-he*nt,qe=Ie*nt+he*rt,gt=ce[3*X],ct=D*ce[3*X+1],wt=Fe*gt-ee*ct,bt=Fe*ct+ee*gt,Ct=we+Ge,It=Re+qe,jt=we-Ge,Fr=Re-qe,lr=Ne+wt,cr=ze+bt,gn=D*(Ne-wt),Jr=D*(ze-bt);if(P[N]=Ct+lr,P[N+1]=It+cr,P[ae]=jt+Jr,P[ae+1]=Fr-gn,re===0){P[J]=Ct-lr,P[J+1]=It-cr;continue}if(re===K)continue;const Zn=pe+ve-re,ai=pe+ke-re;P[Zn]=jt-D*Jr,P[Zn+1]=-Fr-D*gn,P[ai]=Ct-D*lr,P[ai+1]=-It+D*cr}}const Me=L>>>1;for(let ke=2;ke<Me;ke+=2)P[L-ke]=P[ke],P[L-ke+1]=-P[ke+1]}_singleRealTransform2(P,O,D,L,W){const U=P[L],te=P[L+W];O[D]=U+te,O[D+1]=0,O[D+2]=U-te,O[D+3]=0}_singleRealTransform4(P,O,D,L,W,U){const te=W*2,pe=W*3,ne=P[L],ye=P[L+W],ce=P[L+te],Me=P[L+pe],ke=ne+ce,ve=ne-ce,K=ye+Me,re=U*(ye-Me);O[D]=ke+K,O[D+1]=0,O[D+2]=ve,O[D+3]=-re,O[D+4]=ke-K,O[D+5]=0,O[D+6]=ve,O[D+7]=re}}class p{constructor(P){const O=2*(P-1),D=2*(2*P-1),L=2**Math.ceil(Math.log2(D));this.bufferSize=L,this._a=O;const W=new Float64Array(D),U=new Float64Array(L);this._chirpBuffer=new Float64Array(L),this._buffer1=new Float64Array(L),this._buffer2=new Float64Array(L),this._outBuffer1=new Float64Array(L),this._outBuffer2=new Float64Array(L);const te=-2*Math.PI/P,pe=Math.cos(te),ne=Math.sin(te);for(let ye=0;ye<D>>1;++ye){const ce=(ye+1-P)**2/2,Me=Math.sqrt(pe**2+ne**2)**ce,ke=ce*Math.atan2(ne,pe),ve=2*ye;W[ve]=Me*Math.cos(ke),W[ve+1]=Me*Math.sin(ke),U[ve]=W[ve],U[ve+1]=-W[ve+1]}this._slicedChirpBuffer=W.subarray(O,D),this._f=new u(L>>1),this._f.transform(this._chirpBuffer,U)}_transform(P,O,D){const L=this._buffer1,W=this._buffer2,U=this._outBuffer1,te=this._outBuffer2,pe=this._chirpBuffer,ne=this._slicedChirpBuffer,ye=this._a;if(D)for(let ce=0;ce<ne.length;ce+=2){const Me=ce+1,ke=ce>>1,ve=O[ke];L[ce]=ve*ne[ce],L[Me]=ve*ne[Me]}else for(let ce=0;ce<ne.length;ce+=2){const Me=ce+1;L[ce]=O[ce]*ne[ce]-O[Me]*ne[Me],L[Me]=O[ce]*ne[Me]+O[Me]*ne[ce]}this._f.transform(U,L);for(let ce=0;ce<pe.length;ce+=2){const Me=ce+1;W[ce]=U[ce]*pe[ce]-U[Me]*pe[Me],W[Me]=U[ce]*pe[Me]+U[Me]*pe[ce]}this._f.inverseTransform(te,W);for(let ce=0;ce<te.length;ce+=2){const Me=te[ce+ye],ke=te[ce+ye+1],ve=ne[ce],K=ne[ce+1];P[ce]=Me*ve-ke*K,P[ce+1]=Me*K+ke*ve}}transform(P,O){this._transform(P,O,!1)}realTransform(P,O){this._transform(P,O,!0)}}class w{constructor(P){this.fft_length=P,this.isPowerOfTwo=l(P),this.isPowerOfTwo?(this.fft=new u(P),this.outputBufferSize=2*P):(this.fft=new p(P),this.outputBufferSize=this.fft.bufferSize)}realTransform(P,O){this.fft.realTransform(P,O)}transform(P,O){this.fft.transform(P,O)}}function _(C,P){if(P%2===0||P<=0)throw new Error("Window size must be a positive odd number");const O=new C.constructor(C.length),D=new C.constructor(P),L=Math.floor(P/2);for(let W=0;W<C.length;++W){let U=0;for(let te=-L;te<=L;++te){let pe=W+te;pe<0?pe=Math.abs(pe):pe>=C.length&&(pe=2*(C.length-1)-pe),D[U++]=C[pe]}D.sort(),O[W]=D[L]}return O}function v(C,P){const O=Math.pow(10,P);return Math.round(C*O)/O}function y(C){const P=Math.round(C);return Math.abs(C)%1===.5?P%2===0?P:P-1:P}function T(C){const P=C.length,O=C[0].length,D=[P+1,O+1],L=Array.from({length:D[0]},()=>Array(D[1]).fill(1/0));L[0][0]=0;const W=Array.from({length:D[0]},()=>Array(D[1]).fill(-1));for(let ye=1;ye<D[1];++ye)for(let ce=1;ce<D[0];++ce){const Me=L[ce-1][ye-1],ke=L[ce-1][ye],ve=L[ce][ye-1];let K,re;Me<ke&&Me<ve?(K=Me,re=0):ke<Me&&ke<ve?(K=ke,re=1):(K=ve,re=2),L[ce][ye]=C[ce-1][ye-1]+K,W[ce][ye]=re}for(let ye=0;ye<D[1];++ye)W[0][ye]=2;for(let ye=0;ye<D[0];++ye)W[ye][0]=1;let U=P,te=O,pe=[],ne=[];for(;U>0||te>0;)switch(pe.push(U-1),ne.push(te-1),W[U][te]){case 0:--U,--te;break;case 1:--U;break;case 2:--te;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${U}, ${te}]. Please file a bug report.`)}return pe.reverse(),ne.reverse(),[pe,ne]}},"./src/utils/tensor.js":(t,e,r)=>{r.r(e),r.d(e,{DataTypeMap:()=>x,Tensor:()=>f,cat:()=>O,full:()=>ne,full_like:()=>ye,interpolate:()=>m,interpolate_4d:()=>o,layer_norm:()=>y,matmul:()=>l,mean:()=>U,mean_pooling:()=>v,ones:()=>ce,ones_like:()=>Me,permute:()=>d,quantize_embeddings:()=>re,rand:()=>K,rfft:()=>u,slice:()=>_,stack:()=>D,std_mean:()=>W,topk:()=>p,zeros:()=>ke,zeros_like:()=>ve});var n=r("./src/utils/maths.js"),a=r("./src/backends/onnx.js"),h=r("./src/ops/registry.js");const x=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class f{constructor(...N){$e(this,"ort_tensor");return(0,a.isONNXTensor)(N[0])?this.ort_tensor=N[0]:this.ort_tensor=new a.Tensor(N[0],N[1],N[2]),new Proxy(this,{get:(ae,J)=>{if(typeof J=="string"){let Y=Number(J);if(Number.isInteger(Y))return ae._getitem(Y)}return ae[J]},set:(ae,J,Y)=>ae[J]=Y})}get dims(){return this.ort_tensor.dims}set dims(N){this.ort_tensor.dims=N}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[N,...ae]=this.dims;if(ae.length>0){const J=ae.reduce((Y,be)=>Y*be);for(let Y=0;Y<N;++Y)yield this._subarray(Y,J,ae)}else yield*this.data}_getitem(N){const[ae,...J]=this.dims;if(N=P(N,ae),J.length>0){const Y=J.reduce((be,Ce)=>be*Ce);return this._subarray(N,Y,J)}else return new f(this.type,[this.data[N]],J)}indexOf(N){const ae=this.data;for(let J=0;J<ae.length;++J)if(ae[J]==N)return J;return-1}_subarray(N,ae,J){const Y=N*ae,be=(N+1)*ae,Ce="subarray"in this.data?this.data.subarray(Y,be):this.data.slice(Y,be);return new f(this.type,Ce,J)}item(){const N=this.data;if(N.length!==1)throw new Error(`a Tensor with ${N.length} elements cannot be converted to Scalar`);return N[0]}tolist(){return s(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const N=this.data;for(let ae=0;ae<N.length;++ae)N[ae]=1/(1+Math.exp(-N[ae]));return this}map(N){return this.clone().map_(N)}map_(N){const ae=this.data;for(let J=0;J<ae.length;++J)ae[J]=N(ae[J],J,ae);return this}mul(N){return this.clone().mul_(N)}mul_(N){const ae=this.data;for(let J=0;J<ae.length;++J)ae[J]*=N;return this}div(N){return this.clone().div_(N)}div_(N){const ae=this.data;for(let J=0;J<ae.length;++J)ae[J]/=N;return this}add(N){return this.clone().add_(N)}add_(N){const ae=this.data;for(let J=0;J<ae.length;++J)ae[J]+=N;return this}sub(N){return this.clone().sub_(N)}sub_(N){const ae=this.data;for(let J=0;J<ae.length;++J)ae[J]-=N;return this}clone(){return new f(this.type,this.data.slice(),this.dims.slice())}slice(...N){const ae=[],J=[];for(let Ie=0;Ie<this.dims.length;++Ie){let he=N[Ie];if(he==null)J.push([0,this.dims[Ie]]),ae.push(this.dims[Ie]);else if(typeof he=="number")he=P(he,this.dims[Ie],Ie),J.push([he,he+1]);else if(Array.isArray(he)&&he.length===2){let[Fe,ee]=he;if(Fe=Fe===null?0:P(Fe,this.dims[Ie],Ie,!1),ee=ee===null?this.dims[Ie]:P(ee,this.dims[Ie],Ie,!1),Fe>ee)throw new Error(`Invalid slice: ${he}`);const we=[Math.max(Fe,0),Math.min(ee,this.dims[Ie])];J.push(we),ae.push(we[1]-we[0])}else throw new Error(`Invalid slice: ${he}`)}const Y=J.map(([Ie,he])=>he-Ie),be=Y.reduce((Ie,he)=>Ie*he),Ce=this.data,Ue=new Ce.constructor(be),Ve=this.stride();for(let Ie=0;Ie<be;++Ie){let he=0;for(let Fe=Y.length-1,ee=Ie;Fe>=0;--Fe){const we=Y[Fe];he+=(ee%we+J[Fe][0])*Ve[Fe],ee=Math.floor(ee/we)}Ue[Ie]=Ce[he]}return new f(this.type,Ue,ae)}permute(...N){return d(this,N)}transpose(...N){return this.permute(...N)}sum(N=null,ae=!1){return this.norm(1,N,ae)}norm(N="fro",ae=null,J=!1){if(N==="fro")N=2;else if(typeof N=="string")throw Error(`Unsupported norm: ${N}`);const Y=this.data,be=(Ie,he)=>Ie+he**N;if(ae===null){const Ie=Y.reduce(be,0)**(1/N);return new f(this.type,[Ie],[])}const[Ce,Ue,Ve]=L(be,this,ae,J);if(N!==1)for(let Ie=0;Ie<Ue.length;++Ie)Ue[Ie]=Ue[Ie]**(1/N);return new f(Ce,Ue,Ve)}normalize_(N=2,ae=1){ae=P(ae,this.dims.length);const J=this.norm(N,ae,!0),Y=this.data,be=J.data;for(let Ce=0;Ce<Y.length;++Ce){let Ue=0;for(let Ve=this.dims.length-1,Ie=Ce,he=1;Ve>=0;--Ve){const Fe=this.dims[Ve];if(Ve!==ae){const ee=Ie%Fe;Ue+=ee*he,he*=this.dims[Ve]}Ie=Math.floor(Ie/Fe)}Y[Ce]/=be[Ue]}return this}normalize(N=2,ae=1){return this.clone().normalize_(N,ae)}stride(){return te(this.dims)}squeeze(N=null){return new f(this.type,this.data,T(this.dims,N))}squeeze_(N=null){return this.dims=T(this.dims,N),this}unsqueeze(N=null){return new f(this.type,this.data,C(this.dims,N))}unsqueeze_(N=null){return this.dims=C(this.dims,N),this}flatten_(N=0,ae=-1){ae=(ae+this.dims.length)%this.dims.length;let J=this.dims.slice(0,N),Y=this.dims.slice(N,ae+1),be=this.dims.slice(ae+1);return this.dims=[...J,Y.reduce((Ce,Ue)=>Ce*Ue,1),...be],this}flatten(N=0,ae=-1){return this.clone().flatten_(N,ae)}view(...N){let ae=-1;for(let Y=0;Y<N.length;++Y)if(N[Y]===-1){if(ae!==-1)throw new Error("Only one dimension can be inferred");ae=Y}const J=this.data;if(ae!==-1){const Y=N.reduce((be,Ce,Ue)=>Ue!==ae?be*Ce:be,1);N[ae]=J.length/Y}return new f(this.type,J,N)}neg_(){const N=this.data;for(let ae=0;ae<N.length;++ae)N[ae]=-N[ae];return this}neg(){return this.clone().neg_()}gt(N){const ae=new Uint8Array(this.data.length),J=this.data;for(let Y=0;Y<J.length;++Y)ae[Y]=J[Y]>N?1:0;return new f("bool",ae,this.dims)}lt(N){const ae=new Uint8Array(this.data.length),J=this.data;for(let Y=0;Y<J.length;++Y)ae[Y]=J[Y]<N?1:0;return new f("bool",ae,this.dims)}clamp_(N,ae){const J=this.data;for(let Y=0;Y<J.length;++Y)J[Y]=Math.min(Math.max(J[Y],N),ae);return this}clamp(N,ae){return this.clone().clamp_(N,ae)}round_(){const N=this.data;for(let ae=0;ae<N.length;++ae)N[ae]=Math.round(N[ae]);return this}round(){return this.clone().round_()}mean(N=null,ae=!1){return U(this,N,ae)}min(N=null,ae=!1){if(N===null){const Ce=(0,n.min)(this.data)[0];return new f(this.type,[Ce],[])}const[J,Y,be]=L((Ce,Ue)=>Math.min(Ce,Ue),this,N,ae,1/0);return new f(J,Y,be)}max(N=null,ae=!1){if(N===null){const Ce=(0,n.max)(this.data)[0];return new f(this.type,[Ce],[])}const[J,Y,be]=L((Ce,Ue)=>Math.max(Ce,Ue),this,N,ae,-1/0);return new f(J,Y,be)}argmin(N=null,ae=!1){if(N!==null)throw new Error("`dim !== null` not yet implemented.");const J=(0,n.min)(this.data)[1];return new f("int64",[BigInt(J)],[])}argmax(N=null,ae=!1){if(N!==null)throw new Error("`dim !== null` not yet implemented.");const J=(0,n.max)(this.data)[1];return new f("int64",[BigInt(J)],[])}to(N){if(this.type===N)return this;if(!x.hasOwnProperty(N))throw new Error(`Unsupported type: ${N}`);let ae;const J=["int64","uint64"].includes(this.type),Y=["int64","uint64"].includes(N);return J&&!Y?ae=Number:!J&&Y&&(ae=BigInt),new f(N,x[N].from(this.data,ae),this.dims)}}function s(X,N){const ae=X.length,J=N.reduce((be,Ce)=>be*Ce);if(ae!==J)throw Error(`cannot reshape array of size ${ae} into shape (${N})`);let Y=X;for(let be=N.length-1;be>=0;be--)Y=Y.reduce((Ce,Ue)=>{let Ve=Ce[Ce.length-1];return Ve.length<N[be]?Ve.push(Ue):Ce.push([Ue]),Ce},[[]]);return Y[0]}function d(X,N){const[ae,J]=(0,n.permute_data)(X.data,X.dims,N);return new f(X.type,ae,J)}function m(X,[N,ae],J="bilinear",Y=!1){var Ie;const be=(Ie=X.dims.at(-3))!=null?Ie:1,Ce=X.dims.at(-2),Ue=X.dims.at(-1);let Ve=(0,n.interpolate_data)(X.data,[be,Ce,Ue],[N,ae],J,Y);return new f(X.type,Ve,[be,N,ae])}async function o(X,{size:N=null,mode:ae="bilinear"}={}){if(X.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!N)throw new Error("`interpolate_4d` requires a `size` argument.");let J;if(N.length===2)J=[...X.dims.slice(0,2),...N];else if(N.length===3)J=[X.dims[0],...N];else if(N.length===4)J=N;else throw new Error("`size` must be of length 2, 3, or 4.");let Y;if(ae==="nearest")Y=await h.TensorOpRegistry.nearest_interpolate_4d;else if(ae==="bilinear")Y=await h.TensorOpRegistry.bilinear_interpolate_4d;else if(ae==="bicubic")Y=await h.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${ae}`);const be=new f("int64",new BigInt64Array(J.map(BigInt)),[J.length]);return await Y({x:X,s:be})}async function l(X,N){return await(await h.TensorOpRegistry.matmul)({a:X,b:N})}async function u(X,N){return await(await h.TensorOpRegistry.rfft)({x:X,a:N})}async function p(X,N){const ae=await h.TensorOpRegistry.top_k;return N==null?N=X.dims.at(-1):N=Math.min(N,X.dims.at(-1)),await ae({x:X,k:new f("int64",[BigInt(N)],[1])})}const w=X=>new f("int64",X,[X.length]);async function _(X,N,ae,J,Y){return await(await h.TensorOpRegistry.slice)({x:X,s:w(N),e:w(ae),a:w(J),t:w(Y!=null?Y:new Array(J.length).fill(1))})}function v(X,N){const ae=X.data,J=N.data,Y=[X.dims[0],X.dims[2]],be=new ae.constructor(Y[0]*Y[1]),[Ce,Ue,Ve]=X.dims;let Ie=0;for(let he=0;he<Ce;++he){const Fe=he*Ve*Ue;for(let ee=0;ee<Ve;++ee){let we=0,Re=0;const Be=he*Ue,Se=Fe+ee;for(let ze=0;ze<Ue;++ze){const rt=Number(J[Be+ze]);Re+=rt,we+=ae[Se+ze*Ve]*rt}const Ne=we/Re;be[Ie++]=Ne}}return new f(X.type,be,Y)}function y(X,N,{eps:ae=1e-5}={}){if(X.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[J,Y]=X.dims;if(N.length!==1&&N[0]!==Y)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[be,Ce]=W(X,1,0,!0),Ue=be.data,Ve=Ce.data,Ie=X.data,he=new Ie.constructor(Ie.length);for(let Fe=0;Fe<J;++Fe){const ee=Fe*Y;for(let we=0;we<Y;++we){const Re=ee+we;he[Re]=(Ie[Re]-Ve[Fe])/(Ue[Fe]+ae)}}return new f(X.type,he,X.dims)}function T(X,N){return X=X.slice(),N===null?X=X.filter(ae=>ae!==1):typeof N=="number"?X[N]===1&&X.splice(N,1):Array.isArray(N)&&(X=X.filter((ae,J)=>ae!==1||!N.includes(J))),X}function C(X,N){return N=P(N,X.length+1),X=X.slice(),X.splice(N,0,1),X}function P(X,N,ae=null,J=!0){if(X<-N||X>=N){if(J)throw new Error(`IndexError: index ${X} is out of bounds for dimension${ae===null?"":" "+ae} with size ${N}`);return X<-N?0:N}return X<0&&(X=(X%N+N)%N),X}function O(X,N=0){N=P(N,X[0].dims.length);const ae=X[0].dims.slice();ae[N]=X.reduce((Ce,Ue)=>Ce+Ue.dims[N],0);const J=ae.reduce((Ce,Ue)=>Ce*Ue,1),Y=new X[0].data.constructor(J),be=X[0].type;if(N===0){let Ce=0;for(const Ue of X){const Ve=Ue.data;Y.set(Ve,Ce),Ce+=Ve.length}}else{let Ce=0;for(let Ue=0;Ue<X.length;++Ue){const{data:Ve,dims:Ie}=X[Ue];for(let he=0;he<Ve.length;++he){let Fe=0;for(let ee=Ie.length-1,we=he,Re=1;ee>=0;--ee){const Be=Ie[ee];let Se=we%Be;ee===N&&(Se+=Ce),Fe+=Se*Re,Re*=ae[ee],we=Math.floor(we/Be)}Y[Fe]=Ve[he]}Ce+=Ie[N]}}return new f(be,Y,ae)}function D(X,N=0){return O(X.map(ae=>ae.unsqueeze(N)),N)}function L(X,N,ae=null,J=!1,Y=null){const be=N.data,Ce=N.dims;ae=P(ae,Ce.length);const Ue=Ce.slice();Ue[ae]=1;const Ve=new be.constructor(be.length/Ce[ae]);Y!==null&&Ve.fill(Y);for(let Ie=0;Ie<be.length;++Ie){let he=0;for(let Fe=Ce.length-1,ee=Ie,we=1;Fe>=0;--Fe){const Re=Ce[Fe];if(Fe!==ae){const Be=ee%Re;he+=Be*we,we*=Ue[Fe]}ee=Math.floor(ee/Re)}Ve[he]=X(Ve[he],be[Ie],Ie,he)}return J||Ue.splice(ae,1),[N.type,Ve,Ue]}function W(X,N=null,ae=1,J=!1){const Y=X.data,be=X.dims;if(N===null){const we=Y.reduce((Ne,ze)=>Ne+ze,0)/Y.length,Re=Math.sqrt(Y.reduce((Ne,ze)=>Ne+(ze-we)**2,0)/(Y.length-ae)),Be=new f(X.type,[we],[]);return[new f(X.type,[Re],[]),Be]}N=P(N,be.length);const Ce=U(X,N,J),Ue=Ce.data,[Ve,Ie,he]=L((ee,we,Re,Be)=>ee+(we-Ue[Be])**2,X,N,J);for(let ee=0;ee<Ie.length;++ee)Ie[ee]=Math.sqrt(Ie[ee]/(be[N]-ae));return[new f(Ve,Ie,he),Ce]}function U(X,N=null,ae=!1){const J=X.dims,Y=X.data;if(N===null){const Ve=Y.reduce((Ie,he)=>Ie+he,0);return new f(X.type,[Ve/Y.length],[])}N=P(N,J.length);const[be,Ce,Ue]=L((Ve,Ie)=>Ve+Ie,X,N,ae);if(J[N]!==1)for(let Ve=0;Ve<Ce.length;++Ve)Ce[Ve]/=J[N];return new f(be,Ce,Ue)}function te(X){const N=new Array(X.length);for(let ae=X.length-1,J=1;ae>=0;--ae)N[ae]=J,J*=X[ae];return N}function pe(X,N,ae,J){const Y=X.reduce((be,Ce)=>be*Ce,1);return new f(ae,new J(Y).fill(N),X)}function ne(X,N){let ae,J;if(typeof N=="number")ae="float32",J=Float32Array;else if(typeof N=="bigint")ae="int64",J=BigInt64Array;else if(typeof N=="boolean")ae="bool",J=Uint8Array;else throw new Error(`Unsupported data type: ${typeof N}`);return pe(X,N,ae,J)}function ye(X,N){return ne(X.dims,N)}function ce(X){return pe(X,1n,"int64",BigInt64Array)}function Me(X){return ce(X.dims)}function ke(X){return pe(X,0n,"int64",BigInt64Array)}function ve(X){return ke(X.dims)}function K(X){const N=X.reduce((ae,J)=>ae*J,1);return new f("float32",Float32Array.from({length:N},()=>Math.random()),X)}function re(X,N){if(X.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(X.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(N))throw new Error("The precision must be either 'binary' or 'ubinary'");const ae=N==="binary",J=ae?"int8":"uint8",Y=ae?Int8Array:Uint8Array,be=X.data,Ce=new Y(be.length/8);for(let Ue=0;Ue<be.length;++Ue){const Ve=be[Ue]>0?1:0,Ie=Math.floor(Ue/8),he=Ue%8;Ce[Ie]|=Ve<<7-he,ae&&he===0&&(Ce[Ie]-=128)}return new f(J,Ce,[X.dims[0],X.dims[1]/8])}},"./src/utils/video.js":(t,e,r)=>{r.r(e),r.d(e,{RawVideo:()=>x,RawVideoFrame:()=>h,load_video:()=>f});var n=r("./src/utils/image.js"),a=r("./src/env.js");class h{constructor(d,m){this.image=d,this.timestamp=m}}class x{constructor(d,m){d.length>0&&d[0]instanceof n.RawImage&&(d=d.map((o,l)=>new h(o,(l+1)/(d.length+1)*m))),this.frames=d,this.duration=m}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function f(s,{num_frames:d=null,fps:m=null}={}){if(!a.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(d==null&&m==null)throw new Error("Either num_frames or fps must be provided.");const o=[],l=document.createElement("video");if(l.crossOrigin="anonymous",l.muted=!0,typeof s=="string")l.src=s;else if(s instanceof Blob)l.src=URL.createObjectURL(s);else if(s instanceof HTMLVideoElement)l.src=s.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(T=>l.onloadedmetadata=T),l.seekable.start(0)===l.seekable.end(0)){const C=await(await fetch(l.src)).blob();l.src=URL.createObjectURL(C),await new Promise(P=>l.onloadedmetadata=P)}const u=l.duration;let p,w;d!=null?(p=d,w=d===1?0:u/(d-1)):(w=1/m,p=Math.floor(u/w));let _=[];for(let T=0;T<p;++T)_.push(d===1?u/2:T*w);const v=document.createElement("canvas");v.width=l.videoWidth,v.height=l.videoHeight;const y=v.getContext("2d",{willReadFrequently:!0});for(const T of _){l.currentTime=T,await new Promise(D=>{l.onseeked=D}),y.drawImage(l,0,0,v.width,v.height);const C=y.getImageData(0,0,v.width,v.height),P=new n.RawImage(C.data,v.width,v.height,4),O=new h(P,T);o.push(O)}return l.remove(),new x(o,u)}}},_b={};function fn(t){var e=_b[t];if(e!==void 0)return e.exports;var r=_b[t]={exports:{}};return KA[t](r,r.exports,fn),r.exports}(()=>{var t=Object.getPrototypeOf?r=>Object.getPrototypeOf(r):r=>r.__proto__,e;fn.t=function(r,n){if(n&1&&(r=this(r)),n&8||typeof r=="object"&&r&&(n&4&&r.__esModule||n&16&&typeof r.then=="function"))return r;var a=Object.create(null);fn.r(a);var h={};e=e||[null,t({}),t([]),t(t)];for(var x=n&2&&r;typeof x=="object"&&!~e.indexOf(x);x=t(x))Object.getOwnPropertyNames(x).forEach(f=>h[f]=()=>r[f]);return h.default=()=>r,fn.d(a,h),a}})();fn.d=(t,e)=>{for(var r in e)fn.o(e,r)&&!fn.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})};fn.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);fn.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var F={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/fn.r(F),fn.d(F,{ASTFeatureExtractor:()=>o.ASTFeatureExtractor,ASTForAudioClassification:()=>r.ASTForAudioClassification,ASTModel:()=>r.ASTModel,ASTPreTrainedModel:()=>r.ASTPreTrainedModel,AlbertForMaskedLM:()=>r.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>r.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>r.AlbertForSequenceClassification,AlbertModel:()=>r.AlbertModel,AlbertPreTrainedModel:()=>r.AlbertPreTrainedModel,AlbertTokenizer:()=>n.AlbertTokenizer,AudioClassificationPipeline:()=>e.AudioClassificationPipeline,AutoConfig:()=>a.AutoConfig,AutoFeatureExtractor:()=>l.AutoFeatureExtractor,AutoImageProcessor:()=>w.AutoImageProcessor,AutoModel:()=>r.AutoModel,AutoModelForAudioClassification:()=>r.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>r.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>r.AutoModelForAudioTextToText,AutoModelForCTC:()=>r.AutoModelForCTC,AutoModelForCausalLM:()=>r.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>r.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>r.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>r.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>r.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>r.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>r.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>r.AutoModelForImageTextToText,AutoModelForImageToImage:()=>r.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>r.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>r.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>r.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>r.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>r.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>r.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>r.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>r.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>r.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>r.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>r.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>r.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>r.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>r.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>r.AutoModelForVision2Seq,AutoModelForXVector:()=>r.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>r.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>y.AutoProcessor,AutoTokenizer:()=>n.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>e.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>e.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>r.BartForConditionalGeneration,BartForSequenceClassification:()=>r.BartForSequenceClassification,BartModel:()=>r.BartModel,BartPretrainedModel:()=>r.BartPretrainedModel,BartTokenizer:()=>n.BartTokenizer,BaseModelOutput:()=>r.BaseModelOutput,BaseStreamer:()=>T.BaseStreamer,BeitFeatureExtractor:()=>p.BeitFeatureExtractor,BeitForImageClassification:()=>r.BeitForImageClassification,BeitModel:()=>r.BeitModel,BeitPreTrainedModel:()=>r.BeitPreTrainedModel,BertForMaskedLM:()=>r.BertForMaskedLM,BertForQuestionAnswering:()=>r.BertForQuestionAnswering,BertForSequenceClassification:()=>r.BertForSequenceClassification,BertForTokenClassification:()=>r.BertForTokenClassification,BertModel:()=>r.BertModel,BertPreTrainedModel:()=>r.BertPreTrainedModel,BertTokenizer:()=>n.BertTokenizer,BitImageProcessor:()=>p.BitImageProcessor,BlenderbotForConditionalGeneration:()=>r.BlenderbotForConditionalGeneration,BlenderbotModel:()=>r.BlenderbotModel,BlenderbotPreTrainedModel:()=>r.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>r.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>r.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>r.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>n.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>n.BlenderbotTokenizer,BloomForCausalLM:()=>r.BloomForCausalLM,BloomModel:()=>r.BloomModel,BloomPreTrainedModel:()=>r.BloomPreTrainedModel,BloomTokenizer:()=>n.BloomTokenizer,CLIPFeatureExtractor:()=>p.CLIPFeatureExtractor,CLIPImageProcessor:()=>p.CLIPImageProcessor,CLIPModel:()=>r.CLIPModel,CLIPPreTrainedModel:()=>r.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>r.CLIPSegForImageSegmentation,CLIPSegModel:()=>r.CLIPSegModel,CLIPSegPreTrainedModel:()=>r.CLIPSegPreTrainedModel,CLIPTextModel:()=>r.CLIPTextModel,CLIPTextModelWithProjection:()=>r.CLIPTextModelWithProjection,CLIPTokenizer:()=>n.CLIPTokenizer,CLIPVisionModel:()=>r.CLIPVisionModel,CLIPVisionModelWithProjection:()=>r.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>r.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>r.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>r.CamembertForSequenceClassification,CamembertForTokenClassification:()=>r.CamembertForTokenClassification,CamembertModel:()=>r.CamembertModel,CamembertPreTrainedModel:()=>r.CamembertPreTrainedModel,CamembertTokenizer:()=>n.CamembertTokenizer,CausalLMOutput:()=>r.CausalLMOutput,CausalLMOutputWithPast:()=>r.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>p.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>r.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>r.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>r.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>o.ClapFeatureExtractor,ClapModel:()=>r.ClapModel,ClapPreTrainedModel:()=>r.ClapPreTrainedModel,ClapTextModelWithProjection:()=>r.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>P.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>r.CodeGenForCausalLM,CodeGenModel:()=>r.CodeGenModel,CodeGenPreTrainedModel:()=>r.CodeGenPreTrainedModel,CodeGenTokenizer:()=>n.CodeGenTokenizer,CodeLlamaTokenizer:()=>n.CodeLlamaTokenizer,CohereForCausalLM:()=>r.CohereForCausalLM,CohereModel:()=>r.CohereModel,CoherePreTrainedModel:()=>r.CoherePreTrainedModel,CohereTokenizer:()=>n.CohereTokenizer,ConvBertForMaskedLM:()=>r.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>r.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>r.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>r.ConvBertForTokenClassification,ConvBertModel:()=>r.ConvBertModel,ConvBertPreTrainedModel:()=>r.ConvBertPreTrainedModel,ConvBertTokenizer:()=>n.ConvBertTokenizer,ConvNextFeatureExtractor:()=>p.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>r.ConvNextForImageClassification,ConvNextImageProcessor:()=>p.ConvNextImageProcessor,ConvNextModel:()=>r.ConvNextModel,ConvNextPreTrainedModel:()=>r.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>r.ConvNextV2ForImageClassification,ConvNextV2Model:()=>r.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>r.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>r.DFineForObjectDetection,DFineModel:()=>r.DFineModel,DFinePreTrainedModel:()=>r.DFinePreTrainedModel,DPTFeatureExtractor:()=>p.DPTFeatureExtractor,DPTForDepthEstimation:()=>r.DPTForDepthEstimation,DPTImageProcessor:()=>p.DPTImageProcessor,DPTModel:()=>r.DPTModel,DPTPreTrainedModel:()=>r.DPTPreTrainedModel,DacDecoderModel:()=>r.DacDecoderModel,DacDecoderOutput:()=>r.DacDecoderOutput,DacEncoderModel:()=>r.DacEncoderModel,DacEncoderOutput:()=>r.DacEncoderOutput,DacFeatureExtractor:()=>o.DacFeatureExtractor,DacModel:()=>r.DacModel,DacPreTrainedModel:()=>r.DacPreTrainedModel,DataTypeMap:()=>s.DataTypeMap,DebertaForMaskedLM:()=>r.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>r.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>r.DebertaForSequenceClassification,DebertaForTokenClassification:()=>r.DebertaForTokenClassification,DebertaModel:()=>r.DebertaModel,DebertaPreTrainedModel:()=>r.DebertaPreTrainedModel,DebertaTokenizer:()=>n.DebertaTokenizer,DebertaV2ForMaskedLM:()=>r.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>r.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>r.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>r.DebertaV2ForTokenClassification,DebertaV2Model:()=>r.DebertaV2Model,DebertaV2PreTrainedModel:()=>r.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>n.DebertaV2Tokenizer,DecisionTransformerModel:()=>r.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>r.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>p.DeiTFeatureExtractor,DeiTForImageClassification:()=>r.DeiTForImageClassification,DeiTImageProcessor:()=>p.DeiTImageProcessor,DeiTModel:()=>r.DeiTModel,DeiTPreTrainedModel:()=>r.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>r.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>r.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>e.DepthEstimationPipeline,DepthProForDepthEstimation:()=>r.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>r.DepthProPreTrainedModel,DetrFeatureExtractor:()=>p.DetrFeatureExtractor,DetrForObjectDetection:()=>r.DetrForObjectDetection,DetrForSegmentation:()=>r.DetrForSegmentation,DetrImageProcessor:()=>p.DetrImageProcessor,DetrModel:()=>r.DetrModel,DetrObjectDetectionOutput:()=>r.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>r.DetrPreTrainedModel,DetrSegmentationOutput:()=>r.DetrSegmentationOutput,Dinov2ForImageClassification:()=>r.Dinov2ForImageClassification,Dinov2Model:()=>r.Dinov2Model,Dinov2PreTrainedModel:()=>r.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>r.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>r.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>r.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>r.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>r.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>r.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>r.DistilBertForTokenClassification,DistilBertModel:()=>r.DistilBertModel,DistilBertPreTrainedModel:()=>r.DistilBertPreTrainedModel,DistilBertTokenizer:()=>n.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>e.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>p.DonutFeatureExtractor,DonutImageProcessor:()=>p.DonutImageProcessor,DonutSwinModel:()=>r.DonutSwinModel,DonutSwinPreTrainedModel:()=>r.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>r.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>p.EfficientNetImageProcessor,EfficientNetModel:()=>r.EfficientNetModel,EfficientNetPreTrainedModel:()=>r.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>r.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>r.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>r.ElectraForSequenceClassification,ElectraForTokenClassification:()=>r.ElectraForTokenClassification,ElectraModel:()=>r.ElectraModel,ElectraPreTrainedModel:()=>r.ElectraPreTrainedModel,ElectraTokenizer:()=>n.ElectraTokenizer,EncodecFeatureExtractor:()=>o.EncodecFeatureExtractor,EosTokenCriteria:()=>C.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>r.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>r.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>r.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>n.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>r.EsmForMaskedLM,EsmForSequenceClassification:()=>r.EsmForSequenceClassification,EsmForTokenClassification:()=>r.EsmForTokenClassification,EsmModel:()=>r.EsmModel,EsmPreTrainedModel:()=>r.EsmPreTrainedModel,EsmTokenizer:()=>n.EsmTokenizer,ExaoneForCausalLM:()=>r.ExaoneForCausalLM,ExaoneModel:()=>r.ExaoneModel,ExaonePreTrainedModel:()=>r.ExaonePreTrainedModel,FFT:()=>d.FFT,FalconForCausalLM:()=>r.FalconForCausalLM,FalconModel:()=>r.FalconModel,FalconPreTrainedModel:()=>r.FalconPreTrainedModel,FalconTokenizer:()=>n.FalconTokenizer,FastViTForImageClassification:()=>r.FastViTForImageClassification,FastViTModel:()=>r.FastViTModel,FastViTPreTrainedModel:()=>r.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>e.FeatureExtractionPipeline,FeatureExtractor:()=>m.FeatureExtractor,FillMaskPipeline:()=>e.FillMaskPipeline,Florence2ForConditionalGeneration:()=>r.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>r.Florence2PreTrainedModel,Florence2Processor:()=>v.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>P.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>P.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>p.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>r.GLPNForDepthEstimation,GLPNModel:()=>r.GLPNModel,GLPNPreTrainedModel:()=>r.GLPNPreTrainedModel,GPT2LMHeadModel:()=>r.GPT2LMHeadModel,GPT2Model:()=>r.GPT2Model,GPT2PreTrainedModel:()=>r.GPT2PreTrainedModel,GPT2Tokenizer:()=>n.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>r.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>r.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>r.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>r.GPTJForCausalLM,GPTJModel:()=>r.GPTJModel,GPTJPreTrainedModel:()=>r.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>r.GPTNeoForCausalLM,GPTNeoModel:()=>r.GPTNeoModel,GPTNeoPreTrainedModel:()=>r.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>r.GPTNeoXForCausalLM,GPTNeoXModel:()=>r.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>r.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>n.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>r.Gemma2ForCausalLM,Gemma2Model:()=>r.Gemma2Model,Gemma2PreTrainedModel:()=>r.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>r.Gemma3ForCausalLM,Gemma3Model:()=>r.Gemma3Model,Gemma3PreTrainedModel:()=>r.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>o.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>r.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>r.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>v.Gemma3nProcessor,GemmaForCausalLM:()=>r.GemmaForCausalLM,GemmaModel:()=>r.GemmaModel,GemmaPreTrainedModel:()=>r.GemmaPreTrainedModel,GemmaTokenizer:()=>n.GemmaTokenizer,GlmForCausalLM:()=>r.GlmForCausalLM,GlmModel:()=>r.GlmModel,GlmPreTrainedModel:()=>r.GlmPreTrainedModel,GraniteForCausalLM:()=>r.GraniteForCausalLM,GraniteModel:()=>r.GraniteModel,GranitePreTrainedModel:()=>r.GranitePreTrainedModel,Grok1Tokenizer:()=>n.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>r.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>p.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>r.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>v.GroundingDinoProcessor,GroupViTModel:()=>r.GroupViTModel,GroupViTPreTrainedModel:()=>r.GroupViTPreTrainedModel,HeliumForCausalLM:()=>r.HeliumForCausalLM,HeliumModel:()=>r.HeliumModel,HeliumPreTrainedModel:()=>r.HeliumPreTrainedModel,HerbertTokenizer:()=>n.HerbertTokenizer,HieraForImageClassification:()=>r.HieraForImageClassification,HieraModel:()=>r.HieraModel,HieraPreTrainedModel:()=>r.HieraPreTrainedModel,HubertForCTC:()=>r.HubertForCTC,HubertForSequenceClassification:()=>r.HubertForSequenceClassification,HubertModel:()=>r.HubertModel,HubertPreTrainedModel:()=>r.HubertPreTrainedModel,IJepaForImageClassification:()=>r.IJepaForImageClassification,IJepaModel:()=>r.IJepaModel,IJepaPreTrainedModel:()=>r.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>r.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>p.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>r.Idefics3PreTrainedModel,Idefics3Processor:()=>v.Idefics3Processor,ImageClassificationPipeline:()=>e.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>e.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>o.ImageFeatureExtractor,ImageMattingOutput:()=>r.ImageMattingOutput,ImageProcessor:()=>u.ImageProcessor,ImageSegmentationPipeline:()=>e.ImageSegmentationPipeline,ImageToImagePipeline:()=>e.ImageToImagePipeline,ImageToTextPipeline:()=>e.ImageToTextPipeline,InterruptableStoppingCriteria:()=>C.InterruptableStoppingCriteria,JAISLMHeadModel:()=>r.JAISLMHeadModel,JAISModel:()=>r.JAISModel,JAISPreTrainedModel:()=>r.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>p.JinaCLIPImageProcessor,JinaCLIPModel:()=>r.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>r.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>v.JinaCLIPProcessor,JinaCLIPTextModel:()=>r.JinaCLIPTextModel,JinaCLIPVisionModel:()=>r.JinaCLIPVisionModel,LiteWhisperForConditionalGeneration:()=>r.LiteWhisperForConditionalGeneration,LlamaForCausalLM:()=>r.LlamaForCausalLM,LlamaModel:()=>r.LlamaModel,LlamaPreTrainedModel:()=>r.LlamaPreTrainedModel,LlamaTokenizer:()=>n.LlamaTokenizer,LlavaForConditionalGeneration:()=>r.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>r.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>p.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>r.LlavaPreTrainedModel,LlavaProcessor:()=>v.LlavaProcessor,LlavaQwen2ForCausalLM:()=>r.LlavaQwen2ForCausalLM,LogitsProcessor:()=>P.LogitsProcessor,LogitsProcessorList:()=>P.LogitsProcessorList,LogitsWarper:()=>P.LogitsWarper,LongT5ForConditionalGeneration:()=>r.LongT5ForConditionalGeneration,LongT5Model:()=>r.LongT5Model,LongT5PreTrainedModel:()=>r.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>r.M2M100ForConditionalGeneration,M2M100Model:()=>r.M2M100Model,M2M100PreTrainedModel:()=>r.M2M100PreTrainedModel,M2M100Tokenizer:()=>n.M2M100Tokenizer,MBart50Tokenizer:()=>n.MBart50Tokenizer,MBartForCausalLM:()=>r.MBartForCausalLM,MBartForConditionalGeneration:()=>r.MBartForConditionalGeneration,MBartForSequenceClassification:()=>r.MBartForSequenceClassification,MBartModel:()=>r.MBartModel,MBartPreTrainedModel:()=>r.MBartPreTrainedModel,MBartTokenizer:()=>n.MBartTokenizer,MPNetForMaskedLM:()=>r.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>r.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>r.MPNetForSequenceClassification,MPNetForTokenClassification:()=>r.MPNetForTokenClassification,MPNetModel:()=>r.MPNetModel,MPNetPreTrainedModel:()=>r.MPNetPreTrainedModel,MPNetTokenizer:()=>n.MPNetTokenizer,MT5ForConditionalGeneration:()=>r.MT5ForConditionalGeneration,MT5Model:()=>r.MT5Model,MT5PreTrainedModel:()=>r.MT5PreTrainedModel,MarianMTModel:()=>r.MarianMTModel,MarianModel:()=>r.MarianModel,MarianPreTrainedModel:()=>r.MarianPreTrainedModel,MarianTokenizer:()=>n.MarianTokenizer,Mask2FormerImageProcessor:()=>p.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>p.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>r.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>p.MaskFormerImageProcessor,MaskFormerModel:()=>r.MaskFormerModel,MaskFormerPreTrainedModel:()=>r.MaskFormerPreTrainedModel,MaskedLMOutput:()=>r.MaskedLMOutput,MaxLengthCriteria:()=>C.MaxLengthCriteria,Metric3DForDepthEstimation:()=>r.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>r.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>r.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>r.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>r.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>r.MgpstrModelOutput,MgpstrPreTrainedModel:()=>r.MgpstrPreTrainedModel,MgpstrProcessor:()=>v.MgpstrProcessor,MgpstrTokenizer:()=>n.MgpstrTokenizer,MimiDecoderModel:()=>r.MimiDecoderModel,MimiDecoderOutput:()=>r.MimiDecoderOutput,MimiEncoderModel:()=>r.MimiEncoderModel,MimiEncoderOutput:()=>r.MimiEncoderOutput,MimiModel:()=>r.MimiModel,MimiPreTrainedModel:()=>r.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>P.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>P.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>r.MistralForCausalLM,MistralModel:()=>r.MistralModel,MistralPreTrainedModel:()=>r.MistralPreTrainedModel,MobileBertForMaskedLM:()=>r.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>r.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>r.MobileBertForSequenceClassification,MobileBertModel:()=>r.MobileBertModel,MobileBertPreTrainedModel:()=>r.MobileBertPreTrainedModel,MobileBertTokenizer:()=>n.MobileBertTokenizer,MobileLLMForCausalLM:()=>r.MobileLLMForCausalLM,MobileLLMModel:()=>r.MobileLLMModel,MobileLLMPreTrainedModel:()=>r.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>p.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>r.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>r.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>p.MobileNetV1ImageProcessor,MobileNetV1Model:()=>r.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>r.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>p.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>r.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>r.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>p.MobileNetV2ImageProcessor,MobileNetV2Model:()=>r.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>r.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>p.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>r.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>r.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>p.MobileNetV3ImageProcessor,MobileNetV3Model:()=>r.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>r.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>p.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>r.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>r.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>p.MobileNetV4ImageProcessor,MobileNetV4Model:()=>r.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>r.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>p.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>r.MobileViTForImageClassification,MobileViTImageProcessor:()=>p.MobileViTImageProcessor,MobileViTModel:()=>r.MobileViTModel,MobileViTPreTrainedModel:()=>r.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>r.MobileViTV2ForImageClassification,MobileViTV2Model:()=>r.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>r.MobileViTV2PreTrainedModel,ModelOutput:()=>r.ModelOutput,ModernBertForMaskedLM:()=>r.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>r.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>r.ModernBertForTokenClassification,ModernBertModel:()=>r.ModernBertModel,ModernBertPreTrainedModel:()=>r.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>r.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>o.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>r.MoonshineForConditionalGeneration,MoonshineModel:()=>r.MoonshineModel,MoonshinePreTrainedModel:()=>r.MoonshinePreTrainedModel,MoonshineProcessor:()=>v.MoonshineProcessor,MptForCausalLM:()=>r.MptForCausalLM,MptModel:()=>r.MptModel,MptPreTrainedModel:()=>r.MptPreTrainedModel,MultiModalityCausalLM:()=>r.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>r.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>r.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>r.MusicgenForConditionalGeneration,MusicgenModel:()=>r.MusicgenModel,MusicgenPreTrainedModel:()=>r.MusicgenPreTrainedModel,NeoBertForMaskedLM:()=>r.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>r.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>r.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>r.NeoBertForTokenClassification,NeoBertModel:()=>r.NeoBertModel,NeoBertPreTrainedModel:()=>r.NeoBertPreTrainedModel,NllbTokenizer:()=>n.NllbTokenizer,NoBadWordsLogitsProcessor:()=>P.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>P.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>r.NomicBertModel,NomicBertPreTrainedModel:()=>r.NomicBertPreTrainedModel,NougatImageProcessor:()=>p.NougatImageProcessor,NougatTokenizer:()=>n.NougatTokenizer,OPTForCausalLM:()=>r.OPTForCausalLM,OPTModel:()=>r.OPTModel,OPTPreTrainedModel:()=>r.OPTPreTrainedModel,ObjectDetectionPipeline:()=>e.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>r.Olmo2ForCausalLM,Olmo2Model:()=>r.Olmo2Model,Olmo2PreTrainedModel:()=>r.Olmo2PreTrainedModel,OlmoForCausalLM:()=>r.OlmoForCausalLM,OlmoModel:()=>r.OlmoModel,OlmoPreTrainedModel:()=>r.OlmoPreTrainedModel,OpenELMForCausalLM:()=>r.OpenELMForCausalLM,OpenELMModel:()=>r.OpenELMModel,OpenELMPreTrainedModel:()=>r.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>p.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>r.OwlViTForObjectDetection,OwlViTImageProcessor:()=>p.OwlViTImageProcessor,OwlViTModel:()=>r.OwlViTModel,OwlViTPreTrainedModel:()=>r.OwlViTPreTrainedModel,OwlViTProcessor:()=>v.OwlViTProcessor,Owlv2ForObjectDetection:()=>r.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>p.Owlv2ImageProcessor,Owlv2Model:()=>r.Owlv2Model,Owlv2PreTrainedModel:()=>r.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>r.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>r.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>v.PaliGemmaProcessor,PatchTSMixerForPrediction:()=>r.PatchTSMixerForPrediction,PatchTSMixerModel:()=>r.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>r.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>r.PatchTSTForPrediction,PatchTSTModel:()=>r.PatchTSTModel,PatchTSTPreTrainedModel:()=>r.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>r.Phi3ForCausalLM,Phi3Model:()=>r.Phi3Model,Phi3PreTrainedModel:()=>r.Phi3PreTrainedModel,Phi3VForCausalLM:()=>r.Phi3VForCausalLM,Phi3VImageProcessor:()=>p.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>r.Phi3VPreTrainedModel,Phi3VProcessor:()=>v.Phi3VProcessor,PhiForCausalLM:()=>r.PhiForCausalLM,PhiModel:()=>r.PhiModel,PhiPreTrainedModel:()=>r.PhiPreTrainedModel,Pipeline:()=>e.Pipeline,PreTrainedModel:()=>r.PreTrainedModel,PreTrainedTokenizer:()=>n.PreTrainedTokenizer,PretrainedConfig:()=>a.PretrainedConfig,PretrainedMixin:()=>r.PretrainedMixin,Processor:()=>_.Processor,PvtForImageClassification:()=>r.PvtForImageClassification,PvtImageProcessor:()=>p.PvtImageProcessor,PvtModel:()=>r.PvtModel,PvtPreTrainedModel:()=>r.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>o.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>r.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>r.PyAnnoteModel,PyAnnotePreTrainedModel:()=>r.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>v.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>r.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>e.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>r.Qwen2ForCausalLM,Qwen2Model:()=>r.Qwen2Model,Qwen2PreTrainedModel:()=>r.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>n.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>r.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>p.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>r.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>v.Qwen2VLProcessor,Qwen3ForCausalLM:()=>r.Qwen3ForCausalLM,Qwen3Model:()=>r.Qwen3Model,Qwen3PreTrainedModel:()=>r.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>r.RFDetrForObjectDetection,RFDetrModel:()=>r.RFDetrModel,RFDetrObjectDetectionOutput:()=>r.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>r.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>r.RTDetrForObjectDetection,RTDetrImageProcessor:()=>p.RTDetrImageProcessor,RTDetrModel:()=>r.RTDetrModel,RTDetrObjectDetectionOutput:()=>r.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>r.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>r.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>r.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>r.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>r.RTDetrV2PreTrainedModel,RawAudio:()=>h.RawAudio,RawImage:()=>x.RawImage,RawVideo:()=>f.RawVideo,RawVideoFrame:()=>f.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>P.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>r.ResNetForImageClassification,ResNetModel:()=>r.ResNetModel,ResNetPreTrainedModel:()=>r.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>r.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>r.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>r.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>r.RoFormerForTokenClassification,RoFormerModel:()=>r.RoFormerModel,RoFormerPreTrainedModel:()=>r.RoFormerPreTrainedModel,RoFormerTokenizer:()=>n.RoFormerTokenizer,RobertaForMaskedLM:()=>r.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>r.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>r.RobertaForSequenceClassification,RobertaForTokenClassification:()=>r.RobertaForTokenClassification,RobertaModel:()=>r.RobertaModel,RobertaPreTrainedModel:()=>r.RobertaPreTrainedModel,RobertaTokenizer:()=>n.RobertaTokenizer,SamImageProcessor:()=>p.SamImageProcessor,SamImageSegmentationOutput:()=>r.SamImageSegmentationOutput,SamModel:()=>r.SamModel,SamPreTrainedModel:()=>r.SamPreTrainedModel,SamProcessor:()=>v.SamProcessor,SapiensForDepthEstimation:()=>r.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>r.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>r.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>r.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>o.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>p.SegformerFeatureExtractor,SegformerForImageClassification:()=>r.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>r.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>p.SegformerImageProcessor,SegformerModel:()=>r.SegformerModel,SegformerPreTrainedModel:()=>r.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>r.Seq2SeqLMOutput,SequenceClassifierOutput:()=>r.SequenceClassifierOutput,SiglipImageProcessor:()=>p.SiglipImageProcessor,SiglipModel:()=>r.SiglipModel,SiglipPreTrainedModel:()=>r.SiglipPreTrainedModel,SiglipTextModel:()=>r.SiglipTextModel,SiglipTokenizer:()=>n.SiglipTokenizer,SiglipVisionModel:()=>r.SiglipVisionModel,SmolLM3ForCausalLM:()=>r.SmolLM3ForCausalLM,SmolLM3Model:()=>r.SmolLM3Model,SmolLM3PreTrainedModel:()=>r.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>r.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>p.SmolVLMImageProcessor,SmolVLMProcessor:()=>v.SmolVLMProcessor,SnacDecoderModel:()=>r.SnacDecoderModel,SnacEncoderModel:()=>r.SnacEncoderModel,SnacFeatureExtractor:()=>o.SnacFeatureExtractor,SnacModel:()=>r.SnacModel,SnacPreTrainedModel:()=>r.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>o.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>r.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>r.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>r.SpeechT5HifiGan,SpeechT5Model:()=>r.SpeechT5Model,SpeechT5PreTrainedModel:()=>r.SpeechT5PreTrainedModel,SpeechT5Processor:()=>v.SpeechT5Processor,SpeechT5Tokenizer:()=>n.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>r.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>r.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>r.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>r.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>r.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>n.SqueezeBertTokenizer,StableLmForCausalLM:()=>r.StableLmForCausalLM,StableLmModel:()=>r.StableLmModel,StableLmPreTrainedModel:()=>r.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>r.Starcoder2ForCausalLM,Starcoder2Model:()=>r.Starcoder2Model,Starcoder2PreTrainedModel:()=>r.Starcoder2PreTrainedModel,StoppingCriteria:()=>C.StoppingCriteria,StoppingCriteriaList:()=>C.StoppingCriteriaList,StyleTextToSpeech2Model:()=>r.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>r.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>e.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>P.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>r.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>p.Swin2SRImageProcessor,Swin2SRModel:()=>r.Swin2SRModel,Swin2SRPreTrainedModel:()=>r.Swin2SRPreTrainedModel,SwinForImageClassification:()=>r.SwinForImageClassification,SwinForSemanticSegmentation:()=>r.SwinForSemanticSegmentation,SwinModel:()=>r.SwinModel,SwinPreTrainedModel:()=>r.SwinPreTrainedModel,T5ForConditionalGeneration:()=>r.T5ForConditionalGeneration,T5Model:()=>r.T5Model,T5PreTrainedModel:()=>r.T5PreTrainedModel,T5Tokenizer:()=>n.T5Tokenizer,TableTransformerForObjectDetection:()=>r.TableTransformerForObjectDetection,TableTransformerModel:()=>r.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>r.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>r.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>P.TemperatureLogitsWarper,Tensor:()=>s.Tensor,Text2TextGenerationPipeline:()=>e.Text2TextGenerationPipeline,TextClassificationPipeline:()=>e.TextClassificationPipeline,TextGenerationPipeline:()=>e.TextGenerationPipeline,TextStreamer:()=>T.TextStreamer,TextToAudioPipeline:()=>e.TextToAudioPipeline,TokenClassificationPipeline:()=>e.TokenClassificationPipeline,TokenClassifierOutput:()=>r.TokenClassifierOutput,TokenizerModel:()=>n.TokenizerModel,TopKLogitsWarper:()=>P.TopKLogitsWarper,TopPLogitsWarper:()=>P.TopPLogitsWarper,TrOCRForCausalLM:()=>r.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>r.TrOCRPreTrainedModel,TranslationPipeline:()=>e.TranslationPipeline,UltravoxModel:()=>r.UltravoxModel,UltravoxPreTrainedModel:()=>r.UltravoxPreTrainedModel,UltravoxProcessor:()=>v.UltravoxProcessor,UniSpeechForCTC:()=>r.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>r.UniSpeechForSequenceClassification,UniSpeechModel:()=>r.UniSpeechModel,UniSpeechPreTrainedModel:()=>r.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>r.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>r.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>r.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>r.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>r.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>v.VLChatProcessor,VLMImageProcessor:()=>p.VLMImageProcessor,ViTFeatureExtractor:()=>p.ViTFeatureExtractor,ViTForImageClassification:()=>r.ViTForImageClassification,ViTImageProcessor:()=>p.ViTImageProcessor,ViTMAEModel:()=>r.ViTMAEModel,ViTMAEPreTrainedModel:()=>r.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>r.ViTMSNForImageClassification,ViTMSNModel:()=>r.ViTMSNModel,ViTMSNPreTrainedModel:()=>r.ViTMSNPreTrainedModel,ViTModel:()=>r.ViTModel,ViTPreTrainedModel:()=>r.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>r.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>r.VitMatteForImageMatting,VitMatteImageProcessor:()=>p.VitMatteImageProcessor,VitMattePreTrainedModel:()=>r.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>r.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>p.VitPoseImageProcessor,VitPosePreTrainedModel:()=>r.VitPosePreTrainedModel,VitsModel:()=>r.VitsModel,VitsModelOutput:()=>r.VitsModelOutput,VitsPreTrainedModel:()=>r.VitsPreTrainedModel,VitsTokenizer:()=>n.VitsTokenizer,Wav2Vec2BertForCTC:()=>r.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>r.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>r.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>r.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>n.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>o.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>r.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>r.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>r.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>r.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>r.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>v.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>v.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>r.WavLMForAudioFrameClassification,WavLMForCTC:()=>r.WavLMForCTC,WavLMForSequenceClassification:()=>r.WavLMForSequenceClassification,WavLMForXVector:()=>r.WavLMForXVector,WavLMModel:()=>r.WavLMModel,WavLMPreTrainedModel:()=>r.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>o.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>r.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>r.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>o.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>r.WhisperForConditionalGeneration,WhisperModel:()=>r.WhisperModel,WhisperPreTrainedModel:()=>r.WhisperPreTrainedModel,WhisperProcessor:()=>v.WhisperProcessor,WhisperTextStreamer:()=>T.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>P.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>n.WhisperTokenizer,XLMForQuestionAnswering:()=>r.XLMForQuestionAnswering,XLMForSequenceClassification:()=>r.XLMForSequenceClassification,XLMForTokenClassification:()=>r.XLMForTokenClassification,XLMModel:()=>r.XLMModel,XLMPreTrainedModel:()=>r.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>r.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>r.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>r.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>r.XLMRobertaForTokenClassification,XLMRobertaModel:()=>r.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>r.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>n.XLMRobertaTokenizer,XLMTokenizer:()=>n.XLMTokenizer,XLMWithLMHeadModel:()=>r.XLMWithLMHeadModel,XVectorOutput:()=>r.XVectorOutput,YolosFeatureExtractor:()=>p.YolosFeatureExtractor,YolosForObjectDetection:()=>r.YolosForObjectDetection,YolosImageProcessor:()=>p.YolosImageProcessor,YolosModel:()=>r.YolosModel,YolosObjectDetectionOutput:()=>r.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>r.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>e.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>e.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>e.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>e.ZeroShotObjectDetectionPipeline,bankers_round:()=>d.bankers_round,cat:()=>s.cat,cos_sim:()=>d.cos_sim,dot:()=>d.dot,dynamic_time_warping:()=>d.dynamic_time_warping,env:()=>t.env,full:()=>s.full,full_like:()=>s.full_like,getKeyValueShapes:()=>a.getKeyValueShapes,hamming:()=>h.hamming,hanning:()=>h.hanning,interpolate:()=>s.interpolate,interpolate_4d:()=>s.interpolate_4d,interpolate_data:()=>d.interpolate_data,is_chinese_char:()=>n.is_chinese_char,layer_norm:()=>s.layer_norm,load_image:()=>x.load_image,load_video:()=>f.load_video,log_softmax:()=>d.log_softmax,magnitude:()=>d.magnitude,matmul:()=>s.matmul,max:()=>d.max,mean:()=>s.mean,mean_pooling:()=>s.mean_pooling,medianFilter:()=>d.medianFilter,mel_filter_bank:()=>h.mel_filter_bank,min:()=>d.min,ones:()=>s.ones,ones_like:()=>s.ones_like,permute:()=>s.permute,permute_data:()=>d.permute_data,pipeline:()=>e.pipeline,quantize_embeddings:()=>s.quantize_embeddings,rand:()=>s.rand,read_audio:()=>h.read_audio,rfft:()=>s.rfft,round:()=>d.round,slice:()=>s.slice,softmax:()=>d.softmax,spectrogram:()=>h.spectrogram,stack:()=>s.stack,std_mean:()=>s.std_mean,topk:()=>s.topk,window_function:()=>h.window_function,zeros:()=>s.zeros,zeros_like:()=>s.zeros_like});var t=fn("./src/env.js"),e=fn("./src/pipelines.js"),r=fn("./src/models.js"),n=fn("./src/tokenizers.js"),a=fn("./src/configs.js"),h=fn("./src/utils/audio.js"),x=fn("./src/utils/image.js"),f=fn("./src/utils/video.js"),s=fn("./src/utils/tensor.js"),d=fn("./src/utils/maths.js"),m=fn("./src/base/feature_extraction_utils.js"),o=fn("./src/models/feature_extractors.js"),l=fn("./src/models/auto/feature_extraction_auto.js"),u=fn("./src/base/image_processors_utils.js"),p=fn("./src/models/image_processors.js"),w=fn("./src/models/auto/image_processing_auto.js"),_=fn("./src/base/processing_utils.js"),v=fn("./src/models/processors.js"),y=fn("./src/models/auto/processing_auto.js"),T=fn("./src/generation/streamers.js"),C=fn("./src/generation/stopping_criteria.js"),P=fn("./src/generation/logits_process.js")})();F.ASTFeatureExtractor;F.ASTForAudioClassification;F.ASTModel;F.ASTPreTrainedModel;F.AlbertForMaskedLM;F.AlbertForQuestionAnswering;F.AlbertForSequenceClassification;F.AlbertModel;F.AlbertPreTrainedModel;F.AlbertTokenizer;F.AudioClassificationPipeline;F.AutoConfig;F.AutoFeatureExtractor;F.AutoImageProcessor;var jD=F.AutoModel;F.AutoModelForAudioClassification;F.AutoModelForAudioFrameClassification;F.AutoModelForAudioTextToText;F.AutoModelForCTC;F.AutoModelForCausalLM;F.AutoModelForDepthEstimation;F.AutoModelForDocumentQuestionAnswering;F.AutoModelForImageClassification;F.AutoModelForImageFeatureExtraction;F.AutoModelForImageMatting;F.AutoModelForImageSegmentation;F.AutoModelForImageTextToText;F.AutoModelForImageToImage;F.AutoModelForMaskGeneration;F.AutoModelForMaskedLM;F.AutoModelForNormalEstimation;F.AutoModelForObjectDetection;F.AutoModelForPoseEstimation;F.AutoModelForQuestionAnswering;F.AutoModelForSemanticSegmentation;F.AutoModelForSeq2SeqLM;F.AutoModelForSequenceClassification;F.AutoModelForSpeechSeq2Seq;F.AutoModelForTextToSpectrogram;F.AutoModelForTextToWaveform;F.AutoModelForTokenClassification;F.AutoModelForUniversalSegmentation;F.AutoModelForVision2Seq;F.AutoModelForXVector;F.AutoModelForZeroShotObjectDetection;var ND=F.AutoProcessor;F.AutoTokenizer;F.AutomaticSpeechRecognitionPipeline;F.BackgroundRemovalPipeline;F.BartForConditionalGeneration;F.BartForSequenceClassification;F.BartModel;F.BartPretrainedModel;F.BartTokenizer;F.BaseModelOutput;F.BaseStreamer;F.BeitFeatureExtractor;F.BeitForImageClassification;F.BeitModel;F.BeitPreTrainedModel;F.BertForMaskedLM;F.BertForQuestionAnswering;F.BertForSequenceClassification;F.BertForTokenClassification;F.BertModel;F.BertPreTrainedModel;F.BertTokenizer;F.BitImageProcessor;F.BlenderbotForConditionalGeneration;F.BlenderbotModel;F.BlenderbotPreTrainedModel;F.BlenderbotSmallForConditionalGeneration;F.BlenderbotSmallModel;F.BlenderbotSmallPreTrainedModel;F.BlenderbotSmallTokenizer;F.BlenderbotTokenizer;F.BloomForCausalLM;F.BloomModel;F.BloomPreTrainedModel;F.BloomTokenizer;F.CLIPFeatureExtractor;F.CLIPImageProcessor;F.CLIPModel;F.CLIPPreTrainedModel;F.CLIPSegForImageSegmentation;F.CLIPSegModel;F.CLIPSegPreTrainedModel;F.CLIPTextModel;F.CLIPTextModelWithProjection;F.CLIPTokenizer;F.CLIPVisionModel;F.CLIPVisionModelWithProjection;F.CamembertForMaskedLM;F.CamembertForQuestionAnswering;F.CamembertForSequenceClassification;F.CamembertForTokenClassification;F.CamembertModel;F.CamembertPreTrainedModel;F.CamembertTokenizer;F.CausalLMOutput;F.CausalLMOutputWithPast;F.ChineseCLIPFeatureExtractor;F.ChineseCLIPModel;F.ChineseCLIPPreTrainedModel;F.ClapAudioModelWithProjection;F.ClapFeatureExtractor;F.ClapModel;F.ClapPreTrainedModel;F.ClapTextModelWithProjection;F.ClassifierFreeGuidanceLogitsProcessor;F.CodeGenForCausalLM;F.CodeGenModel;F.CodeGenPreTrainedModel;F.CodeGenTokenizer;F.CodeLlamaTokenizer;F.CohereForCausalLM;F.CohereModel;F.CoherePreTrainedModel;F.CohereTokenizer;F.ConvBertForMaskedLM;F.ConvBertForQuestionAnswering;F.ConvBertForSequenceClassification;F.ConvBertForTokenClassification;F.ConvBertModel;F.ConvBertPreTrainedModel;F.ConvBertTokenizer;F.ConvNextFeatureExtractor;F.ConvNextForImageClassification;F.ConvNextImageProcessor;F.ConvNextModel;F.ConvNextPreTrainedModel;F.ConvNextV2ForImageClassification;F.ConvNextV2Model;F.ConvNextV2PreTrainedModel;F.DFineForObjectDetection;F.DFineModel;F.DFinePreTrainedModel;F.DPTFeatureExtractor;F.DPTForDepthEstimation;F.DPTImageProcessor;F.DPTModel;F.DPTPreTrainedModel;F.DacDecoderModel;F.DacDecoderOutput;F.DacEncoderModel;F.DacEncoderOutput;F.DacFeatureExtractor;F.DacModel;F.DacPreTrainedModel;F.DataTypeMap;F.DebertaForMaskedLM;F.DebertaForQuestionAnswering;F.DebertaForSequenceClassification;F.DebertaForTokenClassification;F.DebertaModel;F.DebertaPreTrainedModel;F.DebertaTokenizer;F.DebertaV2ForMaskedLM;F.DebertaV2ForQuestionAnswering;F.DebertaV2ForSequenceClassification;F.DebertaV2ForTokenClassification;F.DebertaV2Model;F.DebertaV2PreTrainedModel;F.DebertaV2Tokenizer;F.DecisionTransformerModel;F.DecisionTransformerPreTrainedModel;F.DeiTFeatureExtractor;F.DeiTForImageClassification;F.DeiTImageProcessor;F.DeiTModel;F.DeiTPreTrainedModel;F.DepthAnythingForDepthEstimation;F.DepthAnythingPreTrainedModel;F.DepthEstimationPipeline;F.DepthProForDepthEstimation;F.DepthProPreTrainedModel;F.DetrFeatureExtractor;F.DetrForObjectDetection;F.DetrForSegmentation;F.DetrImageProcessor;F.DetrModel;F.DetrObjectDetectionOutput;F.DetrPreTrainedModel;F.DetrSegmentationOutput;F.Dinov2ForImageClassification;F.Dinov2Model;F.Dinov2PreTrainedModel;F.Dinov2WithRegistersForImageClassification;F.Dinov2WithRegistersModel;F.Dinov2WithRegistersPreTrainedModel;F.DistilBertForMaskedLM;F.DistilBertForQuestionAnswering;F.DistilBertForSequenceClassification;F.DistilBertForTokenClassification;F.DistilBertModel;F.DistilBertPreTrainedModel;F.DistilBertTokenizer;F.DocumentQuestionAnsweringPipeline;F.DonutFeatureExtractor;F.DonutImageProcessor;F.DonutSwinModel;F.DonutSwinPreTrainedModel;F.EfficientNetForImageClassification;F.EfficientNetImageProcessor;F.EfficientNetModel;F.EfficientNetPreTrainedModel;F.ElectraForMaskedLM;F.ElectraForQuestionAnswering;F.ElectraForSequenceClassification;F.ElectraForTokenClassification;F.ElectraModel;F.ElectraPreTrainedModel;F.ElectraTokenizer;F.EncodecFeatureExtractor;F.EosTokenCriteria;F.Ernie4_5_ForCausalLM;F.Ernie4_5_Model;F.Ernie4_5_PretrainedModel;F.Ernie4_5_Tokenizer;F.EsmForMaskedLM;F.EsmForSequenceClassification;F.EsmForTokenClassification;F.EsmModel;F.EsmPreTrainedModel;F.EsmTokenizer;F.ExaoneForCausalLM;F.ExaoneModel;F.ExaonePreTrainedModel;F.FFT;F.FalconForCausalLM;F.FalconModel;F.FalconPreTrainedModel;F.FalconTokenizer;F.FastViTForImageClassification;F.FastViTModel;F.FastViTPreTrainedModel;F.FeatureExtractionPipeline;F.FeatureExtractor;F.FillMaskPipeline;F.Florence2ForConditionalGeneration;F.Florence2PreTrainedModel;F.Florence2Processor;F.ForcedBOSTokenLogitsProcessor;F.ForcedEOSTokenLogitsProcessor;F.GLPNFeatureExtractor;F.GLPNForDepthEstimation;F.GLPNModel;F.GLPNPreTrainedModel;F.GPT2LMHeadModel;F.GPT2Model;F.GPT2PreTrainedModel;F.GPT2Tokenizer;F.GPTBigCodeForCausalLM;F.GPTBigCodeModel;F.GPTBigCodePreTrainedModel;F.GPTJForCausalLM;F.GPTJModel;F.GPTJPreTrainedModel;F.GPTNeoForCausalLM;F.GPTNeoModel;F.GPTNeoPreTrainedModel;F.GPTNeoXForCausalLM;F.GPTNeoXModel;F.GPTNeoXPreTrainedModel;F.GPTNeoXTokenizer;F.Gemma2ForCausalLM;F.Gemma2Model;F.Gemma2PreTrainedModel;F.Gemma3ForCausalLM;F.Gemma3Model;F.Gemma3PreTrainedModel;F.Gemma3nAudioFeatureExtractor;F.Gemma3nForConditionalGeneration;F.Gemma3nPreTrainedModel;F.Gemma3nProcessor;F.GemmaForCausalLM;F.GemmaModel;F.GemmaPreTrainedModel;F.GemmaTokenizer;F.GlmForCausalLM;F.GlmModel;F.GlmPreTrainedModel;F.GraniteForCausalLM;F.GraniteModel;F.GranitePreTrainedModel;F.Grok1Tokenizer;F.GroundingDinoForObjectDetection;F.GroundingDinoImageProcessor;F.GroundingDinoPreTrainedModel;F.GroundingDinoProcessor;F.GroupViTModel;F.GroupViTPreTrainedModel;F.HeliumForCausalLM;F.HeliumModel;F.HeliumPreTrainedModel;F.HerbertTokenizer;F.HieraForImageClassification;F.HieraModel;F.HieraPreTrainedModel;F.HubertForCTC;F.HubertForSequenceClassification;F.HubertModel;F.HubertPreTrainedModel;F.IJepaForImageClassification;F.IJepaModel;F.IJepaPreTrainedModel;F.Idefics3ForConditionalGeneration;F.Idefics3ImageProcessor;F.Idefics3PreTrainedModel;F.Idefics3Processor;F.ImageClassificationPipeline;F.ImageFeatureExtractionPipeline;F.ImageFeatureExtractor;F.ImageMattingOutput;F.ImageProcessor;F.ImageSegmentationPipeline;F.ImageToImagePipeline;F.ImageToTextPipeline;F.InterruptableStoppingCriteria;F.JAISLMHeadModel;F.JAISModel;F.JAISPreTrainedModel;F.JinaCLIPImageProcessor;F.JinaCLIPModel;F.JinaCLIPPreTrainedModel;F.JinaCLIPProcessor;F.JinaCLIPTextModel;F.JinaCLIPVisionModel;F.LiteWhisperForConditionalGeneration;F.LlamaForCausalLM;F.LlamaModel;F.LlamaPreTrainedModel;F.LlamaTokenizer;F.LlavaForConditionalGeneration;F.LlavaOnevisionForConditionalGeneration;F.LlavaOnevisionImageProcessor;F.LlavaPreTrainedModel;F.LlavaProcessor;F.LlavaQwen2ForCausalLM;F.LogitsProcessor;F.LogitsProcessorList;F.LogitsWarper;F.LongT5ForConditionalGeneration;F.LongT5Model;F.LongT5PreTrainedModel;F.M2M100ForConditionalGeneration;F.M2M100Model;F.M2M100PreTrainedModel;F.M2M100Tokenizer;F.MBart50Tokenizer;F.MBartForCausalLM;F.MBartForConditionalGeneration;F.MBartForSequenceClassification;F.MBartModel;F.MBartPreTrainedModel;F.MBartTokenizer;F.MPNetForMaskedLM;F.MPNetForQuestionAnswering;F.MPNetForSequenceClassification;F.MPNetForTokenClassification;F.MPNetModel;F.MPNetPreTrainedModel;F.MPNetTokenizer;F.MT5ForConditionalGeneration;F.MT5Model;F.MT5PreTrainedModel;F.MarianMTModel;F.MarianModel;F.MarianPreTrainedModel;F.MarianTokenizer;F.Mask2FormerImageProcessor;F.MaskFormerFeatureExtractor;F.MaskFormerForInstanceSegmentation;F.MaskFormerImageProcessor;F.MaskFormerModel;F.MaskFormerPreTrainedModel;F.MaskedLMOutput;F.MaxLengthCriteria;F.Metric3DForDepthEstimation;F.Metric3DPreTrainedModel;F.Metric3Dv2ForDepthEstimation;F.Metric3Dv2PreTrainedModel;F.MgpstrForSceneTextRecognition;F.MgpstrModelOutput;F.MgpstrPreTrainedModel;F.MgpstrProcessor;F.MgpstrTokenizer;F.MimiDecoderModel;F.MimiDecoderOutput;F.MimiEncoderModel;F.MimiEncoderOutput;F.MimiModel;F.MimiPreTrainedModel;F.MinLengthLogitsProcessor;F.MinNewTokensLengthLogitsProcessor;F.MistralForCausalLM;F.MistralModel;F.MistralPreTrainedModel;F.MobileBertForMaskedLM;F.MobileBertForQuestionAnswering;F.MobileBertForSequenceClassification;F.MobileBertModel;F.MobileBertPreTrainedModel;F.MobileBertTokenizer;F.MobileLLMForCausalLM;F.MobileLLMModel;F.MobileLLMPreTrainedModel;F.MobileNetV1FeatureExtractor;F.MobileNetV1ForImageClassification;F.MobileNetV1ForSemanticSegmentation;F.MobileNetV1ImageProcessor;F.MobileNetV1Model;F.MobileNetV1PreTrainedModel;F.MobileNetV2FeatureExtractor;F.MobileNetV2ForImageClassification;F.MobileNetV2ForSemanticSegmentation;F.MobileNetV2ImageProcessor;F.MobileNetV2Model;F.MobileNetV2PreTrainedModel;F.MobileNetV3FeatureExtractor;F.MobileNetV3ForImageClassification;F.MobileNetV3ForSemanticSegmentation;F.MobileNetV3ImageProcessor;F.MobileNetV3Model;F.MobileNetV3PreTrainedModel;F.MobileNetV4FeatureExtractor;F.MobileNetV4ForImageClassification;F.MobileNetV4ForSemanticSegmentation;F.MobileNetV4ImageProcessor;F.MobileNetV4Model;F.MobileNetV4PreTrainedModel;F.MobileViTFeatureExtractor;F.MobileViTForImageClassification;F.MobileViTImageProcessor;F.MobileViTModel;F.MobileViTPreTrainedModel;F.MobileViTV2ForImageClassification;F.MobileViTV2Model;F.MobileViTV2PreTrainedModel;F.ModelOutput;F.ModernBertForMaskedLM;F.ModernBertForSequenceClassification;F.ModernBertForTokenClassification;F.ModernBertModel;F.ModernBertPreTrainedModel;F.Moondream1ForConditionalGeneration;F.MoonshineFeatureExtractor;F.MoonshineForConditionalGeneration;F.MoonshineModel;F.MoonshinePreTrainedModel;F.MoonshineProcessor;F.MptForCausalLM;F.MptModel;F.MptPreTrainedModel;F.MultiModalityCausalLM;F.MultiModalityPreTrainedModel;F.MusicgenForCausalLM;F.MusicgenForConditionalGeneration;F.MusicgenModel;F.MusicgenPreTrainedModel;F.NeoBertForMaskedLM;F.NeoBertForQuestionAnswering;F.NeoBertForSequenceClassification;F.NeoBertForTokenClassification;F.NeoBertModel;F.NeoBertPreTrainedModel;F.NllbTokenizer;F.NoBadWordsLogitsProcessor;F.NoRepeatNGramLogitsProcessor;F.NomicBertModel;F.NomicBertPreTrainedModel;F.NougatImageProcessor;F.NougatTokenizer;F.OPTForCausalLM;F.OPTModel;F.OPTPreTrainedModel;F.ObjectDetectionPipeline;F.Olmo2ForCausalLM;F.Olmo2Model;F.Olmo2PreTrainedModel;F.OlmoForCausalLM;F.OlmoModel;F.OlmoPreTrainedModel;F.OpenELMForCausalLM;F.OpenELMModel;F.OpenELMPreTrainedModel;F.OwlViTFeatureExtractor;F.OwlViTForObjectDetection;F.OwlViTImageProcessor;F.OwlViTModel;F.OwlViTPreTrainedModel;F.OwlViTProcessor;F.Owlv2ForObjectDetection;F.Owlv2ImageProcessor;F.Owlv2Model;F.Owlv2PreTrainedModel;F.PaliGemmaForConditionalGeneration;F.PaliGemmaPreTrainedModel;F.PaliGemmaProcessor;F.PatchTSMixerForPrediction;F.PatchTSMixerModel;F.PatchTSMixerPreTrainedModel;F.PatchTSTForPrediction;F.PatchTSTModel;F.PatchTSTPreTrainedModel;F.Phi3ForCausalLM;F.Phi3Model;F.Phi3PreTrainedModel;F.Phi3VForCausalLM;F.Phi3VImageProcessor;F.Phi3VPreTrainedModel;F.Phi3VProcessor;F.PhiForCausalLM;F.PhiModel;F.PhiPreTrainedModel;F.Pipeline;F.PreTrainedModel;F.PreTrainedTokenizer;F.PretrainedConfig;F.PretrainedMixin;F.Processor;F.PvtForImageClassification;F.PvtImageProcessor;F.PvtModel;F.PvtPreTrainedModel;F.PyAnnoteFeatureExtractor;F.PyAnnoteForAudioFrameClassification;F.PyAnnoteModel;F.PyAnnotePreTrainedModel;F.PyAnnoteProcessor;F.QuestionAnsweringModelOutput;F.QuestionAnsweringPipeline;F.Qwen2ForCausalLM;F.Qwen2Model;F.Qwen2PreTrainedModel;F.Qwen2Tokenizer;F.Qwen2VLForConditionalGeneration;F.Qwen2VLImageProcessor;F.Qwen2VLPreTrainedModel;F.Qwen2VLProcessor;F.Qwen3ForCausalLM;F.Qwen3Model;F.Qwen3PreTrainedModel;F.RFDetrForObjectDetection;F.RFDetrModel;F.RFDetrObjectDetectionOutput;F.RFDetrPreTrainedModel;F.RTDetrForObjectDetection;F.RTDetrImageProcessor;F.RTDetrModel;F.RTDetrObjectDetectionOutput;F.RTDetrPreTrainedModel;F.RTDetrV2ForObjectDetection;F.RTDetrV2Model;F.RTDetrV2ObjectDetectionOutput;F.RTDetrV2PreTrainedModel;F.RawAudio;var UD=F.RawImage;F.RawVideo;F.RawVideoFrame;F.RepetitionPenaltyLogitsProcessor;F.ResNetForImageClassification;F.ResNetModel;F.ResNetPreTrainedModel;F.RoFormerForMaskedLM;F.RoFormerForQuestionAnswering;F.RoFormerForSequenceClassification;F.RoFormerForTokenClassification;F.RoFormerModel;F.RoFormerPreTrainedModel;F.RoFormerTokenizer;F.RobertaForMaskedLM;F.RobertaForQuestionAnswering;F.RobertaForSequenceClassification;F.RobertaForTokenClassification;F.RobertaModel;F.RobertaPreTrainedModel;F.RobertaTokenizer;F.SamImageProcessor;F.SamImageSegmentationOutput;var VD=F.SamModel;F.SamPreTrainedModel;F.SamProcessor;F.SapiensForDepthEstimation;F.SapiensForNormalEstimation;F.SapiensForSemanticSegmentation;F.SapiensPreTrainedModel;F.SeamlessM4TFeatureExtractor;F.SegformerFeatureExtractor;F.SegformerForImageClassification;F.SegformerForSemanticSegmentation;F.SegformerImageProcessor;F.SegformerModel;F.SegformerPreTrainedModel;F.Seq2SeqLMOutput;F.SequenceClassifierOutput;F.SiglipImageProcessor;F.SiglipModel;F.SiglipPreTrainedModel;F.SiglipTextModel;F.SiglipTokenizer;F.SiglipVisionModel;F.SmolLM3ForCausalLM;F.SmolLM3Model;F.SmolLM3PreTrainedModel;F.SmolVLMForConditionalGeneration;F.SmolVLMImageProcessor;F.SmolVLMProcessor;F.SnacDecoderModel;F.SnacEncoderModel;F.SnacFeatureExtractor;F.SnacModel;F.SnacPreTrainedModel;F.SpeechT5FeatureExtractor;F.SpeechT5ForSpeechToText;F.SpeechT5ForTextToSpeech;F.SpeechT5HifiGan;F.SpeechT5Model;F.SpeechT5PreTrainedModel;F.SpeechT5Processor;F.SpeechT5Tokenizer;F.SqueezeBertForMaskedLM;F.SqueezeBertForQuestionAnswering;F.SqueezeBertForSequenceClassification;F.SqueezeBertModel;F.SqueezeBertPreTrainedModel;F.SqueezeBertTokenizer;F.StableLmForCausalLM;F.StableLmModel;F.StableLmPreTrainedModel;F.Starcoder2ForCausalLM;F.Starcoder2Model;F.Starcoder2PreTrainedModel;F.StoppingCriteria;F.StoppingCriteriaList;F.StyleTextToSpeech2Model;F.StyleTextToSpeech2PreTrainedModel;F.SummarizationPipeline;F.SuppressTokensAtBeginLogitsProcessor;F.Swin2SRForImageSuperResolution;F.Swin2SRImageProcessor;F.Swin2SRModel;F.Swin2SRPreTrainedModel;F.SwinForImageClassification;F.SwinForSemanticSegmentation;F.SwinModel;F.SwinPreTrainedModel;F.T5ForConditionalGeneration;F.T5Model;F.T5PreTrainedModel;F.T5Tokenizer;F.TableTransformerForObjectDetection;F.TableTransformerModel;F.TableTransformerObjectDetectionOutput;F.TableTransformerPreTrainedModel;F.TemperatureLogitsWarper;var WD=F.Tensor;F.Text2TextGenerationPipeline;F.TextClassificationPipeline;F.TextGenerationPipeline;F.TextStreamer;F.TextToAudioPipeline;F.TokenClassificationPipeline;F.TokenClassifierOutput;F.TokenizerModel;F.TopKLogitsWarper;F.TopPLogitsWarper;F.TrOCRForCausalLM;F.TrOCRPreTrainedModel;F.TranslationPipeline;F.UltravoxModel;F.UltravoxPreTrainedModel;F.UltravoxProcessor;F.UniSpeechForCTC;F.UniSpeechForSequenceClassification;F.UniSpeechModel;F.UniSpeechPreTrainedModel;F.UniSpeechSatForAudioFrameClassification;F.UniSpeechSatForCTC;F.UniSpeechSatForSequenceClassification;F.UniSpeechSatModel;F.UniSpeechSatPreTrainedModel;F.VLChatProcessor;F.VLMImageProcessor;F.ViTFeatureExtractor;F.ViTForImageClassification;F.ViTImageProcessor;F.ViTMAEModel;F.ViTMAEPreTrainedModel;F.ViTMSNForImageClassification;F.ViTMSNModel;F.ViTMSNPreTrainedModel;F.ViTModel;F.ViTPreTrainedModel;F.VisionEncoderDecoderModel;F.VitMatteForImageMatting;F.VitMatteImageProcessor;F.VitMattePreTrainedModel;F.VitPoseForPoseEstimation;F.VitPoseImageProcessor;F.VitPosePreTrainedModel;F.VitsModel;F.VitsModelOutput;F.VitsPreTrainedModel;F.VitsTokenizer;F.Wav2Vec2BertForCTC;F.Wav2Vec2BertForSequenceClassification;F.Wav2Vec2BertModel;F.Wav2Vec2BertPreTrainedModel;F.Wav2Vec2CTCTokenizer;F.Wav2Vec2FeatureExtractor;F.Wav2Vec2ForAudioFrameClassification;F.Wav2Vec2ForCTC;F.Wav2Vec2ForSequenceClassification;F.Wav2Vec2Model;F.Wav2Vec2PreTrainedModel;F.Wav2Vec2Processor;F.Wav2Vec2ProcessorWithLM;F.WavLMForAudioFrameClassification;F.WavLMForCTC;F.WavLMForSequenceClassification;F.WavLMForXVector;F.WavLMModel;F.WavLMPreTrainedModel;F.WeSpeakerFeatureExtractor;F.WeSpeakerResNetModel;F.WeSpeakerResNetPreTrainedModel;F.WhisperFeatureExtractor;F.WhisperForConditionalGeneration;F.WhisperModel;F.WhisperPreTrainedModel;F.WhisperProcessor;F.WhisperTextStreamer;F.WhisperTimeStampLogitsProcessor;F.WhisperTokenizer;F.XLMForQuestionAnswering;F.XLMForSequenceClassification;F.XLMForTokenClassification;F.XLMModel;F.XLMPreTrainedModel;F.XLMRobertaForMaskedLM;F.XLMRobertaForQuestionAnswering;F.XLMRobertaForSequenceClassification;F.XLMRobertaForTokenClassification;F.XLMRobertaModel;F.XLMRobertaPreTrainedModel;F.XLMRobertaTokenizer;F.XLMTokenizer;F.XLMWithLMHeadModel;F.XVectorOutput;F.YolosFeatureExtractor;F.YolosForObjectDetection;F.YolosImageProcessor;F.YolosModel;F.YolosObjectDetectionOutput;F.YolosPreTrainedModel;F.ZeroShotAudioClassificationPipeline;F.ZeroShotClassificationPipeline;F.ZeroShotImageClassificationPipeline;F.ZeroShotObjectDetectionPipeline;F.bankers_round;F.cat;F.cos_sim;F.dot;F.dynamic_time_warping;var GD=F.env;F.full;F.full_like;F.getKeyValueShapes;F.hamming;F.hanning;F.interpolate;F.interpolate_4d;F.interpolate_data;F.is_chinese_char;F.layer_norm;F.load_image;F.load_video;F.log_softmax;F.magnitude;F.matmul;F.max;F.mean;F.mean_pooling;F.medianFilter;F.mel_filter_bank;F.min;F.ones;F.ones_like;F.permute;F.permute_data;F.pipeline;F.quantize_embeddings;F.rand;F.read_audio;F.rfft;F.round;F.slice;F.softmax;F.spectrogram;F.stack;F.std_mean;F.topk;F.window_function;F.zeros;F.zeros_like;function _f(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hw(t,e){return hw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},hw(t,e)}function ly(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hw(t,e)}function p_(t,e){if(e&&(To(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _f(t)}function jl(t){return jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jl(t)}function XA(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function YA(t){return bS(t)||XA(t)||MS(t)||TS()}function vb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function yb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var qA={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,r){console&&console[e]&&console[e].apply(console,r)}},QA=function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ya(this,t),this.init(e,r)}return qa(t,[{key:"init",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=r||qA,this.options=n,this.debug=n.debug}},{key:"setDebug",value:function(r){this.debug=r}},{key:"log",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return this.forward(n,"log","",!0)}},{key:"warn",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return this.forward(n,"warn","",!0)}},{key:"error",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return this.forward(n,"error","")}},{key:"deprecate",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(r,n,a,h){return h&&!this.debug?null:(typeof r[0]=="string"&&(r[0]="".concat(a).concat(this.prefix," ").concat(r[0])),this.logger[n](r))}},{key:"create",value:function(r){return new t(this.logger,yb(yb({},{prefix:"".concat(this.prefix,":").concat(r,":")}),this.options))}},{key:"clone",value:function(r){return r=r||this.options,r.prefix=r.prefix||this.prefix,new t(this.logger,r)}}]),t}(),Rl=new QA,wf=function(){function t(){Ya(this,t),this.observers={}}return qa(t,[{key:"on",value:function(r,n){var a=this;return r.split(" ").forEach(function(h){a.observers[h]=a.observers[h]||[],a.observers[h].push(n)}),this}},{key:"off",value:function(r,n){if(!!this.observers[r]){if(!n){delete this.observers[r];return}this.observers[r]=this.observers[r].filter(function(a){return a!==n})}}},{key:"emit",value:function(r){for(var n=arguments.length,a=new Array(n>1?n-1:0),h=1;h<n;h++)a[h-1]=arguments[h];if(this.observers[r]){var x=[].concat(this.observers[r]);x.forEach(function(s){s.apply(void 0,a)})}if(this.observers["*"]){var f=[].concat(this.observers["*"]);f.forEach(function(s){s.apply(s,[r].concat(a))})}}}]),t}();function Eg(){var t,e,r=new Promise(function(n,a){t=n,e=a});return r.resolve=t,r.reject=e,r}function wb(t){return t==null?"":""+t}function JA(t,e,r){t.forEach(function(n){e[n]&&(r[n]=e[n])})}function y1(t,e,r){function n(f){return f&&f.indexOf("###")>-1?f.replace(/###/g,"."):f}function a(){return!t||typeof t=="string"}for(var h=typeof e!="string"?[].concat(e):e.split(".");h.length>1;){if(a())return{};var x=n(h.shift());!t[x]&&r&&(t[x]=new r),Object.prototype.hasOwnProperty.call(t,x)?t=t[x]:t={}}return a()?{}:{obj:t,k:n(h.shift())}}function xb(t,e,r){var n=y1(t,e,Object),a=n.obj,h=n.k;a[h]=r}function ZA(t,e,r,n){var a=y1(t,e,Object),h=a.obj,x=a.k;h[x]=h[x]||[],n&&(h[x]=h[x].concat(r)),n||h[x].push(r)}function $v(t,e){var r=y1(t,e),n=r.obj,a=r.k;if(!!n)return n[a]}function eD(t,e,r){var n=$v(t,r);return n!==void 0?n:$v(e,r)}function HS(t,e,r){for(var n in e)n!=="__proto__"&&n!=="constructor"&&(n in t?typeof t[n]=="string"||t[n]instanceof String||typeof e[n]=="string"||e[n]instanceof String?r&&(t[n]=e[n]):HS(t[n],e[n],r):t[n]=e[n]);return t}function Fm(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var tD={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function rD(t){return typeof t=="string"?t.replace(/[&<>"'\/]/g,function(e){return tD[e]}):t}var uy=typeof window<"u"&&window.navigator&&typeof window.navigator.userAgentData>"u"&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,nD=[" ",",","?","!",";"];function iD(t,e,r){e=e||"",r=r||"";var n=nD.filter(function(f){return e.indexOf(f)<0&&r.indexOf(f)<0});if(n.length===0)return!0;var a=new RegExp("(".concat(n.map(function(f){return f==="?"?"\\?":f}).join("|"),")")),h=!a.test(t);if(!h){var x=t.indexOf(r);x>0&&!a.test(t.substring(0,x))&&(h=!0)}return h}function Rv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!!t){if(t[e])return t[e];for(var n=e.split(r),a=t,h=0;h<n.length;++h){if(!a||typeof a[n[h]]=="string"&&h+1<n.length)return;if(a[n[h]]===void 0){for(var x=2,f=n.slice(h,h+x).join(r),s=a[f];s===void 0&&n.length>h+x;)x++,f=n.slice(h,h+x).join(r),s=a[f];if(s===void 0)return;if(s===null)return null;if(e.endsWith(f)){if(typeof s=="string")return s;if(f&&typeof s[f]=="string")return s[f]}var d=n.slice(h+x).join(r);return d?Rv(s,d,r):void 0}a=a[n[h]]}return a}}function bb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function R_(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function sD(t){var e=oD();return function(){var n=jl(t),a;if(e){var h=jl(this).constructor;a=Reflect.construct(n,arguments,h)}else a=n.apply(this,arguments);return p_(this,a)}}function oD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aD=function(t){ly(r,t);var e=sD(r);function r(n){var a,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Ya(this,r),a=e.call(this),uy&&wf.call(_f(a)),a.data=n||{},a.options=h,a.options.keySeparator===void 0&&(a.options.keySeparator="."),a.options.ignoreJSONStructure===void 0&&(a.options.ignoreJSONStructure=!0),a}return qa(r,[{key:"addNamespaces",value:function(a){this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}},{key:"removeNamespaces",value:function(a){var h=this.options.ns.indexOf(a);h>-1&&this.options.ns.splice(h,1)}},{key:"getResource",value:function(a,h,x){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=f.keySeparator!==void 0?f.keySeparator:this.options.keySeparator,d=f.ignoreJSONStructure!==void 0?f.ignoreJSONStructure:this.options.ignoreJSONStructure,m=[a,h];x&&typeof x!="string"&&(m=m.concat(x)),x&&typeof x=="string"&&(m=m.concat(s?x.split(s):x)),a.indexOf(".")>-1&&(m=a.split("."));var o=$v(this.data,m);return o||!d||typeof x!="string"?o:Rv(this.data&&this.data[a]&&this.data[a][h],x,s)}},{key:"addResource",value:function(a,h,x,f){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1},d=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,m=[a,h];x&&(m=m.concat(d?x.split(d):x)),a.indexOf(".")>-1&&(m=a.split("."),f=h,h=m[1]),this.addNamespaces(h),xb(this.data,m,f),s.silent||this.emit("added",a,h,x,f)}},{key:"addResources",value:function(a,h,x){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(var s in x)(typeof x[s]=="string"||Object.prototype.toString.apply(x[s])==="[object Array]")&&this.addResource(a,h,s,x[s],{silent:!0});f.silent||this.emit("added",a,h,x)}},{key:"addResourceBundle",value:function(a,h,x,f,s){var d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1},m=[a,h];a.indexOf(".")>-1&&(m=a.split("."),f=x,x=h,h=m[1]),this.addNamespaces(h);var o=$v(this.data,m)||{};f?HS(o,x,s):o=R_(R_({},o),x),xb(this.data,m,o),d.silent||this.emit("added",a,h,x)}},{key:"removeResourceBundle",value:function(a,h){this.hasResourceBundle(a,h)&&delete this.data[a][h],this.removeNamespaces(h),this.emit("removed",a,h)}},{key:"hasResourceBundle",value:function(a,h){return this.getResource(a,h)!==void 0}},{key:"getResourceBundle",value:function(a,h){return h||(h=this.options.defaultNS),this.options.compatibilityAPI==="v1"?R_(R_({},{}),this.getResource(a,h)):this.getResource(a,h)}},{key:"getDataByLanguage",value:function(a){return this.data[a]}},{key:"hasLanguageSomeTranslations",value:function(a){var h=this.getDataByLanguage(a),x=h&&Object.keys(h)||[];return!!x.find(function(f){return h[f]&&Object.keys(h[f]).length>0})}},{key:"toJSON",value:function(){return this.data}}]),r}(wf),KS={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,r,n,a,h){var x=this;return e.forEach(function(f){x.processors[f]&&(r=x.processors[f].process(r,n,a,h))}),r}};function Mb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function as(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Mb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function lD(t){var e=uD();return function(){var n=jl(t),a;if(e){var h=jl(this).constructor;a=Reflect.construct(n,arguments,h)}else a=n.apply(this,arguments);return p_(this,a)}}function uD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tb={},Sb=function(t){ly(r,t);var e=lD(r);function r(n){var a,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ya(this,r),a=e.call(this),uy&&wf.call(_f(a)),JA(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],n,_f(a)),a.options=h,a.options.keySeparator===void 0&&(a.options.keySeparator="."),a.logger=Rl.create("translator"),a}return qa(r,[{key:"changeLanguage",value:function(a){a&&(this.language=a)}},{key:"exists",value:function(a){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(a==null)return!1;var x=this.resolve(a,h);return x&&x.res!==void 0}},{key:"extractFromKey",value:function(a,h){var x=h.nsSeparator!==void 0?h.nsSeparator:this.options.nsSeparator;x===void 0&&(x=":");var f=h.keySeparator!==void 0?h.keySeparator:this.options.keySeparator,s=h.ns||this.options.defaultNS||[],d=x&&a.indexOf(x)>-1,m=!this.options.userDefinedKeySeparator&&!h.keySeparator&&!this.options.userDefinedNsSeparator&&!h.nsSeparator&&!iD(a,x,f);if(d&&!m){var o=a.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:a,namespaces:s};var l=a.split(x);(x!==f||x===f&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),a=l.join(f)}return typeof s=="string"&&(s=[s]),{key:a,namespaces:s}}},{key:"translate",value:function(a,h,x){var f=this;if(To(h)!=="object"&&this.options.overloadTranslationOptionHandler&&(h=this.options.overloadTranslationOptionHandler(arguments)),To(h)==="object"&&(h=as({},h)),h||(h={}),a==null)return"";Array.isArray(a)||(a=[String(a)]);var s=h.returnDetails!==void 0?h.returnDetails:this.options.returnDetails,d=h.keySeparator!==void 0?h.keySeparator:this.options.keySeparator,m=this.extractFromKey(a[a.length-1],h),o=m.key,l=m.namespaces,u=l[l.length-1],p=h.lng||this.language,w=h.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(p&&p.toLowerCase()==="cimode"){if(w){var _=h.nsSeparator||this.options.nsSeparator;return s?{res:"".concat(u).concat(_).concat(o),usedKey:o,exactUsedKey:o,usedLng:p,usedNS:u}:"".concat(u).concat(_).concat(o)}return s?{res:o,usedKey:o,exactUsedKey:o,usedLng:p,usedNS:u}:o}var v=this.resolve(a,h),y=v&&v.res,T=v&&v.usedKey||o,C=v&&v.exactUsedKey||o,P=Object.prototype.toString.apply(y),O=["[object Number]","[object Function]","[object RegExp]"],D=h.joinArrays!==void 0?h.joinArrays:this.options.joinArrays,L=!this.i18nFormat||this.i18nFormat.handleAsObject,W=typeof y!="string"&&typeof y!="boolean"&&typeof y!="number";if(L&&y&&W&&O.indexOf(P)<0&&!(typeof D=="string"&&P==="[object Array]")){if(!h.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var U=this.options.returnedObjectHandler?this.options.returnedObjectHandler(T,y,as(as({},h),{},{ns:l})):"key '".concat(o," (").concat(this.language,")' returned an object instead of string.");return s?(v.res=U,v):U}if(d){var te=P==="[object Array]",pe=te?[]:{},ne=te?C:T;for(var ye in y)if(Object.prototype.hasOwnProperty.call(y,ye)){var ce="".concat(ne).concat(d).concat(ye);pe[ye]=this.translate(ce,as(as({},h),{joinArrays:!1,ns:l})),pe[ye]===ce&&(pe[ye]=y[ye])}y=pe}}else if(L&&typeof D=="string"&&P==="[object Array]")y=y.join(D),y&&(y=this.extendTranslation(y,a,h,x));else{var Me=!1,ke=!1,ve=h.count!==void 0&&typeof h.count!="string",K=r.hasDefaultValue(h),re=ve?this.pluralResolver.getSuffix(p,h.count,h):"",X=h["defaultValue".concat(re)]||h.defaultValue;!this.isValidLookup(y)&&K&&(Me=!0,y=X),this.isValidLookup(y)||(ke=!0,y=o);var N=h.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey,ae=N&&ke?void 0:y,J=K&&X!==y&&this.options.updateMissing;if(ke||Me||J){if(this.logger.log(J?"updateKey":"missingKey",p,u,o,J?X:y),d){var Y=this.resolve(o,as(as({},h),{},{keySeparator:!1}));Y&&Y.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var be=[],Ce=this.languageUtils.getFallbackCodes(this.options.fallbackLng,h.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Ce&&Ce[0])for(var Ue=0;Ue<Ce.length;Ue++)be.push(Ce[Ue]);else this.options.saveMissingTo==="all"?be=this.languageUtils.toResolveHierarchy(h.lng||this.language):be.push(h.lng||this.language);var Ve=function(he,Fe,ee){var we=K&&ee!==y?ee:ae;f.options.missingKeyHandler?f.options.missingKeyHandler(he,u,Fe,we,J,h):f.backendConnector&&f.backendConnector.saveMissing&&f.backendConnector.saveMissing(he,u,Fe,we,J,h),f.emit("missingKey",he,u,Fe,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&ve?be.forEach(function(Ie){f.pluralResolver.getSuffixes(Ie,h).forEach(function(he){Ve([Ie],o+he,h["defaultValue".concat(he)]||X)})}):Ve(be,o,X))}y=this.extendTranslation(y,a,h,v,x),ke&&y===o&&this.options.appendNamespaceToMissingKey&&(y="".concat(u,":").concat(o)),(ke||Me)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(o):o,Me?y:void 0):y=this.options.parseMissingKeyHandler(y))}return s?(v.res=y,v):y}},{key:"extendTranslation",value:function(a,h,x,f,s){var d=this;if(this.i18nFormat&&this.i18nFormat.parse)a=this.i18nFormat.parse(a,as(as({},this.options.interpolation.defaultVariables),x),f.usedLng,f.usedNS,f.usedKey,{resolved:f});else if(!x.skipInterpolation){x.interpolation&&this.interpolator.init(as(as({},x),{interpolation:as(as({},this.options.interpolation),x.interpolation)}));var m=typeof a=="string"&&(x&&x.interpolation&&x.interpolation.skipOnVariables!==void 0?x.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables),o;if(m){var l=a.match(this.interpolator.nestingRegexp);o=l&&l.length}var u=x.replace&&typeof x.replace!="string"?x.replace:x;if(this.options.interpolation.defaultVariables&&(u=as(as({},this.options.interpolation.defaultVariables),u)),a=this.interpolator.interpolate(a,u,x.lng||this.language,x),m){var p=a.match(this.interpolator.nestingRegexp),w=p&&p.length;o<w&&(x.nest=!1)}!x.lng&&this.options.compatibilityAPI!=="v1"&&f&&f.res&&(x.lng=f.usedLng),x.nest!==!1&&(a=this.interpolator.nest(a,function(){for(var y=arguments.length,T=new Array(y),C=0;C<y;C++)T[C]=arguments[C];return s&&s[0]===T[0]&&!x.context?(d.logger.warn("It seems you are nesting recursively key: ".concat(T[0]," in key: ").concat(h[0])),null):d.translate.apply(d,T.concat([h]))},x)),x.interpolation&&this.interpolator.reset()}var _=x.postProcess||this.options.postProcess,v=typeof _=="string"?[_]:_;return a!=null&&v&&v.length&&x.applyPostProcessor!==!1&&(a=KS.handle(v,a,h,this.options&&this.options.postProcessPassResolved?as({i18nResolved:f},x):x,this)),a}},{key:"resolve",value:function(a){var h=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f,s,d,m,o;return typeof a=="string"&&(a=[a]),a.forEach(function(l){if(!h.isValidLookup(f)){var u=h.extractFromKey(l,x),p=u.key;s=p;var w=u.namespaces;h.options.fallbackNS&&(w=w.concat(h.options.fallbackNS));var _=x.count!==void 0&&typeof x.count!="string",v=_&&!x.ordinal&&x.count===0&&h.pluralResolver.shouldUseIntlApi(),y=x.context!==void 0&&(typeof x.context=="string"||typeof x.context=="number")&&x.context!=="",T=x.lngs?x.lngs:h.languageUtils.toResolveHierarchy(x.lng||h.language,x.fallbackLng);w.forEach(function(C){h.isValidLookup(f)||(o=C,!Tb["".concat(T[0],"-").concat(C)]&&h.utils&&h.utils.hasLoadedNamespace&&!h.utils.hasLoadedNamespace(o)&&(Tb["".concat(T[0],"-").concat(C)]=!0,h.logger.warn('key "'.concat(s,'" for languages "').concat(T.join(", "),`" won't get resolved as namespace "`).concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),T.forEach(function(P){if(!h.isValidLookup(f)){m=P;var O=[p];if(h.i18nFormat&&h.i18nFormat.addLookupKeys)h.i18nFormat.addLookupKeys(O,p,P,C,x);else{var D;_&&(D=h.pluralResolver.getSuffix(P,x.count,x));var L="".concat(h.options.pluralSeparator,"zero");if(_&&(O.push(p+D),v&&O.push(p+L)),y){var W="".concat(p).concat(h.options.contextSeparator).concat(x.context);O.push(W),_&&(O.push(W+D),v&&O.push(W+L))}}for(var U;U=O.pop();)h.isValidLookup(f)||(d=U,f=h.getResource(P,C,U,x))}}))})}}),{res:f,usedKey:s,exactUsedKey:d,usedLng:m,usedNS:o}}},{key:"isValidLookup",value:function(a){return a!==void 0&&!(!this.options.returnNull&&a===null)&&!(!this.options.returnEmptyString&&a==="")}},{key:"getResource",value:function(a,h,x){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(a,h,x,f):this.resourceStore.getResource(a,h,x,f)}}],[{key:"hasDefaultValue",value:function(a){var h="defaultValue";for(var x in a)if(Object.prototype.hasOwnProperty.call(a,x)&&h===x.substring(0,h.length)&&a[x]!==void 0)return!0;return!1}}]),r}(wf);function a0(t){return t.charAt(0).toUpperCase()+t.slice(1)}var Cb=function(){function t(e){Ya(this,t),this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Rl.create("languageUtils")}return qa(t,[{key:"getScriptPartFromCode",value:function(r){if(!r||r.indexOf("-")<0)return null;var n=r.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}},{key:"getLanguagePartFromCode",value:function(r){if(!r||r.indexOf("-")<0)return r;var n=r.split("-");return this.formatLanguageCode(n[0])}},{key:"formatLanguageCode",value:function(r){if(typeof r=="string"&&r.indexOf("-")>-1){var n=["hans","hant","latn","cyrl","cans","mong","arab"],a=r.split("-");return this.options.lowerCaseLng?a=a.map(function(h){return h.toLowerCase()}):a.length===2?(a[0]=a[0].toLowerCase(),a[1]=a[1].toUpperCase(),n.indexOf(a[1].toLowerCase())>-1&&(a[1]=a0(a[1].toLowerCase()))):a.length===3&&(a[0]=a[0].toLowerCase(),a[1].length===2&&(a[1]=a[1].toUpperCase()),a[0]!=="sgn"&&a[2].length===2&&(a[2]=a[2].toUpperCase()),n.indexOf(a[1].toLowerCase())>-1&&(a[1]=a0(a[1].toLowerCase())),n.indexOf(a[2].toLowerCase())>-1&&(a[2]=a0(a[2].toLowerCase()))),a.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?r.toLowerCase():r}},{key:"isSupportedCode",value:function(r){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(r=this.getLanguagePartFromCode(r)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(r)>-1}},{key:"getBestMatchFromCodes",value:function(r){var n=this;if(!r)return null;var a;return r.forEach(function(h){if(!a){var x=n.formatLanguageCode(h);(!n.options.supportedLngs||n.isSupportedCode(x))&&(a=x)}}),!a&&this.options.supportedLngs&&r.forEach(function(h){if(!a){var x=n.getLanguagePartFromCode(h);if(n.isSupportedCode(x))return a=x;a=n.options.supportedLngs.find(function(f){if(f===x)return f;if(!(f.indexOf("-")<0&&x.indexOf("-")<0)&&f.indexOf(x)===0)return f})}}),a||(a=this.getFallbackCodes(this.options.fallbackLng)[0]),a}},{key:"getFallbackCodes",value:function(r,n){if(!r)return[];if(typeof r=="function"&&(r=r(n)),typeof r=="string"&&(r=[r]),Object.prototype.toString.apply(r)==="[object Array]")return r;if(!n)return r.default||[];var a=r[n];return a||(a=r[this.getScriptPartFromCode(n)]),a||(a=r[this.formatLanguageCode(n)]),a||(a=r[this.getLanguagePartFromCode(n)]),a||(a=r.default),a||[]}},{key:"toResolveHierarchy",value:function(r,n){var a=this,h=this.getFallbackCodes(n||this.options.fallbackLng||[],r),x=[],f=function(d){!d||(a.isSupportedCode(d)?x.push(d):a.logger.warn("rejecting language code not found in supportedLngs: ".concat(d)))};return typeof r=="string"&&r.indexOf("-")>-1?(this.options.load!=="languageOnly"&&f(this.formatLanguageCode(r)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&f(this.getScriptPartFromCode(r)),this.options.load!=="currentOnly"&&f(this.getLanguagePartFromCode(r))):typeof r=="string"&&f(this.formatLanguageCode(r)),h.forEach(function(s){x.indexOf(s)<0&&f(a.formatLanguageCode(s))}),x}}]),t}(),cD=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],dD={1:function(e){return Number(e>1)},2:function(e){return Number(e!=1)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(e==0?0:e==1?1:e==2?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(e==1?0:e>=2&&e<=4?1:2)},7:function(e){return Number(e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(e==1?0:e==2?1:e!=8&&e!=11?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(e==1?0:e==2?1:e<7?2:e<11?3:4)},11:function(e){return Number(e==1||e==11?0:e==2||e==12?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(e!==0)},14:function(e){return Number(e==1?0:e==2?1:e==3?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:e!==0?1:2)},17:function(e){return Number(e==1||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(e==0?0:e==1?1:2)},19:function(e){return Number(e==1?0:e==0||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(e==1?0:e==0||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(e==1?0:e==2?1:(e<0||e>10)&&e%10==0?2:3)}},fD=["v1","v2","v3"],Eb={zero:0,one:1,two:2,few:3,many:4,other:5};function hD(){var t={};return cD.forEach(function(e){e.lngs.forEach(function(r){t[r]={numbers:e.nr,plurals:dD[e.fc]}})}),t}var pD=function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ya(this,t),this.languageUtils=e,this.options=r,this.logger=Rl.create("pluralResolver"),(!this.options.compatibilityJSON||this.options.compatibilityJSON==="v4")&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=hD()}return qa(t,[{key:"addRule",value:function(r,n){this.rules[r]=n}},{key:"getRule",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(r,{type:n.ordinal?"ordinal":"cardinal"})}catch{return}return this.rules[r]||this.rules[this.languageUtils.getLanguagePartFromCode(r)]}},{key:"needsPlural",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.getRule(r,n);return this.shouldUseIntlApi()?a&&a.resolvedOptions().pluralCategories.length>1:a&&a.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(r,a).map(function(h){return"".concat(n).concat(h)})}},{key:"getSuffixes",value:function(r){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=this.getRule(r,a);return h?this.shouldUseIntlApi()?h.resolvedOptions().pluralCategories.sort(function(x,f){return Eb[x]-Eb[f]}).map(function(x){return"".concat(n.options.prepend).concat(x)}):h.numbers.map(function(x){return n.getSuffix(r,x,a)}):[]}},{key:"getSuffix",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},h=this.getRule(r,a);return h?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(h.select(n)):this.getSuffixRetroCompatible(h,n):(this.logger.warn("no plural rule found for: ".concat(r)),"")}},{key:"getSuffixRetroCompatible",value:function(r,n){var a=this,h=r.noAbs?r.plurals(n):r.plurals(Math.abs(n)),x=r.numbers[h];this.options.simplifyPluralSuffix&&r.numbers.length===2&&r.numbers[0]===1&&(x===2?x="plural":x===1&&(x=""));var f=function(){return a.options.prepend&&x.toString()?a.options.prepend+x.toString():x.toString()};return this.options.compatibilityJSON==="v1"?x===1?"":typeof x=="number"?"_plural_".concat(x.toString()):f():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&r.numbers.length===2&&r.numbers[0]===1?f():this.options.prepend&&h.toString()?this.options.prepend+h.toString():h.toString()}},{key:"shouldUseIntlApi",value:function(){return!fD.includes(this.options.compatibilityJSON)}}]),t}();function Pb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Ba(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Pb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ob(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,h=eD(t,e,r);return!h&&a&&typeof r=="string"&&(h=Rv(t,r,n),h===void 0&&(h=Rv(e,r,n))),h}var mD=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ya(this,t),this.logger=Rl.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(r){return r},this.init(e)}return qa(t,[{key:"init",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};r.interpolation||(r.interpolation={escapeValue:!0});var n=r.interpolation;this.escape=n.escape!==void 0?n.escape:rD,this.escapeValue=n.escapeValue!==void 0?n.escapeValue:!0,this.useRawValueToEscape=n.useRawValueToEscape!==void 0?n.useRawValueToEscape:!1,this.prefix=n.prefix?Fm(n.prefix):n.prefixEscaped||"{{",this.suffix=n.suffix?Fm(n.suffix):n.suffixEscaped||"}}",this.formatSeparator=n.formatSeparator?n.formatSeparator:n.formatSeparator||",",this.unescapePrefix=n.unescapeSuffix?"":n.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":n.unescapeSuffix||"",this.nestingPrefix=n.nestingPrefix?Fm(n.nestingPrefix):n.nestingPrefixEscaped||Fm("$t("),this.nestingSuffix=n.nestingSuffix?Fm(n.nestingSuffix):n.nestingSuffixEscaped||Fm(")"),this.nestingOptionsSeparator=n.nestingOptionsSeparator?n.nestingOptionsSeparator:n.nestingOptionsSeparator||",",this.maxReplaces=n.maxReplaces?n.maxReplaces:1e3,this.alwaysFormat=n.alwaysFormat!==void 0?n.alwaysFormat:!1,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var r="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(r,"g");var n="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(n,"g");var a="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(a,"g")}},{key:"interpolate",value:function(r,n,a,h){var x=this,f,s,d,m=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function o(_){return _.replace(/\$/g,"$$$$")}var l=function(v){if(v.indexOf(x.formatSeparator)<0){var y=Ob(n,m,v,x.options.keySeparator,x.options.ignoreJSONStructure);return x.alwaysFormat?x.format(y,void 0,a,Ba(Ba(Ba({},h),n),{},{interpolationkey:v})):y}var T=v.split(x.formatSeparator),C=T.shift().trim(),P=T.join(x.formatSeparator).trim();return x.format(Ob(n,m,C,x.options.keySeparator,x.options.ignoreJSONStructure),P,a,Ba(Ba(Ba({},h),n),{},{interpolationkey:C}))};this.resetRegExp();var u=h&&h.missingInterpolationHandler||this.options.missingInterpolationHandler,p=h&&h.interpolation&&h.interpolation.skipOnVariables!==void 0?h.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables,w=[{regex:this.regexpUnescape,safeValue:function(v){return o(v)}},{regex:this.regexp,safeValue:function(v){return x.escapeValue?o(x.escape(v)):o(v)}}];return w.forEach(function(_){for(d=0;f=_.regex.exec(r);){var v=f[1].trim();if(s=l(v),s===void 0)if(typeof u=="function"){var y=u(r,f,h);s=typeof y=="string"?y:""}else if(h&&Object.prototype.hasOwnProperty.call(h,v))s="";else if(p){s=f[0];continue}else x.logger.warn("missed to pass in variable ".concat(v," for interpolating ").concat(r)),s="";else typeof s!="string"&&!x.useRawValueToEscape&&(s=wb(s));var T=_.safeValue(s);if(r=r.replace(f[0],T),p?(_.regex.lastIndex+=s.length,_.regex.lastIndex-=f[0].length):_.regex.lastIndex=0,d++,d>=x.maxReplaces)break}}),r}},{key:"nest",value:function(r,n){var a=this,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},x,f,s;function d(u,p){var w=this.nestingOptionsSeparator;if(u.indexOf(w)<0)return u;var _=u.split(new RegExp("".concat(w,"[ ]*{"))),v="{".concat(_[1]);u=_[0],v=this.interpolate(v,s);var y=v.match(/'/g),T=v.match(/"/g);(y&&y.length%2===0&&!T||T.length%2!==0)&&(v=v.replace(/'/g,'"'));try{s=JSON.parse(v),p&&(s=Ba(Ba({},p),s))}catch(C){return this.logger.warn("failed parsing options string in nesting for key ".concat(u),C),"".concat(u).concat(w).concat(v)}return delete s.defaultValue,u}for(;x=this.nestingRegexp.exec(r);){var m=[];s=Ba({},h),s=s.replace&&typeof s.replace!="string"?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;var o=!1;if(x[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(x[1])){var l=x[1].split(this.formatSeparator).map(function(u){return u.trim()});x[1]=l.shift(),m=l,o=!0}if(f=n(d.call(this,x[1].trim(),s),s),f&&x[0]===r&&typeof f!="string")return f;typeof f!="string"&&(f=wb(f)),f||(this.logger.warn("missed to resolve ".concat(x[1]," for nesting ").concat(r)),f=""),o&&(f=m.reduce(function(u,p){return a.format(u,p,h.lng,Ba(Ba({},h),{},{interpolationkey:x[1].trim()}))},f.trim())),r=r.replace(x[0],f),this.regexp.lastIndex=0}return r}}]),t}();function kb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Uu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function gD(t){var e=t.toLowerCase().trim(),r={};if(t.indexOf("(")>-1){var n=t.split("(");e=n[0].toLowerCase().trim();var a=n[1].substring(0,n[1].length-1);if(e==="currency"&&a.indexOf(":")<0)r.currency||(r.currency=a.trim());else if(e==="relativetime"&&a.indexOf(":")<0)r.range||(r.range=a.trim());else{var h=a.split(";");h.forEach(function(x){if(!!x){var f=x.split(":"),s=YA(f),d=s[0],m=s.slice(1),o=m.join(":").trim().replace(/^'+|'+$/g,"");r[d.trim()]||(r[d.trim()]=o),o==="false"&&(r[d.trim()]=!1),o==="true"&&(r[d.trim()]=!0),isNaN(o)||(r[d.trim()]=parseInt(o,10))}})}}return{formatName:e,formatOptions:r}}function Lm(t){var e={};return function(n,a,h){var x=a+JSON.stringify(h),f=e[x];return f||(f=t(a,h),e[x]=f),f(n)}}var _D=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ya(this,t),this.logger=Rl.create("formatter"),this.options=e,this.formats={number:Lm(function(r,n){var a=new Intl.NumberFormat(r,Uu({},n));return function(h){return a.format(h)}}),currency:Lm(function(r,n){var a=new Intl.NumberFormat(r,Uu(Uu({},n),{},{style:"currency"}));return function(h){return a.format(h)}}),datetime:Lm(function(r,n){var a=new Intl.DateTimeFormat(r,Uu({},n));return function(h){return a.format(h)}}),relativetime:Lm(function(r,n){var a=new Intl.RelativeTimeFormat(r,Uu({},n));return function(h){return a.format(h,n.range||"day")}}),list:Lm(function(r,n){var a=new Intl.ListFormat(r,Uu({},n));return function(h){return a.format(h)}})},this.init(e)}return qa(t,[{key:"init",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}},a=n.interpolation;this.formatSeparator=a.formatSeparator?a.formatSeparator:a.formatSeparator||","}},{key:"add",value:function(r,n){this.formats[r.toLowerCase().trim()]=n}},{key:"addCached",value:function(r,n){this.formats[r.toLowerCase().trim()]=Lm(n)}},{key:"format",value:function(r,n,a){var h=this,x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},f=n.split(this.formatSeparator),s=f.reduce(function(d,m){var o=gD(m),l=o.formatName,u=o.formatOptions;if(h.formats[l]){var p=d;try{var w=x&&x.formatParams&&x.formatParams[x.interpolationkey]||{},_=w.locale||w.lng||x.locale||x.lng||a;p=h.formats[l](d,_,Uu(Uu(Uu({},u),x),w))}catch(v){h.logger.warn(v)}return p}else h.logger.warn("there was no format function for ".concat(l));return d},r);return s}}]),t}();function Ib(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Ab(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ib(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ib(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function vD(t){var e=yD();return function(){var n=jl(t),a;if(e){var h=jl(this).constructor;a=Reflect.construct(n,arguments,h)}else a=n.apply(this,arguments);return p_(this,a)}}function yD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function wD(t,e){t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)}var xD=function(t){ly(r,t);var e=vD(r);function r(n,a,h){var x,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ya(this,r),x=e.call(this),uy&&wf.call(_f(x)),x.backend=n,x.store=a,x.services=h,x.languageUtils=h.languageUtils,x.options=f,x.logger=Rl.create("backendConnector"),x.waitingReads=[],x.maxParallelReads=f.maxParallelReads||10,x.readingCalls=0,x.maxRetries=f.maxRetries>=0?f.maxRetries:5,x.retryTimeout=f.retryTimeout>=1?f.retryTimeout:350,x.state={},x.queue=[],x.backend&&x.backend.init&&x.backend.init(h,f.backend,f),x}return qa(r,[{key:"queueLoad",value:function(a,h,x,f){var s=this,d={},m={},o={},l={};return a.forEach(function(u){var p=!0;h.forEach(function(w){var _="".concat(u,"|").concat(w);!x.reload&&s.store.hasResourceBundle(u,w)?s.state[_]=2:s.state[_]<0||(s.state[_]===1?m[_]===void 0&&(m[_]=!0):(s.state[_]=1,p=!1,m[_]===void 0&&(m[_]=!0),d[_]===void 0&&(d[_]=!0),l[w]===void 0&&(l[w]=!0)))}),p||(o[u]=!0)}),(Object.keys(d).length||Object.keys(m).length)&&this.queue.push({pending:m,pendingCount:Object.keys(m).length,loaded:{},errors:[],callback:f}),{toLoad:Object.keys(d),pending:Object.keys(m),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(a,h,x){var f=a.split("|"),s=f[0],d=f[1];h&&this.emit("failedLoading",s,d,h),x&&this.store.addResourceBundle(s,d,x),this.state[a]=h?-1:2;var m={};this.queue.forEach(function(o){ZA(o.loaded,[s],d),wD(o,a),h&&o.errors.push(h),o.pendingCount===0&&!o.done&&(Object.keys(o.loaded).forEach(function(l){m[l]||(m[l]={});var u=o.loaded[l];u.length&&u.forEach(function(p){m[l][p]===void 0&&(m[l][p]=!0)})}),o.done=!0,o.errors.length?o.callback(o.errors):o.callback())}),this.emit("loaded",m),this.queue=this.queue.filter(function(o){return!o.done})}},{key:"read",value:function(a,h,x){var f=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,m=arguments.length>5?arguments[5]:void 0;if(!a.length)return m(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:a,ns:h,fcName:x,tried:s,wait:d,callback:m});return}this.readingCalls++;var o=function(w,_){if(f.readingCalls--,f.waitingReads.length>0){var v=f.waitingReads.shift();f.read(v.lng,v.ns,v.fcName,v.tried,v.wait,v.callback)}if(w&&_&&s<f.maxRetries){setTimeout(function(){f.read.call(f,a,h,x,s+1,d*2,m)},d);return}m(w,_)},l=this.backend[x].bind(this.backend);if(l.length===2){try{var u=l(a,h);u&&typeof u.then=="function"?u.then(function(p){return o(null,p)}).catch(o):o(null,u)}catch(p){o(p)}return}return l(a,h,o)}},{key:"prepareLoading",value:function(a,h){var x=this,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();typeof a=="string"&&(a=this.languageUtils.toResolveHierarchy(a)),typeof h=="string"&&(h=[h]);var d=this.queueLoad(a,h,f,s);if(!d.toLoad.length)return d.pending.length||s(),null;d.toLoad.forEach(function(m){x.loadOne(m)})}},{key:"load",value:function(a,h,x){this.prepareLoading(a,h,{},x)}},{key:"reload",value:function(a,h,x){this.prepareLoading(a,h,{reload:!0},x)}},{key:"loadOne",value:function(a){var h=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",f=a.split("|"),s=f[0],d=f[1];this.read(s,d,"read",void 0,void 0,function(m,o){m&&h.logger.warn("".concat(x,"loading namespace ").concat(d," for language ").concat(s," failed"),m),!m&&o&&h.logger.log("".concat(x,"loaded namespace ").concat(d," for language ").concat(s),o),h.loaded(a,m,o)})}},{key:"saveMissing",value:function(a,h,x,f,s){var d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},m=arguments.length>6&&arguments[6]!==void 0?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(h)){this.logger.warn('did not save key "'.concat(x,'" as the namespace "').concat(h,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(x==null||x==="")){if(this.backend&&this.backend.create){var o=Ab(Ab({},d),{},{isUpdate:s}),l=this.backend.create.bind(this.backend);if(l.length<6)try{var u;l.length===5?u=l(a,h,x,f,o):u=l(a,h,x,f),u&&typeof u.then=="function"?u.then(function(p){return m(null,p)}).catch(m):m(null,u)}catch(p){m(p)}else l(a,h,x,f,m,o)}!a||!a[0]||this.store.addResource(a[0],h,x,f)}}}]),r}(wf);function Db(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var r={};if(To(e[1])==="object"&&(r=e[1]),typeof e[1]=="string"&&(r.defaultValue=e[1]),typeof e[2]=="string"&&(r.tDescription=e[2]),To(e[2])==="object"||To(e[3])==="object"){var n=e[3]||e[2];Object.keys(n).forEach(function(a){r[a]=n[a]})}return r},interpolation:{escapeValue:!0,format:function(e,r,n,a){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Fb(t){return typeof t.ns=="string"&&(t.ns=[t.ns]),typeof t.fallbackLng=="string"&&(t.fallbackLng=[t.fallbackLng]),typeof t.fallbackNS=="string"&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t}function Lb(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Dl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Lb(Object(r),!0).forEach(function(n){Nl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function bD(t){var e=MD();return function(){var n=jl(t),a;if(e){var h=jl(this).constructor;a=Reflect.construct(n,arguments,h)}else a=n.apply(this,arguments);return p_(this,a)}}function MD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function B_(){}function TD(t){var e=Object.getOwnPropertyNames(Object.getPrototypeOf(t));e.forEach(function(r){typeof t[r]=="function"&&(t[r]=t[r].bind(t))})}var Bv=function(t){ly(r,t);var e=bD(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1?arguments[1]:void 0;if(Ya(this,r),n=e.call(this),uy&&wf.call(_f(n)),n.options=Fb(a),n.services={},n.logger=Rl,n.modules={external:[]},TD(_f(n)),h&&!n.isInitialized&&!a.isClone){if(!n.options.initImmediate)return n.init(a,h),p_(n,_f(n));setTimeout(function(){n.init(a,h)},0)}return n}return qa(r,[{key:"init",value:function(){var a=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=arguments.length>1?arguments[1]:void 0;typeof h=="function"&&(x=h,h={}),!h.defaultNS&&h.defaultNS!==!1&&h.ns&&(typeof h.ns=="string"?h.defaultNS=h.ns:h.ns.indexOf("translation")<0&&(h.defaultNS=h.ns[0]));var f=Db();this.options=Dl(Dl(Dl({},f),this.options),Fb(h)),this.options.compatibilityAPI!=="v1"&&(this.options.interpolation=Dl(Dl({},f.interpolation),this.options.interpolation)),h.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=h.keySeparator),h.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=h.nsSeparator);function s(v){return v?typeof v=="function"?new v:v:null}if(!this.options.isClone){this.modules.logger?Rl.init(s(this.modules.logger),this.options):Rl.init(null,this.options);var d;this.modules.formatter?d=this.modules.formatter:typeof Intl<"u"&&(d=_D);var m=new Cb(this.options);this.store=new aD(this.options.resources,this.options);var o=this.services;o.logger=Rl,o.resourceStore=this.store,o.languageUtils=m,o.pluralResolver=new pD(m,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===f.interpolation.format)&&(o.formatter=s(d),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new mD(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new xD(s(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",function(v){for(var y=arguments.length,T=new Array(y>1?y-1:0),C=1;C<y;C++)T[C-1]=arguments[C];a.emit.apply(a,[v].concat(T))}),this.modules.languageDetector&&(o.languageDetector=s(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=s(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new Sb(this.services,this.options),this.translator.on("*",function(v){for(var y=arguments.length,T=new Array(y>1?y-1:0),C=1;C<y;C++)T[C-1]=arguments[C];a.emit.apply(a,[v].concat(T))}),this.modules.external.forEach(function(v){v.init&&v.init(a)})}if(this.format=this.options.interpolation.format,x||(x=B_),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined");var u=["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"];u.forEach(function(v){a[v]=function(){var y;return(y=a.store)[v].apply(y,arguments)}});var p=["addResource","addResources","addResourceBundle","removeResourceBundle"];p.forEach(function(v){a[v]=function(){var y;return(y=a.store)[v].apply(y,arguments),a}});var w=Eg(),_=function(){var y=function(C,P){a.isInitialized&&!a.initializedStoreOnce&&a.logger.warn("init: i18next is already initialized. You should call init just once!"),a.isInitialized=!0,a.options.isClone||a.logger.log("initialized",a.options),a.emit("initialized",a.options),w.resolve(P),x(C,P)};if(a.languages&&a.options.compatibilityAPI!=="v1"&&!a.isInitialized)return y(null,a.t.bind(a));a.changeLanguage(a.options.lng,y)};return this.options.resources||!this.options.initImmediate?_():setTimeout(_,0),w}},{key:"loadResources",value:function(a){var h=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:B_,f=x,s=typeof a=="string"?a:this.language;if(typeof a=="function"&&(f=a),!this.options.resources||this.options.partialBundledLanguages){if(s&&s.toLowerCase()==="cimode")return f();var d=[],m=function(u){if(!!u){var p=h.services.languageUtils.toResolveHierarchy(u);p.forEach(function(w){d.indexOf(w)<0&&d.push(w)})}};if(s)m(s);else{var o=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);o.forEach(function(l){return m(l)})}this.options.preload&&this.options.preload.forEach(function(l){return m(l)}),this.services.backendConnector.load(d,this.options.ns,function(l){!l&&!h.resolvedLanguage&&h.language&&h.setResolvedLanguage(h.language),f(l)})}else f(null)}},{key:"reloadResources",value:function(a,h,x){var f=Eg();return a||(a=this.languages),h||(h=this.options.ns),x||(x=B_),this.services.backendConnector.reload(a,h,function(s){f.resolve(),x(s)}),f}},{key:"use",value:function(a){if(!a)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!a.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return a.type==="backend"&&(this.modules.backend=a),(a.type==="logger"||a.log&&a.warn&&a.error)&&(this.modules.logger=a),a.type==="languageDetector"&&(this.modules.languageDetector=a),a.type==="i18nFormat"&&(this.modules.i18nFormat=a),a.type==="postProcessor"&&KS.addPostProcessor(a),a.type==="formatter"&&(this.modules.formatter=a),a.type==="3rdParty"&&this.modules.external.push(a),this}},{key:"setResolvedLanguage",value:function(a){if(!(!a||!this.languages)&&!(["cimode","dev"].indexOf(a)>-1))for(var h=0;h<this.languages.length;h++){var x=this.languages[h];if(!(["cimode","dev"].indexOf(x)>-1)&&this.store.hasLanguageSomeTranslations(x)){this.resolvedLanguage=x;break}}}},{key:"changeLanguage",value:function(a,h){var x=this;this.isLanguageChangingTo=a;var f=Eg();this.emit("languageChanging",a);var s=function(l){x.language=l,x.languages=x.services.languageUtils.toResolveHierarchy(l),x.resolvedLanguage=void 0,x.setResolvedLanguage(l)},d=function(l,u){u?(s(u),x.translator.changeLanguage(u),x.isLanguageChangingTo=void 0,x.emit("languageChanged",u),x.logger.log("languageChanged",u)):x.isLanguageChangingTo=void 0,f.resolve(function(){return x.t.apply(x,arguments)}),h&&h(l,function(){return x.t.apply(x,arguments)})},m=function(l){!a&&!l&&x.services.languageDetector&&(l=[]);var u=typeof l=="string"?l:x.services.languageUtils.getBestMatchFromCodes(l);u&&(x.language||s(u),x.translator.language||x.translator.changeLanguage(u),x.services.languageDetector&&x.services.languageDetector.cacheUserLanguage&&x.services.languageDetector.cacheUserLanguage(u)),x.loadResources(u,function(p){d(p,u)})};return!a&&this.services.languageDetector&&!this.services.languageDetector.async?m(this.services.languageDetector.detect()):!a&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(m):this.services.languageDetector.detect(m):m(a),f}},{key:"getFixedT",value:function(a,h,x){var f=this,s=function d(m,o){var l;if(To(o)!=="object"){for(var u=arguments.length,p=new Array(u>2?u-2:0),w=2;w<u;w++)p[w-2]=arguments[w];l=f.options.overloadTranslationOptionHandler([m,o].concat(p))}else l=Dl({},o);l.lng=l.lng||d.lng,l.lngs=l.lngs||d.lngs,l.ns=l.ns||d.ns,l.keyPrefix=l.keyPrefix||x||d.keyPrefix;var _=f.options.keySeparator||".",v;return l.keyPrefix&&Array.isArray(m)?v=m.map(function(y){return"".concat(l.keyPrefix).concat(_).concat(y)}):v=l.keyPrefix?"".concat(l.keyPrefix).concat(_).concat(m):m,f.t(v,l)};return typeof a=="string"?s.lng=a:s.lngs=a,s.ns=h,s.keyPrefix=x,s}},{key:"t",value:function(){var a;return this.translator&&(a=this.translator).translate.apply(a,arguments)}},{key:"exists",value:function(){var a;return this.translator&&(a=this.translator).exists.apply(a,arguments)}},{key:"setDefaultNamespace",value:function(a){this.options.defaultNS=a}},{key:"hasLoadedNamespace",value:function(a){var h=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var f=x.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,d=this.languages[this.languages.length-1];if(f.toLowerCase()==="cimode")return!0;var m=function(u,p){var w=h.services.backendConnector.state["".concat(u,"|").concat(p)];return w===-1||w===2};if(x.precheck){var o=x.precheck(this,m);if(o!==void 0)return o}return!!(this.hasResourceBundle(f,a)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||m(f,a)&&(!s||m(d,a)))}},{key:"loadNamespaces",value:function(a,h){var x=this,f=Eg();return this.options.ns?(typeof a=="string"&&(a=[a]),a.forEach(function(s){x.options.ns.indexOf(s)<0&&x.options.ns.push(s)}),this.loadResources(function(s){f.resolve(),h&&h(s)}),f):(h&&h(),Promise.resolve())}},{key:"loadLanguages",value:function(a,h){var x=Eg();typeof a=="string"&&(a=[a]);var f=this.options.preload||[],s=a.filter(function(d){return f.indexOf(d)<0});return s.length?(this.options.preload=f.concat(s),this.loadResources(function(d){x.resolve(),h&&h(d)}),x):(h&&h(),Promise.resolve())}},{key:"dir",value:function(a){if(a||(a=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!a)return"rtl";var h=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],x=this.services&&this.services.languageUtils||new Cb(Db());return h.indexOf(x.getLanguagePartFromCode(a))>-1||a.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var a=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:B_,f=Dl(Dl(Dl({},this.options),h),{isClone:!0}),s=new r(f);(h.debug!==void 0||h.prefix!==void 0)&&(s.logger=s.logger.clone(h));var d=["store","services","language"];return d.forEach(function(m){s[m]=a[m]}),s.services=Dl({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new Sb(s.services,s.options),s.translator.on("*",function(m){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];s.emit.apply(s,[m].concat(l))}),s.init(f,x),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),r}(wf);Nl(Bv,"createInstance",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;return new Bv(t,e)});var Is=Bv.createInstance();Is.createInstance=Bv.createInstance;Is.createInstance;Is.dir;Is.init;Is.loadResources;Is.reloadResources;Is.use;Is.changeLanguage;Is.getFixedT;Is.t;Is.exists;Is.setDefaultNamespace;Is.hasLoadedNamespace;Is.loadNamespaces;Is.loadLanguages;export{D1 as A,Uk as F,BD as P,Lp as R,vA as S,VD as _,DO as a,AD as b,CD as c,kD as d,DD as e,aO as f,PD as g,FD as h,RD as i,Wa as j,wn as k,Qx as l,yA as m,zD as n,ND as o,ED as p,UD as q,Wr as r,OD as s,WD as t,LD as u,ID as v,GD as w,jD as x,Is as y,$D as z};
